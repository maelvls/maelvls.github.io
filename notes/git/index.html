<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.147.6"><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=author content="Ma√´l Valais"><meta name=description content><meta property="og:url" content="https://maelvls.dev/notes/git/"><meta property="og:site_name" content="maelvls dev blog"><meta property="og:title" content="git stash vs. git reset --hard"><meta property="og:description" content="Many times, I used git reset --hard and found out later that all my changes had disappeared. I think this is because I do not fully understand what git reset --hard does:
move the branch ref pointer to the given reference set HEAD to this ref Depending on the option: ‚Äìsoft: working dir and stage are not touched, useful when git reset --hard HEAD^ to change the content of the commit without having to re-add everything ‚Äìmixed: working dir is not touched, but the stage is set to match the HEAD ‚Äìhard: stage + working dir are set to match the HEAD On the other side, git stash will set stage + working dir to match the HEAD."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2017-12-20T00:00:00+00:00"><meta property="article:modified_time" content="2017-12-20T00:00:00+00:00"><meta property="og:image" content="https://maelvls.dev/img/mael.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://maelvls.dev/img/mael.jpg"><meta name=twitter:title content="git stash vs. git reset --hard"><meta name=twitter:description content="Many times, I used git reset --hard and found out later that all my changes had disappeared. I think this is because I do not fully understand what git reset --hard does:
move the branch ref pointer to the given reference set HEAD to this ref Depending on the option: ‚Äìsoft: working dir and stage are not touched, useful when git reset --hard HEAD^ to change the content of the commit without having to re-add everything ‚Äìmixed: working dir is not touched, but the stage is set to match the HEAD ‚Äìhard: stage + working dir are set to match the HEAD On the other side, git stash will set stage + working dir to match the HEAD."><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=https://maelvls.dev/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://maelvls.dev/css/main.css><link rel=stylesheet type=text/css media=screen href=https://maelvls.dev/css/all.css><link rel=stylesheet type=text/css media=screen href=https://maelvls.dev/css/maelvls.css><title>git stash vs. git reset --hard | maelvls dev blog</title></head><body><header><div id=avatar><a href=https://maelvls.dev/><img src=/img/mael.jpg alt="maelvls dev blog"></a></div><div id=titletext><h2 id=title><a href=https://maelvls.dev/>maelvls dev blog</a></h2></div><div id=title-description><p id=subtitle>Systems software engineer. I write mostly about Kubernetes and Go. <a href=/about/>About</a></p><div id=social><nav><ul><li><a href=https://github.com/maelvls><i title=Github class="icons fab fa-github"></i></a></li><li><a href=https://x.com/maelvls><i title=X class="icons fab fa-x"></i></a></li><li><a href=https://dev.to/maelvls><i title="Ma√´l Valais's DEV Community Profile" class="icons fab fa-dev"></i></a></li></ul></nav></div></div><div id=mainmenu></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>20</span>
<span class=rest>Dec2017</span></div></div><div class=matter><h1 class=title>git stash vs. git reset --hard</h1></div></div><div class=markdown><p>Many times, I used <code>git reset --hard</code> and found out later that all my changes had disappeared. I think this is because I do not fully understand what <code>git reset --hard</code> does:</p><ol><li>move the branch ref pointer to the given reference</li><li>set HEAD to this ref</li><li>Depending on the option:</li></ol><ul><li>&ndash;soft: working dir and stage are not touched, useful when <code>git reset --hard HEAD^</code> to change the content of the commit without having to re-add everything</li><li>&ndash;mixed: working dir is not touched, but the stage is set to match the HEAD</li><li>&ndash;hard: stage + working dir are set to match the HEAD</li></ul><p>On the other side, <code>git stash</code> will set stage + working dir to match the HEAD.</p><p>So instead of <code>git reset --hard REF</code> I should rather do <code>git stash && git reset --hard REF</code>. This would avoid cases where I forgot that I had made changes&mldr; and end up losing them all.</p><p>IDEAS ON NEW COMMANDS</p><ul><li>I often have committed something like @~0: edit touist.rb @~1: edit .travis.yml</li></ul><p>I want to add a command like <code>git ci --amend~2</code> that would amend the commit in @~1, not the HEAD. Here is what I must do:</p><pre><code>vim .travis.yml
git stash
git rb -i @^^ # edit HEAD^
git stash pop
git add .travis.yml
git ci --amend
git rb --continue
</code></pre><p>Facebook&rsquo;s hg extensions have &lsquo;absorb&rsquo; which does this but on @~1, @~2&mldr; and chooses automatically in which commit it should be amended. See:</p><ul><li><a href=https://stackoverflow.com/questions/24625411/amend-the-second-to-last-commit>https://stackoverflow.com/questions/24625411/amend-the-second-to-last-commit</a></li><li><a href=https://blog.filippo.io/git-fixup-amending-an-older-commit/>https://blog.filippo.io/git-fixup-amending-an-older-commit/</a></li></ul></div><a href=https://github.com/maelvls/maelvls.github.io/edit/source/content/notes/git.md>üìù Edit this page</a><div class=tags></div><div style="background-color:#fee;color:#000;padding:10px;border:1px solid red;margin:10px 0">DEBUG: DisableComments value is: (type: &lt;nil>)</div><script src=https://utteranc.es/client.js repo=maelvls/maelvls.github.io issue-term=pathname label=üí¨ theme=github-light crossorigin=anonymous async></script></div></main><footer></footer></body></html>