[{"authors":null,"categories":null,"content":"\u003ch2 id=\"terms\"\u003eTerms\u003c/h2\u003e\n\u003cp\u003eA domain name (or just \u0026ldquo;domain\u0026rdquo;) is a string the form \u003ccode\u003ebar.foo.com.\u003c/code\u003e. Not all domains refer to physical machines; for example, one of my domains, \u003ccode\u003ek.maelvls.dev.\u003c/code\u003e, do not point to any physical machine.\u003c/p\u003e\n\u003cp\u003eWe often represent the domain name space using a tree. Each node is a domain. Leaves and nodes may have \u003ccode\u003eA\u003c/code\u003e records. Here is a simple example of the domain space represented as a tree:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e.\n├── com.\n├── dev.\n│  └── maelvls.dev.\n│     └── k.maelvls.dev.\n└── io.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA \u003ca href=\"https://tools.ietf.org/html/rfc1034#section-2.4\" title=\"Elements of a DNS\"\u003ezone\u003c/a\u003e is a subtree of the domain space that is under the authority of a given name server. In the following, I will use \u0026ldquo;subtree\u0026rdquo; and \u0026ldquo;zone\u0026rdquo; interchangeably and I identify a zone (or subtree) by its apex domain; the apex is domain name at the root of a zone.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI decided to put domain names directly in each node; note that the \u003ca href=\"https://tools.ietf.org/html/rfc1034#section-3.1\" title=\"Domain space\"\u003eRFC 1034\u003c/a\u003e represents the domain space as a tree of labels (a label is of the form \u003ccode\u003efoo\u003c/code\u003e or \u003ccode\u003efoo-bar\u003c/code\u003e). In this tree, the domain name of a node has to be reconstructed by concatenating the labels starting from the node and ending with the root of the domain space tree.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eFrom the above example, my zone is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003emaelvls.dev.\n└── k.maelvls.dev.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA zone has \u0026ldquo;authority\u0026rdquo; over its subtree as long as one of its parent domains has an \u003ccode\u003eNS\u003c/code\u003e record to a name server that has the records for that zone. I told my registrar (Google Domains) to use the Google DNS name servers, which means that the \u003ccode\u003edev.\u003c/code\u003e name servers now have \u003ccode\u003eNS\u003c/code\u003e records that point to Google DNS' name servers. With this \u003ccode\u003eNS\u003c/code\u003e record, the \u003ccode\u003edev.\u003c/code\u003e zone \u0026ldquo;delegates\u0026rdquo; the \u003ccode\u003emaelvls.dev.\u003c/code\u003e zone to Google DNS' name servers.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: recursivity and delegation are different: a recursive DNS makes the subsequent calls on behalf of its client, while delegating a DNS zone means that a certain domain of a zone is \u0026ldquo;forwarded\u0026rdquo; to another name server using the \u003ccode\u003eNS\u003c/code\u003e record.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eFor example, let us use \u003ccode\u003edig\u003c/code\u003e to see all intermediate DNS queries at once:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% dig +trace minio.k.maelvls.dev\n\u003cspan class=\"c1\"\u003e# I omitted the DNSSEC-related records (RRSIG, DS and NSEC3 records).\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# I also omitted some NS records when there was too many of them.\u003c/span\u003e\n.                              \u003cspan class=\"m\"\u003e342831\u003c/span\u003e  IN  NS     a.root-servers.net.\n.                              \u003cspan class=\"m\"\u003e342831\u003c/span\u003e  IN  NS     b.root-servers.net.\ndev.                           \u003cspan class=\"m\"\u003e172800\u003c/span\u003e  IN  NS     ns-tld1.charlestonroadregistry.com.\ndev.                           \u003cspan class=\"m\"\u003e172800\u003c/span\u003e  IN  NS     ns-tld2.charlestonroadregistry.com.\nmaelvls.dev.                   \u003cspan class=\"m\"\u003e10800\u003c/span\u003e   IN  NS     ns-cloud-a1.googledomains.com.\nmaelvls.dev.                   \u003cspan class=\"m\"\u003e10800\u003c/span\u003e   IN  NS     ns-cloud-a2.googledomains.com.\nmaelvls.dev.                   \u003cspan class=\"m\"\u003e300\u003c/span\u003e     IN  SOA   ns-cloud-a1.googledomains.com. ...\nminio.k.maelvls.dev.           \u003cspan class=\"m\"\u003e300\u003c/span\u003e     IN  A       91.211.152.190\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"client-side-name-guessing\"\u003eClient-side name guessing\u003c/h2\u003e\n\u003cp\u003eIn some cases, the DNS query may omit the right-most part of the domain. For example, in Kubernetes, you may either use the fully-qualified domain name (FQDN, which is a domain that contains the \u003ccode\u003e.\u003c/code\u003e root domain), or just use a part of the domain name:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003enslookup kubernetes.default.svc.cluster.local    \u003cspan class=\"c1\"\u003e# works (FQDN)\u003c/span\u003e\nnslookup kubernetes.default.svc.cluster          \u003cspan class=\"c1\"\u003e# doesn\u0026#39;t work\u003c/span\u003e\nnslookup kubernetes.default.svc                  \u003cspan class=\"c1\"\u003e# works\u003c/span\u003e\nnslookup kubernetes.default                      \u003cspan class=\"c1\"\u003e# works\u003c/span\u003e\nnslookup kubernetes                              \u003cspan class=\"c1\"\u003e# works (guesses namespace)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn CoreDNS, you can give the apex domain name (by default, in Kubernetes, the apex is \u003ccode\u003ecluster.local.\u003c/code\u003e). The Corefile needs to load the \u003ca href=\"https://github.com/coredns/coredns/tree/master/plugin/kubernetes\"\u003ekubernetes plugin\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e.:53 \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    kubernetes cluster.local\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eNote that \u003ccode\u003ekubernetes.default\u003c/code\u003e is not a subdomain; a \u003ca href=\"https://tools.ietf.org/html/rfc7719\" title=\"DNS terminology\"\u003esubdomain\u003c/a\u003e of a domain is a domain that contains the domain itself on it right-most side.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003eminio.k.maelvls.dev   is subdomain of     k.maelvls.dev\nminio.k.maelvls.dev   is subdomain of       maelvls.dev\nk.maelvls.dev         is subdomain of       maelvls.dev\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/blockquote\u003e\n\u003cp\u003eWhenever a container is given to resolve any kind of name (even one that looks like an FQDN; the client doesn\u0026rsquo;t known, really), it will go through the \u0026ldquo;search domain names\u0026rdquo; list configured in \u003ccode\u003e/etc/resolv.conf\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% cat /etc/resolv.conf\nsearch default.svc.cluster.local svc.cluster.local cluster.local\nnameserver 10.96.0.10\noptions ndots:5\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s try with \u003ccode\u003ekubernetes.default\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% tcpdump \u003cspan class=\"s2\"\u003e\u0026#34;udp port 53\u0026#34;\u003c/span\u003e\n% nslookup kubernetes.default\n12:01:17.430931 IP foo.39435 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 32862+ A? kubernetes.default.default.svc.cluster.local. \u003cspan class=\"o\"\u003e(\u003c/span\u003e62\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n12:01:17.431573 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.39435: \u003cspan class=\"m\"\u003e32862\u003c/span\u003e NXDomain*- 0/1/0 \u003cspan class=\"o\"\u003e(\u003c/span\u003e155\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n12:01:17.431987 IP foo.35023 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 39314+ A? kubernetes.default.svc.cluster.local. \u003cspan class=\"o\"\u003e(\u003c/span\u003e54\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n12:01:17.433258 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.35023: 39314*- 1/0/0 A 10.96.0.1 \u003cspan class=\"o\"\u003e(\u003c/span\u003e106\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nServer:\t\t10.96.0.10\nAddress:\t10.96.0.10#53\n\nName:\tkubernetes.default.svc.cluster.local\nAddress: 10.96.0.1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe client (the container \u003ccode\u003efoo\u003c/code\u003e) has to do two consecutive queries in order to get an answer; as you can see, the way partial domain name guessing is done is quite dumb and relies on many client-side queries:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003equeried name\u003c/th\u003e\n\u003cth\u003equeries count\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubernetes\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubernetes.default\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubernetes.default.svc\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubernetes.default.svc.cluster\u003c/td\u003e\n\u003ctd\u003e(*)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubernetes.default.svc.cluster.local\u003c/td\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efoo (the container\u0026rsquo;s name)\u003c/td\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003egoogle.com\u003c/td\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(*) since the search domain name \u003ccode\u003ecluster\u003c/code\u003e doesn\u0026rsquo;t exist in \u003ccode\u003e/etc/resolv.conf\u003c/code\u003e, this name can\u0026rsquo;t be resolved.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eI noticed something unexpected when querying \u003ccode\u003efoo\u003c/code\u003e (which is the container\u0026rsquo;s name). I was expecting the name to be picked from \u003ccode\u003e/etc/hosts\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% cat /etc/hosts\n\u003cspan class=\"c1\"\u003e# Kubernetes-managed hosts file.\u003c/span\u003e\n127.0.0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nfe00::0\tip6-mcastprefix\nfe00::1\tip6-allnodes\nfe00::2\tip6-allrouters\n10.244.0.14\tfoo                     \u003cspan class=\"c1\"\u003e# this!\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eBut weirdly enough, \u003ccode\u003efoo\u003c/code\u003e is resolved by the name server:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% hostname\nfoo\n% tcpdump \u003cspan class=\"s2\"\u003e\u0026#34;udp port 53\u0026#34;\u003c/span\u003e\n% nslookup foo\n10:35:09.052394 IP foo.58416 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 39460+ A? foo.default.svc.cluster.local. \u003cspan class=\"o\"\u003e(\u003c/span\u003e47\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:35:09.052993 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.58416: \u003cspan class=\"m\"\u003e39460\u003c/span\u003e NXDomain*- 0/1/0 \u003cspan class=\"o\"\u003e(\u003c/span\u003e140\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:35:09.053708 IP foo.53273 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 3313+ A? foo.svc.cluster.local. \u003cspan class=\"o\"\u003e(\u003c/span\u003e39\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:35:09.054315 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.53273: \u003cspan class=\"m\"\u003e3313\u003c/span\u003e NXDomain*- 0/1/0 \u003cspan class=\"o\"\u003e(\u003c/span\u003e132\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:35:09.055023 IP foo.44989 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 19225+ A? foo.cluster.local. \u003cspan class=\"o\"\u003e(\u003c/span\u003e35\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:35:09.056578 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.44989: \u003cspan class=\"m\"\u003e19225\u003c/span\u003e NXDomain*- 0/1/0 \u003cspan class=\"o\"\u003e(\u003c/span\u003e128\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:35:09.057185 IP foo.39326 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 2052+ A? foo. \u003cspan class=\"o\"\u003e(\u003c/span\u003e21\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:35:09.060754 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.39326: \u003cspan class=\"m\"\u003e2052\u003c/span\u003e 1/0/0 A 127.0.0.1 \u003cspan class=\"o\"\u003e(\u003c/span\u003e40\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nServer:\t\t10.96.0.10\nAddress:\t10.96.0.10#53\n\nNon-authoritative answer:\nName:\tfoo\nAddress: 127.0.0.1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhenever a container queries a name that is outside of Kubernetes, it has to go through all these four NSDOMA ` before actually getting a response:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% tcpdump \u003cspan class=\"s2\"\u003e\u0026#34;udp port 53\u0026#34;\u003c/span\u003e\n% nslookup google.com\n10:40:12.569439 IP foo.49028 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 33319+ A? google.com.default.svc.cluster.local. \u003cspan class=\"o\"\u003e(\u003c/span\u003e54\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:40:12.572349 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.49028: \u003cspan class=\"m\"\u003e33319\u003c/span\u003e NXDomain*- 0/1/0 \u003cspan class=\"o\"\u003e(\u003c/span\u003e147\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:40:12.572970 IP foo.54948 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 48254+ A? google.com.svc.cluster.local. \u003cspan class=\"o\"\u003e(\u003c/span\u003e46\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:40:12.573828 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.54948: \u003cspan class=\"m\"\u003e48254\u003c/span\u003e NXDomain*- 0/1/0 \u003cspan class=\"o\"\u003e(\u003c/span\u003e139\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:40:12.574303 IP foo.56236 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 26722+ A? google.com.cluster.local. \u003cspan class=\"o\"\u003e(\u003c/span\u003e42\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:40:12.574865 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.56236: \u003cspan class=\"m\"\u003e26722\u003c/span\u003e NXDomain*- 0/1/0 \u003cspan class=\"o\"\u003e(\u003c/span\u003e135\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:40:12.576272 IP foo.48021 \u0026gt; kube-dns.kube-system.svc.cluster.local.53: 2652+ A? google.com. \u003cspan class=\"o\"\u003e(\u003c/span\u003e28\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n10:40:12.609035 IP kube-dns.kube-system.svc.cluster.local.53 \u0026gt; foo.48021: \u003cspan class=\"m\"\u003e2652\u003c/span\u003e 1/0/0 A 172.217.18.206 \u003cspan class=\"o\"\u003e(\u003c/span\u003e54\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nServer:\t\t10.96.0.10\nAddress:\t10.96.0.10#53\n\nNon-authoritative answer:\nName:\tgoogle.com\nAddress: 172.217.18.206\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe DHCP answer from my router contains the \u003ca href=\"https://tools.ietf.org/html/rfc2132#section-3.17\"\u003eoption header 15\u003c/a\u003e \u0026ldquo;Domain Name\u0026rdquo;; in my case, the only domain name returned is \u003ccode\u003ehome\u003c/code\u003e. Which means that anytime the client (my machine) wants to query a name, say \u003ccode\u003emacbook-pro\u003c/code\u003e, it will try in this order:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003emacbook-pro.home.\nmacbook-pro.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHere is a capture of my machine trying to figure out the name \u003ccode\u003emacbook-pro\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% tcpdump -ien0 \u003cspan class=\"s1\"\u003e\u0026#39;(udp port 53 \u0026amp;\u0026amp; (src 192.168.1.1 || dst 192.168.1.1))\u0026#39;\u003c/span\u003e\nlistening on en0, link-type EN10MB \u003cspan class=\"o\"\u003e(\u003c/span\u003eEthernet\u003cspan class=\"o\"\u003e)\u003c/span\u003e, capture size \u003cspan class=\"m\"\u003e262144\u003c/span\u003e bytes\n12:04:34.873178 IP 192.168.1.14.58108 \u0026gt; 192.168.1.1.domain: 1698+ A? macbook-pro.home. \u003cspan class=\"o\"\u003e(\u003c/span\u003e41\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n12:04:34.924824 IP 192.168.1.1.domain \u0026gt; 192.168.1.14.58108: \u003cspan class=\"m\"\u003e1698\u003c/span\u003e NXDomain 0/1/0 \u003cspan class=\"o\"\u003e(\u003c/span\u003e116\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n12:04:34.925217 IP 192.168.1.14.53531 \u0026gt; 192.168.1.1.domain: 9166+ A? macbook-pro. \u003cspan class=\"o\"\u003e(\u003c/span\u003e39\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n12:04:34.948013 IP 192.168.1.1.domain \u0026gt; 192.168.1.14.53531: 9166* 2/0/0 A 192.168.1.14, A 192.168.1.21 \u003cspan class=\"o\"\u003e(\u003c/span\u003e71\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003ea hierarchical DNS (also called DNS chaining or DNS delegation) is when a DNS has a record \u003ccode\u003eNS\u003c/code\u003e to another DNS server.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOne single \u003ca href=\"https://simpledns.plus/help/soa-records\"\u003eSOA record\u003c/a\u003e (start of authority) exists for every given zone. As you can see here, my zone is \u003ccode\u003emaelvls.dev.\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"playing-with-k8s_gateway\"\u003ePlaying with \u003ccode\u003ek8s_gateway\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003eThe Corefile is available \u003ca href=\"https://github.com/maelvls/k.maelvls.dev/blob/0e77a838251b209646f433a2b1d5e1a440f8e856/helm/ext-coredns.yaml#L13-L31\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eBefore, my top-level DNS would be littered with records created by ExternalDNS:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud dns record-sets list --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003emaelvls\nNAME                      TYPE   TTL    DATA\nmaelvls.dev.              A      \u003cspan class=\"m\"\u003e300\u003c/span\u003e    185.199.108.153,185.199.109.153,185.199.110.153,185.199.111.153\nmaelvls.dev.              MX     \u003cspan class=\"m\"\u003e300\u003c/span\u003e    \u003cspan class=\"m\"\u003e1\u003c/span\u003e aspmx.l.google.com.,5 alt1.aspmx.l.google.com.,5 alt2.aspmx.l.google.com.,10 alt3.aspmx.l.google.com.,10 alt4.aspmx.l.google.com.,15 pdquboxtbnqki2zinxaksc3jnnluefibfdbqhi7ghbhfbg7ef47q.mx-verification.google.com.\nmaelvls.dev.              NS     \u003cspan class=\"m\"\u003e21600\u003c/span\u003e  ns-cloud-a1.googledomains.com.,ns-cloud-a2.googledomains.com.,ns-cloud-a3.googledomains.com.,ns-cloud-a4.googledomains.com.\nmaelvls.dev.              SOA    \u003cspan class=\"m\"\u003e21600\u003c/span\u003e  ns-cloud-a1.googledomains.com. cloud-dns-hostmaster.google.com. \u003cspan class=\"m\"\u003e12\u003c/span\u003e \u003cspan class=\"m\"\u003e21600\u003c/span\u003e \u003cspan class=\"m\"\u003e3600\u003c/span\u003e \u003cspan class=\"m\"\u003e259200\u003c/span\u003e \u003cspan class=\"m\"\u003e300\u003c/span\u003e\nmaelvls.dev.              TXT    \u003cspan class=\"m\"\u003e300\u003c/span\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;keybase-site-verification=PnIWsZlbzCGwYrc5J_VCVphBOMHCVjcIx6nMSkeCZzI\u0026#34;\u003c/span\u003e\nconcourse.k.maelvls.dev.  A      \u003cspan class=\"m\"\u003e300\u003c/span\u003e    91.211.152.190\nconcourse.k.maelvls.dev.  TXT    \u003cspan class=\"m\"\u003e300\u003c/span\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;heritage=external-dns,external-dns/owner=k8s,external-dns/resource=ingress/concourse/cm-acme-http-solver-xlvtk\u0026#34;\u003c/span\u003e\ndrone.k.maelvls.dev.      A      \u003cspan class=\"m\"\u003e300\u003c/span\u003e    91.211.152.190\ndrone.k.maelvls.dev.      TXT    \u003cspan class=\"m\"\u003e300\u003c/span\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;heritage=external-dns,external-dns/owner=k8s,external-dns/resource=ingress/drone/cm-acme-http-solver-xv5cs\u0026#34;\u003c/span\u003e\nminio.k.maelvls.dev.      A      \u003cspan class=\"m\"\u003e300\u003c/span\u003e    91.211.152.190\nminio.k.maelvls.dev.      TXT    \u003cspan class=\"m\"\u003e300\u003c/span\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;heritage=external-dns,external-dns/owner=k8s,external-dns/resource=ingress/minio/cm-acme-http-solver-82slp\u0026#34;\u003c/span\u003e\n*.minio.k.maelvls.dev.    A      \u003cspan class=\"m\"\u003e300\u003c/span\u003e    91.211.152.190\n*.minio.k.maelvls.dev.    TXT    \u003cspan class=\"m\"\u003e300\u003c/span\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;heritage=external-dns,external-dns/owner=k8s,external-dns/resource=ingress/minio/minio\u0026#34;\u003c/span\u003e\nns.k.maelvls.dev.         A      \u003cspan class=\"m\"\u003e300\u003c/span\u003e    91.211.152.190\nns.k.maelvls.dev.         TXT    \u003cspan class=\"m\"\u003e300\u003c/span\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;heritage=external-dns,external-dns/owner=k8s,external-dns/resource=service/ext-coredns/ext-coredns\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAfter:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e% gcloud dns record-sets list --zone=maelvls\nNAME               TYPE  TTL    DATA\nmaelvls.dev.       A     300    185.199.108.153,185.199.109.153,185.199.110.153,185.199.111.153\nmaelvls.dev.       MX    300    1 aspmx.l.google.com.,5 alt1.aspmx.l.google.com.,5 alt2.aspmx.l.google.com.,10 alt3.aspmx.l.google.com.,10 alt4.aspmx.l.google.com.,15 pdquboxtbnqki2zinxaksc3jnnluefibfdbqhi7ghbhfbg7ef47q.mx-verification.google.com.\nmaelvls.dev.       NS    21600  ns-cloud-a1.googledomains.com.,ns-cloud-a2.googledomains.com.,ns-cloud-a3.googledomains.com.,ns-cloud-a4.googledomains.com.\nmaelvls.dev.       SOA   21600  ns-cloud-a1.googledomains.com. cloud-dns-hostmaster.google.com. 13 21600 3600 259200 300\nmaelvls.dev.       TXT   300    \u0026#34;keybase-site-verification=PnIWsZlbzCGwYrc5J_VCVphBOMHCVjcIx6nMSkeCZzI\u0026#34;\nk.maelvls.dev.     NS    300    ns.k.maelvls.dev.\nns.k.maelvls.dev.  A     300    91.211.152.190\nns.k.maelvls.dev.  TXT   300    \u0026#34;heritage=external-dns,external-dns/owner=k8s,external-dns/resource=service/ext-coredns/ext-coredns\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIt works!\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% dig +trace minio.k.maelvls.dev\n.                     \u003cspan class=\"m\"\u003e407578\u003c/span\u003e  IN  NS  a.root-servers.net.\n.                     \u003cspan class=\"m\"\u003e407578\u003c/span\u003e  IN  NS  b.root-servers.net.\n.                     \u003cspan class=\"m\"\u003e407578\u003c/span\u003e  IN  NS  c.root-servers.net.\ndev.                  \u003cspan class=\"m\"\u003e172800\u003c/span\u003e  IN  NS  ns-tld1.charlestonroadregistry.com.\ndev.                  \u003cspan class=\"m\"\u003e172800\u003c/span\u003e  IN  NS  ns-tld2.charlestonroadregistry.com.\nmaelvls.dev.          \u003cspan class=\"m\"\u003e10800\u003c/span\u003e   IN  NS  ns-cloud-a1.googledomains.com.\nmaelvls.dev.          \u003cspan class=\"m\"\u003e10800\u003c/span\u003e   IN  NS  ns-cloud-a2.googledomains.com.\nk.maelvls.dev.        \u003cspan class=\"m\"\u003e300\u003c/span\u003e     IN  NS  ns.k.maelvls.dev.\nminio.k.maelvls.dev.  \u003cspan class=\"m\"\u003e5\u003c/span\u003e       IN  A   91.211.152.190\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1595635200,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":1400,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1595635200,"objectID":"40e53b9499468aa27bb5336ea4e44dbc","permalink":"https://maelvls.dev/notes/dns/","publishdate":"2020-07-25T00:00:00Z","readingtime":7,"relpermalink":"/notes/dns/","section":"notes","summary":"Terms A domain name (or just \u0026ldquo;domain\u0026rdquo;) is a string the form bar.foo.com.. Not all domains refer to physical machines; for example, one of my domains, k.maelvls.dev., do not point to any physical machine.\nWe often represent the domain name space using a tree. Each node is a domain. Leaves and nodes may have A records. Here is a simple example of the domain space represented as a tree:\n. ├── com.","tags":["networking"],"title":"It's always the DNS' fault","type":"notes","url":"https://maelvls.dev/notes/dns/","weight":0,"wordcount":1369},{"authors":null,"categories":null,"content":"","date":1595635200,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"home","lang":"en","lastmod":1595635200,"objectID":"","permalink":"https://maelvls.dev/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/","section":"","summary":"","tags":null,"title":"maelvls dev blog","type":"page","url":"https://maelvls.dev/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1595635200,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1595635200,"objectID":"","permalink":"https://maelvls.dev/tags/networking/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/networking/","section":"tags","summary":"","tags":null,"title":"networking","type":"tags","url":"https://maelvls.dev/tags/networking/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1595635200,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"section","lang":"en","lastmod":1595635200,"objectID":"","permalink":"https://maelvls.dev/notes/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/notes/","section":"notes","summary":"","tags":null,"title":"Notes","type":"notes","url":"https://maelvls.dev/notes/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1595635200,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"taxonomy","lang":"en","lastmod":1595635200,"objectID":"","permalink":"https://maelvls.dev/tags/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/","section":"tags","summary":"","tags":null,"title":"Tags","type":"tags","url":"https://maelvls.dev/tags/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1594132435,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"section","lang":"en","lastmod":1594132435,"objectID":"","permalink":"https://maelvls.dev/2020/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/2020/","section":"2020","summary":"","tags":null,"title":"2020s","type":"2020","url":"https://maelvls.dev/2020/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1594132435,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1594132435,"objectID":"","permalink":"https://maelvls.dev/tags/conditions/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/conditions/","section":"tags","summary":"","tags":null,"title":"conditions","type":"tags","url":"https://maelvls.dev/tags/conditions/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1594132435,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1594132435,"objectID":"","permalink":"https://maelvls.dev/tags/kubernetes/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/kubernetes/","section":"tags","summary":"","tags":null,"title":"kubernetes","type":"tags","url":"https://maelvls.dev/tags/kubernetes/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eThe various conditions that may appear in a deployment status are not documented in the \u003ca href=\"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/\"\u003eAPI reference\u003c/a\u003e. For example, we can see what are the fields for \u003ca href=\"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#deploymentcondition-v1-apps\"\u003eDeploymentConditions\u003c/a\u003e, but it lacks the description of what conditions can appear in this field.\u003c/p\u003e\n\u003cp\u003eIn this post, I dig into what the \u003ccode\u003eAvailable\u003c/code\u003e condition type is about and how it is computed.\u003c/p\u003e\n\u003cp\u003eSince the \u003ca href=\"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/\"\u003eAPI reference\u003c/a\u003e does not contain any information about conditions, the only way to learn more is to dig into the Kubernetes codebase; quite deep into the code, \u003ca href=\"https://github.com/kubernetes/kubernetes/blob/3615291/pkg/apis/apps/types.go#L461-L473\"\u003ewe can read some comments\u003c/a\u003e about the three possible conditions for a deployment:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"c1\"\u003e// Available means the deployment is available, ie. at least the minimum available\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// replicas required are up and running for at least minReadySeconds.\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003eDeploymentAvailable\u003c/span\u003e \u003cspan class=\"nx\"\u003eDeploymentConditionType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Available\u0026#34;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Progressing means the deployment is progressing. Progress for a deployment is\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// considered when a new replica set is created or adopted, and when new pods scale\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// up or old pods scale down. Progress is not estimated for paused deployments or\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// when progressDeadlineSeconds is not specified.\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003eDeploymentProgressing\u003c/span\u003e \u003cspan class=\"nx\"\u003eDeploymentConditionType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Progressing\u0026#34;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// ReplicaFailure is added in a deployment when one of its pods fails to be created\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// or deleted.\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003eDeploymentReplicaFailure\u003c/span\u003e \u003cspan class=\"nx\"\u003eDeploymentConditionType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ReplicaFailure\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe description given to the \u003ccode\u003eAvailable\u003c/code\u003e condition type is quite mysterious:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAt least the minimum available replicas required are up.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWhat does \u0026ldquo;minimum available replicas\u0026rdquo; mean? Is this minimum 1? I cannot see any \u003ccode\u003eminAvailable\u003c/code\u003e field in the deployment spec, so my initial guess was that it would be 1.\u003c/p\u003e\n\u003cp\u003eBefore going further, let\u0026rsquo;s the description attached to the reason \u003ca href=\"https://github.com/kubernetes/kubernetes/blob/3615291/pkg/controller/deployment/util/deployment_util.go#L96-L97\"\u003e\u003ccode\u003eMinimumReplicasAvailable\u003c/code\u003e\u003c/a\u003e. Apparently, this reason is the only reason for the \u003ccode\u003eAvailable\u003c/code\u003e condition type.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"c1\"\u003e// MinimumReplicasAvailable is added in a deployment when it has its minimum\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// replicas required available.\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003eMinimumReplicasAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;MinimumReplicasAvailable\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe description doesn\u0026rsquo;t help either. Let\u0026rsquo;s see what the \u003ca href=\"https://github.com/kubernetes/kubernetes/blob/3615291/pkg/controller/deployment/sync.go#L513-L516\"\u003edeployment sync\u003c/a\u003e function does:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eavailableReplicas\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003edeploy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eReplicas\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eminAvailability\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003edeploy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewCondition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Available\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;MinimumReplicasAvailable\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Deployment has minimum availability.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003edeploy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCondition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eminAvailability\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eNote: in the real code, the max unavailable is on the right side of the inequality. I find it easier to reason about this inequality when the single value to the right is the desired replica number.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAhhh, the actual logic being \u003ccode\u003eAvailable\u003c/code\u003e! If \u003ccode\u003emaxUnavailable\u003c/code\u003e is 0, then it becomes obvious: the \u0026ldquo;minimum availability\u0026rdquo; means that number of available replicas is greater or equal to the number of replicas in the spec; the deployment has minimum availability if and only if the following inequality holds:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:center\"\u003eavailable\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e+\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003eacceptable unavailable\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e≥\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003edesired\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:center\"\u003e1️⃣\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e2️⃣\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e3️⃣\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eLet\u0026rsquo;s take an example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDeployment\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# 3️⃣ desired\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estrategy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003erollingUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# 2️⃣ acceptable unavailable\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eavailableReplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# 1️⃣ available\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Available\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn this example, the inequality holds which means this deployment has \u0026ldquo;minimum availability\u0026rdquo; (= \u003ccode\u003eAvailable = True\u003c/code\u003e):\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:center\"\u003e\u003ccode\u003eavailableReplicas\u003c/code\u003e\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e+\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e\u003ccode\u003emaxUnavailable\u003c/code\u003e\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e≥\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e\u003ccode\u003ereplicas\u003c/code\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:center\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e10\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"default-value-for-maxunavailable-is-25\"\u003eDefault value for \u003ccode\u003emaxUnavailable\u003c/code\u003e is 25%\u003c/h2\u003e\n\u003cp\u003eNow, what happens when \u003ccode\u003emaxUnavailable\u003c/code\u003e is not set? The official documentation \u003ca href=\"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#max-unavailable\"\u003emaxUnavailable\u003c/a\u003e says:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003emaxUnavailable\u003c/code\u003e is an optional field that specifies the maximum number of Pods that can be unavailable during the update process. The value can be an absolute number (for example, 5) or a percentage of desired Pods (for example, 10%). The absolute number is calculated from percentage by rounding down. The value cannot be 0 if \u003ccode\u003emaxSurge\u003c/code\u003e is 0. \u003cstrong\u003eThe default value is 25%\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eFor example, when this value is set to 30%, the old ReplicaSet can be scaled down to 70% of desired Pods immediately when the rolling update starts. Once new Pods are ready, old ReplicaSet can be scaled down further, followed by scaling up the new ReplicaSet, ensuring that the total number of Pods available at all times during the update is at least 70% of the desired Pods.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eLet\u0026rsquo;s take an example with a deployment that has no \u003ccode\u003emaxUnavailable\u003c/code\u003e field set, and imagine that 4 pods are unavailable due to a resource quota that only allows for 5 pods to start:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDeployment\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eavailableReplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eunavailableReplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Available\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;False\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis time, the inequality does not hold:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:right\"\u003e\u003ccode\u003estatus.availableReplicas\u003c/code\u003e\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e+\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e\u003ccode\u003espec.strategy.rollingUpdate.maxUnavailable\u003c/code\u003e\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e≱\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e\u003ccode\u003espec.replicas\u003c/code\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:right\"\u003e5\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003elower(25% * 10) = 2\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e10\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eLet\u0026rsquo;s dig a bit more and see how \u003ca href=\"https://github.com/kubernetes/kubernetes/blob/3615291/pkg/controller/deployment/util/deployment_util.go#L434-L445\"\u003e\u003ccode\u003eMaxAvailable\u003c/code\u003e\u003c/a\u003e is defined:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"c1\"\u003e// MaxUnavailable returns the maximum unavailable pods a rolling deployment\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// can take.\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eMaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e \u003cspan class=\"nx\"\u003eapps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsRollingUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eReplicas\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nf\"\u003eResolveFenceposts\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eStrategy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eRollingUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eMaxSurge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eStrategy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eRollingUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eMaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eReplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003emaxUnavailable\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eReplicas\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003edeployment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eReplicas\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003emaxUnavailable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe core of the logic behind maxUnavailable is in \u003ca href=\"https://github.com/kubernetes/kubernetes/blob/3615291/pkg/controller/deployment/util/deployment_util.go#L874-L902\"\u003e\u003ccode\u003eResolveFenceposts\u003c/code\u003e\u003c/a\u003e (note: I simplified the code a bit to make it more readable):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"c1\"\u003e// ResolveFenceposts resolves both maxSurge and maxUnavailable. This needs to happen in one\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// step. For example:\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e//\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 2 desired, max unavailable 1%, surge 0% - should scale old(-1), then new(+1), then old(-1), then new(+1)\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 1 desired, max unavailable 1%, surge 0% - should scale old(-1), then new(+1)\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 2 desired, max unavailable 25%, surge 1% - should scale new(+1), then old(-1), then new(+1), then old(-1)\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 1 desired, max unavailable 25%, surge 1% - should scale new(+1), then old(-1)\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 2 desired, max unavailable 0%, surge 1% - should scale new(+1), then old(-1), then new(+1), then old(-1)\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 1 desired, max unavailable 0%, surge 1% - should scale new(+1), then old(-1)\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eResolveFenceposts\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emaxSurge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emaxUnavailable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003einstr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eIntOrString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesired\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003esurge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e       \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003einstr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValueFromIntOrPercent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eValueOrDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emaxSurge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003einstr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"nx\"\u003edesired\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eunavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003einstr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValueFromIntOrPercent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eValueOrDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003einstr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"nx\"\u003edesired\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003esurge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eunavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe \u003ccode\u003efalse\u003c/code\u003e boolean turns the integer rounding \u0026ldquo;up\u0026rdquo;, which means \u003ccode\u003e0.5\u003c/code\u003e will be rounded to \u003ccode\u003e0\u003c/code\u003e instead of \u003ccode\u003e1\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003emaxUnavailable\u003c/code\u003e and \u003ccode\u003emaxSurge\u003c/code\u003e (they call them \u0026ldquo;fenceposts\u0026rdquo; values) are simply read from the deployment\u0026rsquo;s spec. In the following example, the deployment will become \u003ccode\u003eAvailable = True\u003c/code\u003e only if there are at least 5 replicas available:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDeployment\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estrategy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003erollingUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"l\"\u003e% # 🔰 10 * 0.0 = 0 replicas\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"hands-on-example-with-the-available-condition\"\u003eHands-on example with the \u003ccode\u003eAvailable\u003c/code\u003e condition\u003c/h2\u003e\n\u003cp\u003eImagine that we have a namespace named \u003ccode\u003erestricted\u003c/code\u003e that only allows for 200 MiB, and our pod requires 50 MiB. The first 4 pods will be successfully created, but the fifth one will fail.\u003c/p\u003e\n\u003cp\u003eLet us first apply the following manifest:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eNamespace\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erestricted\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eResourceQuota\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erestricted\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emem-cpu-demo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehard\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003erequests.memory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e200Mi\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eapps/v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDeployment\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erestricted\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estrategy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003erollingUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# 🔰\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ematchLabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enginx:alpine\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003ememory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;50Mi\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# the 5th pod will fail (on purpose)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"nt\"\u003econtainerPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e80\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAfter a few seconds, the \u003ccode\u003eAvailable\u003c/code\u003e condition stabilizes to \u003ccode\u003eFalse\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"c\"\u003e# kubectl -n restricted get deploy test -oyaml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDeployment\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estrategy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003erollingUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emaxUnavailable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# 🔰\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2020-07-07T14:04:27Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elastUpdateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2020-07-07T14:04:27Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDeployment does not have minimum availability.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eMinimumReplicasUnavailable\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;False\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAvailable\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2020-07-07T14:04:27Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elastUpdateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2020-07-07T14:04:27Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;pods \u0026#34;test-7df57bd99d-5qw47\u0026#34; is forbidden: exceeded quota: mem-cpu-demo, requested: requests.memory=50Mi, used: requests.memory=200Mi, limited: requests.memory=200Mi\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eFailedCreate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eReplicaFailure\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2020-07-07T14:04:27Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elastUpdateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2020-07-07T14:04:38Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eReplicaSet \u0026#34;test-7df57bd99d\u0026#34; is progressing.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eReplicaSetUpdated\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eProgressing\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eavailableReplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereadyReplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eunavailableReplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eupdatedReplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe are asking for at most 0 unavailable replicas and there is 1 unavailable replica (due to the resource quota). Thus, the \u0026ldquo;minimum availability\u0026rdquo; inequality does not hold which means the deployment has the condition \u003ccode\u003eAvailable = False\u003c/code\u003e:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:center\"\u003e\u003ccode\u003eavailableReplicas\u003c/code\u003e\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e+\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e\u003ccode\u003erollingUpdate.maxUnavailable\u003c/code\u003e\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e≱\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003e\u003ccode\u003ereplicas\u003c/code\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:center\"\u003e4\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e5\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate 9 July 2020:\u003c/strong\u003e added a paragraph on the default value for \u003ca href=\"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#max-unavailable\"\u003emaxUnavailable\u003c/a\u003e, and fixed the yaml example where I had mixed \u003ccode\u003eunavailableReplicas\u003c/code\u003e with \u003ccode\u003emaxUnavailable\u003c/code\u003e.\u003c/p\u003e\n","date":1594132435,"description":"Although the Kubernetes documentation is excellent, the API reference does not document the conditions that can be found in a deployment's status. The Available condition has always eluded me!","dir":"2020/deployment-available-condition/","expirydate":-62135596800,"fuzzywordcount":1200,"images":["deployment-available-condition/cover-deployment-available-condition.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1594132435,"objectID":"a4f5b54c58869e148d298323954f544b","permalink":"https://maelvls.dev/deployment-available-condition/","publishdate":"2020-07-07T16:33:55+02:00","readingtime":6,"relpermalink":"/deployment-available-condition/","section":"2020","summary":"The various conditions that may appear in a deployment status are not documented in the API reference. For example, we can see what are the fields for DeploymentConditions, but it lacks the description of what conditions can appear in this field.\nIn this post, I dig into what the Available condition type is about and how it is computed.\nSince the API reference does not contain any information about conditions, the only way to learn more is to dig into the Kubernetes codebase; quite deep into the code, we can read some comments about the three possible conditions for a deployment:","tags":["kubernetes","conditions"],"title":"Understanding the Available condition of a Kubernetes deployment","type":"2020","url":"https://maelvls.dev/deployment-available-condition/","weight":0,"wordcount":1117},{"authors":null,"categories":null,"content":"","date":1593782019,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1593782019,"objectID":"","permalink":"https://maelvls.dev/tags/dns/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/dns/","section":"tags","summary":"","tags":null,"title":"dns","type":"tags","url":"https://maelvls.dev/tags/dns/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1593782019,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1593782019,"objectID":"","permalink":"https://maelvls.dev/tags/docker/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/docker/","section":"tags","summary":"","tags":null,"title":"docker","type":"tags","url":"https://maelvls.dev/tags/docker/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1593782019,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1593782019,"objectID":"","permalink":"https://maelvls.dev/tags/kind/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/kind/","section":"tags","summary":"","tags":null,"title":"kind","type":"tags","url":"https://maelvls.dev/tags/kind/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003c!--\nDiagram on macOS + Docker: https://textik.com/#b185c1a72a6e782d\n--\u003e\n\u003cp\u003e\u003cstrong\u003eTL;DR:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eto create a local pull-through registry to speed up image pulling in a \u003ca href=\"https://kind.sigs.k8s.io/\"\u003eKind\u003c/a\u003e cluster, run:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003edocker run -d --name proxy --restart\u003cspan class=\"o\"\u003e=\u003c/span\u003ealways --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ekind \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -e \u003cspan class=\"nv\"\u003eREGISTRY_PROXY_REMOTEURL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://registry-1.docker.io registry:2\nkind create cluster --config /dev/stdin \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\n\u003c/span\u003e\u003cspan class=\"s\"\u003ekind: Cluster\n\u003c/span\u003e\u003cspan class=\"s\"\u003eapiVersion: kind.x-k8s.io/v1alpha4\n\u003c/span\u003e\u003cspan class=\"s\"\u003econtainerdConfigPatches:\n\u003c/span\u003e\u003cspan class=\"s\"\u003e  - |-\n\u003c/span\u003e\u003cspan class=\"s\"\u003e    [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003e      endpoint = [\u0026#34;http://proxy:5000\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://docs.docker.com/registry/configuration/#proxy\"\u003eyou can\u0026rsquo;t\u003c/a\u003e use this pull-through proxy registry to push your own images (e.g. to \u003ca href=\"https://github.com/tilt-dev/kind-local\"\u003espeed up Tilt builds\u003c/a\u003e), but you can create two registries (one for caching, the other for local images). See \u003ca href=\"#docker-proxy-vs-local-registry\"\u003ethis section\u003c/a\u003e for more context; the lines are:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003edocker run -d --name proxy --restart\u003cspan class=\"o\"\u003e=\u003c/span\u003ealways --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ekind \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -e \u003cspan class=\"nv\"\u003eREGISTRY_PROXY_REMOTEURL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://registry-1.docker.io registry:2\ndocker run -d --name registry --restart\u003cspan class=\"o\"\u003e=\u003c/span\u003ealways --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ekind \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -p 5000:5000 registry:2\nkind create cluster --config /dev/stdin \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\n\u003c/span\u003e\u003cspan class=\"s\"\u003ekind: Cluster\n\u003c/span\u003e\u003cspan class=\"s\"\u003eapiVersion: kind.x-k8s.io/v1alpha4\n\u003c/span\u003e\u003cspan class=\"s\"\u003econtainerdConfigPatches:\n\u003c/span\u003e\u003cspan class=\"s\"\u003e  - |-\n\u003c/span\u003e\u003cspan class=\"s\"\u003e    [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003e      endpoint = [\u0026#34;http://proxy:5000\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003e    [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;localhost:5000\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003e      endpoint = [\u0026#34;http://registry:5000\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ein case you often create \u0026amp; delete Kind clusters, using a local registry that serves as a proxy avoids redundant downloads\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eKIND_EXPERIMENTAL_DOCKER_NETWORK\u003c/code\u003e is useful but remember that the default network (\u003ccode\u003ebridge\u003c/code\u003e) doesn\u0026rsquo;t have DNS resolution for container hostnames\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe Docker default network (\u003ccode\u003ebridge\u003c/code\u003e) \u003ca href=\"https://stackoverflow.com/questions/41400603/dockers-embedded-dns-on-the-default-bridged-network\"\u003ehas limitations\u003c/a\u003e as \u003ca href=\"https://docs.docker.com/network/bridge/#use-the-default-bridge-network\"\u003edetailed by Docker\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf you play with \u003ca href=\"https://cluster-api.sigs.k8s.io/\"\u003eClusterAPI\u003c/a\u003e with its \u003ca href=\"https://github.com/kubernetes-sigs/cluster-api/tree/master/test/infrastructure/docker\"\u003eDocker provider\u003c/a\u003e, you might not be able to use a local registry due to the clusters being created on the default network, which means the \u0026ldquo;proxy\u0026rdquo; hostname won\u0026rsquo;t be resolved (but we could work around that).\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003e\u003ca href=\"https://kind.sigs.k8s.io/\"\u003eKind\u003c/a\u003e is an awesome tool that allows you to spin up local Kubernetes clusters locally in seconds. It is perfect for Kubernetes developers or anyone who wants to play with controllers.\u003c/p\u003e\n\u003cp\u003eOne thing I hate about Kind is that images are not cached between two Kind containers. Even worse: when deleting and re-creating a cluster, all the downloaded images disappear.\u003c/p\u003e\n\u003cp\u003eIn this post, I detail my discoveries around local registries and why the default Docker network is a trap.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eContents:\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"#kind-has-no-image-caching-mechanism\"\u003eKind has no image caching mechanism\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#creating-a-caching-proxy-registry\"\u003eCreating a caching proxy registry\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#creating-a-kind-cluster-that-knows-about-this-caching-proxy-registry\"\u003eCreating a Kind cluster that knows about this caching proxy registry\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#check-that-the-caching-proxy-registry-works\"\u003eCheck that the caching proxy registry works\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#docker-proxy-vs-local-registry\"\u003eDocker proxy vs. local registry\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#improving-the-clusterapi-docker-provider-to-use-a-given-network\"\u003eImproving the ClusterAPI docker provider to use a given network\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2 id=\"kind-has-no-image-caching-mechanism\"\u003eKind has no image caching mechanism\u003c/h2\u003e\n\u003cp\u003eWhenever I re-create a Kind cluster and try to install ClusterAPI, all the (quite heavy) images have to be re-downloaded. Just take a look at all the images that get re-downloaded:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"c1\"\u003e# That\u0026#39;s the cluster created using \u0026#39;kind create cluster\u0026#39;\u003c/span\u003e\n% docker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it kind-control-plane crictl images\nIMAGE                                                                      TAG      SIZE\nquay.io/jetstack/cert-manager-cainjector                                   v0.11.0  11.1MB\nquay.io/jetstack/cert-manager-controller                                   v0.11.0  14MB\nquay.io/jetstack/cert-manager-webhook                                      v0.11.0  14.3MB\nus.gcr.io/k8s-staging-capi-docker/capd-manager/capd-manager-amd64          dev      53.5MB\nus.gcr.io/k8s-artifacts-prod/cluster-api/cluster-api-controller            v0.3.0   20.3MB\nus.gcr.io/k8s-artifacts-prod/cluster-api/kubeadm-bootstrap-controller      v0.3.0   19.6MB\nus.gcr.io/k8s-artifacts-prod/cluster-api/kubeadm-control-plane-controller  v0.3.0   21.1MB\n\n\u003cspan class=\"c1\"\u003e# I also use a ClusterAPI-created cluster (relying on CAPD):\u003c/span\u003e\n% docker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it capd-capd-control-plane-l4tx7 crictl images ls\ndocker.io/calico/cni                  v3.12.2             8b42391a46731       77.5MB\ndocker.io/calico/kube-controllers     v3.12.2             5ca01eb356b9a       23.1MB\ndocker.io/calico/node                 v3.12.2             4d501404ee9fa       89.7MB\ndocker.io/calico/pod2daemon-flexvol   v3.12.2             2abcc890ae54f       37.5MB\ndocker.io/metallb/controller          v0.9.3              4715cbeb69289       17.1MB\ndocker.io/metallb/speaker             v0.9.3              f241be9dae666       19.2MB\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThat\u0026rsquo;s a total of 418 MB that get re-downloaded every time I restart both clusters!\u003c/p\u003e\n\u003cp\u003eUnfortunately, there is no way to re-use the image registry built into your default Docker engine (both on Linux and on macOS). One solution to this problem is to \u003ca href=\"https://kind.sigs.k8s.io/docs/user/local-registry/\"\u003espin up an intermediary Docker registry\u003c/a\u003e in a side container; as long as this container exists, all the images that have already been downloaded once can be served from cache.\u003c/p\u003e\n\u003ch2 id=\"creating-a-caching-proxy-registry\"\u003eCreating a caching proxy registry\u003c/h2\u003e\n\u003cp\u003eWe want to create a registry with a simple Kind cluster; let\u0026rsquo;s start with the registry:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003edocker run -d --name proxy --restart\u003cspan class=\"o\"\u003e=\u003c/span\u003ealways --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ekind -e \u003cspan class=\"nv\"\u003eREGISTRY_PROXY_REMOTEURL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://registry-1.docker.io registry:2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eDetails:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e--net kind\u003c/code\u003e is required because Kind creates its containers in a separate network; it does that the because the \u0026ldquo;bridge\u0026rdquo; has \u003ca href=\"https://docs.docker.com/network/bridge/#use-the-default-bridge-network\"\u003elimitations\u003c/a\u003e and \u003ca href=\"https://docs.docker.com/config/containers/container-networking/#dns-services\"\u003edoesn\u0026rsquo;t allow you\u003c/a\u003e to use container names as DNS names:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBy default, a container inherits the DNS settings of the host, as defined in the \u003ccode\u003e/etc/resolv.conf\u003c/code\u003e configuration file. Containers that use the default bridge network get a copy of this file, whereas containers that use a custom network use Docker’s embedded DNS server, which forwards external DNS lookups to the DNS servers configured on the host.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003ewhich means that the container runtime (containerd) that runs our Kind cluster won\u0026rsquo;t be able to resove the address \u003ccode\u003eproxy:5000\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eREGISTRY_PROXY_REMOTEURL\u003c/code\u003e is required due to the fact that by default, the registry won\u0026rsquo;t forward requests. It simply tries to find the image in \u003ccode\u003e/var/lib/registry/docker/registry/v2/repositories\u003c/code\u003e and returns 404 if it doesn\u0026rsquo;t find it.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eUsing the \u003ca href=\"https://docs.docker.com/registry/configuration/#proxy\"\u003epull-through\u003c/a\u003e feature (I call it \u0026ldquo;caching proxy\u0026rdquo;), the registry will proxy all requests coming from all mirror prefixes and cache the blobs and manifests locally. To enable this feature, we set \u003ccode\u003eREGISTRY_PROXY_REMOTEURL\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eOther interesting bit about \u003ccode\u003eREGISTRY_PROXY_REMOTEURL\u003c/code\u003e: this environement variable name is mapped from \u003ca href=\"https://docs.docker.com/registry/configuration/#proxy\"\u003ethe registry YAML config API\u003c/a\u003e. The variable\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"nv\"\u003eREGISTRY_PROXY_REMOTEURL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://registry-1.docker.io\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eis equivalent to the following YAML config:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003eproxy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eremoteurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps://registry-1.docker.io\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/blockquote\u003e\n\u003cp\u003e⚠️ The registry can\u0026rsquo;t be both in normal mode (\u0026ldquo;local proxy\u0026rdquo;) and in caching proxy mode at the same time, see \u003ca href=\"#docker-proxy-vs-local-registry\"\u003ebelow\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"creating-a-kind-cluster-that-knows-about-this-caching-proxy-registry\"\u003eCreating a Kind cluster that knows about this caching proxy registry\u003c/h2\u003e\n\u003cp\u003eThe second step is to create a Kind cluster and tell the container runtime to use a specific registry; here is the command to create it:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ekind create cluster --config /dev/stdin \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\n\u003c/span\u003e\u003cspan class=\"s\"\u003ekind: Cluster\n\u003c/span\u003e\u003cspan class=\"s\"\u003eapiVersion: kind.x-k8s.io/v1alpha4\n\u003c/span\u003e\u003cspan class=\"s\"\u003econtainerdConfigPatches:\n\u003c/span\u003e\u003cspan class=\"s\"\u003e  - |-\n\u003c/span\u003e\u003cspan class=\"s\"\u003e    [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003e      endpoint = [\u0026#34;http://proxy:5000\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eNote:\u003c/strong\u003e \u003ccode\u003econtainerdConfigPatches\u003c/code\u003e is a way to semantically patch \u003ccode\u003e/etc/containerd/config.conf\u003c/code\u003e. By default, this file looks like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% docker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it kind-control-plane cat /etc/containerd/config.toml\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eplugins\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e[\u003c/span\u003eplugins.\u003cspan class=\"s2\"\u003e\u0026#34;io.containerd.grpc.v1.cri\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e[\u003c/span\u003eplugins.\u003cspan class=\"s2\"\u003e\u0026#34;io.containerd.grpc.v1.cri\u0026#34;\u003c/span\u003e.registry\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e[\u003c/span\u003eplugins.\u003cspan class=\"s2\"\u003e\u0026#34;io.containerd.grpc.v1.cri\u0026#34;\u003c/span\u003e.registry.mirrors\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e[\u003c/span\u003eplugins.\u003cspan class=\"s2\"\u003e\u0026#34;io.containerd.grpc.v1.cri\u0026#34;\u003c/span\u003e.registry.mirrors.\u003cspan class=\"s2\"\u003e\u0026#34;docker.io\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n          \u003cspan class=\"nv\"\u003eendpoint\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://registry-1.docker.io\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eNote 2:\u003c/strong\u003e the mirror prefix (\u003ccode\u003edocker.io\u003c/code\u003e) can be omitted for images stored on Docker Hub. For other registries such as \u003ccode\u003egcr.io\u003c/code\u003e, this mirror prefix has to be given. Here is a table with some examples of image names that are first prepended with \u0026ldquo;docker.io\u0026rdquo; if the mirror prefix is not present, and we get the final address by mapping these mirror prefixes with mirror entries:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eimage name\u003c/th\u003e\n\u003cth\u003e\u0026ldquo;actual\u0026rdquo; image name\u003c/th\u003e\n\u003cth\u003eregistry address w.r.t. mirrors\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ealpine\u003c/td\u003e\n\u003ctd\u003edocker.io/alpine\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://registry-1.docker.io/v2/library/alpine/manifests/latest\"\u003ehttps://registry-1.docker.io/v2/library/alpine/manifests/latest\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003egcr.io/istio-release/pilot\u003c/td\u003e\n\u003ctd\u003egcr.io/istio-release/pilot\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://gcr.io/v2/istio-release/pilot/manifests/1.9.1\"\u003ehttps://gcr.io/v2/istio-release/pilot/manifests/1.9.1\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efoo.org/something/someimage\u003c/td\u003e\n\u003ctd\u003efoo.org/something/someimage\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://foo.org/v2/something/someimage/manifests/latest\"\u003ehttps://foo.org/v2/something/someimage/manifests/latest\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"check-that-the-caching-proxy-registry-works\"\u003eCheck that the caching proxy registry works\u003c/h2\u003e\n\u003cp\u003eLet\u0026rsquo;s see if the proxy registry works by running a pod:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl run foo -it --rm --image\u003cspan class=\"o\"\u003e=\u003c/span\u003enicolaka/netshoot\n% docker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it proxy ls /var/lib/registry/docker/registry/v2/repositories\nnicolaka\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can also see through the registry logs that everything is going well:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e# docker logs proxy | tail\ntime=\u0026#34;2020-07-26T14:52:44.2624761Z\u0026#34; level=info msg=\u0026#34;Challenge established with upstream : {https registry-1.docker.io /v2/}\u0026#34; go.version=go1.11.2 http.request.host=\u0026#34;proxy:5000\u0026#34; http.request.id=15e9ac86-7d79-4883-a8ce-861a7484887c http.request.method=HEAD http.request.remoteaddr=\u0026#34;172.18.0.2:57588\u0026#34; http.request.uri=\u0026#34;/v2/nicolaka/netshoot/manifests/latest\u0026#34; http.request.useragent=\u0026#34;containerd/v1.4.0-beta.1-34-g49b0743c\u0026#34; vars.name=\u0026#34;nicolaka/netshoot\u0026#34; vars.reference=latest\ntime=\u0026#34;2020-07-26T14:52:45.4195817Z\u0026#34; level=info msg=\u0026#34;Adding new scheduler entry for nicolaka/netshoot@sha256:04786602e5a9463f40da65aea06fe5a825425c7df53b307daa21f828cfe40bf8 with ttl=167h59m59.9999793s\u0026#34; go.version=go1.11.2 instance.id=ba959eb9-2fa3-47c0-beb7-91480c8a31ee service=registry version=v2.7.1\n172.18.0.2 - - [26/Jul/2020:14:52:43 +0000] \u0026#34;HEAD /v2/nicolaka/netshoot/manifests/latest HTTP/1.1\u0026#34; 200 1999 \u0026#34;\u0026#34; \u0026#34;containerd/v1.4.0-beta.1-34-g49b0743c\u0026#34;\ntime=\u0026#34;2020-07-26T14:52:45.4204299Z\u0026#34; level=info msg=\u0026#34;response completed\u0026#34; go.version=go1.11.2 http.request.host=\u0026#34;proxy:5000\u0026#34; http.request.id=15e9ac86-7d79-4883-a8ce-861a7484887c http.request.method=HEAD http.request.remoteaddr=\u0026#34;172.18.0.2:57588\u0026#34; http.request.uri=\u0026#34;/v2/nicolaka/netshoot/manifests/latest\u0026#34; http.request.useragent=\u0026#34;containerd/v1.4.0-beta.1-34-g49b0743c\u0026#34; http.response.contenttype=\u0026#34;application/vnd.docker.distribution.manifest.v2+json\u0026#34; http.response.duration=1.6697112s http.response.status=200 http.response.written=1999\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c!--\n\n## Why \"proxy\" wasn't resolved inside containers\n\n```sh\n% docker inspect proxy --format '{{range $net, $cfg := .NetworkSettings.Networks}}{{$net}} {{$cfg.IPAddress}}{{end}}'\nbridge 172.17.0.2\n\n% docker inspect kind-control-plane --format '{{range $net, $cfg := .NetworkSettings.Networks}}{{$net}} {{$cfg.IPAddress}}{{end}}'\nkind 172.18.0.2\n\n% docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\na6ceea984c68        bridge              bridge              local\n6f6a9618d746        host                host                local\n4927dc2eba9b        kind                bridge              local\n```\n\nLet's try to reproduce this issue. I first run a registry with the default\nnetwork, and I then try to connect to it from a second container using the\nhostname `proxy`:\n\n```sh\n% docker run -d --rm --name proxy registry:2\n% docker run -it --rm alpine nslookup proxy\nServer:         127.0.0.11\nAddress:        127.0.0.11:53\nNon-authoritative answer:\nName:   proxy\nAddress: 172.18.0.7\n\n# Let's cleanup:\n% docker kill proxy\n```\n\nNow, let's do the same but a custom network named \"other\" instead of the\ndefault network:\n\n```sh\n% docker network create other\n% docker run -d --rm --net=other --name proxy registry:2\n% docker run -it --rm --net=other alpine nslookup proxy\nServer:         127.0.0.11\nAddress:        127.0.0.11:53\nNon-authoritative answer:\nName:   proxy\nAddress: 172.18.0.7\n\n# Let's cleanup:\n% docker kill proxy\n```\n\nI thought I could first start the container on the default network and then\nmove the containers to the \"other\" network (so that DNS with container\nnames works) but it does not seem to work either:\n\n```sh\n% docker run -d --rm --name proxy registry:2\n% docker run -d --rm --name alpine alpine sleep 1d\n\n% docker network create other\n% docker network disconnect bridge proxy\n% docker network disconnect bridge alpine\n% docker network connect other proxy\n% docker network connect other alpine\n\n# Now, let's see if 'alpine' can resolve 'proxy':\n% docker exec -it alpine nslookup proxy\n```\n\nI also tried to understand the difference between containers with the\ndefault network and containers with the \"other\" network. As stated [in the\nDocker documentation][dns-services], a container created on the default\nnetwork is setup slightly differently.\n\n```sh\n# 1️⃣ With default network:\n% docker run -it --rm alpine cat /etc/resolv.conf\n# This file is included on the metadata iso\nnameserver 192.168.65.1\n\n% docker run -it --rm alpine cat /etc/hosts\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n172.17.0.4      8f4a5e6bad39\n\n# 2️⃣ With the 'other' network:\n% docker run -it --rm --net=other alpine cat /etc/resolv.conf\nnameserver 127.0.0.11\noptions ndots:0\n\n% docker run -it --rm --net=other alpine cat /etc/hosts\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n172.19.0.4      fed220ca6bd0\n```\n\nSo it definitely comes from `/etc/resolv.conf`! With the default network,\nthe `/etc/resolv.conf` that gets set up does not allow you to resolve\ncontainer names.\n\nSo in order to use container names as hostnames, I have to create your own\nusing `docker network create`.\n\nLet's re-created my registry on the \"kind\" network and also re-create the\ncluster without the `KIND_EXPERIMENTAL_DOCKER_NETWORK=bridge` option:\n\n```sh\ndocker network create kind\ndocker run -d --name proxy --restart=always --net=kind registry:2\nkind create cluster --config /dev/stdin \u003c\u003cEOF\nkind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\ncontainerdConfigPatches:\n  - |-\n    [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"proxy\"]\n      endpoint = [\"http://proxy:5000\"]\nEOF\n```\n\nBoth are now on the same subnet:\n\n```sh\n% docker inspect proxy --format '{{range $net, $cfg := .NetworkSettings.Networks}}{{$net}} {{$cfg.IPAddress}}{{end}}'\nkind 172.18.0.2\n\n% docker inspect kind-control-plane --format '{{range $net, $cfg := .NetworkSettings.Networks}}{{$net}} {{$cfg.IPAddress}}{{end}}'\nkind 172.18.0.3\n```\n\nBut creating a simple deployment doesn't seem to work! By looking at the\nregistry logs, we see no activity at all. Let's see what `containerd` is up\nto:\n\n```log\n% docker exec -i kind-control-plane journalctl -u containerd | grep 'proxy:5000'\ncontainerd[129]: Start cri plugin with config {Registry:{Mirrors:map[\n  docker.io: {Endpoints:[https://registry-1.docker.io]}\n  proxy:  {Endpoints:[http://proxy:5000]}\n]}}\n```\n\n\u003e ✅ I had to remove `-t` (tty) from the above command. That's because\n\u003e `journalctl` was using a pager because this terminal was TTY (which means\n\u003e it had /dev/stdin open? not sure). To disable the pager I removed `-t`.\n\nI guess contained picks the first mirror (`docker.io`); so let's override\nthe `docker.io` key:\n\n```sh\ndocker rm -f registry\ndocker run -d --name proxy --restart=always --net=kind registry:2\nkind create cluster --config /dev/stdin \u003c\u003cEOF\nkind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\ncontainerdConfigPatches:\n  - |-\n    [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\n      endpoint = [\"http://proxy:5000\"]\nEOF\n```\n\nAnd here is the actual configuration given to containerd:\n\n```sh\n% docker exec -it kind-control-plane cat /etc/containerd/config.toml\nversion = 2\n[plugins]\n  [plugins.\"io.containerd.grpc.v1.cri\"]\n    sandbox_image = \"k8s.gcr.io/pause:3.2\"\n    [plugins.\"io.containerd.grpc.v1.cri\".containerd]\n      default_runtime_name = \"runc\"\n      [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes]\n        [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc]\n          runtime_type = \"io.containerd.runc.v2\"\n        [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.test-handler]\n          runtime_type = \"io.containerd.runc.v2\"\n    [plugins.\"io.containerd.grpc.v1.cri\".registry]\n      [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors]\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\n          endpoint = [\"https://registry-1.docker.io\"]\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"proxy\"]\n          endpoint = [\"http://proxy:5000\"]\n```\n\n--\u003e\n\u003ch2 id=\"docker-proxy-vs-local-registry\"\u003eDocker proxy vs. local registry\u003c/h2\u003e\n\u003cp\u003eA bit later, I discovered that \u003ca href=\"https://docs.docker.com/registry/configuration/#proxy\"\u003eyou can\u0026rsquo;t\u003c/a\u003e push to a proxy registry. \u003ca href=\"https://tilt.dev/\"\u003eTilt\u003c/a\u003e is a tool I use to ease the process of developping in a containerized environment (and it works best with Kubernetes); it \u003ca href=\"https://github.com/tilt-dev/kind-local\"\u003erelies on a local registry\u003c/a\u003e in order to cache build containers even when restarting the Kind cluster.\u003c/p\u003e\n\u003cp\u003eEither the registry is used as a \u0026ldquo;local registry\u0026rdquo; (where you can push images), or it is used as a pull-through proxy. So instead of configuring one single \u0026ldquo;proxy\u0026rdquo; registry, I configure two registries: one for local images, one for caching.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003edocker run -d --name proxy --restart\u003cspan class=\"o\"\u003e=\u003c/span\u003ealways --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ekind -e \u003cspan class=\"nv\"\u003eREGISTRY_PROXY_REMOTEURL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://registry-1.docker.io registry:2\ndocker run -d --name registry --restart\u003cspan class=\"o\"\u003e=\u003c/span\u003ealways -p 5000:5000 --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ekind registry:2\nkind create cluster --config /dev/stdin \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\n\u003c/span\u003e\u003cspan class=\"s\"\u003ekind: Cluster\n\u003c/span\u003e\u003cspan class=\"s\"\u003eapiVersion: kind.x-k8s.io/v1alpha4\n\u003c/span\u003e\u003cspan class=\"s\"\u003econtainerdConfigPatches:\n\u003c/span\u003e\u003cspan class=\"s\"\u003e  - |-\n\u003c/span\u003e\u003cspan class=\"s\"\u003e    [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003e      endpoint = [\u0026#34;http://proxy:5000\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003e    [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;localhost:5000\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003e      endpoint = [\u0026#34;http://registry:5000\u0026#34;]\n\u003c/span\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNote that we do use a port-forwarding proxy (\u003ccode\u003e-p 5000:5000\u003c/code\u003e) so that we can push images \u0026ldquo;from the host\u0026rdquo;, e.g.:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% docker tag alpine localhost:5000/alpine\n% docker push localhost:5000/alpine\nThe push refers to repository \u003cspan class=\"o\"\u003e[\u003c/span\u003elocalhost:5000/alpine\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n50644c29ef5a: Pushed\nlatest: digest: sha256:a15790640a6690aa1730c38cf0a440e2aa44aaca9b0e8931a9f2b0d7cc90fd65 size: \u003cspan class=\"m\"\u003e528\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# Let\u0026#39;s see if this image is also available from the cluster:\u003c/span\u003e\n% docker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it kind-control-plane crictl pull localhost:5000/alpine\nImage is up to date \u003cspan class=\"k\"\u003efor\u003c/span\u003e sha256:a24bb4013296f61e89ba57005a7b3e52274d8edd3ae2077d04395f806b63d83e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIf you use Tilt, you might also want to tell Tilt that it can use the local registry. I find it a bit weird to have to set an annotation (hidden Tilt API?) but whatever. If you set this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ekind get nodes \u003cspan class=\"p\"\u003e|\u003c/span\u003e xargs -L1 -I% kubectl annotate node % tilt.dev/registry\u003cspan class=\"o\"\u003e=\u003c/span\u003elocalhost:5000 --overwrite\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ethen Tilt will use \u003ccode\u003edocker push localhost:5000/you-image\u003c/code\u003e (from your host, not from the cluster container) in order to speed up things. Note that there is a proposal (\u003ca href=\"https://github.com/kubernetes/enhancements/tree/master/keps/sig-cluster-lifecycle/generic/1755-communicating-a-local-registry\"\u003eKEP 1755\u003c/a\u003e) that aims at standardizing the discovery of local registries using a configmap. Tilt already supports it, so you may use it!\u003c/p\u003e\n\u003ch2 id=\"improving-the-clusterapi-docker-provider-to-use-a-given-network\"\u003eImproving the ClusterAPI docker provider to use a given network\u003c/h2\u003e\n\u003cp\u003eWhen I play with ClusterAPI, I usually use the CAPD provider (ClusterAPI Provider Docker). This provider \u003ca href=\"https://github.com/kubernetes-sigs/cluster-api/blob/master/test/infrastructure/docker\"\u003eis kept in-tree\u003c/a\u003e inside the cluster-api projet.\u003c/p\u003e\n\u003cp\u003eI want to use the caching mechanism presented above. But to do that, I need to make sure the clusters created by CAPD are not created on the default network (\u003ca href=\"https://sigs.k8s.io/cluster-api/test/infrastructure/docker/docker/kind_manager.go#L178\"\u003ecurrent implementation\u003c/a\u003e creates CAPD clusters on the default \u0026ldquo;bridge\u0026rdquo; network).\u003c/p\u003e\n\u003cp\u003eI want to be able to customize the network on which the CAPD provider creates the container that make up the cluster. Imagine that we could pass the network name as part of a \u003ca href=\"https://github.com/kubernetes-sigs/cluster-api/blob/6821939410c37743b45c36ec91d94c37dba1998e/test/e2e/data/infrastructure-docker/cluster-template.yaml#L26-L35\"\u003eDockerMachineTemplate\u003c/a\u003e (the content of the \u003ccode\u003espec\u003c/code\u003e is defined in code \u003ca href=\"https://github.com/kubernetes-sigs/cluster-api/blob/2ac3728d26593f7c54520999477aad45934e1c59/test/infrastructure/docker/api/v1alpha3/dockermachine_types.go#L30-L55\"\u003ehere\u003c/a\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003einfrastructure.cluster.x-k8s.io/v1alpha3\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDockerMachineTemplate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecapd-control-plane\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edefault\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eextraMounts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003econtainerPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/var/run/docker.sock\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ehostPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/var/run/docker.sock\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003enetwork\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekind # 🔰 This field does not exist yet.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eUpdate 26 July 2020\u003c/strong\u003e: added a section about local registry vs. caching proxy. Reworked the whole post (less noise, more useful information).\u003c/p\u003e\n","date":1593782019,"description":"Kind offers an excellent UX to Kubernetes developers but lacks support for caching images; each time you recreate a new cluster, all the previous downloaded images are gone. In this post, I explain why the default Docker network is a trap and how to set up a registry \u0026 make sure that it actually works.","dir":"2020/docker-proxy-registry-kind/","expirydate":-62135596800,"fuzzywordcount":1700,"images":["docker-proxy-registry-kind/cover-docker-proxy-registry-kind.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1593782019,"objectID":"9fc9b91cf183b07151af2f236ee0e302","permalink":"https://maelvls.dev/docker-proxy-registry-kind/","publishdate":"2020-07-03T15:13:39+02:00","readingtime":8,"relpermalink":"/docker-proxy-registry-kind/","section":"2020","summary":"TL;DR:\n  to create a local pull-through registry to speed up image pulling in a Kind cluster, run:\ndocker run -d --name proxy --restart=always --net=kind \\  -e REGISTRY_PROXY_REMOTEURL=https://registry-1.docker.io registry:2 kind create cluster --config /dev/stdin \u0026lt;\u0026lt;EOF kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 containerdConfigPatches: - |- [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;] endpoint = [\u0026#34;http://proxy:5000\u0026#34;] EOF   you can\u0026rsquo;t use this pull-through proxy registry to push your own images (e.g. to speed up Tilt builds), but you can create two registries (one for caching, the other for local images).","tags":["kubernetes","kind","docker","networking","dns"],"title":"Pull-through Docker registry on Kind clusters","type":"2020","url":"https://maelvls.dev/docker-proxy-registry-kind/","weight":0,"wordcount":1608},{"authors":null,"categories":null,"content":"","date":1593623844,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1593623844,"objectID":"","permalink":"https://maelvls.dev/tags/mitmproxy/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/mitmproxy/","section":"tags","summary":"","tags":null,"title":"mitmproxy","type":"tags","url":"https://maelvls.dev/tags/mitmproxy/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\n\u003cdiv style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"\u003e\n  \u003ciframe src=\"https://www.youtube.com/embed/30a0WrfaS2A\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen title=\"YouTube Video\"\u003e\u003c/iframe\u003e\n\u003c/div\u003e\n\n\u003cp\u003eIn Oct 2019, Ahmet Alp Balkan wrote \u003ca href=\"https://ahmet.im/blog/kubectl-man-in-the-middle\"\u003ethis blog post\u003c/a\u003e that explains how to use \u003ccode\u003emitmproxy\u003c/code\u003e to observe the requests made by \u003ccode\u003ekubectl\u003c/code\u003e. But I couldn\u0026rsquo;t use the tutorial for two reasons:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eI use \u003ccode\u003ekind\u003c/code\u003e to create local clusters which means I hit the Go \u003ccode\u003enet/http\u003c/code\u003e limitation (skips proxying for hosts \u003ccode\u003elocalhost\u003c/code\u003e and \u003ccode\u003e127.0.0.1\u003c/code\u003e, see \u003ca href=\"https://maelvls.dev/go-ignores-proxy-localhost/\"\u003ethis blog post\u003c/a\u003e)\u003c/li\u003e\n\u003cli\u003eI use client certs authentication, which can\u0026rsquo;t work with the method presented by Ahmet; it can only work for header-based authentication (e.g. token) but not for client certs.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn the following, I detail how I managed to make all that work.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"c1\"\u003e# Let\u0026#39;s use a separate kubeconfig file to avoid messing with ~/.kube/config.\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eKUBECONFIG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e~/.kube/kind-kind\n\n\u003cspan class=\"c1\"\u003e# Now, let\u0026#39;s create a cluster.\u003c/span\u003e\nkind create cluster\n\n\u003cspan class=\"c1\"\u003e# Let\u0026#39;s see what the content of $KUECONFIG is:\u003c/span\u003e\ncat \u003cspan class=\"nv\"\u003e$KUBECONFIG\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can see that the kubeconfig uses a client cert as a way to authenticate to the apiserver.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eclusters\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ecluster\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ecertificate-authority-data\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01EWXlPVEE1TURJeU4xb1hEVE13TURZeU56QTVNREl5TjFvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBS25qCmhmRzBvenZVb05jMXY1STkvYm13dFBqb2QvK0RyczF4TFZOcWgxQjhFcTY1S3lnQjBSbDdQcTJueUhyRVRnTmsKZ2VPQ2RzRURObGpKOE12SC9GbE9nRkUvS0dqK2hwN2hwc0dHRExReWFUOExUY25JN0FNL2t3KzY5R0hidlN3Nwo2V0Y1VERTMDU1RkRqdnRveGdHcERycmZQZTk5bXN5Zmk3aWtteDk5MmRyMHFQd0xxanJpZHNkWU52MUZqU1Y1CndkRlFISGxBS2hBcmlUWmpQMnhNL3poOENBOFhndjF0UUxVVk5IS1hrSG5UYWlkeFY1MkduaUVaQmd0d2tSK3oKQ3hQempVZFAxQ1JRYzU0YmxDYW9FQVdTc0NYTUVPREhTSnowSi9CWHJCU2JaeGZIakd0Y0k0bEhBUmx2aURNawp3U3lOLy9qdE9tbWhDT29BTzBzQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFIMDBrYnZpaWNNT3IxdFJoTkQweVpGa3ZkT1AKUzFGOEZKK1BFd1o1WExUTVVyVG1yekVlZmgza21xWkxYUnlyK3c0Snk1a0grK1o3enBpdlp6Q3BGOEtwclJaWAp5N2Z6TkJOeWMrOHFKN3dCek0xZ21BdTRha3BlNVBYbkw3akZIcU9aUmNXTmZKcUpTci9BS05sK2c2SjAzV2pnCmJDc0NQNTNrZ1czSDZYMkRoS1JzZFRWQlc1UGVlek1YRVlON2VYbGpnWE4xcElMdEU1VE5oWVZIcTZaUDVCaDkKMmU2Y1U4bEFuNlhYQ0Ira2RsTkhudGp1cTlSL2lPQVJRaWpVSVlWSFdCT1NyWGp6TnhkTklEakRRd3lKUnViMApDVEhrcDg4eUlNaEV1Nk1OV1VCUU82ZnVqbURHbUJJbTlzdzJpSnI1UlArSUVUVnQyWFc0Q2dHT1cwVT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps://127.0.0.1:53744\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekind-helix\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003econtexts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ecluster\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekind-helix\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekind-helix\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekind-helix\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ecurrent-context\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekind-helix\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eConfig\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003epreferences\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e{}\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eusers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekind-helix\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eclient-certificate-data\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM4akNDQWRxZ0F3SUJBZ0lJYTZXc25HT0RGZW93RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TURBMk1qa3dPVEF5TWpkYUZ3MHlNVEEyTWprd09UQXlNekJhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXRkbkxsb0V1cnFoSmRrMGgKME5VcXpFSHhUbmVHS040QTNtWDBobmFLcE1TT3hISlBQcTB6V0t4WEVxNTZPTkdhSkhvS0VTRUM2Yjh2MGcwTQo5dXVGOXJyQ1VORkpXMmdHcFArRG96TEpVS3RtN2F0WFZRYXNVQ2tjbFRtQ003aHlqOGZTTlRDd2lxT3RNOUFvCnFVVTJYd1k0a2xhL0RuMkRBc1V1VmNiUTdITDA1N0tFbjZvVzlFVy9mQ2hMVE5OTWhmelpkNzFISGs3MFNOZDMKTG5jTXNjNmp2eS9kN2MwbjM4ek45SjVzWVZOTjNsS1YvOU5MT2FaTEQ0bSsyVU5XV1FVazRuci8rZjlaZk1IMwphVlFibDZSWEZwaW1jYWg4UjRJTmhRNkhYbmVEbUI2dUl3RGdjQnhhQUtoNFVPVlZwODB1Uy9pYUVLV1VSWE1PCkg4YXBZUUlEQVFBQm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFJaWtmbis5TkJQc2FNSzNVMU5pWmtBaWxsM1pWVXJDdzNsWgpIeGRGbm9MZGxZYmtPeFVEN25EK3lrNXhZWW4yaDc3WUU4NlU5czJ3aitkdFJTR2Ezc3p4WVJQbkt5MDN3L1M4CkhqZzhwSkZOZFhHWlNPUWJDQTBmT1BONXl5MlpYRlVWd0JwZ3VTMC9nTkNUUkRPUDl3QmNjQXhiSGRmSjMxQzQKa2hCemF4QXI5UEliMVBzUlhqS2ZSRnkvcllwYWRBYVhhYmZMOFRvbTJ4cGpLVDYreGxoL3lJb2tZbVhxSnlXRgp1SGFmWG1qUEdyRDFoZUo2UnR5U0xRM0dKUXQxWmVPK3BaYlJlRjcxU0ZRSjRQdFhtTHhGMjZQL3dlV3F0NWFJClhTK0ZnanRYbzZqUG1mWWRweDZ3bWp3UHRaZ1pRdXhSL2tsejVvQnErNnFaYUZDWXg4RT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eclient-key-data\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eLS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdGRuTGxvRXVycWhKZGswaDBOVXF6RUh4VG5lR0tONEEzbVgwaG5hS3BNU094SEpQClBxMHpXS3hYRXE1Nk9OR2FKSG9LRVNFQzZiOHYwZzBNOXV1RjlyckNVTkZKVzJnR3BQK0RvekxKVUt0bTdhdFgKVlFhc1VDa2NsVG1DTTdoeWo4ZlNOVEN3aXFPdE05QW9xVVUyWHdZNGtsYS9EbjJEQXNVdVZjYlE3SEwwNTdLRQpuNm9XOUVXL2ZDaExUTk5NaGZ6WmQ3MUhIazcwU05kM0xuY01zYzZqdnkvZDdjMG4zOHpOOUo1c1lWTk4zbEtWCi85TkxPYVpMRDRtKzJVTldXUVVrNG5yLytmOVpmTUgzYVZRYmw2UlhGcGltY2FoOFI0SU5oUTZIWG5lRG1CNnUKSXdEZ2NCeGFBS2g0VU9WVnA4MHVTL2lhRUtXVVJYTU9IOGFwWVFJREFRQUJBb0lCQVFDVkNJOXZJeVB0QkFKZwpyOG44NmhhUEc2UDFtTU1jandUTFAyZHRJNDF3aDU0eHBUVUl1czJQNkgzYjA1NWJIbnhqVkprWGZLUjBpTGxhClBsUFhzU0l6R00vVGlCSEVsYmFNVnRPOVZndml6dllsNWZ4R3RKZFhncm5vR2g5NDM3c1Qxc0dSMGZ0OVE3TFkKK2NtNUgvMzFWcFhhYUxsZjJNRWI3aG1STnNWV1lXWm9MUHJ2QUJPemVmUnpKU0RONHU0M3M0eVpnNHJoL3IzWQo3YUhYOS9CSHpJRk93WTRNL1BRQzdYaFhDMXBIeWNPY2lSWVhFTkpuMTdQN2NOSkdoMnJ4dnc2OVQ1QW9rdXY5Ckcxd2lUNmVrVmZuaVYrSlVnL1lwcTNSRGxNdVFETDRZdCtGNG1zVGJtN3NFZk5yVVMzWGZFMFdmcjB2Wk1YN2sKMnE3dXkxNEJBb0dCQU5jb1BxVHNBa3N5YzR6UWtmQmNzb0Y1ekdJM3NQTUFGTHRSMGF6S2x1Q1V3VGMzYVk5dgpiTE05OTBVK3VpVzdtRHF0VHpZMVNVSzZGNW0yMzJoSW5hTnBCTUVJcDZHQ0I3dis5WWZIQURVSkljaVdodmJhCmpIY0M5Qjl4SG5uUTBydU5aNUErdWVtRE9EZkRKUllIVUhrMEh3MlJpTE1qRFhVRmhBanJBUGJ4QW9HQkFOaGUKL3BHb2FWOWtUREtNOWZwTTZUQkZwMFVtb2lSb3crVG9TWjhWeVBmMkl1VlNpa0dtaXUydHU3MzZCZkJtVzNtQgpGWmFRc01rNkMydExkK1NBQ0lSbktQTUN4czYzR05WNkJ0aXRIRFlBaGNtRCtvU3VpaFRrd3l1WXlpQml4aFovCms1UDY3UHFKVkQ2YnhkNDV6YlFsS2VNaUVtMUhnQUVGSEF0UFBqbHhBb0dBYzNnaHhwankwakNOV3ZGRW9WN2UKWGlaanpnSmRjTXlHVTlHaFdiNlFJbzh5OHROR1Q3aFkrZ2t6ZjNJZXJNbDA5V2kxcmo0Q3gxRGdBWnJuWXl3MQpqZEY2djY1SmFLQkVUbHlTb1AvbjJJN0NGc2pTUGdFa2lXcUlZYWR2MTZoK3NERS9kMlp5bUNQWU0vVURIa05tCnFPV1VGTkFhTVNtS3UxYnVlV3JGNWNFQ2dZQnJvNTVySWVnQjM2aVVnVkdoU24rN1Z2dG15RmhqV29jUnFvbHQKamUzamhWeEl6eTRlaU5hV2RSWnY1U0R0UGs2RmZMVWJxVEY1ZWRuU2I4SGVOOStFMXJrbFk1MDVteGJNcEo4aApUY1U2RERxQ1RKamxSdHRFbDZXTVc3ODZLMGsyU2hORnk4LzJ0empreUtPLzhPdW5rZEZyd0RpQWl0QmdNWVdKCkRzdjYwUUtCZ1FDR2htYnZrODRaYm1sdERxYW9hOVR6YU5UT3FrN3dtb0tDby9FVEg5NEtNVVZMVmk3bHhpN1kKcXFQYUdiSm9aYkZGd0NvWW12Rk5jU21nYk9SNjdCVVBkdUEzMHo0VythV1pmQVkwZGpUR08yTC8zVVhoWHdHegpVUGpZTXZZQU5sdzFmZTVmZmk3UExJSGJvZXFhTmhhaDliRVJXdFNRbm95NnYzV2hlNTh6VkE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s run mitmproxy using the above client cert and keys:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003emitmproxy -p \u003cspan class=\"m\"\u003e9000\u003c/span\u003e --ssl-insecure --set \u003cspan class=\"nv\"\u003eclient_certs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;\u003cspan class=\"o\"\u003e(\u003c/span\u003ekubectl config view --minify --flatten -o\u003cspan class=\"o\"\u003e=\u003c/span\u003ego-template\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{{(index (index .users 0).user \u0026#34;client-key-data\u0026#34;)}}\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e base64 -d \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e kubectl config view --minify --flatten -o\u003cspan class=\"o\"\u003e=\u003c/span\u003ego-template\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{{(index (index .users 0).user \u0026#34;client-certificate-data\u0026#34;)}}\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e base64 -d\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, let\u0026rsquo;s make sure that we have some DNS alias to 127.0.0.1 to work around \u003ca href=\"https://maelvls.dev/go-ignores-proxy-localhost/\"\u003ethe Go proxy limitation\u003c/a\u003e which skips proxying for \u003ccode\u003e127.0.0.1\u003c/code\u003e and \u003ccode\u003elocalhost\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003egrep \u003cspan class=\"s2\"\u003e\u0026#34;^127.0.0.1.*local\u003c/span\u003e$\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e /etc/hosts \u003cspan class=\"o\"\u003e||\u003c/span\u003e sudo bash -c \u003cspan class=\"s1\"\u003e\u0026#39;echo \u0026#34;127.0.0.1 local\u0026#34; \u0026gt;\u0026gt; /etc/hosts\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFinally you can run \u003ccode\u003ekubectl\u003c/code\u003e to see the logs of \u003ccode\u003ekube-scheduler\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% \u003cspan class=\"nv\"\u003eHTTPS_PROXY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e:9000 kubectl --kubeconfig\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;\u003cspan class=\"o\"\u003e(\u003c/span\u003esed \u003cspan class=\"s2\"\u003e\u0026#34;s|127.0.0.1|local|\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$KUBECONFIG\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e --insecure-skip-tls-verify logs -n kube-system -l \u003cspan class=\"nv\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ekube-scheduler,tier\u003cspan class=\"o\"\u003e=\u003c/span\u003econtrol-plane\nI0701 11:11:11.585249       \u003cspan class=\"m\"\u003e1\u003c/span\u003e registry.go:150\u003cspan class=\"o\"\u003e]\u003c/span\u003e Registering EvenPodsSpread predicate and priority \u003cspan class=\"k\"\u003efunction\u003c/span\u003e\nI0701 11:11:11.585329       \u003cspan class=\"m\"\u003e1\u003c/span\u003e registry.go:150\u003cspan class=\"o\"\u003e]\u003c/span\u003e Registering EvenPodsSpread predicate and priority \u003cspan class=\"k\"\u003efunction\u003c/span\u003e\nI0701 11:11:12.976581       \u003cspan class=\"m\"\u003e1\u003c/span\u003e serving.go:313\u003cspan class=\"o\"\u003e]\u003c/span\u003e Generated self-signed cert in-memory\nW0701 11:11:17.407371       \u003cspan class=\"m\"\u003e1\u003c/span\u003e authentication.go:349\u003cspan class=\"o\"\u003e]\u003c/span\u003e Unable to get configmap/extension-apiserver-authentication in kube-system.  Usually fixed by \u003cspan class=\"s1\"\u003e\u0026#39;kubectl create rolebinding -n kube-system ROLEBINDING_NAME --role=extension-apiserver-authentication-reader --serviceaccount=YOUR_NS:YOUR_SA\u0026#39;\u003c/span\u003e\nW0701 11:11:17.407465       \u003cspan class=\"m\"\u003e1\u003c/span\u003e authentication.go:297\u003cspan class=\"o\"\u003e]\u003c/span\u003e Error looking up in-cluster authentication configuration: configmaps \u003cspan class=\"s2\"\u003e\u0026#34;extension-apiserver-authentication\u0026#34;\u003c/span\u003e is forbidden: User \u003cspan class=\"s2\"\u003e\u0026#34;system:kube-scheduler\u0026#34;\u003c/span\u003e cannot get resource \u003cspan class=\"s2\"\u003e\u0026#34;configmaps\u0026#34;\u003c/span\u003e in API group \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e in the namespace \u003cspan class=\"s2\"\u003e\u0026#34;kube-system\u0026#34;\u003c/span\u003e\nW0701 11:11:17.407483       \u003cspan class=\"m\"\u003e1\u003c/span\u003e authentication.go:298\u003cspan class=\"o\"\u003e]\u003c/span\u003e Continuing without authentication configuration. This may treat all requests as anonymous.\nW0701 11:11:17.407513       \u003cspan class=\"m\"\u003e1\u003c/span\u003e authentication.go:299\u003cspan class=\"o\"\u003e]\u003c/span\u003e To require authentication configuration lookup to succeed, \u003cspan class=\"nb\"\u003eset\u003c/span\u003e --authentication-tolerate-lookup-failure\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\nI0701 11:11:17.478349       \u003cspan class=\"m\"\u003e1\u003c/span\u003e registry.go:150\u003cspan class=\"o\"\u003e]\u003c/span\u003e Registering EvenPodsSpread predicate and priority \u003cspan class=\"k\"\u003efunction\u003c/span\u003e\nI0701 11:11:17.478483       \u003cspan class=\"m\"\u003e1\u003c/span\u003e registry.go:150\u003cspan class=\"o\"\u003e]\u003c/span\u003e Registering EvenPodsSpread predicate and priority \u003cspan class=\"k\"\u003efunction\u003c/span\u003e\nW0701 11:11:17.491616       \u003cspan class=\"m\"\u003e1\u003c/span\u003e authorization.go:47\u003cspan class=\"o\"\u003e]\u003c/span\u003e Authorization is disabled\nW0701 11:11:17.491729       \u003cspan class=\"m\"\u003e1\u003c/span\u003e authentication.go:40\u003cspan class=\"o\"\u003e]\u003c/span\u003e Authentication is disabled\nI0701 11:11:17.491883       \u003cspan class=\"m\"\u003e1\u003c/span\u003e deprecated_insecure_serving.go:51\u003cspan class=\"o\"\u003e]\u003c/span\u003e Serving healthz insecurely on \u003cspan class=\"o\"\u003e[\u003c/span\u003e::\u003cspan class=\"o\"\u003e]\u003c/span\u003e:10251\nI0701 11:11:17.500576       \u003cspan class=\"m\"\u003e1\u003c/span\u003e secure_serving.go:178\u003cspan class=\"o\"\u003e]\u003c/span\u003e Serving securely on 127.0.0.1:10259\nI0701 11:11:17.500678       \u003cspan class=\"m\"\u003e1\u003c/span\u003e tlsconfig.go:240\u003cspan class=\"o\"\u003e]\u003c/span\u003e Starting DynamicServingCertificateController\nI0701 11:11:17.500919       \u003cspan class=\"m\"\u003e1\u003c/span\u003e configmap_cafile_content.go:202\u003cspan class=\"o\"\u003e]\u003c/span\u003e Starting client-ca::kube-system::extension-apiserver-authentication::client-ca-file\nI0701 11:11:17.500931       \u003cspan class=\"m\"\u003e1\u003c/span\u003e shared_informer.go:223\u003cspan class=\"o\"\u003e]\u003c/span\u003e Waiting \u003cspan class=\"k\"\u003efor\u003c/span\u003e caches to sync \u003cspan class=\"k\"\u003efor\u003c/span\u003e client-ca::kube-system::extension-apiserver-authentication::client-ca-file\nI0701 11:11:17.718085       \u003cspan class=\"m\"\u003e1\u003c/span\u003e shared_informer.go:230\u003cspan class=\"o\"\u003e]\u003c/span\u003e Caches are synced \u003cspan class=\"k\"\u003efor\u003c/span\u003e client-ca::kube-system::extension-apiserver-authentication::client-ca-file\nI0701 11:11:17.801300       \u003cspan class=\"m\"\u003e1\u003c/span\u003e leaderelection.go:242\u003cspan class=\"o\"\u003e]\u003c/span\u003e attempting to acquire leader lease  kube-system/kube-scheduler...\nI0701 11:11:34.659176       \u003cspan class=\"m\"\u003e1\u003c/span\u003e leaderelection.go:252\u003cspan class=\"o\"\u003e]\u003c/span\u003e successfully acquired lease kube-system/kube-scheduler\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIt works!! Here is what mitmproxy is showing:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e18:17:42 GET  HTTPS   \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e /api/v1/namespaces/kube-system/pods/kube-scheduler-helix-control-plane      \u003cspan class=\"m\"\u003e200\u003c/span\u003e …plication/json  5.2k 119ms\n18:17:42 GET  HTTPS   \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e /api/v1/namespaces/kube-system/pods/kube-scheduler-helix-control-plane/log  \u003cspan class=\"m\"\u003e200\u003c/span\u003e      text/plain 2.46k 227ms\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1593623844,"description":"Mitmproxy is an excellent tool that helps us understand what network calls are made by programs. And kubectl is one of these interesting programs, but it uses a mutual TLS authentication which is tricky to get right.","dir":"2020/mitmproxy-kubectl/","expirydate":-62135596800,"fuzzywordcount":500,"images":["mitmproxy-kubectl/cover-mitmproxy-kubectl.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1593623844,"objectID":"5e528729d492260b094df30e03c40d47","permalink":"https://maelvls.dev/mitmproxy-kubectl/","publishdate":"2020-07-01T19:17:24+02:00","readingtime":3,"relpermalink":"/mitmproxy-kubectl/","section":"2020","summary":"In Oct 2019, Ahmet Alp Balkan wrote this blog post that explains how to use mitmproxy to observe the requests made by kubectl. But I couldn\u0026rsquo;t use the tutorial for two reasons:\n I use kind to create local clusters which means I hit the Go net/http limitation (skips proxying for hosts localhost and 127.0.0.1, see this blog post) I use client certs authentication, which can\u0026rsquo;t work with the method presented by Ahmet; it can only work for header-based authentication (e.","tags":["kubernetes","mitmproxy","networking","kind"],"title":"Using mitmproxy to understand what kubectl does under the hood","type":"2020","url":"https://maelvls.dev/mitmproxy-kubectl/","weight":0,"wordcount":489},{"authors":null,"categories":null,"content":"","date":1590864306,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1590864306,"objectID":"","permalink":"https://maelvls.dev/tags/autotools/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/autotools/","section":"tags","summary":"","tags":null,"title":"autotools","type":"tags","url":"https://maelvls.dev/tags/autotools/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1590864306,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1590864306,"objectID":"","permalink":"https://maelvls.dev/tags/c/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/c/","section":"tags","summary":"","tags":null,"title":"c","type":"tags","url":"https://maelvls.dev/tags/c/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1590864306,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1590864306,"objectID":"","permalink":"https://maelvls.dev/tags/c++/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/c++/","section":"tags","summary":"","tags":null,"title":"c++","type":"tags","url":"https://maelvls.dev/tags/c++/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eBetween May and June 2016, I worked with \u003ca href=\"https://github.com/polazarus/ocamlyices\"\u003eocamlyices2\u003c/a\u003e, an OCaml package that binds to the \u003ca href=\"https://github.com/SRI-CSL/yices2\"\u003eYices\u003c/a\u003e C++ library. Both projects (as well as many Linux projects) are built using the \u0026ldquo;Autotools\u0026rdquo; suite.\u003c/p\u003e\n\u003cp\u003eThe Autotools suite includes tools like \u003ca href=\"https://www.gnu.org/software/autoconf/\"\u003eautoconf\u003c/a\u003e, \u003ca href=\"https://www.gnu.org/software/automake\"\u003eautomake\u003c/a\u003e and \u003ca href=\"https://www.gnu.org/software/libtool/\"\u003elibtool\u003c/a\u003e. These tools generate a bunch of shell scripts and Makefiles using shell scripts and the \u003ca href=\"https://en.wikipedia.org/wiki/M4_(computer_language)\"\u003eM4\u003c/a\u003e macro language. The user of your projects ends up two simple commands to build your project:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e./configure\nmake\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eWhy did I bother with this? As part of my PhD, I worked on a tool, \u003ca href=\"https://github.com/touist/touist\"\u003etouist\u003c/a\u003e, which uses SMT solvers like Yices. The \u003ccode\u003etouist\u003c/code\u003e CLI was written in OCaml (a popular language among academics, including my supervisor), which meant I had to go through hoops to interoperate with C/C++ solvers like Yices.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eMy first challenge with ocamlyices2 was the fact that I needed a statically-linked \u003ccode\u003elibyices.a\u003c/code\u003e. And since Yices depends on \u003ca href=\"https://gmplib.org/\"\u003eGMP\u003c/a\u003e, I had to dive deep into Yices2\u0026rsquo;s \u003ccode\u003econfigure.ac\u003c/code\u003e and find a way to select the static version of GMP.\u003c/p\u003e\n\u003cp\u003eBut building a static library \u003ccode\u003elibyices.a\u003c/code\u003e was not enough. I was to build in PIC mode (position-independant code, enabled with \u003ccode\u003e-fPIC\u003c/code\u003e in gcc). The position-independant code is required when you want to embed a static library into a dynamically-linked library. That\u0026rsquo;s due to the fact that OCaml requires both the \u003ccode\u003e.so\u003c/code\u003e and \u003ccode\u003e.a\u003c/code\u003e versions of the \u0026ldquo;stub\u0026rdquo; library (a stub library is a C library that wraps another C library using OCaml C primitives). And naturally, Yices' build system had not been written to support building a static PIC \u003ccode\u003elibyices.a\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eI remember these days as an epic struggle against old build systems. This experience taught me everything about \u003ccode\u003eautoconf\u003c/code\u003e, Makefiles, position-independant code, \u003ccode\u003egcc\u003c/code\u003e, \u003ccode\u003eldd\u003c/code\u003e and \u003ccode\u003elibtool\u003c/code\u003e. And in this post, I want to share these discoveries and how I progressed into contributing to the \u003ca href=\"https://github.com/polazarus/ocamlyices\"\u003eocamlyices2\u003c/a\u003e project.\u003c/p\u003e\n\u003cp\u003eHere is a diagram showing the dependencies between libraries. Ocamlyices2 depends on Yices and Yices depends on GMP.\u003c/p\u003e\n\u003cdiv class=\"nohighlight\"\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e                            build:   dune\n             touist         lang:    ocaml\n                |           output:  touist binary (statically linked)\n                |\n                |\n                |depends on\n                |\n                |\n                |\n                v\n           ocamlyices2      build:   autoconf + make\n                |           lang:    ocaml + C\n                |           output:  libyices2_stubs.a\n                |\n                |depends on\n                |\n                |\n                |\n                v           build:   autoconf + hacky make\n              yices         lang:    C++\n                |           output:  libyices.a (with PIC enabled)\n                |\n                |\n                |depends on\n                |\n                |\n                |\n                v           build:   autoconf + automake + libtool\n               gmp          lang:    C, assembly\n                            output:  libgmp.a (with PIC enabled)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c!-- https://textik.com/#23689eecb0630a77 --\u003e\n\u003cp\u003eThe most important thing about this diagram is that since we need a PIC-enabled static library \u003ccode\u003elibyices.a\u003c/code\u003e in order to build the \u0026ldquo;binding libraries\u0026rdquo;: the shared library \u003ccode\u003eyices2.cmxs\u003c/code\u003e and the static library \u003ccode\u003elibyices2_stubs.a\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eAnd in order to get this PIC-enabled \u003ccode\u003elibyices.a\u003c/code\u003e, I needed to make sure that the GMP library picked by the Yices \u003ccode\u003e./configure\u003c/code\u003e would be static and PIC-enabled.\u003c/p\u003e\n\u003cp\u003eIn early 2016, the Yices build system was limited to building a shared library with no support for cross-compilation (a requirement to build on Windows) and no support for enforcing PIC in \u003ccode\u003elibgmp.a\u003c/code\u003e and \u003ccode\u003elibyices.a\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"yices2--autoconf-an-attempt-at-fixing-a-limited-build-system\"\u003eYices2 \u0026amp; autoconf: an attempt at fixing a limited build system\u003c/h2\u003e\n\u003cp\u003eI remember the warmth that we had in May 2016. My daughter had turned three and we were still living in a tiny appartment since I was technically still a student.\u003c/p\u003e\n\u003cp\u003eMy first patch to the ocamlyices2 project took over a month of intense work. The stake was immense: I aimed at revamping the whole Yices2 build system. The original build system didn\u0026rsquo;t allow developers to statically build \u003ccode\u003elibyices.a\u003c/code\u003e. More generally, it was a pain to work with: most configuration was happening at \u003ccode\u003e./configure\u003c/code\u003e time, but a ton of things had still to be passed at make time (e.g., \u003ccode\u003emake VAR=value\u003c/code\u003e).\u003c/p\u003e\n\u003cp\u003eThis change (\u003ca href=\"https://github.com/polazarus/ocamlyices2/commit/25f5eb15\"\u003e25f5eb15\u003c/a\u003e) brought a ton of features. But the most important ones were:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eBetter \u003ccode\u003e./configure \u0026amp;\u0026amp; make\u003c/code\u003e experience\u003c/strong\u003e. Instead of having some parts of the build configuration being passed as Makefile variables, I moved everything to nice flags that you would pass to \u003ccode\u003e./configure\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eProper PIC support\u003c/strong\u003e. Sometimes, Yices' \u003ccode\u003e./configure\u003c/code\u003e would pick up a \u003ccode\u003elibgmp.a\u003c/code\u003e that would not be \u0026ldquo;PIC\u0026rdquo;. So I wrote a new \u003ca href=\"https://en.wikipedia.org/wiki/M4_(computer_language)\"\u003eM4\u003c/a\u003e macro, \u003ccode\u003eCSL_CHECK_STATIC_GMP_HAS_PIC\u003c/code\u003e, that would do the PIC check using libtool. For example, the developer would be able to ask for a static library with PIC support:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e./configure --with-pic --enable-static --disable-shared --with-pic-gmp\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$PWD\u003c/span\u003e/with-pic/libgmp.a\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eStatic \u003ccode\u003elibyices.a\u003c/code\u003e\u003c/strong\u003e. The original build system did not\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eUsing \u003ccode\u003elibtool\u003c/code\u003e\u003c/strong\u003e. Instead of hand-crafted targets for building the static \u0026amp; dynamic libraries, \u003ccode\u003elibtool\u003c/code\u003e allowed me to build both with very little effort (at the cost of slightly longer build times). I remember trying to fiddle with the Makefile to be able to get PIC/non-PIC as well as dynamic/static \u003ccode\u003e.o\u003c/code\u003e units. Using \u003ccode\u003elibtool\u003c/code\u003e made it so easier to build simultanously the static and dynamic versions of \u003ccode\u003elibyices\u003c/code\u003e (\u003ccode\u003elibyices.a\u003c/code\u003e and \u003ccode\u003elibyices.so\u003c/code\u003e).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eCross-compilation\u003c/strong\u003e. I wanted to be able to release binaries for Windows users, which meant that I needed to cross-compile from a Cygwin environment to a Win32 executable.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eI also fixed weird bugs like a failure on Alpine 3.5 due to a race condition in \u003ccode\u003eltmain.sh\u003c/code\u003e. Yes, you heard well! A race condition in a build system!\u003c/p\u003e\n\u003cp\u003eNot sure, but \u003ca href=\"https://github.com/polazarus/ocamlyices2/commit/25f5eb15\"\u003e25f5eb15\u003c/a\u003e might be my biggest commit ever:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003eAuthor: Maël Valais \u0026lt;mael.valais@gmail.com\u0026gt;\nDate:   Fri May 5 10:31:37 2017 +0200\nCommit: 25f5eb15\n\n    libyices: build system: moved all config from Makefile to ./configure\n\n    What I tried to fix:\n    * Impossible to produces static archive libyices.a for the mingw32 host.\n    * So much configuration done in Makefile instead of ./configure.\n    * The \u0026#39;make build OPTION= MODE=\u0026#39; is kind of unexpected and not really standard.\n    * As an end-user builder, it is hard to guess that my system-installed libgmp.a\n      is not PIC. The build system should help me with that.\n    * CFLAGS and CPPFLAGS cannot be overritten by the end-user builder at \u0026#39;make\u0026#39;\n      time. See \u0026#39;Preset Output Variables\u0026#39; in the autoconf manual.\n    * `smt2_commands.c`, `smt2_parser.c` and `smt2_term_stack.c` are all including\n      `smt2_commands.h`, and in `smt2_commands.h` there is a definition of a type,\n      so there is a clash of symbols at link time. Solution 1: use \u0026#39;extern\u0026#39; in .h\n      and definition in .c. Solution 2: typedef the enum.\n    * The build system should be fully parallel-proof. Note that \u0026#39;make -j\u0026#39; is a\n      thread bomb; prefer using \u0026#39;make -j4\u0026#39; if you have 4 processors.\n    * Why removing libyices.a when using \u0026#39;dist\u0026#39;? (rm -f $(distdir)/lib/libyices.a)\n      libyices.a should be distributed to the end-users along with the shared lib.\n    * Why does libgmp.a contain more than libgmp.so? I guess it is because some\n      function are needed by the tests and the tests are never dynamically linked\n      to the shared libyices.so... For example, the test `test_type_matching` calls\n      a function \u0026#39;delete_pstore\u0026#39; that is not exported. This means we cannot use the\n      created libyices.so! We must instead use the object files directly.\n\n    Features of the new build system:\n    * It is now possible to select what you want to build using --enable-static\n      and --enable-shared. By default, both are built. You can speed up the build\n      by disabling one of the modes, for example --disable-shared.\n    * Running ./configure will tell you if the libgmp.a found/given with\n      --with-static-gmp or --with-pic-gmp is PIC or not.\n    * Libtool now handles all shared library naming with version number and symbolic\n      links. on linux, .so, on mac os .dylib, on windows .a, .dll.a and .dll...\n    * It is now possible to choose if you want PIC-only code in the static\n      library libyices.a using --with-pic.\n    * The ./configure now configures and the Makefile makes; moved all the\n      configuration steps that were done in the Makefile.\n    * It is not required anymore to pass OPTION when using make. OPTION is now\n      handled by passing for example --host=i686-w64-mingw32 when running\n      ./configure, instead of \u0026#39;make OPTION=mingw32\u0026#39;,\n    * It is not required anymore to pass MODE in make. MODE is now handled by\n      the argument --with-mode=release (for example) when running ./configure.\n    * Removed the confusing mess of build/\u0026lt;host\u0026gt;/... and configs/make.\u0026lt;host\u0026gt;.\n      Build objects are simply put in build/.\n    * Merged the many Makefiles that were sharing a lot of code in common.\n    * Standardized the \u0026#39;make\u0026#39; target and experience:\n      - make build for building binaries and library (no need for OPTION or MODE)\n      - make dist (non-standard) for showing the results of the build as it would\n        be distributed\n      - make distclean for removing any files created by ./configure\n      - make lib if you only want the library\n      - make install and uninstall for installing/uninstalling (DESTDIR supported)\n    * On Windows, we can now build a static library libyices.a.\n    * On Windows, shared and static libraries can be built at once. The static\n      version of libyices.a can be renamed using --with-static-name.\n    * DESTDIR works as expected: it will reproduce the hierarchy using the prefix\n      when running \u0026#39;make install DESTDIR=/path\u0026#39;\n    * A nice summary of the configuration is now printed when running ./configure.\n      It allows to check if libgmp.a is PIC or not, and helps to have a clear\n      view of what is going to happen.\n    * Moved version number of Yices in configure.ac\n    * If the user wants to use --with-pic-gmp but his libgmp.a is not PIC, give him\n      an indication of what command to run to build the with-PIC libgmp.a.\n    * Moved the gmaketest into configure; warn the user if \u0026#39;make\u0026#39; is not gnu make.\n    * Parallel build is now fully supported (make -j)\n    * when using --with-static-gmp (and other similar flags), try to find gmp.h\n      in . and ../include automatically, and fall back with the system-wide gmp.h\n    * check for gmp.h even when no --with-static-gmp-include-dir is given\n    * moved all csl_* functions into autoconf/m4/csl_check_libs.m4 so that they\n      can be reused somewhere else\n    * compute dependencies only if not in release mode and at compile time\n      instead of ahead of time. This saves time during compilation, because deps\n      are not necessary if the .c or .h files are not changed (i.e., if the builder\n      is the end-user). If the builder is a developer, then he will set\n      --with-mode={debug,profile...} and this will trigger the deps to be computed.\n    * \u0026#39;make test\u0026#39; compiles and runs all tests in tests/unit\n    * \u0026#39;make test_api12\u0026#39; will compile and run the test tests/unit/test_api12.c\n    * removed version_*.c file as it is rebuilt at make time\n    * gperf is now only necessary when changing the tokens.txt or keywords.txt files,\n      the end-user builder does not have to have gperf installed.\n\n    Side notes:\n    * CPPFLAGS, CFLAGS, LDFLAGS and any other makefile variable can be overwritten\n      using \u0026#39;make LDFLAGS=...\u0026#39; (was already the case with the previous version of the\n      build system)\n\n    Known issues:\n    * on Mac OS X, linking executables agains non-PIC libgmp.a will throw the\n      following warning:\n      ld: warning: PIE disabled. Absolute addressing (perhaps -mdynamic-no-pic)\n      not allowed in code signed PIE, but used in ___gmpn_mul_1 from libgmp.a(mul_1.o).\n      To fix this warning, don\u0026#39;t compile with -mdynamic-no-pic or link with -Wl,-no_pie\n\n    Todo:\n    * produce libyices.def on Windows\n    * make sure the test on libgmp-10.dll is future-proof (remove the \u0026#39;-10\u0026#39;)\n    * fix the \u0026#39;echo summary\u0026#39;\n    * I did not test the checks made configure.ac on mcsat and libpoly; we should\n      do the same tests as done on libgmp.a (for checking that it is PIC) and\n      add a helping message at the end of configure.ac.\n    * For the tests, I read that two kind of tests were compiled:\n      - \u0026#39;tests\u0026#39; where the tests are linked to the non-PIC libgmp.a and static libgmp.a\n      - \u0026#39;tests-static\u0026#39; where the tests are linked to the PIC libgmp.a and shared\n        GMP library.\n      I changed the second one: it links to the shared version of libyices and shared\n      version of GMP. But building the with-PIC libyices.a would be really easy\n      (and it is still possible using the flag --with-pic).\n    * \u0026#39;make dist\u0026#39; is not a staging area (for now) for \u0026#39;make install\u0026#39;. They both\n      install from built objects.\n    * it is not possible to compile the tests against the shared library\n      because many symbols which are used in the tests are not exported (\u0026#39;export\u0026#39;\n      in the C code). They exist if we do \u0026#39;nm\u0026#39; but they are just not usable.\n\n    * pstore issue:\n\n    The visibility is T (visible) in static mode and t (hidden) in shared mode. This\n    is because \u0026#39;abstract_values.c\u0026#39; has not been \u0026#39;exported\u0026#39; (=added in `yices_api.c`).\n    Here is an example of the difference (functions from )\n    ```\n    # nm build/lib/libyices.a | grep pstore\n    0000000000000090 T _delete_pstore\n    0000000000000000 T _init_pstore\n    # nm build/lib/.libs/libyices.2.dylib | grep pstore\n    0000000000037e10 t _delete_pstore\n    0000000000037d80 t _init_pstore\n    ```\n\n    I tweaked the ltmain.sh to be able to pass different CPPFLAGS for the compilation\n    of static and shared objects by the `%.o: %.c` rule. CPPFLAGS must be different\n    because of Windows dlls: `-DNOYICES_DLL -D__GMP_LIBGMP_DLL=0` for example.\n\n    I added two variables LT_STATIC_CFLAGS and LT_SHARED_CFLAGS. They allow me\n    to pass CFLAGS to libtool for .c -\u0026gt; .o targets. It allows me to pass things\n    like -DYICES_STATIC, -DNOYICES_DLL and -D_LIBGMP_DLL.\n\n    ``` diff\n    diff --git a/ext/yices/autoconf/ltmain.sh b/ext/yices/autoconf/ltmain.sh\n    index bf5d83b..7b7dd3a 100644\n    --- a/ext/yices/autoconf/ltmain.sh\n    +++ b/ext/yices/autoconf/ltmain.sh\n    @@ -3500,10 +3500,10 @@ compiler.\u0026#34;\n           fbsd_hideous_sh_bug=$base_compile\n\n           if test no != \u0026#34;$pic_mode\u0026#34;; then\n    -       command=\u0026#34;$base_compile $qsrcfile $pic_flag\u0026#34;\n    +       command=\u0026#34;$base_compile $LT_SHARED_CFLAGS $qsrcfile $pic_flag\u0026#34;\n           else\n            # Don\u0026#39;t build PIC code\n    -       command=\u0026#34;$base_compile $qsrcfile\u0026#34;\n    +       command=\u0026#34;$base_compile $LT_SHARED_CFLAGS $qsrcfile\u0026#34;\n           fi\n\n           func_mkdir_p \u0026#34;$xdir$objdir\u0026#34;\n    @@ -3552,9 +3552,9 @@ compiler.\u0026#34;\n         if test yes = \u0026#34;$build_old_libs\u0026#34;; then\n           if test yes != \u0026#34;$pic_mode\u0026#34;; then\n            # Don\u0026#39;t build PIC code\n    -       command=\u0026#34;$base_compile $qsrcfile$pie_flag\u0026#34;\n    +       command=\u0026#34;$base_compile $LT_STATIC_CFLAGS $qsrcfile$pie_flag\u0026#34;\n           else\n    -       command=\u0026#34;$base_compile $qsrcfile $pic_flag\u0026#34;\n    +       command=\u0026#34;$base_compile $LT_STATIC_CFLAGS $qsrcfile $pic_flag\u0026#34;\n           fi\n           if test yes = \u0026#34;$compiler_c_o\u0026#34;; then\n            func_append command \u0026#34; -o $obj\u0026#34;\n    ```\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhat a massive commit message, right?!\u003c/p\u003e\n\u003cp\u003eOviously, I still needed to use all the new features that I had just addeed to the Yices \u003ccode\u003e./configure\u003c/code\u003e. So I proposed a second patch (\u003ca href=\"https://github.com/polazarus/ocamlyices2/commit/ccb5a563\"\u003eccb5a563\u003c/a\u003e) with changes to the ocamlyices2\u0026rsquo;s own \u003ccode\u003e./configure\u003c/code\u003e; that took the form of new flags so that I would be able to build a static \u003ccode\u003elibyices.a\u003c/code\u003e by specifying the static version of the GMP library \u003ccode\u003elibgmp.a\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eI also used the new cross-compilation capability of the Yices \u003ccode\u003e./configure\u003c/code\u003e so that it would be possible to build ocamlyices2 on Windows. The compilation would rely on the POSIX-compliant \u003ca href=\"https://www.cygwin.com/\"\u003eCygwin\u003c/a\u003e suite and cross-compile to a native Win32 executable using \u003ca href=\"http://www.mingw.org/\"\u003eMinGW32\u003c/a\u003e (which a port of GCC).\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"nx\"\u003eAuthor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMaël\u003c/span\u003e \u003cspan class=\"nx\"\u003eValais\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003emael\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalais\u003c/span\u003e\u003cspan class=\"err\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003egmail\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecom\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"nx\"\u003eFri\u003c/span\u003e \u003cspan class=\"nx\"\u003eMay\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e46\u003c/span\u003e \u003cspan class=\"mi\"\u003e2017\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mo\"\u003e0200\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eCommit\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eccb5a563\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eocamlyices2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eonly\u003c/span\u003e \u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003estub\u003c/span\u003e \u003cspan class=\"nx\"\u003eusing\u003c/span\u003e \u003cspan class=\"nx\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eThe\u003c/span\u003e \u003cspan class=\"nx\"\u003elibrary\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003ebe\u003c/span\u003e \u003cspan class=\"nx\"\u003esearched\u003c/span\u003e \u003cspan class=\"nx\"\u003ein\u003c/span\u003e \u003cspan class=\"nx\"\u003esystem\u003c/span\u003e \u003cspan class=\"nx\"\u003edirs\u003c/span\u003e \u003cspan class=\"nx\"\u003eor\u003c/span\u003e \u003cspan class=\"nx\"\u003eyou\u003c/span\u003e \u003cspan class=\"nx\"\u003ecan\u003c/span\u003e \u003cspan class=\"nx\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003eflag\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003ewith\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003estatic\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003egmp\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ewhen\u003c/span\u003e \u003cspan class=\"nx\"\u003erunning\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003econfigure\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"nx\"\u003esetting\u003c/span\u003e \u003cspan class=\"nx\"\u003eyour\u003c/span\u003e \u003cspan class=\"nx\"\u003eown\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e \u003cspan class=\"nx\"\u003eIf\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eno\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003efound\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003eshared\u003c/span\u003e \u003cspan class=\"nx\"\u003elibrary\u003c/span\u003e \u003cspan class=\"nx\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003eused\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e \u003cspan class=\"nx\"\u003eYou\u003c/span\u003e \u003cspan class=\"nx\"\u003ecan\u003c/span\u003e \u003cspan class=\"nx\"\u003eforce\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eof\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eshared\u003c/span\u003e \u003cspan class=\"nx\"\u003egmp\u003c/span\u003e \u003cspan class=\"nx\"\u003elibrary\u003c/span\u003e \u003cspan class=\"nx\"\u003ewith\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003ewith\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eshared\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003egmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eIf\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003ewith\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eshared\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003egmp\u003c/span\u003e \u003cspan class=\"nx\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003enot\u003c/span\u003e \u003cspan class=\"nx\"\u003egiven\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003ethat\u003c/span\u003e \u003cspan class=\"nx\"\u003ehas\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeen\u003c/span\u003e \u003cspan class=\"nx\"\u003efound\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003ebe\u003c/span\u003e \u003cspan class=\"nx\"\u003eincluded\u003c/span\u003e \u003cspan class=\"nx\"\u003ein\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003elist\u003c/span\u003e \u003cspan class=\"nx\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003einstalled\u003c/span\u003e \u003cspan class=\"nx\"\u003efiles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e \u003cspan class=\"nx\"\u003eThe\u003c/span\u003e \u003cspan class=\"nx\"\u003ereason\u003c/span\u003e \u003cspan class=\"nx\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003ebecause\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003ewe\u003c/span\u003e \u003cspan class=\"nx\"\u003ewant\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003eshared\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003egmp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003efree\u003c/span\u003e \u003cspan class=\"nx\"\u003ebinary\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ezarith\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003esometimes\u003c/span\u003e \u003cspan class=\"nx\"\u003epick\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eshared\u003c/span\u003e \u003cspan class=\"nf\"\u003elibrary\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewith\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003elgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003eover\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003elbirary\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eIncluding\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003ein\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003edistribution\u003c/span\u003e \u003cspan class=\"nx\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003eocamlyices2\u003c/span\u003e \u003cspan class=\"nx\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003econvenience\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ecreating\u003c/span\u003e \u003cspan class=\"nx\"\u003egmp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eshared\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003efree\u003c/span\u003e \u003cspan class=\"nx\"\u003ebinaries\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eWhy\u003c/span\u003e \u003cspan class=\"nx\"\u003edo\u003c/span\u003e \u003cspan class=\"nx\"\u003ewe\u003c/span\u003e \u003cspan class=\"nx\"\u003eprefer\u003c/span\u003e \u003cspan class=\"nx\"\u003eusing\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003eversion\u003c/span\u003e \u003cspan class=\"nx\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"err\"\u003e?\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e==================================================\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eThis\u003c/span\u003e \u003cspan class=\"nx\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003ebecause\u003c/span\u003e \u003cspan class=\"nx\"\u003ewe\u003c/span\u003e \u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003enon\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ePIC\u003c/span\u003e \u003cspan class=\"nx\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003eversion\u003c/span\u003e \u003cspan class=\"nx\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003elibyices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e \u003cspan class=\"nx\"\u003eIf\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ewe\u003c/span\u003e \u003cspan class=\"nx\"\u003ewanted\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e \u003cspan class=\"nx\"\u003eboth\u003c/span\u003e \u003cspan class=\"nx\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003eand\u003c/span\u003e \u003cspan class=\"nx\"\u003eshared\u003c/span\u003e \u003cspan class=\"nx\"\u003estubs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewe\u003c/span\u003e \u003cspan class=\"nx\"\u003eshould\u003c/span\u003e \u003cspan class=\"nx\"\u003eeither\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003ePIC\u003c/span\u003e \u003cspan class=\"nx\"\u003elibyices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003ebut\u003c/span\u003e \u003cspan class=\"nx\"\u003eit\u003c/span\u003e \u003cspan class=\"nx\"\u003ewould\u003c/span\u003e \u003cspan class=\"nx\"\u003econflict\u003c/span\u003e \u003cspan class=\"nx\"\u003ewith\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003enon\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ePIC\u003c/span\u003e \u003cspan class=\"nx\"\u003eone\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003eshared\u003c/span\u003e \u003cspan class=\"nx\"\u003elibrary\u003c/span\u003e \u003cspan class=\"nx\"\u003elibyices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eFor\u003c/span\u003e \u003cspan class=\"nx\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eI\u003c/span\u003e \u003cspan class=\"nx\"\u003echose\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003ejust\u003c/span\u003e \u003cspan class=\"nx\"\u003eskip\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003eshared\u003c/span\u003e \u003cspan class=\"nf\"\u003estubs\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edllyices2_stubs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eso\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eAlso\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\n    \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003eturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eon\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nf\"\u003efPIC\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ein\u003c/span\u003e \u003cspan class=\"nx\"\u003econfigure\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003eonly\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003enon\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003egmp\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003eadded\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003eway\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003elink\u003c/span\u003e \u003cspan class=\"nx\"\u003estatically\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003elibgmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003ewith\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003estatic\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003egmp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003euse\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003einstead\u003c/span\u003e \u003cspan class=\"nx\"\u003eof\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eI\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"nx\"\u003ecompiling\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ec\u003c/span\u003e \u003cspan class=\"nx\"\u003ein\u003c/span\u003e \u003cspan class=\"nx\"\u003eocamlc\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eThis\u003c/span\u003e \u003cspan class=\"nx\"\u003eoption\u003c/span\u003e \u003cspan class=\"nx\"\u003euses\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003echange\u003c/span\u003e \u003cspan class=\"nx\"\u003eI\u003c/span\u003e \u003cspan class=\"nx\"\u003emade\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e \u003cspan class=\"nx\"\u003esystem\u003c/span\u003e \u003cspan class=\"nx\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003elibyices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eWhy\u003c/span\u003e\u003cspan class=\"err\"\u003e?\u003c/span\u003e \u003cspan class=\"nx\"\u003eBecause\u003c/span\u003e \u003cspan class=\"nx\"\u003eI\u003c/span\u003e \u003cspan class=\"nx\"\u003ewant\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003epossibility\u003c/span\u003e \u003cspan class=\"nx\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003eproducing\u003c/span\u003e \u003cspan class=\"nx\"\u003ebinaries\u003c/span\u003e \u003cspan class=\"nx\"\u003ethat\u003c/span\u003e \u003cspan class=\"nx\"\u003edo\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enot\u003c/span\u003e \u003cspan class=\"nx\"\u003eneed\u003c/span\u003e \u003cspan class=\"nx\"\u003eany\u003c/span\u003e \u003cspan class=\"nx\"\u003edll\u003c/span\u003e \u003cspan class=\"nx\"\u003ealongside\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eGuess\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003ehost\u003c/span\u003e \u003cspan class=\"nx\"\u003esystem\u003c/span\u003e \u003cspan class=\"nx\"\u003eand\u003c/span\u003e \u003cspan class=\"nx\"\u003epass\u003c/span\u003e \u003cspan class=\"nx\"\u003eit\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003elibyices\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003econfigure\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e========================================================\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eIt\u003c/span\u003e \u003cspan class=\"nx\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003enow\u003c/span\u003e \u003cspan class=\"nx\"\u003epossible\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003euse\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003econfigure\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"nx\"\u003emingw32\u003c/span\u003e \u003cspan class=\"nx\"\u003ecross\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ecompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA month past and I soon realized that GMP was not embedded at all in \u003ccode\u003elibyices.a\u003c/code\u003e. I could see the symbols as undefined (\u003ccode\u003eU\u003c/code\u003e) when running \u003ccode\u003enm libyices.a\u003c/code\u003e. It took me a while to figure this out\u0026hellip; back to tweaking the fragile Yices \u003ccode\u003e./configure\u003c/code\u003e!\u003c/p\u003e\n\u003cp\u003eAlong the way, I also realized how different Linux distributions are. Arch Linux is notably lacking support for partial linking (\u003ccode\u003eld -r\u003c/code\u003e). Which meant I had to add a flag for this specific purpose in commit \u003ca href=\"https://github.com/polazarus/ocamlyices2/commit/38200b0a\"\u003e38200b0a\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003eAuthor: Maël Valais \u0026lt;mael.valais@gmail.com\u0026gt;\nDate:   Fri Jun 16 21:18:37 2017 +0200\nCommit: 38200b0a\n\n    libyices: added option --without-gmp-embedded\n\n    This option will disable the partial linking that allows to embed\n    GMP into libyices.a (only with --enable-static).\n\n    For example, on Arch linux, the partial linking command\n\n        ld -r -lgmp *.o -o libyices.o\n\n    would fail even if libgmp.so is correclty installed. It seems that \u0026#39;ld -r\u0026#39;\n    would only work with a static libgmp.a (but the arch linux repo only installs\n    the shared gmp library).\n\n    Why this `ld -r`? This command is the only way I found to compile a\n    static libyices.a from either a shared or a static libgmp and produce\n    a gmp-depend-free libyices.a.\n\n    Two solutions:\n\n    1. Drop the necessity for building a libyices.a free of gmp dependency.\n       In this case, I could remove the `ld -r`.\n       It would then create a libyices.a that depends on libgmp.a/so.\n    2. Separate the gmp-dependency-free libyices.a from the normal\n       gmp-dependent libyices.a. For example, I could use the option\n       `--without-gmp-embedded`\n\n    So I went with solution (2).\n\n    This option disables the embedding of GMP inside libyices.a. This\n    \u0026#39;embedding\u0026#39; is made using partial linking (ld -r) which seems to\n    be failing on Arch Linux when using the shared GMP library.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAlthough I had already added a check (\u003ccode\u003eCSL_CHECK_STATIC_GMP_HAS_PIC\u003c/code\u003e in \u003ca href=\"https://github.com/polazarus/ocamlyices2/commit/25f5eb15\"\u003e25f5eb15\u003c/a\u003e) to make sure that the user-provided libgmp was PIC when using \u003ccode\u003e--with-pic\u003c/code\u003e, I realized that it was trickier that what I thought in \u003ca href=\"https://github.com/polazarus/ocamlyices2/commit/55c8e92a\"\u003e55c8e92a\u003c/a\u003e\u0026hellip;\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003eAuthor: Maël Valais \u0026lt;mael.valais@gmail.com\u0026gt;\nDate:   Sat Jun 17 14:09:12 2017 +0200\nCommit: 55c8e92a\n\n    libyices: with --enable-static and --with-pic, enforce PIC libgmp.a\n\n    One problem I came across was that most of the time, when I was doing\n\n        ./configure --enable-static --with-pic\n\n    the produced libyices.a would still contain non-PIC libgmp.a, although\n    being itself PIC. In this commit, I enforce that if --with-pic is given,\n    then:\n\n    1) either --with-pic-gmp has been given, in this case we use that for\n       creating the PIC libyices.a;\n    2) or --with-pic-gmp has not been given and thus we try to simply use the\n       shared gmp through -lgmp.\n\n    Reminder: we also check that the system libgmp.a or the libgmp.a given with\n    --with-static-gmp is PIC. If it is the case, the PIC libgmp.a will be used\n    for --with-pic.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, I also had to fix ocamlyices2\u0026rsquo;s \u003ccode\u003e./configure\u003c/code\u003e since \u003ccode\u003eld -r\u003c/code\u003e (partial linking) was not supported on Arch Linux (see [PR\u0026rsquo;s CI failure](pull request](\u003ca href=\"https://github.com/ocaml/opam-repository/pull/9086)\"\u003ehttps://github.com/ocaml/opam-repository/pull/9086)\u003c/a\u003e. I remember waiting for hours for the CI to run on all imaginable systems: Debian, Ubuntu, Suse, Arch Linux, Alpine, CentOS, Fedora, macOS and Windows\u0026hellip;\u003c/p\u003e\n\u003cp\u003eCommits \u003ca href=\"https://github.com/polazarus/ocamlyices2/commit/df7c89a1\"\u003edf7c89a1\u003c/a\u003e and \u003ca href=\"https://github.com/polazarus/ocamlyices2/commit/70dc5de5\"\u003e70dc5de5\u003c/a\u003e) fix the partial linking issue on Arch Linux:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003eAuthor: Maël Valais \u0026lt;mael.valais@gmail.com\u0026gt;\nDate:   Sat Jun 17 16:52:59 2017 +0200\nCommit: df7c89a1\n\n    ocamlyices2: added --with-libyices and --with-libyices-include-dir\n\n    These options allow to give your own libyices.a and the include directory\n    where the libyices headers are.\n\nAuthor: Maël Valais \u0026lt;mael.valais@gmail.com\u0026gt;\nDate:   Sat Jun 17 17:01:58 2017 +0200\nCommit: 70dc5de5\n\n    ocamlyices2: use --without-gmp-embedded by default\n\n    After giving it some thoughts, the need for having a self-contained libyices.a\n    (which would only need -lyices, no -lgmp needed) in ocamlyices2 is pointless\n    as \u0026#39;zarith\u0026#39; will still need \u0026#39;-lgmp\u0026#39; anyway.\n\n    The Makefile will still put libgmp.a and libyices.a inside src/ so that\n    the static version of gmp is used (with -L.) instead of the shared version.\n\n    Rationale: disabling the partial linking fixes the build on Arch Linux, which\n    (I re-tested on a docker image) cannot accept partial linking with -lgmp when\n    only libgmp.so is available. Here is the failing command:\n\n        ld -r *.o -lgmp -o libyices.o\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"final-result-of-the-yices2-build-system\"\u003eFinal result of the Yices2 build system\u003c/h2\u003e\n\u003cp\u003eThe experience with the re-written \u003ccode\u003e./configure\u003c/code\u003e (\u003ca href=\"https://github.com/polazarus/ocamlyices2/tree/master/ext/yices\"\u003ehere\u003c/a\u003e) is very different from the original one. When the user wants to compile the library with PIC, they get a warning if one of the dependencies is not PIC. There is a much finer control over what the user wants: dynamic vs. static, PIC vs. non-PIC. But also more control over dependencies like GMP, since the user must be able to pass a static or dynamic version of libgmp.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003e./configure\u003c/code\u003e that you can see \u003ca href=\"https://github.com/polazarus/ocamlyices2/tree/master/ext/yices\"\u003ehere\u003c/a\u003e gained many features like \u003ccode\u003e--with-shared-gmp\u003c/code\u003e or \u003ccode\u003e--with-pic\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% ./configure --help\n\u003cspan class=\"sb\"\u003e`\u003c/span\u003econfigure\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e configures Yices 2.5.2 to adapt to many kinds of systems.\n\nUsage: ./configure \u003cspan class=\"o\"\u003e[\u003c/span\u003eOPTION\u003cspan class=\"o\"\u003e]\u003c/span\u003e... \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003eVAR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eVALUE\u003cspan class=\"o\"\u003e]\u003c/span\u003e...\n\nSystem types:\n  --build\u003cspan class=\"o\"\u003e=\u003c/span\u003eBUILD     configure \u003cspan class=\"k\"\u003efor\u003c/span\u003e building on BUILD \u003cspan class=\"o\"\u003e[\u003c/span\u003eguessed\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n  --host\u003cspan class=\"o\"\u003e=\u003c/span\u003eHOST       cross-compile to build programs to run on HOST \u003cspan class=\"o\"\u003e[\u003c/span\u003eBUILD\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nOptional Features:\n  --enable-shared\u003cspan class=\"o\"\u003e[=\u003c/span\u003ePKGS\u003cspan class=\"o\"\u003e]\u003c/span\u003e  build shared libraries \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003edefault\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n  --enable-static\u003cspan class=\"o\"\u003e[=\u003c/span\u003ePKGS\u003cspan class=\"o\"\u003e]\u003c/span\u003e  build static libraries \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003edefault\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n  --disable-libtool-lock  avoid locking \u003cspan class=\"o\"\u003e(\u003c/span\u003emight \u003cspan class=\"nb\"\u003ebreak\u003c/span\u003e parallel builds\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  --enable-mcsat          Enable support \u003cspan class=\"k\"\u003efor\u003c/span\u003e MCSAT. This requires the libpoly\n                          library.\n\nOptional Packages:\n  --with-pic\u003cspan class=\"o\"\u003e[=\u003c/span\u003ePKGS\u003cspan class=\"o\"\u003e]\u003c/span\u003e       try to use only PIC/non-PIC objects \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003edefault\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003euse\n                          both\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n  --with-static-gmp\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;path\u0026gt;\n                          Full path to a static GMP library \u003cspan class=\"o\"\u003e(\u003c/span\u003ee.g., libgmp.a\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  --with-static-gmp-include-dir\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;directory\u0026gt;\n                          Directory of include file \u003cspan class=\"s2\"\u003e\u0026#34;gmp.h\u0026#34;\u003c/span\u003e compatible with\n                          static GMP library\n  --with-pic-gmp\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;path\u0026gt;   Full path to a relocatable GMP library \u003cspan class=\"o\"\u003e(\u003c/span\u003ee.g.,\n                          libgmp.a\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  --with-pic-gmp-include-dir\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;directory\u0026gt;\n                          Directory of include file \u003cspan class=\"s2\"\u003e\u0026#34;gmp.h\u0026#34;\u003c/span\u003e compatible with\n                          relocatable GMP library\n  --with-static-libpoly\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;path\u0026gt;\n                          Full path to libpoly.a\n  --with-static-libpoly-include-dir\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;directory\u0026gt;\n                          Path to include files compatible with libpoly.a\n                          \u003cspan class=\"o\"\u003e(\u003c/span\u003ee.g., /usr/local/include\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  --with-pic-libpoly\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;path\u0026gt;\n                          Full path to a relocatable libpoly.a\n  --with-pic-libpoly-include-dir\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;directory\u0026gt;\n                          Path to include files compatible with the\n                          relocatable libpoly.a\n  --with-shared-gmp       By default, a static version of the GMP library will\n                          be searched. This option forces the use of the\n                          shared version. This applies \u003cspan class=\"k\"\u003efor\u003c/span\u003e both shared and\n                          static libraries.\n  --without-gmp-embedded  \u003cspan class=\"o\"\u003e(\u003c/span\u003eOnly when --enable-static\u003cspan class=\"o\"\u003e)\u003c/span\u003e By default, the static\n                          library libyices.a created will be partially linked\n                          \u003cspan class=\"o\"\u003e(\u003c/span\u003eld -r\u003cspan class=\"o\"\u003e)\u003c/span\u003e so that the GMP library is not needed\n                          afterwards \u003cspan class=\"o\"\u003e(\u003c/span\u003ei.e., only -lyices is needed\u003cspan class=\"o\"\u003e)\u003c/span\u003e. If you\n                          want to disable the partial linking \u003cspan class=\"o\"\u003e(\u003c/span\u003eand thus -lgmp\n                          and -lyices will be needed\u003cspan class=\"o\"\u003e)\u003c/span\u003e, you can use this flag.\n  --with-mode\u003cspan class=\"o\"\u003e=\u003c/span\u003eMODE        The mode used during compilation/distribution. It\n                          can be one of release, debug, devel, profile, gcov,\n                          valgrind, purify, quantify or gperftools. \u003cspan class=\"o\"\u003e(\u003c/span\u003edefault:\n                          release\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  --with-static-name\u003cspan class=\"o\"\u003e=\u003c/span\u003ename \u003cspan class=\"o\"\u003e(\u003c/span\u003eWindows only\u003cspan class=\"o\"\u003e)\u003c/span\u003e when building simultanously shared\n                          and static libraries, allows you to give a different\n                          name \u003cspan class=\"k\"\u003efor\u003c/span\u003e the static version of libyices.a.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eI also added a ton of diagnostic information that appears at the end of \u003ccode\u003e./configure\u003c/code\u003e. That\u0026rsquo;s very useful when you want to make sure that \u003ccode\u003e./configure\u003c/code\u003e has picked up the right version of \u003ccode\u003elibgmp\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003econfigure: Summary of the configuration:\nEXEEXT:\nSED:                        /usr/bin/sed\nLN_S:                       ln -s\nMKDIR_P:                    /usr/local/opt/coreutils/libexec/gnubin/mkdir -p\nCC:                         gcc\nLD:                         /Library/Developer/CommandLineTools/usr/bin/ld\nAR:                         ar\nRANLIB:                     ranlib\nSTRIP:                      strip\nGPERF:                      gperf\nNO_STACK_PROTECTOR:         -fno-stack-protector\nSTATIC_GMP:                 /usr/local/lib/libgmp.a\nSTATIC_GMP_INCLUDE_DIR:\nPIC_GMP:                    /usr/local/lib/libgmp.a\nPIC_GMP_INCLUDE_DIR:\nENABLE_MCSAT:               no\nSTATIC_LIBPOLY:\nSTATIC_LIBPOLY_INCLUDE_DIR:\nPIC_LIBPOLY:\nPIC_LIBPOLY_INCLUDE_DIR:\n\nVersion:                    Yices 2.5.2\nHost type:                  x86_64-apple-darwin19.4.0\nInstall prefix:             /Users/mvalais/code/ocamlyices2/ext/yices\nBuild mode:                 release\n\nFor both static and shared library:\n  CPPFLAGS:                  -DMACOSX -DNDEBUG\n  CFLAGS:                    -fvisibility=hidden -Wall -Wredundant-decls -O3 -fomit-frame-pointer -fno-stack-protector\n  LDFLAGS:\n\nFor static library          libyices.a:\n  Enable:                   yes\n  STATIC_CPPFLAGS:           -DYICES_STATIC\n  STATIC_LIBS:\n  Libgmp.a found:           yes\n  Libgmp.a path:            /usr/local/lib/libgmp.a\n  Libgmp.a is pic:          yes     (non-PIC is faster for the static library)\n  PIC mode for libyices.a:  default\n  Use shared gmp instead of libgmp.a:  no\n  Embed gmp in libyices.a:  yes\n\nFor shared library:\n  Enable:                   yes\n  SHARED_CPPFLAGS:\n  SHARED_LIBS:\n  Libgmp.a with PIC found:  yes\n  Libgmp.a path:            /usr/local/lib/libgmp.a\n  Use shared gmp instead of libgmp.a: no\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA final word about the \u003ccode\u003eMakefile\u003c/code\u003e: since all the build configuration is handled by \u003ccode\u003e./configure\u003c/code\u003e, you don\u0026rsquo;t have to pass any variables at \u003ccode\u003emake\u003c/code\u003e time anymore, which really helps when you need to \u003ccode\u003emake\u003c/code\u003e multiple times in a row and don\u0026rsquo;t want to type the variables every single time.\u003c/p\u003e\n\u003ch2 id=\"inpecting-static-and-dynamic-libraries\"\u003eInpecting static and dynamic libraries\u003c/h2\u003e\n\u003cp\u003eHere are two tips that I learned along the way. First, I very often need to know what libraries an executable is depending on:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"c1\"\u003e# macOS\u003c/span\u003e\n% otool -L /bin/ls\n/bin/ls:\n    /usr/lib/libutil.dylib \u003cspan class=\"o\"\u003e(\u003c/span\u003ecompatibility version 1.0.0, current version 1.0.0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n    /usr/lib/libncurses.5.4.dylib \u003cspan class=\"o\"\u003e(\u003c/span\u003ecompatibility version 5.4.0, current version 5.4.0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n    /usr/lib/libSystem.B.dylib \u003cspan class=\"o\"\u003e(\u003c/span\u003ecompatibility version 1.0.0, current version 1281.100.1\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# Linux (Alpine Linux 3.9)\u003c/span\u003e\nldd /bin/ls\n    /lib/ld-musl-x86_64.so.1 \u003cspan class=\"o\"\u003e(\u003c/span\u003e0x7fc9b2c84000\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n    libc.musl-x86_64.so.1 \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; /lib/ld-musl-x86_64.so.1 \u003cspan class=\"o\"\u003e(\u003c/span\u003e0x7fc9b2c84000\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eI also had to dig into the symbols of libraries in order to make sure that static libraries contained all the needed symbols:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% nm ext/libyices_pic_no_gmp/lib/libyices.a\next/libyices_pic_no_gmp/lib/libyices.a\u003cspan class=\"o\"\u003e(\u003c/span\u003elibyices.o\u003cspan class=\"o\"\u003e)\u003c/span\u003e:\n00000000000ef6c0 t _convert_rba_tree\n0000000000049a20 t _convert_simple_value\n00000000000c2f70 t _convert_term_to_bit\n00000000000d97e0 t _convert_term_to_conditional\n\u003cspan class=\"m\"\u003e0000000000049700\u003c/span\u003e t _convert_term_to_val\n0000000000049b30 t _convert_val\n00000000000028b0 T _yices_or\n0000000000002fa0 T _yices_or2\n0000000000002ca0 T _yices_or3\n\u003cspan class=\"m\"\u003e0000000000003480\u003c/span\u003e T _yices_pair\n000000000002ad30 t _yices_parse\n\u003cspan class=\"m\"\u003e0000000000006420\u003c/span\u003e T _yices_parse_bvbin\n00000000000064b0 T _yices_parse_bvhex\n\u003cspan class=\"m\"\u003e0000000000004200\u003c/span\u003e T _yices_parse_float\n\u003cspan class=\"m\"\u003e0000000000004180\u003c/span\u003e T _yices_parse_rational\n000000000000b150 T _yices_parse_term\n000000000000b090 T _yices_parse_type\n                 U _memcpy\n                 U _memset\n                 U _memset_pattern16\n                 U ___error\n\u003cspan class=\"m\"\u003e0000000000145280\u003c/span\u003e S ___gmp_0\n000000000017dcf0 D ___gmp_allocate_func\n00000000001099e0 T ___gmp_assert_fail\n\u003cspan class=\"m\"\u003e0000000000109980\u003c/span\u003e T ___gmp_assert_header\n\u003cspan class=\"m\"\u003e0000000000145460\u003c/span\u003e S ___gmp_binvert_limb_table\n000000000014527c S ___gmp_bits_per_limb\n0000000000109a60 T ___gmp_default_allocate\n0000000000109ae0 T ___gmp_default_free\n0000000000109a90 T ___gmp_default_reallocate\n\u003cspan class=\"m\"\u003e0000000000145290\u003c/span\u003e S ___gmp_digit_value_tab\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe letter before the symbol is the \u0026ldquo;symbol type\u0026rdquo; (from \u003ccode\u003eman nm\u003c/code\u003e):\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eEach symbol name is preceded by its value (blanks if undefined). This value is followed by one of the following characters, representing the symbol type:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eU = undefined,\u003c/li\u003e\n\u003cli\u003eT (text section symbol),\u003c/li\u003e\n\u003cli\u003eD (data section symbol),\u003c/li\u003e\n\u003cli\u003eS (symbol in a section other than those above).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf the symbol is local (non-external), the symbol\u0026rsquo;s type is instead represented by the corresponding lowercase letter. A lower case u in a dynamic shared library indicates a undefined reference to a private external in another module in the same library.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eFor example, the symbol \u003ccode\u003e_yices_parse_float\u003c/code\u003e is an external symbol, meaning that this symbol isn\u0026rsquo;t static to \u003ccode\u003elibyices.a\u003c/code\u003e. On the other side, \u003ccode\u003e_convert_simple_value\u003c/code\u003e is statically defined (\u003ccode\u003et\u003c/code\u003e).\u003c/p\u003e\n\u003ch2 id=\"contributing-the-new-yices-build-system-to-upstream\"\u003eContributing the new Yices build system to upstream\u003c/h2\u003e\n\u003cp\u003eOn 16 June 2016, I sent an email to Bruno Dutertre, one of the developers at SRI (the company behind the Yices SMT solver). I proposed all these changes with links to the various patches on GitHub. Unfortunately, it didn\u0026rsquo;t work out, and the reason might be that the whole patch was enormous and very hard to review.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eHi Maël,\u003c/p\u003e\n\u003cp\u003eThanks for the message and for your efforts. We\u0026rsquo;ll look into your updates.\u003c/p\u003e\n\u003cp\u003eWe know that the Yices build system is unconventional because most of the work is done in the Makefiles rather that in the configure script. There are historical reason for this (and it should be able to build PIC libraries without problems).\u003c/p\u003e\n\u003cp\u003eBy the way, Yices is now open-source (GPL) on github: \u003ca href=\"https://github.com/SRI-CSL/yices2\"\u003ehttps://github.com/SRI-CSL/yices2\u003c/a\u003e. Take a look when you have time,\u003c/p\u003e\n\u003cp\u003eThanks again,\u003c/p\u003e\n\u003cp\u003eBruno\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eI wish we had a unit-test framework for \u003ccode\u003eautoconf\u003c/code\u003e. The \u003ccode\u003eautoconf\u003c/code\u003e ecosystem generates very fragile scripts and the only way to test them is to run them with all possible flag combinations, which is pretty much impossible.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eUpdate 31 May 2020\u003c/strong\u003e: added the ascii \u0026ldquo;dependency\u0026rdquo; diagram to give a better sense of what the challenge was.\u003c/li\u003e\n\u003c/ul\u003e\n","date":1590864306,"description":"Dynamic libraries and PIC (position-independant code) are great features of modern systems. But trying to get the right library built can become a nightmare as soon as you rely on other libraries that may or may not have these features in the first place... In this post, I detail the hacks I made to the ./configure-based build system of Yices, a C++ library.","dir":"2020/static-libraries-and-autoconf-hell/","expirydate":-62135596800,"fuzzywordcount":4400,"images":["static-libraries-and-autoconf-hell/cover-static-libraries-and-autoconf-hell.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1590864306,"objectID":"0afb4ba2379c97d4fb25446e2d083476","permalink":"https://maelvls.dev/static-libraries-and-autoconf-hell/","publishdate":"2020-05-30T20:45:06+02:00","readingtime":21,"relpermalink":"/static-libraries-and-autoconf-hell/","section":"2020","summary":"Between May and June 2016, I worked with ocamlyices2, an OCaml package that binds to the Yices C++ library. Both projects (as well as many Linux projects) are built using the \u0026ldquo;Autotools\u0026rdquo; suite.\nThe Autotools suite includes tools like autoconf, automake and libtool. These tools generate a bunch of shell scripts and Makefiles using shell scripts and the M4 macro language. The user of your projects ends up two simple commands to build your project:","tags":["autotools","c++","c","ocaml"],"title":"Epic journey with statically and dynamically-linked libraries (.a, .so)","type":"2020","url":"https://maelvls.dev/static-libraries-and-autoconf-hell/","weight":0,"wordcount":4349},{"authors":null,"categories":null,"content":"","date":1590864306,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1590864306,"objectID":"","permalink":"https://maelvls.dev/tags/ocaml/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/ocaml/","section":"tags","summary":"","tags":null,"title":"ocaml","type":"tags","url":"https://maelvls.dev/tags/ocaml/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eA common way of sharing terraform modules is to move them in a separate repo. And for companies, that means a private repo. When \u003ccode\u003eterraform init\u003c/code\u003e is run, the terraform module is fetched and if this module is stored on a Github private repo, you will need to work around the authentication.\u003c/p\u003e\n\u003cp\u003eImagine that these shared modules are stored on the private Github repo \u0026ldquo;github.com/your-org/terraform-modules\u0026rdquo;. Importing this module from a different repo would look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-hcl\" data-lang=\"hcl\"\u003e\u003cspan class=\"k\"\u003emodule\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;some_instance_of_this_module\u0026#34;\u003c/span\u003e {\n\u003cspan class=\"n\"\u003e  source\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003e \u0026#34;git@github.com:your-org/terraform-modules.git//path/to/module?ref\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003emaster\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#34;\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUsing \u003ccode\u003egit+ssh\u003c/code\u003e as a way of fetching this private module will work great locally since you might probably have a private key that Github knows about. Locally, \u003ccode\u003eterraform init\u003c/code\u003e will work.\u003c/p\u003e\n\u003cp\u003eBut what about CI, should I create a key pair and store the private key as a secret and have the public key known by Github (or Gitlab)?\u003c/p\u003e\n\u003cp\u003eUsing SSH key pairs is not ideal. The key pair is tied to an individual and can\u0026rsquo;t be linked to a Github App like \u003ccode\u003egithub-bot\u003c/code\u003e. Plus, the key pair mechanism doesn\u0026rsquo;t offer access to a specific repo, which means all your company\u0026rsquo;s repositories are exposed. And finally, some companies do not have port 22 open for security reasons, which means \u003ccode\u003egit+https\u003c/code\u003e is their only option.\u003c/p\u003e\n\u003cp\u003eTo use https instead of ssh, we start by changing the way we import these modules:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-diff\" data-lang=\"diff\"\u003e module \u0026#34;some_instance_of_this_module\u0026#34; {\n\u003cspan class=\"gd\"\u003e-   source = \u0026#34;git@github.com:your-org/terraform-modules.git//path/to/module?ref=master\u0026#34;\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e\u003c/span\u003e\u003cspan class=\"gi\"\u003e+   source = \u0026#34;git::https://github.com/your-org/terraform-modules.git//path/to/module?ref=master\u0026#34;\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e\u003c/span\u003e }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"local-development--git-over-https\"\u003eLocal development \u0026amp; git over https\u003c/h2\u003e\n\u003cp\u003eLocally, you will have to make sure you can \u003ccode\u003egit clone\u003c/code\u003e this private repo, for example, the following should work:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003egit clone https://github.com/your-org/terraform-modules.git\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIf it doesn\u0026rsquo;t work, Github has a helpful page \u0026ldquo;\u003ca href=\"https://help.github.com/en/github/using-git/caching-your-github-password-in-git\"\u003eCaching your GitHub password in Git\u003c/a\u003e\u0026rdquo;.\u003c/p\u003e\n\u003ch2 id=\"continous-integration--git-over-https\"\u003eContinous integration \u0026amp; git over HTTPS\u003c/h2\u003e\n\u003cp\u003eIt is a bit trickier to get HTTPS working on the CI. In the following, I\u0026rsquo;ll take the example of Github Actions but that will work for any CI provider. There are two main solutions:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eusing \u003ccode\u003eurl.insteadof\u003c/code\u003e,\u003c/li\u003e\n\u003cli\u003eor using \u003ccode\u003ecredential.helper\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eFor both options, you will need a PAT (personal access token) linked your own account. I refer to this token as \u003ccode\u003eGH_TOKEN\u003c/code\u003e. To create a PAT, you can go \u003ca href=\"https://github.com/settings/tokens\"\u003eto your Github settings\u003c/a\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e⚠️ NOTE: around April 2020, Github decided to prevent users from using Github Secrets names that begin with \u003ccode\u003eGITHUB_\u003c/code\u003e. We used to use the name \u003ccode\u003eGITHUB_PAT\u003c/code\u003e frequently in Github Actions readmes, I guess we will all have to update everything!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"solution-1-urlinsteadof\"\u003eSolution 1: \u003ccode\u003eurl.insteadof\u003c/code\u003e\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eactions/checkout@v2 sets the \u0026lsquo;Authorization\u0026rsquo; for any git command issued from the checked out repo. But since this uses the Github Actions \u003ccode\u003eGITHUB_TOKEN\u003c/code\u003e which is limited to the current repository. And since we want to access another private repo, we have to disable that.\u003c/li\u003e\n\u003cli\u003einstead, you can use \u003ccode\u003egit config --global url.insteadof\u003c/code\u003e. The \u003ccode\u003eGH_TOKEN\u003c/code\u003e Github Secret is a \u003ca href=\"https://github.com/settings/tokens\"\u003eGithub personal token\u003c/a\u003e that has the \u0026lsquo;repo\u0026rsquo; scope (full control of private repositories).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: when using git over https with a token on \u003ccode\u003ehttps://github.com\u003c/code\u003e, the username doesn\u0026rsquo;t matter, that\u0026rsquo;s why we put \u003ccode\u003efoo\u003c/code\u003e here.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e- \u003cspan class=\"nt\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"sd\"\u003e|\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e    git config --local --remove-section http.\u0026#34;https://github.com/\u0026#34;\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e    git config --global url.\u0026#34;https://foo:${GH_TOKEN}@github.com/your-org\u0026#34;.insteadOf \u0026#34;https://github.com/your-org\u0026#34;\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e  env:\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e    GH_TOKEN: ${{ secrets.GH_TOKEN }}\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"solution-2-credentialhelper\"\u003eSolution 2: \u003ccode\u003ecredential.helper\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003eWhen \u003ccode\u003egit config url.insteadof\u003c/code\u003e does not work, you can try using \u003ccode\u003egit credential.helper\u003c/code\u003e instead. For example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e- \u003cspan class=\"nt\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"sd\"\u003e|\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e    cat \u0026lt;\u0026lt;EOF \u0026gt; creds\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e      #!/bin/sh\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e      echo protocol=https\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e      echo host=github.com\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e      echo username=foo\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e      echo password=${GH_TOKEN}\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e    EOF\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e    sudo install creds /usr/local/bin/creds\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e    git config --global credential.helper \u0026#34;creds\u0026#34;\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e  env:\n\u003c/span\u003e\u003cspan class=\"sd\"\u003e    GH_TOKEN: ${{ secrets.GH_TOKEN }}\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"solution-2-bis-credentialhelper-with-a-github-action\"\u003eSolution 2 bis: \u003ccode\u003ecredential.helper\u003c/code\u003e with a Github Action\u003c/h3\u003e\n\u003cp\u003eSame as solution 2 but wrapped in a neat Github Action \u003ca href=\"https://github.com/marketplace/actions/setup-git-credentials\"\u003esetup-git-credentials\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThis action stores the credentials in the file \u003ccode\u003e$XDG_CONFIG_HOME/git/credentials\u003c/code\u003e and configures git to use it by calling:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003egit config --global credential.helper store/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe actions also makes sure all \u003ccode\u003essh\u003c/code\u003e calls are rewritten to \u003ccode\u003ehttps\u003c/code\u003e. The \u0026lsquo;credentials\u0026rsquo; field must be of the form \u003ca href=\"https://foo:$GH_TOKEN@github.com/\"\u003ehttps://foo:$GH_TOKEN@github.com/\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e- \u003cspan class=\"nt\"\u003euses\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efusion-engineering/setup-git-credentials@v2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ecredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps://foo:{{secrets.GH_TOKEN}}@github.com\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1589032946,"description":"Terraform makes it easy to manage infrastructure at scale; you might want to share code between modules, and that's where it becomes tricky. In this post, I try to give some clues on how to use terraform across private Github repos.","dir":"2020/gh-actions-with-tf-private-repo/","expirydate":-62135596800,"fuzzywordcount":700,"images":["gh-actions-with-tf-private-repo/cover-gh-actions-with-tf-private-repo.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1589032946,"objectID":"3257b3d6010edfc7fc136160c6704c4e","permalink":"https://maelvls.dev/gh-actions-with-tf-private-repo/","publishdate":"2020-05-09T16:02:26+02:00","readingtime":3,"relpermalink":"/gh-actions-with-tf-private-repo/","section":"2020","summary":"A common way of sharing terraform modules is to move them in a separate repo. And for companies, that means a private repo. When terraform init is run, the terraform module is fetched and if this module is stored on a Github private repo, you will need to work around the authentication.\nImagine that these shared modules are stored on the private Github repo \u0026ldquo;github.com/your-org/terraform-modules\u0026rdquo;. Importing this module from a different repo would look something like:","tags":["terraform","github-actions"],"title":"Github Actions with a private Terraform module","type":"2020","url":"https://maelvls.dev/gh-actions-with-tf-private-repo/","weight":0,"wordcount":622},{"authors":null,"categories":null,"content":"","date":1589032946,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1589032946,"objectID":"","permalink":"https://maelvls.dev/tags/github-actions/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/github-actions/","section":"tags","summary":"","tags":null,"title":"github-actions","type":"tags","url":"https://maelvls.dev/tags/github-actions/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1589032946,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1589032946,"objectID":"","permalink":"https://maelvls.dev/tags/terraform/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/terraform/","section":"tags","summary":"","tags":null,"title":"terraform","type":"tags","url":"https://maelvls.dev/tags/terraform/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1587549506,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1587549506,"objectID":"","permalink":"https://maelvls.dev/tags/controllers/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/controllers/","section":"tags","summary":"","tags":null,"title":"controllers","type":"tags","url":"https://maelvls.dev/tags/controllers/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eKubernetes' extensibility is probably its biggest strength. Controllers and CRDs are all over the place. But finding the right information to begin writing a controller isn\u0026rsquo;t easy due to the sheer amount of tribal knowledge scattered everywhere. This post intends to help you start with controllers.\u003c/p\u003e\n\u003c!--\n\n\u003e A \"Kubernetes controller\" is a binary that runs reconciliation loops. A\n\u003e reconciliation loop watches the objects stored in Kubernetes. When it\n\u003e notices a discrepency between what the object specifies (e.g. 4 replicas)\n\u003e and the observed reality (e.g., the reconcialiation loop asks kubelet,\n\u003e and it answers there are only 2 replicas), the reconcialiation loop will\n\u003e take actions in order to satisfy what is specified in the object. The\n\u003e \"controller\" binary is run as a simple Kubernetes Deployment. Sometimes,\n\u003e when the Kubernetes API is not enough, it may also come with some\n\u003e CustomResourceDefinitions YAML files.\n\nI use interchangeably the term \"sync loop\" and \"controller\". The word\n\"controller\" is quite overloaded: we use to qualify the binary that runs in\na pod and watches for objects (\"Kubernetes controller\"), but we also use it\nto mean \"one sync loop\" that is running inside this binary.\n\nAnyone writing Kubernetes controllers might want to take a look at the\nfollowing resources.\nOne controller\n\n**[Kubernetes API conventions](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md)**\n\n\u003e When a new version of an object is POSTed or PUT, the \"spec\" is updated\n\u003e and available immediately. Over time the system will work to bring the\n\u003e \"status\" into line with the \"spec\". The system will drive toward the most\n\u003e recent \"spec\" regardless of previous versions of that stanza. In other\n\u003e words, if a value is changed from 2 to 5 in one PUT and then back down to\n\u003e 3 in another PUT the system is not required to 'touch base' at 5 before\n\u003e changing the \"status\" to 3. In other words, the system's behavior is\n\u003e level-based rather than edge-based. This enables robust behavior in the\n\u003e presence of missed intermediate state changes.\n\n--\u003e\n\u003chr\u003e\n\u003cp\u003eLet us begin with some terminology:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003econtroller\u003c/strong\u003e: a single loop that watches some objects. We often refer to this loop as \u0026ldquo;controller loop\u0026rdquo; or \u0026ldquo;sync loop\u0026rdquo; or \u0026ldquo;reconcile loop\u0026rdquo;.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003econtroller binary\u003c/strong\u003e is a binary that runs one or multiple sync loops. We often refer to it as \u0026ldquo;controllers\u0026rdquo;.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eCRD\u003c/strong\u003e (Custom Resource Definition) is a simple YAML manifest that describes a custom object, for example \u003ca href=\"https://github.com/jetstack/cert-manager/blob/a04d2f0935/deploy/crds/crd-orders.yaml#L2\"\u003ethis CRD\u003c/a\u003e defines the acme.cert-manager.io/v1alpha3 Order resource. After applying this CRD to a Kubernetes cluster, you can apply manifests that have the kind \u0026ldquo;Order\u0026rdquo;\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: CRDs and controllers are decoupled. You can apply a CRD manifest without having any controller binary running. It works in both ways: you can have a controller binary running that doesn\u0026rsquo;t require any custom objects. Traefik is a controller binary which relies on built-in Service objects.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: the \u0026ldquo;CRD\u0026rdquo; manifest is just a schema. It doesn\u0026rsquo;t carry any logic (except for the basic validation the apiserver does). The actual logic happens in the controller binary.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eoperator\u003c/strong\u003e: the term \u0026ldquo;operator\u0026rdquo; is often used to mean a controller binary with its CRDs, for example the \u003ca href=\"https://github.com/elastic/cloud-on-k8s\"\u003eelastic operator\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eHere are the links that I would give to anyone interested in writing their own controller:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/kubernetes/community/blob/712590c108bd4533b80e8f2753cadaa617d9bdf2/contributors/devel/sig-api-machinery/controllers.md\"\u003esig-api-machinery/controllers.md\u003c/a\u003e gives a good intuition as to what a \u0026ldquo;controller\u0026rdquo; is:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eA Kubernetes controller is an active reconciliation process. That is, it watches some object for the world\u0026rsquo;s desired state, and it watches the world\u0026rsquo;s actual state, too. Then, it sends instructions to try and make the world\u0026rsquo;s current state be more like the desired state.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eNote: the client-go\u0026rsquo;s informers and listers and workqueue are not mandatory for writing a controller: you can just rely on client-go\u0026rsquo;s \u003ccode\u003eWatch\u003c/code\u003e primitive to reconcile state. The informers and workqueue add important scalability and reliability features but these also come with the cost of heavy abstractions. Use client-go\u0026rsquo;s \u003ccode\u003eWatch\u003c/code\u003e first to have a sense of what it can offer, and then try out informers and workqueue.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://book.kubebuilder.io/quick-start.html\"\u003eKubebuilder book\u003c/a\u003e is a nice starting point. Kubebuilder uses code generation a lot and that\u0026rsquo;s what most controllers use nowadays (Rancher uses a somehow forked version of controller-runtime and controller-tools, \u003ca href=\"https://github.com/rancher/wrangler\"\u003eWrangler\u003c/a\u003e, that also generates code but with their own \u0026ldquo;style\u0026rdquo; – for example, simple flat interfaces instead of \u003ca href=\"https://github.com/kubernetes/client-go\"\u003eclient-go\u003c/a\u003e\u0026rsquo;s deeply nested interfaces that don\u0026rsquo;t feel like Go).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ca href=\"https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md\"\u003eKubernetes API conventions\u003c/a\u003e is an amazing document. It summarizes a lot of the \u0026ldquo;tribal knowledge\u0026rdquo; around naming and how sync loops are conceived and what they mean by \u0026ldquo;level-based behaviour\u0026rdquo;.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGithub search \u0026ldquo;\u003ca href=\"https://github.com/search?q=language%3Ayaml+language%3Ago+kubernetes+controllers\"\u003elanguage:yaml language:go kubernetes controllers\u003c/a\u003e\u0026rdquo;, tons of nice examples of controllers\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jetstack/cert-manager\"\u003ecert-manager\u003c/a\u003e\u0026rsquo;s codebase is a nice controller to take a look at\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eClusterAPI \u003ca href=\"https://github.com/kubernetes-sigs/cluster-api/blob/master/docs/proposals/20190610-machine-states-preboot-bootstrapping.md\"\u003eproposals\u003c/a\u003e and codebase (\u003ca href=\"https://github.com/kubernetes-sigs/cluster-api\"\u003ecapi\u003c/a\u003e, \u003ca href=\"https://github.com/kubernetes-sigs/cluster-api-provider-aws\"\u003ecapa\u003c/a\u003e) and  (we took a lot of inspiration from what they do)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe ClusterAPI \u003ca href=\"https://docs.google.com/document/d/1fQNlqsDkvEggWFi51GVxOglL2P1Bvo2JhZlMhm2d-Co/edit#\"\u003eMeeting notes\u003c/a\u003e contains a ton of useful information on Machine, MachinePool\u0026hellip; (crazy how much I learned from that).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe Kubernetes \u003ccode\u003estatus\u003c/code\u003e field is tricky. You can take a look at \u0026ldquo;\u003ca href=\"https://maelvls.dev/kubernetes-conditions/\"\u003econditions vs. phases vs. reasons\u003c/a\u003e\u0026rdquo;.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ca href=\"https://github.com/kubernetes/kubernetes\"\u003eKubernetes codebase\u003c/a\u003e itself is also a very nice read. It might feel overwhelming at first; I invite you to take a look at a few of the following sync loops contained in the \u003ccode\u003ekube-controller-manager\u003c/code\u003e, \u003ccode\u003ekube-scheduler\u003c/code\u003e and \u003ccode\u003ekubelet\u003c/code\u003e. Since each sync loop reads or updates different objects, I also detail which objects are updated or created by each sync loop:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ebinary\u003c/th\u003e\n\u003cth\u003esync loop = component\u003c/th\u003e\n\u003cth\u003ereads\u003c/th\u003e\n\u003cth\u003ecreates\u003c/th\u003e\n\u003cth\u003eupdates\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ekube-controller-manager\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/controller/deployment/deployment_controller.go#L560-L649\"\u003e\u003ccode\u003esyncDeployment\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003ePod\u003c/td\u003e\n\u003ctd\u003eReplicaSet\u003c/td\u003e\n\u003ctd\u003eDeployment\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekube-controller-manager\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/controller/replicaset/replica_set.go#L653-L721\"\u003e\u003ccode\u003esyncReplicaSet\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003ePod\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubelet\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/kubelet/status/status_manager.go#L514-L567\"\u003e\u003ccode\u003esyncPod\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003ePod\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekube-scheduler\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/scheduler/scheduler.go#L589-L762\"\u003e\u003ccode\u003escheduleOne\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003ePod\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubelet\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bff9bfb9dfe0f2ea40f1c80cac47fc12b2/pkg/kubelet/kubelet_node_status.go#L374-L391\"\u003e\u003ccode\u003esyncNodeStatus\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eNode\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli\u003eThe podcast episode \u0026ldquo;\u003ca href=\"https://changelog.com/gotime/105\"\u003eGotime #105 – Kubernetes and Cloud Native\u003c/a\u003e\u0026rdquo; (Oct. 2019) with Joe Beda (initiator of Kubernetes) and Kris Nova is very interesting and tells us more about the genesis of the project, which things like why is Kubernetes written in Go and why client-go feels like Java. For example:\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eKris Nova:\u003c/strong\u003e I think there’s a fourth role. I think there’s what we called in the book an infrastructure engineer. These are effectively the folks like Joe and myself. These are the folks who are writing software to manage and mutate infrastructure behind the scenes. Folks who are contributing to Kubernetes, folks who are writing the software for the operators, folks who are writing admission controller implementations and so forth… I think it’s this very new engineer role, that we haven’t seen until we’ve started having – effectively, as Joe likes to put it, a platform-platform.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003eThe \u003ca href=\"https://github.com/operator-framework/operator-sdk\"\u003eoperator-sdk\u003c/a\u003e (RedHat) is a package that aims at helping dealing with the whole scafollding when writing a sync loop. It relies on \u003ca href=\"https://github.com/kubernetes-sigs/controller-runtime\"\u003econtroller-runtime\u003c/a\u003e. I don\u0026rsquo;t use either of them but taking a look at these projects helps getting more understanding about the challenges (read: boilerplate) that comes when writing controllers. I personally write all the controller-related boilerplate myself (creating the queue, setting event handlers, running the loop itself\u0026hellip;).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAnd a final note: CRDs are not necessary for writing a controller! You can write a tiny controller that watches the \u0026ldquo;standard\u0026rdquo; Kubernetes objects. That\u0026rsquo;s exactly what ingress controllers do: they watch for Service objects.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eUpdate 23 April 2020\u003c/strong\u003e: I added a quote from Kris Nova! 😁\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eUpdate 2 May 2020\u003c/strong\u003e: Rephrased the \u0026ldquo;terminology\u0026rdquo; bullet points to make them clearer and added a note on CRD vs. controller binary.\u003c/li\u003e\n\u003c/ul\u003e\n","date":1587549506,"description":"Kubernetes' extensibility is probably its biggest strength. Controllers and CRDs are all over the place. But finding the right information to begin writing a controller isn't easy due to the sheer amount of tribal knowledge scattered everywhere. Here are some links to help you start.","dir":"2020/learning-kubernetes-controllers/","expirydate":-62135596800,"fuzzywordcount":1200,"images":["learning-kubernetes-controllers/cover-learning-kubernetes-controllers.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1587549506,"objectID":"bbd09cca5d6050a160c38a6f108f6ec0","permalink":"https://maelvls.dev/learning-kubernetes-controllers/","publishdate":"2020-04-22T11:58:26+02:00","readingtime":6,"relpermalink":"/learning-kubernetes-controllers/","section":"2020","summary":"Kubernetes' extensibility is probably its biggest strength. Controllers and CRDs are all over the place. But finding the right information to begin writing a controller isn\u0026rsquo;t easy due to the sheer amount of tribal knowledge scattered everywhere. This post intends to help you start with controllers.\nA \"Kubernetes controller\" is a binary that runs reconciliation loops. A  reconciliation loop watches the objects stored in Kubernetes. When it  notices a discrepency between what the object specifies (e.","tags":["kubernetes","controllers"],"title":"Learning Kubernetes Controllers","type":"2020","url":"https://maelvls.dev/learning-kubernetes-controllers/","weight":0,"wordcount":1176},{"authors":null,"categories":null,"content":"","date":1586908800,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1586908800,"objectID":"","permalink":"https://maelvls.dev/tags/client-go/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/client-go/","section":"tags","summary":"","tags":null,"title":"client-go","type":"tags","url":"https://maelvls.dev/tags/client-go/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1586908800,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1586908800,"objectID":"","permalink":"https://maelvls.dev/tags/go-modules/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/go-modules/","section":"tags","summary":"","tags":null,"title":"go-modules","type":"tags","url":"https://maelvls.dev/tags/go-modules/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cblockquote\u003e\n\u003cp\u003e⚠️ I\u0026rsquo;m not sure this is a transitive issue. It might just not be due to transitivity at all!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eLooks like the Kubernetes people chose to break the client-go API without bumping the major version (with a new import path e.g \u003ccode\u003ek8s.io/client-go/v13\u003c/code\u003e) when adding support for \u003ccode\u003econtext.Context\u003c/code\u003e that comes with Kubernetes v1.18. Darren Shepherd reported the \u003ca href=\"https://issues.k8s.io/88472\"\u003eissue\u003c/a\u003e in February 2020. We \u003ca href=\"https://github.com/kubernetes/client-go#compatibility-your-code---client-go\"\u003ewere warned\u003c/a\u003e:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe v0.x.y tags indicate that go APIs may change in incompatible ways in different versions.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAt first, I thought that it would not affect us at Ori since we don’t use any extra dependency that rely on client-go — so no transitive dependencies on client-go, we are the sole user of it. We then began working on some tooling depending on the API of our main project. And the transitive hell began.\u003c/p\u003e\n\u003cp\u003eHere is what the error looks like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e# k8s.io/client-go/rest\n../../../go/pkg/mod/k8s.io/client-go@v11.0.0+incompatible/rest/request.go:598:31: not enough arguments in call to watch.NewStreamWatcher\n        have (*versioned.Decoder)\n        want (watch.Decoder, watch.Reporter)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOn top of that, you might also have a version mismatch between \u003ccode\u003ek8s.io/api\u003c/code\u003e and \u003ccode\u003ek8s.io/apimachinery\u003c/code\u003e with the following error:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e../../../go/pkg/mod/k8s.io/client-go@v11.0.0+incompatible/tools/clientcmd/api/v1/conversion.go:52:12: s.DefaultConvert undefined (type conversion.Scope has no field or method DefaultConvert)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIf you cannot upgrade to v0.18.* (e.g. you have a transitive dependency that still relies on v0.17.4), a workaround is to set client-go to use the latest pre-v1.18 version:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-diff\" data-lang=\"diff\"\u003e require (\n\u003cspan class=\"gd\"\u003e-    k8s.io/client-go v0.18.1\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e-    k8s.io/apimachinery v0.18.1\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e-    k8s.io/api v0.18.1 //indirect\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    k8s.io/client-go v0.17.4\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    k8s.io/apimachinery v0.17.4\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    k8s.io/api v0.17.4 //indirect\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e\u003c/span\u003e )\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe \u003ccode\u003ev0.17.4\u003c/code\u003e version is the last version of apimachinery and api that stays compatible with client-go pre-v1.18.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eLong-term\u003c/strong\u003e: you want to upgrade to client-go v0.18.* as soon as possible. If the breaking dependencies that still require client-go with no \u003ccode\u003econtext.Context\u003c/code\u003e argument, ask their maintainer (if it is an open-source project) and hopefully that will work\u0026hellip; but then, anyone relying on this project will also have then stuff broken.\u003c/p\u003e\n\u003cp\u003eThe project still has v11, v12\u0026hellip; version but they stopped tagging new major versions like they did with \u003ccode\u003ev11.0.0\u003c/code\u003e (there is no \u003ccode\u003ev18.0.0\u003c/code\u003e) because they don\u0026rsquo;t use the major used with Go Modules. That\u0026rsquo;s due to the fact that the client-go project doesn\u0026rsquo;t follow the \u0026ldquo;\u003ca href=\"https://research.swtch.com/vgo-import\"\u003esemantic import versioning\u003c/a\u003e\u0026rdquo; rule. You can\u0026rsquo;t do:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% go get k8s.io/client-go@v12.0.0\ngo get k8s.io/client-go@v12.0.0: k8s.io/client-go@v12.0.0: invalid version: module contains a go.mod file, so major version must be compatible: should be v0 or v1, not v12\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThat\u0026rsquo;s why the Kubernetes team maintains another set of tags that begin with \u003ccode\u003ev0.*\u003c/code\u003e (e.g., \u003ccode\u003ev0.18.0\u003c/code\u003e) for that specific reason. Just a clever way of escaping the semantic import versioning, but all these different versions make it very confusing\u0026hellip;\u003c/p\u003e\n\u003cp\u003eOh, and when you use the \u003ccode\u003ekubernetes-1.17.4\u003c/code\u003e tag, it redirects to the \u003ccode\u003ev0.17.4\u003c/code\u003e tag (my guess is that it is infered by \u003ccode\u003ego get\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% go get k8s.io/client-go@kubernetes-1.17.4\ngo: k8s.io/client-go kubernetes-1.17.4 \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; v0.17.4\ngo: downloading k8s.io/client-go v0.17.4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnd to make even more confusing, these tags (kubernetes-v1.17.4, v0.17.4 and v12.0.0) are not set on the master branch; instead, they all live on headless branches.\u003c/p\u003e\n\u003cp\u003eThis issue is a reminder that we (Kubernetes hackers who write controllers for a living) heavily rely on the “good will” of the Kubernetes team. These decisions as they might affect anyone relying on Kubernetes \u0026ldquo;as a platform\u0026rdquo;\u0026hellip; 🤔\u003c/p\u003e\n\u003c!--\nhttps://ori-edge.slack.com/archives/C96DU1WDC/p1583851517147600?thread_ts=1582966579.027200\u0026cid=C96DU1WDC\nhttps://ori-edge.slack.com/archives/C96DU1WDC/p1586525068128100\n--\u003e\n","date":1586908800,"description":"Client-go is the client library that allows anyone (including Kubernetes itself) to talk to the Kubernetes apiserver. Recently, the Kubernetes team chose to release a breaking version of client-go that adds support for context.Context, without really giving anyone notice. In this post, I detail the workaround and what that happened.","dir":"2020/client-go-transitive-hell/","expirydate":-62135596800,"fuzzywordcount":600,"images":[],"keywords":null,"kind":"page","lang":"en","lastmod":1586908800,"objectID":"55b47cacb0aff126ea5b2fe200af69d1","permalink":"https://maelvls.dev/client-go-transitive-hell/","publishdate":"2020-04-15T00:00:00Z","readingtime":3,"relpermalink":"/client-go-transitive-hell/","section":"2020","summary":"⚠️ I\u0026rsquo;m not sure this is a transitive issue. It might just not be due to transitivity at all!\n Looks like the Kubernetes people chose to break the client-go API without bumping the major version (with a new import path e.g k8s.io/client-go/v13) when adding support for context.Context that comes with Kubernetes v1.18. Darren Shepherd reported the issue in February 2020. We were warned:\n The v0.x.y tags indicate that go APIs may change in incompatible ways in different versions.","tags":["go-modules","kubernetes","client-go"],"title":"The Client-go Transitive Hell","type":"2020","url":"https://maelvls.dev/client-go-transitive-hell/","weight":0,"wordcount":528},{"authors":null,"categories":null,"content":"","date":1586736000,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1586736000,"objectID":"","permalink":"https://maelvls.dev/tags/gcp/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/gcp/","section":"tags","summary":"","tags":null,"title":"gcp","type":"tags","url":"https://maelvls.dev/tags/gcp/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eIn a previous post \u0026ldquo;\u003ca href=\"/packets-eye-kubernetes-service/\"\u003eThe Packet\u0026rsquo;s-Eye View of a Kubernetes Service\u003c/a\u003e\u0026rdquo;, I studied how traffic flows in when using Kubernetes Services. In the last diagram of that post, I could not clearly see how traffic could make its way back to the user. In this article, I will try to understand how packets are able to flow back to the user and where stateless rewriting happens.\u003c/p\u003e\n\u003cp\u003eIn the following diagram, we can see a packet coming from a user, then being re-written by Google\u0026rsquo;s VPC firewalls and finally coming into a VM \u0026ldquo;node 1\u0026rdquo;.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Packet coming from a user hitting one going through Google's VPC\"\nsrc=\"dnat-google-vpc-how-comes-back.svg\" width=\"80%\"/\u003e\u003c/p\u003e\n\u003cp\u003eSo, how come the packet can come back \u003cdel\u003eand does it use conntrack\u003c/del\u003e and does Google\u0026rsquo;s firewall have to remember some state?\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate 14th April:\u003c/strong\u003e I initially thought that the conntrack kernel module would not register anything when using DNAT. \u003ca href=\"https://twitter.com/networkop1\"\u003e@networkop1\u003c/a\u003e showed me that conntrack registers the connection even for stateless DNATing.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://netfilter.org/documentation/HOWTO/netfilter-hacking-HOWTO-3.html#ss3.3\"\u003econntrack\u003c/a\u003e is a part of the netfilter suite in the Linux kernel. It is in charge of remembering connections that are forwarded. The initial packet hits the iptables machinery and conntrack remembers it so that further packets don\u0026rsquo;t need to go through iptables again. You can list the tracked connections using the \u003ca href=\"https://manpages.debian.org/testing/conntrack/conntrack.8.en.html\"\u003econntrack(8)\u003c/a\u003e tool. I mention it in \u0026ldquo;\u003ca href=\"/debugging-kubernetes-networking/\"\u003eDebugging Kubernetes Networking\u003c/a\u003e\u0026rdquo;.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eLet us dive a bit more and add the \u0026ldquo;response\u0026rdquo; packets. For the following diagram, I used the excellent \u003ca href=\"https://textik.com/\"\u003etextik\u003c/a\u003e ascii drawing tool.\u003c/p\u003e\n\u003cdiv class=\"nohighlight\"\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e                     D-NAT (dest-based NAT, also called port-forwarding)\n\n          +--------------------------------------------------------------------------+\n          |   src: 90.76.45.149:32345                       src: 35.211.248.124:80   |\n          |   dst: 35.211.248.124:80                        dst: 90.76.45.149:32345  |\n          +------------------------------90.76.45.149--------------------------------+\n                         |                 (user)                     |\n                         |                                            |\n          +--------------------------------------------------------------------------+\n          |              |                one-to-one                  |              |\n          |              v              port forwarding               |              |\n          |   src: 90.76.45.149:32345          =          - src: 10.142.0.62:80      |\n          | - dst: 35.211.248.124:80      no need for     + src: 35.211.248.124:80   |\n          | + dst: 10.142.0.62:80         conntrack to      dst: 90.76.45.149:32345  |\n          |              |                 remember!                  ^              |\n          |              |                (stateless)                 |              |\n          |              |                                            |              |\n          +--------------|--------------35.211.248.124----------------|--------------+\n                         |              (Google\u0026#39;s VPC)                |\n                         |                                            |\n                         |                                            |\n          +--------------|--------------------------------------------|--------------+\n          |              v             userland process               |              |\n          |   src: 90.76.45.149:32345      response         src: 10.142.0.62:80      |\n          |   dst: 10.142.0.62:80      ----------------\u0026gt;    dst: 90.76.45.149:32345  |\n          |                                                                          |\n          +-------------------------------10.142.0.62--------------------------------+\n                                          (VM in VPC)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c!-- https://textik.com/#0db10960397c06f5 --\u003e\n\u003cp\u003eBy reading through the diagram, we can see that the packet is re-written by Google\u0026rsquo;s firewall using DNAT: the destination is replaced by a fixed IP, the one of the VM.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWhy do I say \u0026ldquo;packets\u0026rdquo; but what I should really say is \u0026ldquo;segments\u0026rdquo;? That\u0026rsquo;s because I don\u0026rsquo;t really know anyone using this strict terminology. Outside of the kernel and TCP/IP stack implementors, who actually cares about the L3 layer \u0026ldquo;units\u0026rdquo;? And I enjoy the \u0026ldquo;packet\u0026rdquo; word too more than \u0026ldquo;segment\u0026rdquo;!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eNow, why do I care about Google\u0026rsquo;s firewalls storing state? That\u0026rsquo;s because if some state about a connection has to be remembered, it means it is harder to distribute the firewall horizontally, which makes it harder to scale.\u003c/p\u003e\n\u003cp\u003eAs we can see on the diagram, the firewall does not need to remember anything: it is just a static one-to-one relation between \u003ccode\u003e10.142.0.62\u003c/code\u003e and \u003ccode\u003e35.211.248.124\u003c/code\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eHere is what I want to remember from this post:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eOutgoing traffic from your broadband modem router has to be SNATed (source-based NAT). The router needs to keep track of outgoing connections using conntrack.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIncoming traffic from the Internet to a Google Cloud VM has to go through the VPC firewall. The packet rewriting is very fast and very scalable since it only uses DNAT, which means no need to remember anything.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMost packet forwarding in Kubernetes relies on stateless DNATing (e.g. \u003ccode\u003ehostPort\u003c/code\u003e or \u003ccode\u003enodePort\u003c/code\u003e). Some parts of Kubernetes rely on stateful SNAT rewriting, for example when you use \u003ccode\u003eexternalTrafficPolicy: Cluster\u003c/code\u003e in a which is the default policy for a Service. The following diagram shows where this rewriting happens (extracted from the last diagram in \u0026ldquo;\u003ca href=\"/packets-eye-kubernetes-service/\"\u003eThe Packet\u0026rsquo;s-Eye View of a Kubernetes Service\u003c/a\u003e\u0026quot;):\u003c/p\u003e\n\u003cimg alt=\"Packet's source is rewritten (SNAT) because of the 'policy: Cluster' that is set in the Service.\" src=\"kubernetes-snat-cluster-ip.svg\" width=\"50%\"/\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n","date":1586736000,"description":"In one of my previous posts, I studied how traffic flows when using Kubernetes Services. While drawing the last diagram, I did not clearly see how traffic could make its way back to the user. In this post, I focus on how packets find their way back and what makes stateless rewriting interesting.","dir":"2020/how-do-packets-come-back/","expirydate":-62135596800,"fuzzywordcount":700,"images":["how-do-packets-come-back/cover-how-can-packets-come-back.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1586736000,"objectID":"2ec8ba01594d6b8f7f27da15a5586661","permalink":"https://maelvls.dev/how-do-packets-come-back/","publishdate":"2020-04-13T00:00:00Z","readingtime":3,"relpermalink":"/how-do-packets-come-back/","section":"2020","summary":"In a previous post \u0026ldquo;The Packet\u0026rsquo;s-Eye View of a Kubernetes Service\u0026rdquo;, I studied how traffic flows in when using Kubernetes Services. In the last diagram of that post, I could not clearly see how traffic could make its way back to the user. In this article, I will try to understand how packets are able to flow back to the user and where stateless rewriting happens.\nIn the following diagram, we can see a packet coming from a user, then being re-written by Google\u0026rsquo;s VPC firewalls and finally coming into a VM \u0026ldquo;node 1\u0026rdquo;.","tags":["networking","gcp"],"title":"How do packets find their way back?","type":"2020","url":"https://maelvls.dev/how-do-packets-come-back/","weight":0,"wordcount":622},{"authors":null,"categories":null,"content":"","date":1585526400,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1585526400,"objectID":"","permalink":"https://maelvls.dev/tags/home-office/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/home-office/","section":"tags","summary":"","tags":null,"title":"home-office","type":"tags","url":"https://maelvls.dev/tags/home-office/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1585526400,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1585526400,"objectID":"","permalink":"https://maelvls.dev/tags/setup/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/setup/","section":"tags","summary":"","tags":null,"title":"setup","type":"tags","url":"https://maelvls.dev/tags/setup/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eIn this post, I document the changes to my office setup through time.\u003c/p\u003e\n\u003ch2 id=\"2021-update\"\u003e2021 Update\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"mael-home-office-desk-2021.jpg\" alt=\"My home office in 2020\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eI switched from the Apple Magic AZERTY keyboard to a QWERTY mechanical keyboard: the \u003ca href=\"https://www.amazon.com/DURGOD-Mechanical-Interface-Tenkeyless-Anti-Ghosting/dp/B07B8J6C3C\"\u003eDurgod Taurus K320 TKL\u003c/a\u003e. I chose the Cherry MX Brown switches, and I love them. It feels so much better to be typing on this keyboard. Moving from AZERTY to QWERTY was the hardest part. It took about 3 months to get as confortable as I was using the AZERTY layout. I really wanted to stop working on a \u0026ldquo;second class\u0026rdquo; keyboard layout that has poor shortcut support on most apps. The other adjustment I had to do was to go to the macOS settings and swap the \u003ckbd\u003eWindows\u003c/kbd\u003e key with the \u003ckbd\u003eAlt\u003c/kbd\u003e key so that the \u003ckbd\u003e⌘\u003c/kbd\u003e and \u003ckbd/\u003e⌥\u003c/kbd\u003e keys are at in the right order.\u003c/li\u003e\n\u003cli\u003eTwo \u003ca href=\"https://www.amazon.com/UTEBIT-Upgraded-Articulating-Friction-Adjustable/dp/B07H77KB7R/ref=sr_1_6?dchild=1\u0026amp;keywords=UTEBIT+Desk+Mount+Metal+Tabletop+Light+Stand+Adjustable\u0026amp;qid=1615567111\u0026amp;sr=8-6\"\u003eUTEBIT articulating arms\u003c/a\u003e that hold (1) an old iPhone 7 that I use as a secondary screen using Duet and (2) a Razer Kiyo camera.\u003c/li\u003e\n\u003cli\u003eA \u003ca href=\"https://www.razer.com/streaming-cameras/razer-kiyo\"\u003eRazer Kiyo\u003c/a\u003e camera (USB 3). I wish I had a proper DSLR camera though: the Kiyo needs a ton of light to have a good image quality.\u003c/li\u003e\n\u003cli\u003eTwo \u003ca href=\"https://www.amazon.com/UTEBIT-Shooting-Adjustable-Aluminum-Tabletop/dp/B08PYY95LJ/ref=sr_1_3?dchild=1\u0026amp;keywords=UTEBIT+Desk+Mount+Metal+Tabletop+Light+Stand+Adjustable\u0026amp;qid=1615567111\u0026amp;sr=8-3\"\u003eUTEBIT tabletop arms\u003c/a\u003e that I use to hold the flood lights.\u003c/li\u003e\n\u003cli\u003eTwo \u003ca href=\"https://www.amazon.com/Neewer-Pieces-Bi-color-Video-Light/dp/B06XW3B81V\"\u003eNEEWER bi-color 660 flood lights\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eA set of UTEBIT 1/4 to 3/8 screw adapters.\u003c/li\u003e\n\u003cli\u003e24 panels of the \u003ca href=\"https://www.thomann.de/gb/the_takustik_was7_absorber_8erset.htm\"\u003et.akustik WAS-7 Absorber\u003c/a\u003e. It greatly reduced the amount of echo/reberb in the room, and allows me to put the microphone a bit further away without losing on sound quality.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"2020-update\"\u003e2020 Update\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"mael-home-office-desk-2020.jpg\" alt=\"My home office in 2020\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.bluedesigns.com/products/compass\"\u003eYeti Compass\u003c/a\u003e boom arm\n\u003cblockquote\u003e\n\u003cp\u003eNote that the boom arm is meant to carry the shock mount + the mic and since I only mounted the Yeti mic, the spring mechanism is a bit too tight which means the arm tends to go up. I unscrewed the screw in the base of the boom arm at its minimum but the tension is still too high and the boom arm tends to go up.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003eApple Magic Keyboard. I also use a \u003ca href=\"https://fr.sharkoon.com/product/PureWriter%20TKL\"\u003eSharkoon PureWriter TKL\u003c/a\u003e from time to time when I want to bother my collegues with the clank-clank sound of the red switches\u003c/li\u003e\n\u003cli\u003eUSB-C hub Ugreen and AUKEY USB3 hub.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"2019-office\"\u003e2019 Office\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"mael-home-office-desk-2019.jpg\" alt=\"My home office in 2020\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.amazon.com/LG-27UL850-W-Display-DisplayHDR-Connectivity/dp/B07MKT1W65/ref=cm_cr_arp_d_product_top?ie=UTF8\"\u003eLG 27UL850-W 27 inches 4K monitor\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://griffintechnology.com/products/elevator\"\u003eGriffin Elevator stand\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eThe \u003ca href=\"https://www.amazon.co.uk/FlexiSpot-Adjustable-Electric-Standing-Automatic/dp/B071G2NSRP/ref=sr_1_fkmr0_1?keywords=flexispot%2BE5B\u0026amp;qid=1563776981\u0026amp;s=electronics\u0026amp;sr=8-1-fkmr0\u0026amp;th=1\"\u003eFlexispot standing desk E5B\u003c/a\u003e (B = black) with a €25 wood board I mounted on top.\u003c/li\u003e\n\u003cli\u003eI use the \u003ca href=\"https://www.beatsbydre.com/headphones/solo3-wireless\"\u003eBeats Solo 3\u003c/a\u003e headphones. I only use it for audio output. I never use the mic in Bluetooth mode since it greatly degrades my colleague\u0026rsquo;s listening experience.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.bluedesigns.com/products/yeti\"\u003eBlue Yeti\u003c/a\u003e USB microphone\n\u003cblockquote\u003e\n\u003cp\u003eWhy a standalone mic just for Zoom? One very important aspect of the remote-only work setup is the importance of being properly understood. I take this very seriously and think that the sound quality of the mic I use every day influences how effective my meetings are. I also make a number of calls to potential candidates, which means I should sound perfect.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.amazon.com/Logitech-Wireless-Solar-Kebyoard-iPhone/dp/B007VL8Y2C\"\u003eLogitech K760\u003c/a\u003e (wireless solar keyboard).\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.amazon.co.uk/Logitech-Master-Wireless-Bluetooth-Windows/dp/B00ULNAOMA\"\u003eLogitech MX Master\u003c/a\u003e Just an excellent mouse\u003c/li\u003e\n\u003cli\u003eAUKEY mousepad XXL.\u003c/li\u003e\n\u003cli\u003eSome random chair (I wish I could afford the Herman Miller Aeron)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!--\n## Cool software stuff\n\n- USB overdrive (the default macOS mouse acceleration drives me crazy; also\n  allows me to invert up/down scolling for the mouse only; I keep \"natural\n  scrolling\" turned on in the system settings)\n- HyperSwitch for switching between windows with \u003ckbd\u003ealt+tab\u003c/kbd\u003e (\u003ckbd\u003ecmd+tab\u003c/kbd\u003e only allows to switch between apps)\n- iTerm 2 + zsh + antigen + async prompt theme (agkozak-zsh-prompt) + tons\n  of stuff around command line\n--\u003e\n\u003cp\u003eAnd finally, here is a picture from the backyard. 🙂\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"at-maels.jpg\" alt=\"Backyard\"\u003e\u003c/p\u003e\n","date":1585526400,"description":"I present what hardware I have been using and what changed between 2019 and 2021!","dir":"2020/home-office-remote-setup/","expirydate":-62135596800,"fuzzywordcount":600,"images":["/evolution-of-my-home-office/mael-home-office-desk-2021.jpg"],"keywords":null,"kind":"page","lang":"en","lastmod":1585526400,"objectID":"2c5e15dbae92dd7d9996736c62059924","permalink":"https://maelvls.dev/evolution-of-my-home-office/","publishdate":"2020-03-30T00:00:00Z","readingtime":3,"relpermalink":"/evolution-of-my-home-office/","section":"2020","summary":"In this post, I document the changes to my office setup through time.\n2021 Update  I switched from the Apple Magic AZERTY keyboard to a QWERTY mechanical keyboard: the Durgod Taurus K320 TKL. I chose the Cherry MX Brown switches, and I love them. It feels so much better to be typing on this keyboard. Moving from AZERTY to QWERTY was the hardest part. It took about 3 months to get as confortable as I was using the AZERTY layout.","tags":["setup","home-office"],"title":"The evolution of my home office from 2019 to 2021","type":"2020","url":"https://maelvls.dev/evolution-of-my-home-office/","weight":0,"wordcount":550},{"authors":null,"categories":null,"content":"\u003cp\u003eTo learn and play with Kubernetes, I keep a \u0026ldquo;playground\u0026rdquo; cluster to try things on it (helm files I use are \u003ca href=\"https://github.com/maelvls/k.maelvls.dev\"\u003ehere\u003c/a\u003e). Since 2019, I have been using GKE (Google\u0026rsquo;s managed Kubernetes service), which works great with the one-year $300 credit that you get initially. A few days ago, reality hit me hard with this message:\u003c/p\u003e\n\u003cimg alt=\"Only 2 days left on my GCP 1-year trial\" src=\"2-days-free-trial.png\" width=\"50%\"\u003e\n\u003cp\u003eI had only 2 days to find a plan and migrate everything away from GKE! My current setup was only using a single \u003ccode\u003en1-standard-1\u003c/code\u003e on \u003ccode\u003eus-west-1\u003c/code\u003e and with no network load balancer. But that was still around €15 a month, and I just didn\u0026rsquo;t want to pay. I chose to migrate to Civo\u0026rsquo;s managed K3s since they are in beta and I really wanted to try K3s.\u003c/p\u003e\n\u003ch2 id=\"civos-managed-k3s\"\u003eCivo\u0026rsquo;s Managed K3s\u003c/h2\u003e\n\u003cp\u003eCivo is a company that offers a public cloud as well as managed Kubernetes clusters. Their managed Kubernetes offer, named \u0026ldquo;\u003ca href=\"https://www.civo.com/kube100\"\u003eKUBE100\u003c/a\u003e\u0026rdquo;, is quite new (launched in mid-2019). Unlike most managed Kubernetes offerings like EKS or GKE, Civo went with Rancher\u0026rsquo;s \u003ca href=\"https://k3s.io/\"\u003eK3s\u003c/a\u003e Kubernetes distribution.\u003c/p\u003e\n\u003cp\u003eCompared to the standard Kubernetes distribution, K3s is a way lighter: simple embedded database with sqlite, one single binary instead of four; a single VM can both host the control plane and run pods. With the traditional Kubernetes distribution, you have to run the control plane on a separate VM. Note that Civo has a whole blog post on \u0026ldquo;\u003ca href=\"https://www.civo.com/blog/k8s-vs-k3s\"\u003eKubernetes vs. K3s\u003c/a\u003e\u0026rdquo;.\u003c/p\u003e\n\u003cp\u003eThis lightweight feature is what brings me here, and also the fact that K3s comes by default with Traefik \u0026amp; their own tiny Service type=LoadBalancer controller, which means you don\u0026rsquo;t even need an expensive network load balancer like on GKE when you want to expose a service to the internet.\u003c/p\u003e\n\u003cp\u003eOf course, K3s has drawbacks and is probably meant for IoT-based clusters, but it\u0026rsquo;s also perfect for playing around with Kubernetes! So I went ahead and create a two-nodes cluster:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"civo-k3s.png\" alt=\"My K3s cluster on Civo\"\u003e\u003c/p\u003e\n\u003cp\u003eNote that since this is K3s, the master can also be scheduled with pods. So I could have gone with a single node.\u003c/p\u003e\n\u003ch2 id=\"migrating-externaldns-cert-manager-and-traefik\"\u003eMigrating ExternalDNS, cert-manager and Traefik\u003c/h2\u003e\n\u003cp\u003eThat\u0026rsquo;s the easy part. I just had to run \u003ca href=\"https://github.com/maelvls/k.maelvls.dev\"\u003e./helm_apply\u003c/a\u003e which runs \u003ccode\u003ehelm upgrade --install\u003c/code\u003e for each helm chart I use.\u003c/p\u003e\n\u003cp\u003eIn the process, I decided to go with \u003ccode\u003e*.k.maelvls.dev\u003c/code\u003e instead of \u003ccode\u003e*.kube.maelvls.dev\u003c/code\u003e. The shorter, the better! I forgot to add that I still use Google\u0026rsquo;s CloudDNS. I did not find an easy alternative yet. Maybe just Cloudflare for now?\u003c/p\u003e\n\u003cp\u003eAfter creating Traefik, I knew that its service would automatically be populated with the \u003ccode\u003estatus.loadBalancer\u003c/code\u003e field thanks to K3s' \u003ca href=\"https://github.com/rancher/k3s/blob/master/pkg/servicelb/controller.go\"\u003eservicelb\u003c/a\u003e. Let\u0026rsquo;s see:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl -n traefik get services\nNAME     TYPE          CLUSTER-IP        EXTERNAL-IP      PORT\u003cspan class=\"o\"\u003e(\u003c/span\u003eS\u003cspan class=\"o\"\u003e)\u003c/span\u003e\ntraefik  LoadBalancer  192.168.255.134   91.211.152.190   443:32164/TCP,80:32684/TCP\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eGreat! Now, Traefik will propagate this external IP to the ingresses, and ExternalDNS will use the \u003ccode\u003estatus.loadBalancer\u003c/code\u003e from these ingresses in order to set \u003ccode\u003eA\u003c/code\u003e records.\u003c/p\u003e\n\u003cp\u003eIf you want to know more about how \u0026ldquo;servicelb\u0026rdquo; works, you can take a look at \u003ca href=\"https://maelvls.dev/packets-eye-kubernetes-service/\"\u003eThe Packet\u0026rsquo;s-Eye View of a Kubernetes Service\u003c/a\u003e where I describe how Akrobateo works (K3s' servicelb has the exact same behavior).\u003c/p\u003e\n\u003ch2 id=\"migrating-minio-from-the-old-to-the-new-cluster\"\u003eMigrating MinIO from the old to the new cluster\u003c/h2\u003e\n\u003cp\u003eI use \u003ca href=\"https://min.io/\"\u003eminio\u003c/a\u003e for various uses. It is great if you want a S3-compatible storage solution. In order to migrate, I followed \u003ca href=\"https://www.scaleway.com/en/docs/how-to-migrate-object-storage-buckets-with-minio\"\u003ethis\u003c/a\u003e. It\u0026rsquo;s quite painless:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e$ kubectl -n minio run a --generator\u003cspan class=\"o\"\u003e=\u003c/span\u003erun-pod/v1 -it --rm --restart\u003cspan class=\"o\"\u003e=\u003c/span\u003eNever --image\u003cspan class=\"o\"\u003e=\u003c/span\u003ealpine\n\n% wget https://dl.minio.io/client/mc/release/linux-amd64/mc \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e install mc /usr/bin\n% mc config host add old https://minio.kube.maelvls.dev AKIAIOSFODNN7EXAMPLE \u003cspan class=\"s2\"\u003e\u0026#34;wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\u0026#34;\u003c/span\u003e --api S3v4\n% mc config host add new http://minio:9000 AKIAIOSFODNN7EXAMPLE \u003cspan class=\"s2\"\u003e\u0026#34;wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\u0026#34;\u003c/span\u003e --api S3v4\n\n% mc ls old/         \u003cspan class=\"c1\"\u003e# List buckets since I had to create manually each bucket.\u003c/span\u003e\n% mc mb new/bucket1  \u003cspan class=\"c1\"\u003e# Then create each bucket one by one.\u003c/span\u003e\n% mc cp --recursive old/bucket1/ new/bucket1/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eI also decided to change the access key \u0026amp; secret key. Again, quite painless. As mentioned in the \u003ca href=\"https://github.com/minio/minio/tree/master/docs/config\"\u003edocumentation\u003c/a\u003e, I changed the secret stored in Kubernetes:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ekubectl -n minio edit secret minio\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eand then I temporarily added the \u003ccode\u003eMINIO_ACCESS_KEY_OLD\u003c/code\u003e and \u003ccode\u003eMINIO_SECRET_KEY_OLD\u003c/code\u003e to the deployment by editing it.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ekubectl -n minio edit deployment minio\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAfter that, the pods get recreated, and MinIO picks up the new secret. Note: I also had to edit the deployment again in order to remove the temporary \u003ccode\u003e_OLD\u003c/code\u003e environment variables.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eTo recap, the whole migration was painless. The only data I migrated was MinIO. Note that I didn\u0026rsquo;t have any SLA to comply with, but if I had planned a bit better, I could have moved over with almost zero downtime.\u003c/p\u003e\n\u003cp\u003eIn order to get almost-zero-downtime, I would have made sure to keep the old and new MinIO instances replicated until the move was over. The only problem with the whole migration is the DNS change. I cannot precisely know when the propagation will take. After completing the migration and assuming that all the DNS entries are propagated, if for some reason people keep hitting the old IP due to outdated DNS entries, the old and new clusters would have become out-of-sync. To mitigate that issue, I could have chosen to \u0026ldquo;cordon\u0026rdquo; the old cluster just to make sure that this case never happens.\u003c/p\u003e\n\u003cp\u003eThe repo for my Kubernetes playground cluster (\u003ccode\u003e*.k.maelvls.dev\u003c/code\u003e) is available \u003ca href=\"https://github.com/maelvls/k.maelvls.dev\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eUpdate 7 May 2020\u003c/strong\u003e: better introduction explaining why I use GKE, tell what Civo and K3s are all about.\u003c/li\u003e\n\u003c/ul\u003e\n","date":1584835200,"description":"My free trial on GKE was ending in 2 days and I had to find a way to migrate away. I decided to switch to Civo's managed K3s.","dir":"2020/migrating-from-gke-to-civo/","expirydate":-62135596800,"fuzzywordcount":900,"images":["from-gke-to-civo-k3s/civo-k3s.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1584835200,"objectID":"427b7e08b111144c1fb2461d0da60a82","permalink":"https://maelvls.dev/from-gke-to-civo-k3s/","publishdate":"2020-03-22T00:00:00Z","readingtime":5,"relpermalink":"/from-gke-to-civo-k3s/","section":"2020","summary":"To learn and play with Kubernetes, I keep a \u0026ldquo;playground\u0026rdquo; cluster to try things on it (helm files I use are here). Since 2019, I have been using GKE (Google\u0026rsquo;s managed Kubernetes service), which works great with the one-year $300 credit that you get initially. A few days ago, reality hit me hard with this message:\nI had only 2 days to find a plan and migrate everything away from GKE!","tags":["kubernetes"],"title":"Migrating from GKE to Civo's K3s","type":"2020","url":"https://maelvls.dev/from-gke-to-civo-k3s/","weight":0,"wordcount":865},{"authors":null,"categories":null,"content":"","date":1582761600,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1582761600,"objectID":"","permalink":"https://maelvls.dev/tags/go/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/go/","section":"tags","summary":"","tags":null,"title":"go","type":"tags","url":"https://maelvls.dev/tags/go/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"","date":1582761600,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1582761600,"objectID":"","permalink":"https://maelvls.dev/tags/software-engineering/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/software-engineering/","section":"tags","summary":"","tags":null,"title":"software-engineering","type":"tags","url":"https://maelvls.dev/tags/software-engineering/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003c!--\n\nExamples: https://github.com/jetstack/cert-manager/pull/3795/files#r600322397\n\n--\u003e\n\u003cp\u003eComments are one of these topics that we seem to never agree on (\u003ca href=\"https://softwareengineering.stackexchange.com/questions/1/comments-are-a-code-smell\"\u003estackoverflow\u003c/a\u003e says so). I often hear that comments add noise to the code and that comments never get properly updated.\u003c/p\u003e\n\u003cp\u003eThe solution seems to be to properly self-document code. And I love Go for that; one of the Go proverbs even \u003ca href=\"https://go-proverbs.github.io/\"\u003esays\u003c/a\u003e:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eClear is better than clever.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIt is true that Go favors easy-to-read code rather than smart-but-hard-to-parse code, which really helps to keep the level of comments low. But there are still many reasons comments are still needed.\u003c/p\u003e\n\u003ch3 id=\"fighting-tribal-knowledge\"\u003eFighting tribal knowledge\u003c/h3\u003e\n\u003cp\u003eExcellent naming and structure cannot help with the \u0026ldquo;why\u0026rdquo; of a piece of code. Complex math operations is a typical example of code that needs to be thougouly commented. Teams want to keep the amount of \u0026ldquo;tribal knowledge\u0026rdquo; as low as possible, and the only way in this kind of situation is to write comments. Take a look at \u003ca href=\"https://github.com/haproxy/haproxy/blob/530408f976e5fe2f2f2b4b733b39da36770b566f/include/proto/freq_ctr.h#L138-L248\"\u003ethis\u003c/a\u003e for example.\u003c/p\u003e\n\u003ch3 id=\"good-naming-takes-time\"\u003eGood naming takes time\u003c/h3\u003e\n\u003cp\u003eFinding a good name that properly carries the exact intent and help self-documenting takes time. It always takes a few iterations before the code becomes self-documenting enough to be able to remove comments.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"chart-comments-over-time.svg\" alt=\"Number of comments lowers with time\"\u003e\u003c/p\u003e\n\u003cp\u003eAs shown by the diagram, the amount of comments for a given codebase decreases thanks to PR reviews and refactorings. The more we learn and understand our codebase, the better we become at self-documenting.\u003c/p\u003e\n\u003ch3 id=\"comments-are-disposable-dont-copy-them-over\"\u003eComments are disposable, don\u0026rsquo;t copy them over\u003c/h3\u003e\n\u003cp\u003eNow, let\u0026rsquo;s talk about the issue of comments becoming outdated. Over time, comments start lying. That\u0026rsquo;s where my second point comes into play: deleting and rewriting comments is part of our job. I would even say that it takes around 40% of my time spent coding.\u003c/p\u003e\n\u003cp\u003eDuring code reviews, I pay extra attention to these comments. And yes, very often, comments don\u0026rsquo;t make sense anymore because of some copy-paste of code. We must delete any copy-pasted comment and rewrite it. Spreading copy-pasted comments that we don\u0026rsquo;t really know why they were added in the first place is a plague.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eAs a final word, I want us to remember that yes, maintaining comments is a pain. Comments will eventually start lying if you don\u0026rsquo;t delete and rewrite them. But would you rather have no comments at all and let the amount of tribal knowledge creep in every part of your codebase, making it harder and harder for new engineers to join the team?\u003c/p\u003e\n\u003cp\u003eI think we all enjoy reading good comments. Well commented code is an art. Some projects like HAProxy, Git or the Linux kernel have done an amazing job at keeping knowledge accessible as opposed to knowledge locked in and scattered across many brains. Just take a look at \u003ca href=\"https://github.com/haproxy/haproxy/blob/530408f976e5fe2f2f2b4b733b39da36770b566f/ebtree/ebtree.h#L23\"\u003e\u003ccode\u003eebtree/ebtree.h\u003c/code\u003e\u003c/a\u003e (HAProxy), \u003ca href=\"https://github.com/git/git/blob/2d2118b814c11f509e1aa76cb07110f7231668dc/unpack-trees.c#L821-L836\"\u003e\u003ccode\u003eunpack-trees.c\u003c/code\u003e\u003c/a\u003e (Git) and \u003ca href=\"https://github.com/torvalds/linux/blob/bfdc6d91a25f4545bcd1b12e3219af4838142ef1/kernel/sched/core.c#L157-L171\"\u003e\u003ccode\u003ekernel/sched/core.c\u003c/code\u003e\u003c/a\u003e (Linux kernel). Absolute delights.\u003c/p\u003e\n\u003c!--\nJoin the discussion on Twitter:\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eI know I know comments always end up outdated and so on. But I really think we should still write beautiful comments! 😇\u003ca href=\"https://t.co/704lUCDzo2\"\u003ehttps://t.co/704lUCDzo2\u003c/a\u003e\u003c/p\u003e\u0026mdash; Maël Valais (@maelvls) \u003ca href=\"https://twitter.com/maelvls/status/1233140530017644544?ref_src=twsrc%5Etfw\"\u003eFebruary 27, 2020\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n\\--\u003e\n","date":1582761600,"description":"We often talk about avoiding unecessary comments that needlessly paraphrase what the code does. In this article, I gathered some thoughts about why writing comments is as important as writing the code itself.","dir":"2020/you-should-write-comments/","expirydate":-62135596800,"fuzzywordcount":500,"images":["you-should-write-comments/cover-you-should-write-comments.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1582761600,"objectID":"289dd098e6b45927cb25a77a40c14ac1","permalink":"https://maelvls.dev/you-should-write-comments/","publishdate":"2020-02-27T00:00:00Z","readingtime":3,"relpermalink":"/you-should-write-comments/","section":"2020","summary":"Comments are one of these topics that we seem to never agree on (stackoverflow says so). I often hear that comments add noise to the code and that comments never get properly updated.\nThe solution seems to be to properly self-document code. And I love Go for that; one of the Go proverbs even says:\n Clear is better than clever.\n It is true that Go favors easy-to-read code rather than smart-but-hard-to-parse code, which really helps to keep the level of comments low.","tags":["go","software-engineering"],"title":"You should write comments","type":"2020","url":"https://maelvls.dev/you-should-write-comments/","weight":0,"wordcount":486},{"authors":null,"categories":null,"content":"\u003cp\u003eWhen I scaled my GKE cluster from one node to two nodes, I realised there was some DNS issues with one of the pods on the new Node 2 (that\u0026rsquo;s what I initially thought).\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"diagram-node-2-dns-not-working.png\" alt=\"network diagram of the cluster where DNS not working in a pod of Node 2\"\u003e\u003c/p\u003e\n\u003cp\u003eSo I went into pod-on-2 (10.24.12.40) and checked that DNS wasn\u0026rsquo;t working. What I did is run\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud compute ssh node-2\n% docker run --rm -it --net\u003cspan class=\"o\"\u003e=\u003c/span\u003econtainer:\u003cspan class=\"k\"\u003e$(\u003c/span\u003edocker ps \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep POD_pod-on-2 \u003cspan class=\"p\"\u003e|\u003c/span\u003e head -1 \u003cspan class=\"p\"\u003e|\u003c/span\u003e cut -f1 -d\u003cspan class=\"s2\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e nicolaka/netshoot\n% nslookup github.com\n\u003cspan class=\"p\"\u003e;;\u003c/span\u003e connection timed out\u003cspan class=\"p\"\u003e;\u003c/span\u003e no servers could be reached\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s see if this DNS request actually goes out of the container. So I ran tcpdump on the \u003ccode\u003ecbr0\u003c/code\u003e interface on node 2. \u003ccode\u003ecbr0\u003c/code\u003e is the linux bridge used by Kubernetes (the bridge and the interface have the same name). Using Wireshark on top of tcpdump gives me easier-to-explore results:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"wireshark-node-2-cbr0-and-terminal.png\" alt=\"Wireshark running on interface cbr0 on node 2\"\u003e\u003c/p\u003e\n\u003cp\u003eNote that the actual name of Node 2 is \u003cem\u003egke-august-period-234610-worker-micro-1de60498-9gsb\u003c/em\u003e (now, you know!). Here is the command I used for opening wireshark on Node 2:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud compute ssh node-2 --command \u003cspan class=\"s2\"\u003e\u0026#34;docker run --rm --net=host corfr/tcpdump -i cbr0 -U -w - \u0026#39;not port 22\u0026#39;\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e wireshark -k -i -\ntcpdump: listening on cbr0, link-type EN10MB \u003cspan class=\"o\"\u003e(\u003c/span\u003eEthernet\u003cspan class=\"o\"\u003e)\u003c/span\u003e, capture size \u003cspan class=\"m\"\u003e262144\u003c/span\u003e bytes\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhat we see is that \u003ccode\u003ecbr0\u003c/code\u003e properly receives UDP packets coming from the pod \u003ccode\u003e10.24.12.40\u003c/code\u003e, and that the DNS address is \u003ccode\u003e10.27.240.10\u003c/code\u003e. I double checked, \u003ccode\u003e10.27.240.10\u003c/code\u003e is the DNS address set in \u003ccode\u003e/etc/resolve.conf\u003c/code\u003e inside containers in this pod.\u003c/p\u003e\n\u003cp\u003eHere is the network setup with the IPs to get a better picture:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"diagram-pod-ips.png\" alt=\"Network diagram of the Kubernetes cluster with two nodes and two pods and with IPs displayed\"\u003e\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s check that \u003ccode\u003e10.27.240.10\u003c/code\u003e is actually a service:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl -n kube-system get service kube-dns\nNAME       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT\u003cspan class=\"o\"\u003e(\u003c/span\u003eS\u003cspan class=\"o\"\u003e)\u003c/span\u003e         AGE\nkube-dns   ClusterIP   10.27.240.10   \u0026lt;none\u0026gt;        53/UDP,53/TCP   34d\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe now know that the DNS used in all the pods is the ClusterIP of the kube-dns service. That\u0026rsquo;s not a real pod IP, so the iptables should be translating that into an actual pod IP.\u003c/p\u003e\n\u003cp\u003eNow that we know that the packet goes to \u003ccode\u003ecbr0\u003c/code\u003e, is it forwarded to Node 2\u0026rsquo;s \u003ccode\u003eeth0\u003c/code\u003e? I used Wireshark again, but on \u003ccode\u003eeth0\u003c/code\u003e this time:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"wireshark-node-2-eth0.png\" alt=\"Wireshark on eth0 of Node 2\"\u003e\u003c/p\u003e\n\u003cp\u003eApparently, the packet destination has been re-written from \u003ccode\u003e10.27.240.10\u003c/code\u003e to \u003ccode\u003e10.24.9.31\u003c/code\u003e (an actual pod IP) which is good sign. This pod IP corresponds to one of the replicas of kube-dns on node 1, which seems fine.\u003c/p\u003e\n\u003cp\u003eAt this point, I was wondering: are UDP packets from node 2 to node 1 properly routed?\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003emvalais@node-2 ~ $ docker run -it --rm --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ehost nicolaka/netshoot\n% nslookup github.com 10.27.240.10\nServer:\t\t10.27.240.10\nAddress:\t10.27.240.10#53\n\nNon-authoritative answer:\nName:\tgithub.com\nAddress: 192.30.253.113\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWait what? The DNS query to \u003ccode\u003e10.27.240.10\u003c/code\u003e works from the host but not from the pod? At this point, my guesses were:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003esomething wrong with the routes on the host,\u003c/li\u003e\n\u003cli\u003esomething is wrong with networking on node 1\u003c/li\u003e\n\u003cli\u003esomething is wrong with the iptables of node 2\u003c/li\u003e\n\u003cli\u003ean issue with routing of \u003ccode\u003e10.24.0.0/14\u003c/code\u003e on the VPC (it\u0026rsquo;s the CIDR allocated to this GKE cluster; the nodes themselves receive \u003ccode\u003e/24\u003c/code\u003e CIDRs from this range)\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eLet\u0026rsquo;s rule (1) out. Here is the L3 routing table on node 2:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003emvalais@node-2 ~ $ docker run -it --rm --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ehost nicolaka/netshoot\n% ip route\ndefault via 10.142.0.1 dev eth0    proto dhcp   src 10.142.15.206 metric \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\ndefault via 10.142.0.1 dev eth0    proto dhcp\n10.24.12.0/24          dev cbr0    proto kernel src 10.24.12.1\n10.142.0.1             dev eth0    proto dhcp   src 10.142.15.206 metric \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\n10.142.0.1             dev eth0    proto dhcp\n169.254.123.0/24       dev docker0 proto kernel src 169.254.123.1 linkdown\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eRemembering that Node 2\u0026rsquo;s eth0 has the IP \u003ccode\u003e10.142.15.206\u003c/code\u003e, it looks like all packets that are meant for Node 1\u0026rsquo;s kube-dns will use the first rule. So no problem on this side.\u003c/p\u003e\n\u003cp\u003eThe (2) guess is easy to check: I ran tcpdump with wireshark on the eth0 of node 1. No trace of an UDP packet coming from \u003ccode\u003e10.24.12.40\u003c/code\u003e. So the packets don\u0026rsquo;t even reach the node 1.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s recap all we know: the packet goes from the pod\u0026rsquo;s eth0 to the linux bridge, and is then rewritten and forwarded to the host\u0026rsquo;s eth0.\u003c/p\u003e\n\u003cp\u003e\u003cimg\nsrc=\"diagram-node-2-iptables-flow.png\"\nwidth=\"400\" alt=\"On Node 2, packet goes from pod's eth0 to host's cbr0 and\nthen host's eth0\" /\u003e\u003c/p\u003e\n\u003cp\u003eSo we are left with\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003esomething is wrong with the iptables of node 2\u003c/li\u003e\n\u003cli\u003ean issue with routing of \u003ccode\u003e10.24.0.0/14\u003c/code\u003e on the VPC\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eI now realise that I could have ruled out the iptable issue since I could see the packet on Node 2\u0026rsquo;s eth0 interface. But I wanted to know how that packet was handled anyway!\u003c/p\u003e\n\u003cp\u003eSo let\u0026rsquo;s dive into what iptables is doing to this packet. First, let\u0026rsquo;s see if a conntrack entry exists due to the DNAT rewriting:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"c1\"\u003e# From the pod on Node 2:\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% nslookup github.com\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003emvalais\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"m\"\u003e-2\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e \u003cspan class=\"n\"\u003edocker\u003c/span\u003e \u003cspan class=\"n\"\u003erun\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003enet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eprivileged\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003erm\u003c/span\u003e \u003cspan class=\"n\"\u003emissioncriticalkubernetes\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003econntrack\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eL\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003egrep\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24\u003c/span\u003e\n\u003cspan class=\"n\"\u003econntrack\u003c/span\u003e \u003cspan class=\"nf\"\u003ev1.4.4 \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econntrack\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003etools\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e52\u003c/span\u003e \u003cspan class=\"n\"\u003eflow\u003c/span\u003e \u003cspan class=\"n\"\u003eentries\u003c/span\u003e \u003cspan class=\"n\"\u003ehave\u003c/span\u003e \u003cspan class=\"n\"\u003ebeen\u003c/span\u003e \u003cspan class=\"n\"\u003eshown.\u003c/span\u003e\n\u003cspan class=\"n\"\u003eudp\u003c/span\u003e \u003cspan class=\"m\"\u003e17\u003c/span\u003e \u003cspan class=\"m\"\u003e26\u003c/span\u003e  \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e    \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003esport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57400\u003c/span\u003e \u003cspan class=\"n\"\u003edport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003e[UNREPLIED]\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e     \u003cspan class=\"n\"\u003esport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003edport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57400\u003c/span\u003e           \u003cspan class=\"n\"\u003emark\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003euse\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# From Node 2\u0026#39;s host networking:\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% nslookup github.com 10.27.240.10\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003emvalais\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"m\"\u003e-2\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e \u003cspan class=\"n\"\u003edocker\u003c/span\u003e \u003cspan class=\"n\"\u003erun\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003enet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eprivileged\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003erm\u003c/span\u003e \u003cspan class=\"n\"\u003emissioncriticalkubernetes\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003econntrack\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eL\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003egrep\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24\u003c/span\u003e\n\u003cspan class=\"n\"\u003eudp\u003c/span\u003e \u003cspan class=\"m\"\u003e17\u003c/span\u003e \u003cspan class=\"m\"\u003e175\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.142.15.206\u003c/span\u003e \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003esport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e37337\u003c/span\u003e \u003cspan class=\"n\"\u003edport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e             \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.142.15.206\u003c/span\u003e \u003cspan class=\"n\"\u003esport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003edport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e37337\u003c/span\u003e \u003cspan class=\"n\"\u003e[ASSURED]\u003c/span\u003e \u003cspan class=\"n\"\u003emark\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003euse\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eComing from the pod, we see that the DNAT rewriting happened but the connection status is UNREPLIED. Coming from the host, the DNAT rewriting also happened but the connection status is ASSURED, which means a reply has been given.\u003c/p\u003e\n\u003cp\u003eNow, the deep dive: let\u0026rsquo;s use iptables' \u003ccode\u003eTRACE\u003c/code\u003e target to know how this packet gets rewritten when coming from the pod:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"c1\"\u003e# From Node 2\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% sudo modprobe ipt_LOG\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003eiptables\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24.0.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e16\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% sudo iptables -A PREROUTING -t raw -d 10.24.0.0/16 -j TRACE\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003edocker\u003c/span\u003e \u003cspan class=\"n\"\u003erun\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003erm\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eit\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003enet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003econtainer\u003c/span\u003e\u003cspan class=\"o\"\u003e:$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edocker\u003c/span\u003e \u003cspan class=\"n\"\u003eps\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003egrep\u003c/span\u003e \u003cspan class=\"n\"\u003ePOD_pod\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eon\u003c/span\u003e\u003cspan class=\"m\"\u003e-2\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ehead\u003c/span\u003e \u003cspan class=\"m\"\u003e-1\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ecut\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ef1\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eprivileged\u003c/span\u003e \u003cspan class=\"n\"\u003enicolaka\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003enetshoot\u003c/span\u003e \u003cspan class=\"n\"\u003enslookup\u003c/span\u003e \u003cspan class=\"n\"\u003egithub.com\u003c/span\u003e\n% \u003cspan class=\"n\"\u003edmesg\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.179725]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.200327]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e               \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.221171]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.241576]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSERVICES\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e14\u003c/span\u003e                \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.262385]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSVC\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eTCOU7JCQXEZGVUNU\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.284116]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSEP\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eMQYG7Z5PYI3N6YFY\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.305838]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.326491]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.346973]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e             \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.368068]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.389031]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSERVICES\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e            \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.410253]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.430735]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eDOCKER\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eUSER\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e              \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.451887]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.472366]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eDOCKER\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eISOLATION\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSTAGE\u003c/span\u003e\u003cspan class=\"m\"\u003e-1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.494488]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.515049]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e              \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.531693]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.547953]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e            \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.564769]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.580978]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eIP\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eMASQ\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                       \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.596840]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e                 \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.12.40\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.31\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe last list, \u003ccode\u003ePOSTROUTING\u003c/code\u003e, makes it clear that the packet is properly sent to the host\u0026rsquo;s \u003ccode\u003eeth0\u003c/code\u003e with \u003ccode\u003esrc 10.24.12.40\u003c/code\u003e and \u003ccode\u003edst 10.24.9.31\u003c/code\u003e. The packet should get to node 1 now!\u003c/p\u003e\n\u003cp\u003eI noticed that using \u003ccode\u003e-j TRACE\u003c/code\u003e is extremely expensive. For example, using \u003ccode\u003e-p icmp\u003c/code\u003e would result in pings going from 1ms (without tracing) to 500ms. I also overloaded one of the nodes by adding a rule that was \u0026ldquo;too wide\u0026rdquo; and nearly killed the entire node. Use tracing filters (\u003ccode\u003e-s\u003c/code\u003e, \u003ccode\u003e-p\u003c/code\u003e, \u003ccode\u003e-d\u003c/code\u003e) as narrow as possible!\u003c/p\u003e\n\u003cp\u003eSo UDP traffic doesn\u0026rsquo;t get routed. But what about ICMP and TCP packets? I had previously noticed that \u003ccode\u003eping\u003c/code\u003e would work from 10.24.12.40 to 10.24.9.31.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s see if TCP traffic also works. This time, instead of ssh-ing into the nodes and running docker, I used \u003ccode\u003e--generator=run-pod/v1\u003c/code\u003e and \u003ccode\u003e--override\u003c/code\u003e in order to choose on which node the pod is launched. Here is a sample of what I give to \u003ccode\u003e--override\u003c/code\u003e for running a pod on \u003ccode\u003enode-2\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eaffinity\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003enodeAffinity\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003erequiredDuringSchedulingIgnoredDuringExecution\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003enodeSelectorTerms\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ematchFields\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e- \u003cspan class=\"nt\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emetadata.name\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                \u003c/span\u003e\u003cspan class=\"nt\"\u003eoperator\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eIn\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                \u003c/span\u003e\u003cspan class=\"nt\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"l\"\u003enode-2]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFrom a pod on Node 1 (\u003ccode\u003e10.24.9.32\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl run --generator\u003cspan class=\"o\"\u003e=\u003c/span\u003erun-pod/v1 tmp-host-a --overrides\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;spec\u0026#34;:{\u0026#34;affinity\u0026#34;:{\u0026#34;nodeAffinity\u0026#34;:{\u0026#34;requiredDuringSchedulingIgnoredDuringExecution\u0026#34;:{\u0026#34;nodeSelectorTerms\u0026#34;:[{\u0026#34;matchFields\u0026#34;:[{\u0026#34;key\u0026#34;:\u0026#34;metadata.name\u0026#34;,\u0026#34;operator\u0026#34;:\u0026#34;In\u0026#34;,\u0026#34;values\u0026#34;:[\u0026#34;node-1\u0026#34;]}]}]}}}}}\u0026#39;\u003c/span\u003e --rm -i --tty --image nicolaka/netshoot\n% nc -v 10.24.12.41 \u003cspan class=\"m\"\u003e80\u003c/span\u003e\nConnection to 10.24.12.41 \u003cspan class=\"m\"\u003e80\u003c/span\u003e port \u003cspan class=\"o\"\u003e[\u003c/span\u003etcp/http\u003cspan class=\"o\"\u003e]\u003c/span\u003e succeeded!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFrom a pod on Node 2 (\u003ccode\u003e10.24.12.41\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl run --generator\u003cspan class=\"o\"\u003e=\u003c/span\u003erun-pod/v1 tmp-host-b --overrides\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;spec\u0026#34;:{\u0026#34;affinity\u0026#34;:{\u0026#34;nodeAffinity\u0026#34;:{\u0026#34;requiredDuringSchedulingIgnoredDuringExecution\u0026#34;:{\u0026#34;nodeSelectorTerms\u0026#34;:[{\u0026#34;matchFields\u0026#34;:[{\u0026#34;key\u0026#34;:\u0026#34;metadata.name\u0026#34;,\u0026#34;operator\u0026#34;:\u0026#34;In\u0026#34;,\u0026#34;values\u0026#34;:[\u0026#34;node-2\u0026#34;]}]}]}}}}}\u0026#39;\u003c/span\u003e --rm -i --tty --image nicolaka/netshoot\n% nc -v -l \u003cspan class=\"m\"\u003e80\u003c/span\u003e\nListening on \u003cspan class=\"o\"\u003e[\u003c/span\u003e0.0.0.0\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003efamily 0, port 80\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nConnection from 10.24.9.32 \u003cspan class=\"m\"\u003e38274\u003c/span\u003e received!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe traffic on 80/tcp definitely seems to work from Node 1 to Node 2! Now, let\u0026rsquo;s try the same but with 53/tcp and from Node 2 to Node 1.\u003c/p\u003e\n\u003cp\u003eFrom pod on Node 1 (\u003ccode\u003e10.24.9.32\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% nc -v -l \u003cspan class=\"m\"\u003e53\u003c/span\u003e\nListening on \u003cspan class=\"o\"\u003e[\u003c/span\u003e0.0.0.0\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003efamily 0, port 53\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFrom pod on Node 2 (\u003ccode\u003e10.24.12.41\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% curl 10.24.9.32:53\ncurl: \u003cspan class=\"o\"\u003e(\u003c/span\u003e28\u003cspan class=\"o\"\u003e)\u003c/span\u003e Failed to connect to 10.24.9.32 port 53: Operation timed out\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTo recap, only 80/tcp, 443/tcp and icmp packets are routed. It\u0026rsquo;s surprisingly very specific: what if the VPC firewall rules were off? That was my last guess, but I guess it should have been myst first\u0026hellip;\u003c/p\u003e\n\u003cp\u003eTwo weeks ago, I remember having deleted some left-over rules when I was playing with Kops. I might have deleted one of the rules that allowed this traffic to flow!\u003c/p\u003e\n\u003cp\u003eHere is what the UI shows:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"gcp-ui-vpc-firewall-rules.png\" alt=\"Screenshot of the VPC interface on GCP, the 10.24.0.0 subnet doesn\u0026rsquo;t seem to be allowed\"\u003e\u003c/p\u003e\n\u003cp\u003eEven easier-to-read, using \u003ccode\u003egcloud\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud compute firewall-rules list\nNAME                   NETWORK  DIRECTION  PRIORITY ALLOW\nakrobateo-fw-traefik   default  INGRESS    \u003cspan class=\"m\"\u003e1000\u003c/span\u003e     tcp:80,tcp:443\ndefault-allow-icmp     default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e    icmp\ndefault-allow-internal default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e    tcp:0-65535,udp:0-65535,icmp\ndefault-allow-rdp      default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e    tcp:3389\ndefault-allow-ssh      default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e    tcp:22\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHow is the traffic using the \u003ccode\u003e10.24.0.0/14\u003c/code\u003e subnet supposed to be routed? This subnet was allocated to this GKE cluster; node 1 was given the CIDR \u003ccode\u003e10.24.9.0/24\u003c/code\u003e and node 2 was given the CIDR \u003ccode\u003e10.24.12.0/24\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eSo I added a new rule \u003ccode\u003egke-august-period-234610-all\u003c/code\u003e (august-period-234610 is the name of my project); it looks like that:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003eNAME                         NETWORK  DIRECTION  PRIORITY  ALLOW                         DENY  DISABLED\ngke-august-period-234610-all default  INGRESS    \u003cspan class=\"m\"\u003e1000\u003c/span\u003e      udp,icmp,esp,ah,sctp,tcp            False\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, let\u0026rsquo;s test again using 53/udp:\u003c/p\u003e\n\u003cp\u003ePod on Node 2 (\u003ccode\u003e10.24.12.41\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% nc -v -u 10.24.9.32 \u003cspan class=\"m\"\u003e8888\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Exits with 0 and no output\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ePod on Node 1 (\u003ccode\u003e10.24.9.32\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% tcpdump\ntcpdump: verbose output suppressed, use -v or -vv \u003cspan class=\"k\"\u003efor\u003c/span\u003e full protocol decode\nlistening on eth0, link-type EN10MB \u003cspan class=\"o\"\u003e(\u003c/span\u003eEthernet\u003cspan class=\"o\"\u003e)\u003c/span\u003e, capture size \u003cspan class=\"m\"\u003e262144\u003c/span\u003e bytes\n21:54:39.787779 IP 10.24.12.41.40760 \u0026gt; tmp-host-a.8888: UDP, length \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n21:54:39.787802 IP tmp-host-a \u0026gt; 10.24.12.41: ICMP tmp-host-a udp port \u003cspan class=\"m\"\u003e8888\u003c/span\u003e unreachable, length \u003cspan class=\"m\"\u003e37\u003c/span\u003e\n21:54:39.787805 IP 10.24.12.41.40760 \u0026gt; tmp-host-a.8888: UDP, length \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n21:54:39.787808 IP tmp-host-a \u0026gt; 10.24.12.41: ICMP tmp-host-a udp port \u003cspan class=\"m\"\u003e8888\u003c/span\u003e unreachable, length \u003cspan class=\"m\"\u003e37\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eYay! In the end, the issue was not so deep\u0026hellip; A manual edit to the firewall rules that I had not thought through and for which I have no record of. I already terraformed a lot of the cluster and node creation, but I should definitely move everything to terraform and stop doing manual edits that can\u0026rsquo;t be traced back!\u003c/p\u003e\n\u003c!--\nIf you with to leave a comment, here is a Twitter thread:\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eI decided to write a blog post that recaps what I went through while trying to fix my cluster 😁 \u003ca href=\"https://t.co/sb0UcctUUU\"\u003ehttps://t.co/sb0UcctUUU\u003c/a\u003e\u003c/p\u003e\u0026mdash; Maël Valais (@maelvls) \u003ca href=\"https://twitter.com/maelvls/status/1221488683485925376?ref_src=twsrc%5Etfw\"\u003eJanuary 26, 2020\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n--\u003e\n","date":1579996800,"description":"Some pods were unable to connect to the kube-proxy pod on one of my GKE Kubernetes clusters. This post present an in-depth investigation using tcpdump, wireshark and iptables tracing.","dir":"2020/debug-kubernetes-networking/","expirydate":-62135596800,"fuzzywordcount":2000,"images":["debugging-kubernetes-networking/cover-debug-kubernetes-networking.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1579996800,"objectID":"3857ffe139e101d2bed980267b059779","permalink":"https://maelvls.dev/debugging-kubernetes-networking/","publishdate":"2020-01-26T00:00:00Z","readingtime":10,"relpermalink":"/debugging-kubernetes-networking/","section":"2020","summary":"When I scaled my GKE cluster from one node to two nodes, I realised there was some DNS issues with one of the pods on the new Node 2 (that\u0026rsquo;s what I initially thought).\nSo I went into pod-on-2 (10.24.12.40) and checked that DNS wasn\u0026rsquo;t working. What I did is run\n% gcloud compute ssh node-2 % docker run --rm -it --net=container:$(docker ps | grep POD_pod-on-2 | head -1 | cut -f1 -d\u0026#34; \u0026#34;) nicolaka/netshoot % nslookup github.","tags":["kubernetes","networking"],"title":"Debugging Kubernetes Networking: my kube-dns is not working!","type":"2020","url":"https://maelvls.dev/debugging-kubernetes-networking/","weight":0,"wordcount":1965},{"authors":null,"categories":null,"content":"\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e⚠️ Update 25 April 2020\u003c/strong\u003e: Akrobateo has been EOL in January 2020 due to the company going out of business. Their blog post regarding the EOL isn\u0026rsquo;t available anymore and was probably shut down. Fortunately, the Wayback Machine \u003ca href=\"https://web.archive.org/web/20200107111252/https://blog.kontena.io/farewell/\"\u003ehas a snapshot of the post\u003c/a\u003e (7th January 2020). Here is an excerpt:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis is a sad day for team Kontena. We tried to build something amazing but our plans of creating business around open source software has failed. We couldn\u0026rsquo;t build a sustainable business. Despite all the effort, highs and lows, as of today, Kontena has ceased operations. The team is no more and the official support for Kontena products is no more available.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is so sad\u0026hellip; 😢 Note that the Github repo \u003ca href=\"https://github.com/kontena/akrobateo\"\u003ekontena/akrobateo\u003c/a\u003e is still there (and has not been archived yet), but their Docker registry has been shut down which means most of this post is broken.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIn my spare time, I maintain a tiny \u0026ldquo;playground\u0026rdquo; Kubernetes cluster on \u003ca href=\"https://cloud.google.com/kubernetes-engine\"\u003eGKE\u003c/a\u003e (helm charts \u003ca href=\"https://github.com/maelvls/k.maelvls.dev\"\u003ehere\u003c/a\u003e). I quickly realized that realized using \u003ccode\u003eService type=LoadBalancer\u003c/code\u003e in GKE was spawning a \u003cem\u003e\u003ca href=\"https://cloud.google.com/load-balancing/docs/network\"\u003eNetwork Load Balancer\u003c/a\u003e\u003c/em\u003e which costs approximately \u003cstrong\u003e$15 per month\u003c/strong\u003e! In this post, I present a way of avoiding the expensive Google Network Load Balancer by load balancing in-cluster using akrobateo, which acts as a Service type=LoadBalancer controller.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e✅ Since this method uses the worker node\u0026rsquo;s external IPs, we can\u0026rsquo;t really say it is a real \u0026ldquo;load balancing\u0026rdquo; mechanism (i.e., this method doesn\u0026rsquo;t handle IP failover and doesn\u0026rsquo;t even tolerate node failures). But in my tiny setup, it makes a lot of sense to use that.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"cost-load-balancer-gke.png\" alt=\"Network Load Balancing: Forwarding Rule Minimum Service Charge in EMEA\"\u003e\u003c/p\u003e\n\u003cp\u003eWhat happens is that GKE has a LoadBalancer controller running (I can\u0026rsquo;t see it) and whenever I have a service with \u003ccode\u003etype: LoadBalancer\u003c/code\u003e, it will create a L4 load balancer that balances 80 and 443 traffic across the nodes. Here is a diagram of my current setup:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"how-service-controller-works-on-gke.png\" alt=\"ExternalDNS, GKE and Traefik\"\u003e\u003c/p\u003e\n\u003cp\u003eI use Traefik as a reverse-proxy and terminates the end-user TLS connection. And since Traefik sets the \u003ccode\u003estatus.loadBalancer.ingress\u003c/code\u003e on the ingress objects, I can also use \u003ca href=\"https://github.com/kubernetes-sigs/external-dns/\"\u003eExternalDNS\u003c/a\u003e for setting the \u003ccode\u003eA\u003c/code\u003e records automatically (I use Cloud DNS).\u003c/p\u003e\n\u003cp\u003eWhat if I stopped using the LoadBalancer service and use a \u003ccode\u003eNodePort\u003c/code\u003e instead? Two reasons against that:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGKE \u003ca href=\"https://issues.k8s.io/9995\"\u003erestricts\u003c/a\u003e the ports you can use to 30000 and above. So I would end up with \u003ccode\u003ehttps://kube.maelvls.dev:30145\u003c/code\u003e and I definitely don\u0026rsquo;t want that. I want to use 80 and 443.\u003c/li\u003e\n\u003cli\u003eTraefik uses the LoadBalancer service\u0026rsquo;s status in order to set the ingresses' \u003ccode\u003estatus.loadBalancer.ingress\u003c/code\u003e, which in turn is used by ExternalDNS for setting the \u003ccode\u003eA\u003c/code\u003e records automatically. I still want to be able to use ExternalDNS.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThus, my goal is expose Traefik on 80 and 443 and still use the \u003ccode\u003etype: LoadBalancer\u003c/code\u003e which, in turn, allows me to use ExternalDNS.\u003c/p\u003e\n\u003cp\u003eI could use the service\u0026rsquo;s \u003ccode\u003eexternalIPs\u003c/code\u003e but it isn\u0026rsquo;t supported by Traefik and I would have to write some controller that would get the node internal IP and then set the \u003ccode\u003eexternalIPs\u003c/code\u003e with these.\u003c/p\u003e\n\u003cp\u003eInstead, I opted for the \u003ccode\u003ehostPort\u003c/code\u003e solution. No restriction on 80 or 443. But I still have to automate a lot. Fortunately, \u003ca href=\"https://github.com/kontena/akrobateo\"\u003eakrobateo\u003c/a\u003e does exactly what I need.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003ehostPort\u003c/code\u003e is a field you can set in a Pod. The hostPort is used by kube-proxy to forward traffic coming to the node with the destination \u003ccode\u003ehostIP:hostPort\u003c/code\u003e to the pod itself.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ePod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eakrobateo-lb-xmz8z\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;registry.pharos.sh/kontenapharos/akrobateo-lb:0.1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003econtainerPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e443\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ehostPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e443\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# ⚠️\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eTCP\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehostIP\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e172.31.4.153\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# ⚠️ hostIP and hostPort go together\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epodIP\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e192.168.1.38\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn this example pod, the pod runs on the node that has the hostIP \u003ccode\u003e172.31.4.153\u003c/code\u003e. Any time traffic comes to the main network interface of the node with the TCP packet destination \u003ccode\u003edst: 172.31.4.153:443\u003c/code\u003e will be forwarded (i.e., DNATed) to \u003ccode\u003edst: 192.168.1.38:443\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eNote that this pod was actually created using a DeamonSet.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAkrobateo acts as an internal LoadBalancer service controller and replaces the gce-ingress-controller that GKE applies to every GKE cluster. It is inspired by K3S' \u003ca href=\"https://github.com/rancher/k3s/blob/341a5553/pkg/servicelb/controller.go\"\u003eservicelb\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe akrobateo controller reads the LoadBalancer services and updates the \u003ccode\u003estatus.loadBalancer.ingress\u003c/code\u003e on these services with the node external IPs. Whenever the external IPs change (since they are ephemeral), the controller updates the service; Traefik does it job and finally ExternalDNS updates the DNS records.\u003c/p\u003e\n\u003cp\u003eI might get some downtime with that, but for my use it\u0026rsquo;s just fine.\u003c/p\u003e\n\u003ch2 id=\"setting-up-akrobateo\"\u003eSetting up Akrobateo\u003c/h2\u003e\n\u003cp\u003eThat will install the akrobateo controller in the kube-system namespace:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ek apply -k https://github.com/kontena/akrobateo/deploy\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSince we want TCP 80 and 443 traffic to be able to hit the nodes. Let\u0026rsquo;s set a new firewall rule:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003egcloud compute firewall-rules create akrobateo-fw-traefik --allow tcp:80,tcp:443 --source-ranges\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0/0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAlso, make sure we don\u0026rsquo;t have a L4 load balancer still running. The load balancer won\u0026rsquo;t get removed automatically.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud compute forwarding-rules list\nListed \u003cspan class=\"m\"\u003e0\u003c/span\u003e items.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAt this point, the LoadBalancer service should contain the IPs of the nodes:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ekubectl -n traefik get services traefik -oyaml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eService\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etraefik\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etraefik\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eclusterIP\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.244.111\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eexternalTrafficPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCluster\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003enodePort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e30371\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e80\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eTCP\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etargetPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003enodePort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e32748\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e443\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eTCP\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etargetPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eLoadBalancer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eloadBalancer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eingress\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e- \u003cspan class=\"nt\"\u003eip\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e35.211.248.124\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e- \u003cspan class=\"nt\"\u003eip\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e35.231.10.40\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhen displayed with \u003ccode\u003ekubectl get\u003c/code\u003e, we can see the two IPs from the status.loadBalancer in the \u0026ldquo;EXTERNAL-IP\u0026rdquo; column:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl -n traefik get services -owide\nNAME                TYPE           CLUSTER-IP      EXTERNAL-IP                   PORT\u003cspan class=\"o\"\u003e(\u003c/span\u003eS\u003cspan class=\"o\"\u003e)\u003c/span\u003e\ntraefik             LoadBalancer   10.27.244.111   35.211.248.124,35.231.10.40   80:30371/TCP,443:32748/TCP\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s check that these are the external IPs of the cluster nodes:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl get nodes -owide\nNAME                                                 INTERNAL-IP   EXTERNAL-IP\ngke-august-period-234610-worker-0c5c84f5-rq25        10.142.0.61   35.231.10.40\ngke-august-period-234610-worker-micro-cf12d79d-klh6  10.142.0.62   35.211.248.124\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe \u003ccode\u003ekube-system/akrobateo\u003c/code\u003e controller will create a DeamonSet for every LoadBalancer service it finds. The DeamonSet is created in the same namespace as where the Service is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl get ds -A\nNAMESPACE     NAME                       DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE\ntraefik       akrobateo-traefik          \u003cspan class=\"m\"\u003e2\u003c/span\u003e         \u003cspan class=\"m\"\u003e2\u003c/span\u003e         \u003cspan class=\"m\"\u003e2\u003c/span\u003e       \u003cspan class=\"m\"\u003e2\u003c/span\u003e            \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis DeamonSet runs one pod per node, each pod being responsible for proxying everything coming to the host\u0026rsquo;s 80 and 443 ports to Traefik (see description of the network flow below).\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s make sure ExternalDNS uses the correct IPs:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ek -n external-dns logs -l app.kubernetes.io/name\u003cspan class=\"o\"\u003e=\u003c/span\u003eexternal-dns -f\n\u003cspan class=\"nv\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2020-01-18T17:26:31Z\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003elevel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003edebug \u003cspan class=\"nv\"\u003emsg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Endpoints generated from ingress: traefik/traefik-dashboard: [traefik.kube.maelvls.dev 0 IN A  35.211.248.124 [] traefik.kube.maelvls.dev 0 IN A  35.211.248.124 []]\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThere still is a slight issue here: we would expect ExternalDNS to set a \u003ccode\u003eA\u003c/code\u003e record with both IPs (35.211.248.124 and 35.231.10.40). But for some reason, it doesn\u0026rsquo;t. As we have seen previously, the Akrobateo controller has successfully updated the traefik/traefik service (type LoadBalancer). And since Traefik is the ingress controller responsible for setting the \u003ccode\u003estatus.loadBalancer.ingress\u003c/code\u003e on ingresses, Traefik is probably the culprit and might simply pick the first element.\u003c/p\u003e\n\u003ch2 id=\"pros-and-cons\"\u003ePros and cons\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eIsn\u0026rsquo;t \u003ccode\u003ehostPort\u003c/code\u003e a bad practice?\u003c/strong\u003e From the \u003ca href=\"https://kubernetes.io/docs/concepts/configuration/overview/#services\"\u003eKubernetes documentation\u003c/a\u003e:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eDon\u0026rsquo;t specify a \u003ccode\u003ehostPort\u003c/code\u003e for a Pod unless it is absolutely necessary. When you bind a Pod to a \u003ccode\u003ehostPort\u003c/code\u003e, it limits the number of places the Pod can be scheduled, because each \u0026lt;\u003ccode\u003ehostIP\u003c/code\u003e, \u003ccode\u003ehostPort\u003c/code\u003e, \u003ccode\u003eprotocol\u003c/code\u003e\u0026gt; combination must be unique.\u003c/p\u003e\n\u003cp\u003e[When using \u003ccode\u003ehostPort\u003c/code\u003e,] if you don\u0026rsquo;t specify the \u003ccode\u003ehostIP\u003c/code\u003e and \u003ccode\u003eprotocol\u003c/code\u003e explicitly, Kubernetes will use \u003ccode\u003e0.0.0.0\u003c/code\u003e as the default \u003ccode\u003ehostIP\u003c/code\u003e and \u003ccode\u003eTCP\u003c/code\u003e as the default \u003ccode\u003eprotocol\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eIf you explicitly need to expose a Pod’s port on the node, consider using a \u003ca href=\"https://kubernetes.io/docs/concepts/services-networking/service/#nodeport\"\u003eNodePort\u003c/a\u003e Service before resorting to \u003ccode\u003ehostPort\u003c/code\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eI do not fuly grasp what are the implications of using a hostPort. I guess it \u0026ldquo;litters\u0026rdquo; the iptables on the node? I\u0026rsquo;m not sure.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eWhat if I have many more nodes, can it scale?\u003c/strong\u003e I guess it won\u0026rsquo;t. Maybe one idea would be to leader-elect two or three nodes and put only these two or three IPs in \u003ccode\u003estatus.loadbalancer.ingress[]\u003c/code\u003e. If one of the nodes fails, the DNS will be updated; the client will be able to failover using the two or three IPs from the DNS record.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eReliability?\u003c/strong\u003e If the nodes that are advertised in the \u003ccode\u003eA\u003c/code\u003e DNS records go down, no more ingress traffic possible.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eWhat if the node\u0026rsquo;s external-ip changes?\u003c/strong\u003e Since these IPs are ephemeral, the controller will pick up this change and change the \u003ccode\u003estatus.loadBalancer.ingress\u003c/code\u003e field of my \u003ccode\u003etype: LoadBalancer\u003c/code\u003e service.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"how-does-it-work\"\u003eHow does it work?\u003c/h2\u003e\n\u003cp\u003eSince I created a firewall rule for 80 and 443, GCE forwards the traffic from 35.211.248.124 (the node\u0026rsquo;s external-ip) to 10.142.0.62 (the node\u0026rsquo;s internal-ip). And since we use \u003ccode\u003ehostPort\u003c/code\u003e, kubelet creates some iptable rules that redirect traffic to the pod running on that node:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud compute ssh gke-august-period-234610-worker-micro-cf12d79d-klh6 --command\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;sudo iptables-save\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e egrep \u003cspan class=\"s2\"\u003e\u0026#34;(HOSTPORT|HP)\u0026#34;\u003c/span\u003e\n-A PREROUTING -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;kube hostport portals\u0026#34;\u003c/span\u003e -m addrtype --dst-type LOCAL -j KUBE-HOSTPORTS\n-A OUTPUT -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;kube hostport portals\u0026#34;\u003c/span\u003e -m addrtype --dst-type LOCAL -j KUBE-HOSTPORTS\n-A PREROUTING -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;kube hostport portals\u0026#34;\u003c/span\u003e -m addrtype --dst-type LOCAL -j KUBE-HOSTPORTS\n    \u003cspan class=\"c1\"\u003e# If the packet destination is local (localhost or 127.*), continue with KUBE-HOSTPORTS.\u003c/span\u003e\n-A KUBE-HOSTPORTS -p tcp -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;akrobateo-traefik-4jh5k_traefik hostport 443\u0026#34;\u003c/span\u003e -m tcp --dport \u003cspan class=\"m\"\u003e443\u003c/span\u003e -j KUBE-HP-A7HWACIJNU4N3R5W\n    \u003cspan class=\"c1\"\u003e# If it is a TCP packet and the destication port is 443, continue with KUBE-HP-A7HWACIJNU4N3R5W\u003c/span\u003e\n-A KUBE-HP-A7HWACIJNU4N3R5W -s 10.24.4.2/32 -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;akrobateo-traefik-4jh5k_traefik hostport 443\u0026#34;\u003c/span\u003e -j KUBE-MARK-MASQ\n    \u003cspan class=\"c1\"\u003e# If the source IP of the packet is the akrobateo proxy pod, this packet is egressing: continue with KUBE-MARK-MASQ (masquarade)\u003c/span\u003e\n-A KUBE-HP-A7HWACIJNU4N3R5W -p tcp -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;akrobateo-traefik-4jh5k_traefik hostport 443\u0026#34;\u003c/span\u003e -m tcp -j DNAT --to-destination 10.24.4.2:443\n    \u003cspan class=\"c1\"\u003e# If the source wasnt this pod, then we assume it is some ingress. We replace the destination with the pods ClusterIP.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThen, when it is in the pod, the pod\u0026rsquo;s iptables will kick in and redirect. Nothing is actually running in the pod, except for the namespaced network stack. These pods have:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ean init container that runs \u003ccode\u003esysctl -w net.ipv4.ip_forward=1\u003c/code\u003e (see \u003ca href=\"https://kubernetes.io/docs/concepts/cluster-administration/networking/#google-compute-engine-gce\"\u003ek8s-networking-gce\u003c/a\u003e) in privileged mode, which enables forwarding inside the pod (does not affect the host).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003etwo containers set iptables and then \u003ccode\u003epause\u003c/code\u003e. In order to alter its namespaced TCP stack, we give the containers the NET_ADMIN capability (these rules only affect the pod, not the host).\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003esudo iptables -t nat -I PREROUTING ! -s 10.27.244.111/32 -p TCP --dport \u003cspan class=\"m\"\u003e80\u003c/span\u003e -j DNAT --to 10.27.244.111:80\nsudo iptables -t nat -I POSTROUTING -d 10.27.244.111/32 -p TCP -j MASQUERADE\nsudo iptables -t nat -I PREROUTING ! -s 10.27.244.111/32 -p TCP --dport \u003cspan class=\"m\"\u003e443\u003c/span\u003e -j DNAT --to 10.27.244.111:443\nsudo iptables -t nat -I POSTROUTING -d 10.27.244.111/32 -p TCP -j MASQUERADE\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHere is a diagram that shows the whole picture:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"packet-routing-with-akrobateo.png\" alt=\"Packet routing using Akrobateo, Traefik and iptables\"\u003e\u003c/p\u003e\n\u003ch2 id=\"akrobateo-vs-k3ss-servicelb-controller\"\u003eAkrobateo vs. K3s\u0026rsquo;s servicelb controller\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/rancher/k3s\"\u003eK3s\u003c/a\u003e has this same idea of \u0026ldquo;service type loadbalancer controller\u0026rdquo; embedded to K3s itself. The controller, called \u0026ldquo;servicelb\u0026rdquo; (\u003ca href=\"https://github.com/rancher/k3s/blob/master/pkg/servicelb/controller.go\"\u003eservicelb/controller.go\u003c/a\u003e) runs as a Deployment and a DeamonSet running \u003ca href=\"https://github.com/rancher/klipper-lb\"\u003eklipper-lb\u003c/a\u003e that uses pod\u0026rsquo;s \u003ccode\u003ehostPort\u003c/code\u003e and the pod\u0026rsquo;s iptables to forward traffic to the cluster-ip of the service. I don\u0026rsquo;t know yet what are the differences between Akrobateo and K3s' servicelb. Note that Akrobateo itself is based on servicelb.\u003c/p\u003e\n\u003ch2 id=\"recap\"\u003eRecap\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eAkrobateo is a controller that watches Services of \u003ccode\u003etype: LoadBalancer\u003c/code\u003e;\u003c/li\u003e\n\u003cli\u003eWhen it finds one, creates a deamonset of empty pods.\u003c/li\u003e\n\u003cli\u003eThe task of these empty pods is to set one iptable rule that redirects traffic to the ClusterIP of the \u003ccode\u003etype: LoadBalancer\u003c/code\u003e service.\u003c/li\u003e\n\u003cli\u003eAkrobateo also sets the Service\u0026rsquo;s status with the loadBalancer IP.\u003c/li\u003e\n\u003cli\u003eBenefit: since the loadBalancer IP is properly set, ExternalDNS works!\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!--\nWant to drop a comment? Here is a Twitter thread:\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eGKE is great and everything but the default €17 load balancer is just too much for my \u0026quot;playground\u0026quot; cluster.\u003cbr\u003e\u003cbr\u003eHere is how I avoid it by using a custom loadbalancer controller \u003cbr\u003e (kontena/akrobateo) with ExternalDNS and Traefik:\u003ca href=\"https://t.co/8TjrrUi4Sg\"\u003ehttps://t.co/8TjrrUi4Sg\u003c/a\u003e\u003c/p\u003e\u0026mdash; Maël Valais (@maelvls) \u003ca href=\"https://twitter.com/maelvls/status/1219193625478881285?ref_src=twsrc%5Etfw\"\u003eJanuary 20, 2020\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n--\u003e\n\u003c!--\n## Metallb vs. K3s' servicelb vs. akrobateo\n\n- metallb = vrrp + arp (l2), see \"[MetalLB Layer 2 concepts](https://metallb.universe.tf/concepts/layer2/)\"\n\nARP =\nNDP =\n\nMetalLB implements something close to VRRP.\n\n--\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate 22 April 2020:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAkrobateo \u003ca href=\"https://twitter.com/i/status/1219193625478881285\"\u003eis EOL\u003c/a\u003e since January 2020 😢 I added a note about that.\u003c/li\u003e\n\u003cli\u003eBetter introduction.\u003c/li\u003e\n\u003cli\u003eExplain what I mean by \u003ccode\u003ehostPort\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIn \u0026ldquo;Isn\u0026rsquo;t \u003ccode\u003ehostPort\u003c/code\u003e a bad practice?\u0026rdquo;, I replaced \u0026ldquo;I don\u0026rsquo;t know\u0026rdquo; with a \u003ca href=\"https://kubernetes.io/docs/concepts/configuration/overview/#services\"\u003elink\u003c/a\u003e to the Kubernetes documentation that mention why I should avoid hostPort.\u003c/li\u003e\n\u003cli\u003eIn \u0026ldquo;What if I have many more nodes, can it scale?\u0026rdquo;, I replaced \u0026ldquo;I don\u0026rsquo;t know\u0026rdquo; with a proposition of solution.\u003c/li\u003e\n\u003cli\u003eDetail how K3s' servicelb is similar to Akrobateo.\u003c/li\u003e\n\u003c/ul\u003e\n","date":1579478400,"description":"I want to avoid using the expensive Google Network Load Balancer and instead do the load balancing in-cluster using akrobateo, which acts as a LoadBalancer controller.","dir":"2020/avoid-gke-lb-using-hostport/","expirydate":-62135596800,"fuzzywordcount":1900,"images":["avoid-gke-lb-with-hostport/cover-external-dns.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1579478400,"objectID":"766db7c63735883bace9bdcba2b5030e","permalink":"https://maelvls.dev/avoid-gke-lb-with-hostport/","publishdate":"2020-01-20T00:00:00Z","readingtime":9,"relpermalink":"/avoid-gke-lb-with-hostport/","section":"2020","summary":"⚠️ Update 25 April 2020: Akrobateo has been EOL in January 2020 due to the company going out of business. Their blog post regarding the EOL isn\u0026rsquo;t available anymore and was probably shut down. Fortunately, the Wayback Machine has a snapshot of the post (7th January 2020). Here is an excerpt:\n This is a sad day for team Kontena. We tried to build something amazing but our plans of creating business around open source software has failed.","tags":["kubernetes","networking"],"title":"Avoid GKE's expensive load balancer by using hostPort","type":"2020","url":"https://maelvls.dev/avoid-gke-lb-with-hostport/","weight":0,"wordcount":1890},{"authors":null,"categories":null,"content":"\u003cdiv class=\"nohighlight\"\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e  ROLE OF THE CERTIFICATE AUTHORITY\n\n      +------------------------------+  +-----------------+\n     CERTIFICATE AUTHORITY (NOT A CERT) |     CA KEY      |\n      |+----------------------------+|  |+---------------+|\n      || O=GlobalSign,CN=GlobalSign ||  || private key   ||\n      |+----------------------------+|  |+-------|-------+|\n      |+----------------------------+|  +--------|--------+\n      ||   public key (= VERIFY)    ||           |\n      |+----------------------------+|           |\n      +------------------------------+           |\n                                                 |\n CA cert\u0026#39;s pub key = signature                   |\n -----------------------------------------------------------\n Signed cert\u0026#39;s pub key = encryption              |\n                                                 |\n      +------------------------------+           |\n      |         CERTIFICATE          |           |\n      |1----------------------------+|           |\n      ||O=Google LLC,CN=*.google.com||           |\n      |+----------------------------+|           |signs using\n      |2----------------------------+|           |private key\n      ||   public key (= DECRYPT)   ||           |\n      |+----------------------------+|           |\n      |+----------------------------+|           |\n      ||      signature of 1+2      ||\u0026lt;----------+\n      |+----------------------------+|\n      +------------------------------+\n\n\n\n   ROLE OF THE END-USER               +------------------------------+\n                                      |   CA CERTIFICATE (trusted)   |\n    Can I trust foo.google.com?       |+----------------------------+|\n                |                     || O=GlobalSign,CN=GlobalSign ||\n                |                     |+----------------------------+|\n                |                     |+----------------------------+|\n                |  +-----------------\u0026gt;||    public key (= VERIFY)   ||\n                |  |                  |+----------------------------+|\n                |  |                  +------------------------------+\n                |  |check signature   (this cert is secure on my disk)\n                |  |using public key\n                |  |\n            (1) |  |(2)               +------------------------------+\n                |  |                  |    CERTIFICATE (untrusted)   |\n         verify |  |                  |1----------------------------+|\n      signature |  |                  ||O=Google LLC,CN=*.google.com||\n                |  |                  |+----------------------------+|\n                |  |                  |2----------------------------+|\n                |  |                  ||   public key (= ENCRYPT)   ||\n                |  +------------------|+----------------------------+|\n                |                     |+----------------------------+|\n                +--------------------\u0026gt;||      signature of 1+2      ||\n                                      |+----------------------------+|\n                                      +------------------------------+\n                                      (this cert is sent to me by the\n                                                foo.google.com server)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c!--\nhttps://textik.com/#d85b4624473ca862\n--\u003e\n\u003ch2 id=\"whats-a-certificate-in-the-openssl-jargon\"\u003eWhat\u0026rsquo;s a \u0026ldquo;certificate\u0026rdquo; in the openssl jargon\u003c/h2\u003e\n\u003cp\u003eFor example, mitmproxy relies on a specific dir structure and filenames:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e/Users/mvalais/.mitmproxy\n├── mitmproxy-ca-cert.pem            \u003cspan class=\"c1\"\u003e# ca-cert = cert\u003c/span\u003e\n└── mitmproxy-ca.pem                 \u003cspan class=\"c1\"\u003e# ca      = cert + key\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThat\u0026rsquo;s the kind of directory structure that \u003ccode\u003e--set client_dir=...\u003c/code\u003e would expect (in mitmproxy).\u003c/p\u003e\n\u003ch2 id=\"using-openssl-to-dig-certificates\"\u003eUsing \u003ccode\u003eopenssl\u003c/code\u003e to dig certificates\u003c/h2\u003e\n\u003cp\u003eThis \u003ca href=\"https://www.sslshopper.com/article-most-common-openssl-commands.html\"\u003echeat sheet\u003c/a\u003e is nice. Here is a one-liner for fetching the certificate chain sitting on a server; for example for \u003ccode\u003eapi.github.com:443\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% openssl x509 -in \u0026lt;\u003cspan class=\"o\"\u003e(\u003c/span\u003eopenssl s_client -connect api.github.com:443 -prexit \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e -noout -text\n\n\u003cspan class=\"nv\"\u003eopenssldepth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"nv\"\u003eC\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e US, \u003cspan class=\"nv\"\u003eO\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e DigiCert Inc, \u003cspan class=\"nv\"\u003eOU\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e www.digicert.com, \u003cspan class=\"nv\"\u003eCN\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e DigiCert High Assurance EV Root CA\nverify \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e:1\n\u003cspan class=\"nv\"\u003edepth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eC\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e US, \u003cspan class=\"nv\"\u003eO\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e DigiCert Inc, \u003cspan class=\"nv\"\u003eOU\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e www.digicert.com, \u003cspan class=\"nv\"\u003eCN\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e DigiCert SHA2 High Assurance Server CA\nverify \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e:1\n\u003cspan class=\"nv\"\u003edepth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"nv\"\u003eC\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e US, \u003cspan class=\"nv\"\u003eST\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e California, \u003cspan class=\"nv\"\u003eL\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e San Francisco, \u003cspan class=\"nv\"\u003eO\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;GitHub, Inc.\u0026#34;\u003c/span\u003e, \u003cspan class=\"nv\"\u003eCN\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e *.github.com\nverify \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e:1\nDONE\nCertificate:\n    Data:\n        Version: \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e0x2\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n        Serial Number:\n            0c:07:3b:67:6f:67:45:78:f9:99:81:48:52:84:46:51\n    Signature Algorithm: sha256WithRSAEncryption\n        Issuer: \u003cspan class=\"nv\"\u003eC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eUS, \u003cspan class=\"nv\"\u003eO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eDigiCert Inc, \u003cspan class=\"nv\"\u003eOU\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ewww.digicert.com, \u003cspan class=\"nv\"\u003eCN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eDigiCert SHA2 High Assurance Server CA\n        Validity\n            Not Before: Jun \u003cspan class=\"m\"\u003e22\u003c/span\u003e 00:00:00 \u003cspan class=\"m\"\u003e2020\u003c/span\u003e GMT\n            Not After : Aug \u003cspan class=\"m\"\u003e17\u003c/span\u003e 12:00:00 \u003cspan class=\"m\"\u003e2022\u003c/span\u003e GMT\n        Subject: \u003cspan class=\"nv\"\u003eC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eUS, \u003cspan class=\"nv\"\u003eST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eCalifornia, \u003cspan class=\"nv\"\u003eL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eSan Francisco, \u003cspan class=\"nv\"\u003eO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eGitHub, Inc., \u003cspan class=\"nv\"\u003eCN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e*.github.com\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                Public-Key: \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2048\u003c/span\u003e bit\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n                Modulus:\n                    00:a0:e6:d3:87:ac:6f:4e:3b:29:75:60:4c:4a:1e:\n                    fa:dd:af:81:0a:37:c4:89:ad:b5:8e:9d:1d:0c:55:\n                    da:a4:b1:cb:ab:d3:14:bc:d2:6d:b8:d1:7c:36:1f:\n                    45:a1:06:25:32:63:7f:94:4c:f4:d6:97:06:3f:24:\n                    f2:85:f5:83:8c:27:8a:7f:6a:c8:46:e8:04:6f:4c:\n                    5f:4c:48:9a:a6:80:c1:08:db:9c:6e:81:8b:54:59:\n                    f0:c6:6d:58:2a:3d:42:ea:da:5d:aa:6b:90:7b:af:\n                    12:34:30:1b:22:5c:af:cd:ee:f2:3c:08:90:99:91:\n                    be:41:16:c6:e0:95:59:a9:d6:52:39:de:e9:a3:02:\n                    e2:68:e3:f9:b5:56:ce:ae:62:27:5e:ff:a3:94:1f:\n                    89:82:0f:5d:ea:82:4d:af:de:0f:3b:aa:04:4a:6f:\n                    a4:85:43:80:11:35:f1:3b:d6:66:80:68:97:6e:0a:\n                    e9:79:57:63:44:91:c1:e2:45:db:dd:2c:b9:2d:3d:\n                    16:76:af:0b:a4:04:80:c0:10:35:26:f2:9f:38:43:\n                    a8:1d:a5:19:79:f0:b0:60:98:40:f8:4c:54:53:5f:\n                    32:0e:de:86:65:e7:4f:5c:21:7a:c7:35:7f:de:a3:\n                    e0:8e:b2:d3:02:42:64:40:14:21:20:96:14:09:54:\n                    1f:53\n                Exponent: \u003cspan class=\"m\"\u003e65537\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e0x10001\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n        X509v3 extensions:\n            X509v3 Authority Key Identifier:\n                keyid:51:68:FF:90:AF:02:07:75:3C:CC:D9:65:64:62:A2:12:B8:59:72:3B\n\n            X509v3 Subject Key Identifier:\n                79:53:13:17:53:DA:1E:A9:73:A9:9E:88:8D:C2:53:D9:36:E2:E5:2A\n            X509v3 Subject Alternative Name:\n                DNS:*.github.com, DNS:github.com\n            X509v3 Key Usage: critical\n                Digital Signature, Key Encipherment\n            X509v3 Extended Key Usage:\n                TLS Web Server Authentication, TLS Web Client Authentication\n            X509v3 CRL Distribution Points:\n\n                Full Name:\n                  URI:http://crl3.digicert.com/sha2-ha-server-g6.crl\n\n                Full Name:\n                  URI:http://crl4.digicert.com/sha2-ha-server-g6.crl\n\n            X509v3 Certificate Policies:\n                Policy: 2.16.840.1.114412.1.1\n                  CPS: https://www.digicert.com/CPS\n                Policy: 2.23.140.1.2.2\n\n            Authority Information Access:\n                OCSP - URI:http://ocsp.digicert.com\n                CA Issuers - URI:http://cacerts.digicert.com/DigiCertSHA2HighAssuranceServerCA.crt\n\n            X509v3 Basic Constraints: critical\n                CA:FALSE\n            1.3.6.1.4.1.11129.2.4.2:\n                ...g.e.u.\u003cspan class=\"o\"\u003e)\u003c/span\u003ey...99!.Vs.c.w..W\u003cspan class=\"o\"\u003e}\u003c/span\u003e.\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n..M\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\%\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e.....r..*......F0D. f........\n,cj...\u003cspan class=\"s2\"\u003e\u0026#34;~........M,..... U+.zza....WN9.V...A;U..?k.e%._.`.u.A....\u0026#34;\u003c/span\u003eFJ...:.B.^N1.....K.h..b......r..*......F0D. w.jXF...7K..v. %.A...\u003cspan class=\"p\"\u003e;\u003c/span\u003e,.E.o\u003cspan class=\"o\"\u003e}\u003c/span\u003eJN... 39..W..Z..Ff\u003cspan class=\"p\"\u003e;\u003c/span\u003e.0.....u SZ\n..\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e. ...u.F.U.u.. 0...i..\u003cspan class=\"o\"\u003e}\u003c/span\u003e.,At..I.....p.mG...r..+6.....F0D. \u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e....................O....Dmcpu@. A?W...o.d..o.!..e*....C\u003cspan class=\"o\"\u003e(\u003c/span\u003e%......c\n    Signature Algorithm: sha256WithRSAEncryption\n         4e:0c:e9:56:59:75:8a:8c:af:75:d9:0e:57:58:fc:c0:8d:d9:\n         35:67:84:61:a9:2c:0b:aa:ff:a6:62:31:31:53:6c:d6:50:44:\n         1d:7e:0a:11:ec:40:00:d9:f4:d2:e0:f7:a3:f7:32:91:1b:ac:\n         d0:4c:01:1e:03:f8:19:8b:1e:79:33:dd:38:c6:a7:f4:4b:3b:\n         e9:31:11:b9:c6:a7:63:40:d6:02:2b:43:59:bb:98:4f:08:24:\n         78:a0:67:1d:0e:35:bb:40:82:85:e0:d5:7e:76:7e:e4:94:d3:\n         4e:a6:d1:31:c0:41:d2:b0:9a:b7:77:c9:36:b9:31:69:95:87:\n         b0:50:d9:ef:e5:37:80:a9:f2:dc:0d:a0:82:c8:56:2e:af:85:\n         1b:ef:0d:c2:eb:1c:33:d5:76:ae:cb:9d:f1:6e:b4:00:85:75:\n         e2:b9:4c:3b:7f:16:41:47:a9:53:b0:c4:b1:7a:44:da:f6:5b:\n         84:45:29:13:37:c3:aa:30:98:d2:67:8f:fb:1a:be:94:06:0e:\n         b9:cf:e6:fc:5f:fc:e2:f1:1b:32:6a:8e:c2:16:a7:cd:45:c1:\n         fe:75:8b:02:b2:f0:d9:3b:5d:7c:1b:a8:45:b8:b1:4d:d8:3c:\n         66:2b:2b:33:1e:9f:dc:b8:5e:3b:fe:0a:e4:b2:5b:eb:41:48:\n         59:10:6b:63\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"fun-things-about-x509\"\u003eFun things about X.509\u003c/h2\u003e\n\u003cp\u003eIn \u003ca href=\"https://github.com/golang/go/blob/e6ac2df2/src/crypto/x509/verify.go#L700-L715\"\u003ecrypto/x509/verify.go\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"c1\"\u003e// KeyUsage status flags are ignored. From Engineering Security, Peter\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// Gutmann: A European government CA marked its signing certificates as\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// being valid for encryption only, but no-one noticed. Another\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// European CA marked its signature keys as not being valid for\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// signatures. A different CA marked its own trusted root certificate\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// as being invalid for certificate signing. Another national CA\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// distributed a certificate to be used to encrypt data for the\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// country’s tax authority that was marked as only being usable for\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// digital signatures but not for encryption. Yet another CA reversed\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// the order of the bit flags in the keyUsage due to confusion over\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// encoding endianness, essentially setting a random keyUsage in\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// certificates that it issued. Another CA created a self-invalidating\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// certificate by adding a certificate policy statement stipulating\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// that the certificate had to be used strictly as specified in the\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// keyUsage, and a keyUsage containing a flag indicating that the RSA\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// encryption key could only be used for Diffie-Hellman key agreement.\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1579478400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":800,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1579478400,"objectID":"13e2daa957e78da454740b10126948f5","permalink":"https://maelvls.dev/notes/tls/","publishdate":"2020-01-20T00:00:00Z","readingtime":4,"relpermalink":"/notes/tls/","section":"notes","summary":"ROLE OF THE CERTIFICATE AUTHORITY +------------------------------+ +-----------------+ CERTIFICATE AUTHORITY (NOT A CERT) | CA KEY | |+----------------------------+| |+---------------+| || O=GlobalSign,CN=GlobalSign || || private key || |+----------------------------+| |+-------|-------+| |+----------------------------+| +--------|--------+ || public key (= VERIFY) || | |+----------------------------+| | +------------------------------+ | | CA cert\u0026#39;s pub key = signature | ----------------------------------------------------------- Signed cert\u0026#39;s pub key = encryption | | +------------------------------+ | | CERTIFICATE | | |1----------------------------+| | ||O=Google LLC,CN=*.google.com|| | |+----------------------------+| |signs using |2----------------------------+| |private key || public key (= DECRYPT) || | |+----------------------------+| | |+----------------------------+| | || signature of 1+2 ||\u0026lt;----------+ |+----------------------------+| +------------------------------+ ROLE OF THE END-USER +------------------------------+ | CA CERTIFICATE (trusted) | Can I trust foo.","tags":[],"title":"Nice diagram about TLS, certificates and keys","type":"notes","url":"https://maelvls.dev/notes/tls/","weight":0,"wordcount":714},{"authors":null,"categories":null,"content":"","date":1578268800,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1578268800,"objectID":"","permalink":"https://maelvls.dev/tags/proxyman/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/proxyman/","section":"tags","summary":"","tags":null,"title":"proxyman","type":"tags","url":"https://maelvls.dev/tags/proxyman/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eI use \u003ca href=\"https://proxyman.io\"\u003eProxyman\u003c/a\u003e for inspecting the HTTP and HTTPS traffic coming from applications. For example, you may want to know which API calls are made by \u003ccode\u003edocker\u003c/code\u003e when running \u003ccode\u003edocker search\u003c/code\u003e. What I would do is\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"nv\"\u003eHTTPS_PROXY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://localhost:9090 docker search ubuntu\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSince Proxyman acts like a proxy listening on 0.0.0.0:9090, I can see and replay all the HTTP calls, similarly to what you would do with the Chrome DevTools.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"proxyman.png\" alt=\"Screenshot with macOS' Proxyman for a local Openstack instance\"\u003e\u003c/p\u003e\n\u003cp\u003eNote that HTTPS is a bit tricky and requires an additional step on macOS (settings \u0026gt; Proxyman CA \u0026gt; Generate new) but works flawlessly with any Go binary since Go supports \u003ccode\u003eHTTPS_PROXY\u003c/code\u003e by default. For Python, it becomes a bit trickier often requires the app to have a flag like \u003ccode\u003e--cacert\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eBut by default, Go [ignores \u003ccode\u003eHTTPS_PROXY\u003c/code\u003e] for \u003ccode\u003elocalhost\u003c/code\u003e and \u003ccode\u003e127.0.0.1\u003c/code\u003e hosts (see \u003ca href=\"https://godoc.org/golang.org/x/net/http/httpproxy#Config.ProxyFunc\"\u003eProxyFunc\u003c/a\u003e and \u003ca href=\"https://github.com/golang/net/blob/c0dbc17a35534bf2e581d7a942408dc936316da4/http/httpproxy/proxy.go#L172-L191\"\u003euseProxy\u003c/a\u003e):\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAs a special case, if req.URL.Host is \u0026ldquo;localhost\u0026rdquo; (with or without a port number), then a nil URL and nil error will be returned.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eNote that the documentation forgets to mention that \u003ccode\u003e127.0.0.1\u003c/code\u003e (and related) are also ignored. That\u0026rsquo;s a bummer since using a proxy may be the only way to debug a CLI or an application that makes network calls without logging properly.\u003c/p\u003e\n\u003cp\u003eTwo solutions: either you have access (and are willing to) hack the source code in order to force Go to use the proxy with \u003ccode\u003elocalhost\u003c/code\u003e anyway, or you can hack your \u003ccode\u003e/etc/hosts\u003c/code\u003e and use a different host.\u003c/p\u003e\n\u003ch2 id=\"solution-1-hack-the-proxy-setup-by-tweaking-httptransport\"\u003eSolution 1: hack the proxy setup by tweaking \u003ccode\u003ehttp.Transport\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003eYou need to have access to the place where the \u003ccode\u003ehttp.Client\u003c/code\u003e is set. Imagine that you are working on something that uses the Openstack API. You would have something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;os\u0026#34;\u003c/span\u003e\n\n\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/gophercloud/gophercloud\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/gophercloud/gophercloud/openstack\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/gophercloud/gophercloud/openstack/compute/v2/servers\u0026#34;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003epr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eopenstack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewClient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://localhost/identity/v3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eStderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;could not create an openstack client\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eopenstack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAuthenticate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egophercloud\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eAuthOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eIdentityEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;http://localhost/identity/v3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eDomainName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e       \u003cspan class=\"s\"\u003e\u0026#34;Default\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eUsername\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e         \u003cspan class=\"s\"\u003e\u0026#34;admin\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003ePassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e         \u003cspan class=\"s\"\u003e\u0026#34;secret\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eTenantName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e       \u003cspan class=\"s\"\u003e\u0026#34;admin\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eStderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;auth failed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"nx\"\u003ecompute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eopenstack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewComputeV2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egophercloud\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEndpointOpts\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eRegion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003esrvs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eservers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecompute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAllPages\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eStderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;%v\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;servers:\\n%v\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esrvs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe must be able to swap the \u003ccode\u003ehttp.Transport\u003c/code\u003e used. The \u003ca href=\"https://golang.org/src/net/http/transport.go#L42\"\u003e\u003ccode\u003ehttp.DefaultTransport\u003c/code\u003e\u003c/a\u003e uses \u003ccode\u003eProxyFromEnvironment\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"c1\"\u003e// DefaultTransport is the default implementation of Transport and is\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// used by DefaultClient. It establishes network connections as needed\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// and caches them for reuse by subsequent calls. It uses HTTP proxies\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// as directed by the $HTTP_PROXY and $NO_PROXY (or $http_proxy and\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// $no_proxy) environment variables.\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eDefaultTransport\u003c/span\u003e \u003cspan class=\"nx\"\u003eRoundTripper\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTransport\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003eProxy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eProxyFromEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003eDialContext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003enet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDialer\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"mi\"\u003e30\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eKeepAlive\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e30\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eDualStack\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003eDialContext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003eForceAttemptHTTP2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e     \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003eMaxIdleConns\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e          \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003eIdleConnTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e       \u003cspan class=\"mi\"\u003e90\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003eTLSHandshakeTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"mi\"\u003e10\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003eExpectContinueTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s change \u003ccode\u003eProxyFromEnvironment\u003c/code\u003e with something of our own:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"nx\"\u003eProxy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003ehttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eURL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://127.0.0.1:9090\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, the code looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;net\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;net/http\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;net/url\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;os\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;time\u0026#34;\u003c/span\u003e\n\n\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/gophercloud/gophercloud\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/gophercloud/gophercloud/openstack\u0026#34;\u003c/span\u003e\n\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/gophercloud/gophercloud/openstack/compute/v2/servers\u0026#34;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003epr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eopenstack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewClient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://localhost/identity/v3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eStderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;could not create an openstack client\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003epr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eHTTPClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eTransport\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003ehttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eTransport\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eProxy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003ehttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eURL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://127.0.0.1:9090\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eDialContext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003enet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDialer\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"nx\"\u003eTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"mi\"\u003e30\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\t\u003cspan class=\"nx\"\u003eKeepAlive\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e30\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\t\u003cspan class=\"nx\"\u003eDualStack\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003eDialContext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eForceAttemptHTTP2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e     \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eMaxIdleConns\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e          \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eIdleConnTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e       \u003cspan class=\"mi\"\u003e90\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eTLSHandshakeTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"mi\"\u003e10\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eExpectContinueTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eopenstack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAuthenticate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egophercloud\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eAuthOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eIdentityEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;http://localhost/identity/v3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eDomainName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e       \u003cspan class=\"s\"\u003e\u0026#34;Default\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eUsername\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e         \u003cspan class=\"s\"\u003e\u0026#34;admin\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003ePassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e         \u003cspan class=\"s\"\u003e\u0026#34;secret\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eTenantName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e       \u003cspan class=\"s\"\u003e\u0026#34;admin\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eStderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;auth failed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"nx\"\u003ecompute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eopenstack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewComputeV2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egophercloud\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEndpointOpts\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eRegion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\t\u003cspan class=\"nx\"\u003esrvs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eservers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecompute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAllPages\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eStderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;%v\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;servers:\\n%v\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esrvs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, all traffic including calls to \u003ccode\u003eHost: localhost\u003c/code\u003e or \u003ccode\u003eHost: 127.0.0.1\u003c/code\u003e will be properly proxied to \u003ccode\u003elocalhost:9090\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"solution-2-use-a-different-host-name\"\u003eSolution 2: use a different host name\u003c/h2\u003e\n\u003cp\u003eIn your \u003ccode\u003e/etc/hosts\u003c/code\u003e, add the line such as \u003ccode\u003elocal 127.0.0.1\u003c/code\u003e. Now, you can use the host \u003ccode\u003elocal\u003c/code\u003e instead of \u003ccode\u003elocalhost\u003c/code\u003e, which means Go will proxy your requests properly.\u003c/p\u003e\n\u003c!--\nJoin the discussion [on\nTwitter](https://twitter.com/maelvls/status/1214242197119406080) or post a\nmessage here\n--\u003e\n","date":1578268800,"description":"At some point, the Go team chose to disable the proxy for requests coming from localhost or 127.0.0.1. This is annoying when debugging services locally.","dir":"2020/go-proxy-localhost-ignored/","expirydate":-62135596800,"fuzzywordcount":700,"images":["go-ignores-proxy-localhost/cover-go-proxy-ignored.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1578268800,"objectID":"c8d5bca6870aa365b80f0b1a357e5ae9","permalink":"https://maelvls.dev/go-ignores-proxy-localhost/","publishdate":"2020-01-06T00:00:00Z","readingtime":4,"relpermalink":"/go-ignores-proxy-localhost/","section":"2020","summary":"I use Proxyman for inspecting the HTTP and HTTPS traffic coming from applications. For example, you may want to know which API calls are made by docker when running docker search. What I would do is\nHTTPS_PROXY=http://localhost:9090 docker search ubuntu Since Proxyman acts like a proxy listening on 0.0.0.0:9090, I can see and replay all the HTTP calls, similarly to what you would do with the Chrome DevTools.\nNote that HTTPS is a bit tricky and requires an additional step on macOS (settings \u0026gt; Proxyman CA \u0026gt; Generate new) but works flawlessly with any Go binary since Go supports HTTPS_PROXY by default.","tags":["go","proxyman"],"title":"What to do when Go ignores HTTP_PROXY for 127.0.0.1","type":"2020","url":"https://maelvls.dev/go-ignores-proxy-localhost/","weight":0,"wordcount":653},{"authors":null,"categories":null,"content":"","date":1574467200,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"section","lang":"en","lastmod":1574467200,"objectID":"","permalink":"https://maelvls.dev/2019/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/2019/","section":"2019","summary":"","tags":null,"title":"2019s","type":"2019","url":"https://maelvls.dev/2019/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eReadability is a property we all love about Go. In other languages, it might be fine to have a lot of nested if statements; in Go, it is a good practice to keep away from overly-nested logic. One of the \u003ca href=\"https://www.reddit.com/r/ProgrammerTIL/comments/acweob/go_til_a_new_go_proverb_the_happy_path_is/\"\u003eGo proverbs\u003c/a\u003e says:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe happy path is left-aligned.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIn this post, I attempt to show through two examples what we mean by \u0026ldquo;left-aligned happy path\u0026rdquo; and what are the benefits in terms of readibility and maintainability.\u003c/p\u003e\n\u003ch2 id=\"simple-example\"\u003eSimple example\u003c/h2\u003e\n\u003cp\u003eLet\u0026rsquo;s see a quick example of what we mean by \u0026ldquo;happy path is left-aligned\u0026rdquo;. The following snippet has two nested ifs. That would be the standard idiom for any language like Java:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eauthorizationHeader\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// nested happy path\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebearerToken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// even more nested happy path\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// error handling here\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error handling here\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe see two things happening here:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003enesting \u003ccode\u003eif\u003c/code\u003es increases the cognitive weight; we have to think in order to understand what the logic does.\u003c/li\u003e\n\u003cli\u003enesting ifs often encourages the use of \u0026ldquo;fallthroughs\u0026rdquo; (reusing the same code path for two different cases). It tends to obfuscate how and where the function fails and returns.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf we move the first \u003ccode\u003eif\u003c/code\u003e to its own \u0026ldquo;guard statement\u0026rdquo;, then we end up with less nesting which translates to code easier to parse (parse as a human):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eauthorizationHeader\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// unhappy path, error handling here\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// happy path always stays (or almost always) unnested\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebearerToken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// unhappy path, error handling here\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNotice how each code path is obvious. Parsing the code is fast and you have less chance of misunderstanding the logic.\u003c/p\u003e\n\u003c!--\n\n## Business logic guards vs. data verification guards\n\nIn the chapter \"[Introducing Guard\nClauses](https://www.pluralsight.com/courses/advanced-defensive-programming-techniques)\"\n(pluralsight course), it says you should fail fast with guard clauses.\nThat's pretty much what the left-aligned happy path idiom does. The author\nadds something interesting: we should avoid mixing the \"business logic\nguards\" with the \"data verification (nil, err...) guards\". It makes sense\nbecause it's easy to mix things and loose where the business logic is.\nFurther on that: [Go Verifier\nlibrary](https://itnext.io/clear-defensive-programming-with-go-using-verifier-library-6f648810b453).\n\n--\u003e\n\u003c!--\n## How does it fit with Defensive programming?\n\ndefensive programming = logic must be nested in ifs so that it is protected and is only run when all if checks are OK\n\nYou can write a program with the \"deeply-nested ifs\" and later change it to\nbe \"left-aligned with guard clauses\". Both ways are very similar, it is\njust a different \"style\".\n\nChanging from one to the other will not make your code \"more defensive\" or\n\"less defensive\" in the sense that these two styles are just styles and do\nnot prescribe a specific way of writing things like the input verification.\n--\u003e\n\u003ch2 id=\"real-example\"\u003eReal example\u003c/h2\u003e\n\u003cp\u003eWhile perusing how other Kubernetes developers are implementing their own reconciliation loop, I came across \u003ca href=\"https://github.com/kubeflow/katib/blob/40f55b41c/pkg/controller.v1alpha3/trial/trial_controller.go#L259-L291\"\u003ean interesting piece of code\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe author decided to use the \u003ccode\u003eif-else\u003c/code\u003e control flow at its maximum potential: the logic goes as deep as three tabs to the right. We cannot immediately guess which parts are important and which aren\u0026rsquo;t.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eReconcileTrial\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003ereconcileJob\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003etrialsv1alpha3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eTrial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eunstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUnstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eunstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUnstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithValues\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Trial\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eNamespacedName\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003eNamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e()})\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eapiVersion\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAPIVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ekind\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetKind\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003egvk\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eschema\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromAPIVersionAndKind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003edeployedJob\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003eunstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUnstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003edeployedJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetGroupVersionKind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003egvk\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTODO\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003etypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eNamespacedName\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003eNamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e()},\u003c/span\u003e \u003cspan class=\"nx\"\u003edeployedJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNotFound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Creating Job\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;kind\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTODO\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Create job error\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003eeventMsg\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Job %s has been created\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erecorder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecorev1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEventTypeNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eJobCreatedReason\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eeventMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Trial is running\u0026#34;\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMarkTrialStatusRunning\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eTrialRunningReason\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Trial Get error\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eRetainRun\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTODO\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePropagationPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emetav1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDeletePropagationForeground\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Delete job error\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003eeventMsg\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Job %s has been deleted\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erecorder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecorev1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEventTypeNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eJobDeletedReason\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eeventMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003edeployedJob\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe outline of this function doesn\u0026rsquo;t tell us anything about what the flow is and where the important logic is. Having deeply nested \u003ccode\u003eif-else\u003c/code\u003e statements hurt Go\u0026rsquo;s glanceability: where is the \u0026ldquo;happy path\u0026rdquo;? Where are the \u0026ldquo;error paths\u0026rdquo;?\u003c/p\u003e\n\u003cimg src=\"before.png\" width=\"500\"/\u003e\n\u003cp\u003eBy refactoring and removing \u003ccode\u003eelse\u003c/code\u003e statements, we obtain a more coherent aligned-to-the-left path:\u003c/p\u003e\n\u003cimg src=\"after.png\" width=\"500\"/\u003e\n\u003cp\u003eThe green line represents the \u0026ldquo;core logic\u0026rdquo; and is at the minimum indentation level. The red line represents anything out of the ordinary: error handling and guards.\u003c/p\u003e\n\u003cp\u003eAnd since our eyes are very good at following lines, the \u003cem\u003eline of sight\u003c/em\u003e (the green line) guides us and greatly improves the experience of glancing at a piece of code.\u003c/p\u003e\n\u003cp\u003eHere is the actual code I rewrote:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eReconcileTrial\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003ereconcileJob\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003etrialsv1alpha3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eTrial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eunstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUnstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eunstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUnstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithValues\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Trial\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eNamespacedName\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003eNamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e()})\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eapiVersion\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAPIVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ekind\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetKind\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003egvk\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eschema\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromAPIVersionAndKind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003edeployedJob\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003eunstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUnstructured\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003edeployedJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetGroupVersionKind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003egvk\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTODO\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003etypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eNamespacedName\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003eNamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e()},\u003c/span\u003e \u003cspan class=\"nx\"\u003edeployedJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNotFound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Job deleted and trial completed, nothing left to do.\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNotFound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Job deleted, we must create a job.\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Creating Job\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;kind\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTODO\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Create job error\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eeventMsg\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Job %s has been created\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erecorder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecorev1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEventTypeNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eJobCreatedReason\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eeventMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Trial is running\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMarkTrialStatusRunning\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eTrialRunningReason\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Trial Get error\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSpec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eRetainRun\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eeventMsg\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Job %s has been deleted\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erecorder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecorev1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEventTypeNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eJobDeletedReason\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eeventMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTODO\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003edesiredJob\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePropagationPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emetav1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDeletePropagationForeground\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Delete job error\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003edeployedJob\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eYou can also take a look at Matt Ryer\u0026rsquo;s \u003cem\u003eIdiomatic Go Tricks\u003c/em\u003e (\u003ca href=\"https://medium.com/@matryer/line-of-sight-in-code-186dd7cdea88\"\u003eblog post\u003c/a\u003e) where he presents some ways of keeping your code as readable as possible:\u003c/p\u003e\n\n\u003cdiv style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"\u003e\n  \u003ciframe src=\"https://www.youtube.com/embed/yeetIgNeIkc\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen title=\"YouTube Video\"\u003e\u003c/iframe\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eUpdate 23 April 2020:\u003c/strong\u003e added a proper introduction with a simple example.\u003c/p\u003e\n\u003chr\u003e\n\u003c!--\nWish to comment? Here is the Twitter thread for that post:\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eMy weekend\u0026#39;s write-up: your Go code wants to be happy: let it be as close to the left as possible! 😄\u003ca href=\"https://t.co/bizd1zouzv\"\u003ehttps://t.co/bizd1zouzv\u003c/a\u003e\u003c/p\u003e\u0026mdash; Maël Valais (@maelvls) \u003ca href=\"https://twitter.com/maelvls/status/1198259761722122240?ref_src=twsrc%5Etfw\"\u003eNovember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n--\u003e\n","date":1574467200,"description":"Readability is a property we all love about Go. In other languages, it might be fine to have a lot of nested if statements; in Go, it is a good practice to keep away from overly-nested logic.","dir":"2019/go-happy-line-of-sight/","expirydate":-62135596800,"fuzzywordcount":900,"images":["go-happy-line-of-sight/cover-happy-line-of-sight.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1574467200,"objectID":"b938d053a3ffd72b467c5890eba9ff01","permalink":"https://maelvls.dev/go-happy-line-of-sight/","publishdate":"2019-11-23T00:00:00Z","readingtime":4,"relpermalink":"/go-happy-line-of-sight/","section":"2019","summary":"Readability is a property we all love about Go. In other languages, it might be fine to have a lot of nested if statements; in Go, it is a good practice to keep away from overly-nested logic. One of the Go proverbs says:\n The happy path is left-aligned.\n In this post, I attempt to show through two examples what we mean by \u0026ldquo;left-aligned happy path\u0026rdquo; and what are the benefits in terms of readibility and maintainability.","tags":["go"],"title":"Go Happy Path: the Unindented Line of Sight","type":"2019","url":"https://maelvls.dev/go-happy-line-of-sight/","weight":0,"wordcount":850},{"authors":null,"categories":null,"content":"\u003cp\u003eYou might have noticed that \u003ccode\u003eGO111MODULE=on\u003c/code\u003e is flourishing everywhere. Many readmes have that:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon go get golang.org/x/tools/gopls@latest\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn this short post, I will explain why \u003ccode\u003eGO111MODULE\u003c/code\u003e exists, its caveats and interesting bits that you need to know when dealing with Go Modules.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cstrong\u003eTable of content:\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"#from-gopath-to-go111module\"\u003eFrom \u003ccode\u003eGOPATH\u003c/code\u003e to \u003ccode\u003eGO111MODULE\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#the-go111module-environment-variable\"\u003eThe \u003ccode\u003eGO111MODULE\u003c/code\u003e environment variable\u003c/a\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"#go111module-with-go-111-and-112\"\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e with Go 1.11 and 1.12\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#go111module-with-go-113\"\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e with Go 1.13\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#go111module-with-go-114\"\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e with Go 1.14\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#go111module-with-go-116\"\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e with Go 1.16\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#so-why-is-go111module-everywhere\"\u003eSo, why is \u003ccode\u003eGO111MODULE\u003c/code\u003e everywhere?!\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#fixed-in-go-116-the-pitfall-of-gomod-being-silently-updated\"\u003e_[Fixed in Go 1.16]_ The pitfall of \u003ccode\u003ego.mod\u003c/code\u003e being silently updated\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#the--u-and-version-pitfall\"\u003eThe \u003ccode\u003e-u\u003c/code\u003e and \u003ccode\u003e@version\u003c/code\u003e pitfall\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#caveats-when-using-go-modules\"\u003eCaveats when using Go Modules\u003c/a\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"#remember-that-go-get-also-updates-your-gomod\"\u003eRemember that \u003ccode\u003ego get\u003c/code\u003e also updates your \u003ccode\u003ego.mod\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#where-are-the-sources-of-the-dependencies-with-go-modules\"\u003eWhere are the sources of the dependencies with Go Modules\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#set-go111module-on-a-per-folder-basis-with-direnv\"\u003eSet \u003ccode\u003eGO111MODULE\u003c/code\u003e on a per-folder basis with \u003ccode\u003edirenv\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#private-go-modules-and-dockerfile\"\u003ePrivate Go Modules and Dockerfile\u003c/a\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"#solution-1-vendoring\"\u003eSolution 1: vendoring\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#solution-2-no-vendoring\"\u003eSolution 2: no vendoring\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2 id=\"from-gopath-to-go111module\"\u003eFrom \u003ccode\u003eGOPATH\u003c/code\u003e to \u003ccode\u003eGO111MODULE\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003eFirst off, let\u0026rsquo;s talk about GOPATH. When Go was first introduced in 2009, it was not shipped with a package manager. Instead, \u003ccode\u003ego get\u003c/code\u003e would fetch all the sources by using their import paths and store them in \u003ccode\u003e$GOPATH/src\u003c/code\u003e. There was no versioning and the \u0026lsquo;master\u0026rsquo; branch would represent a stable version of the package.\u003c/p\u003e\n\u003cp\u003eGo Modules (previously called vgo \u0026ndash; versioned Go) were introduced with Go 1.11. Instead of using the GOPATH for storing a single git checkout of every package, Go Modules stores tagged versions with \u003ccode\u003ego.mod\u003c/code\u003e keeping track of each package\u0026rsquo;s version.\u003c/p\u003e\n\u003cp\u003eSince then, the interaction between the \u0026lsquo;GOPATH behavior\u0026rsquo; and the \u0026lsquo;Go Modules behavior\u0026rsquo; has become one of the biggest gotchas of Go. One environment variable is responsible for 95% of this pain: \u003ccode\u003eGO111MODULE\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"the-go111module-environment-variable\"\u003eThe \u003ccode\u003eGO111MODULE\u003c/code\u003e environment variable\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e is an environment variable that can be set when using \u003ccode\u003ego\u003c/code\u003e for changing how Go imports packages. One of the first pain-points is that depending on the Go version, its semantics change.\u003c/p\u003e\n\u003ch3 id=\"go111module-with-go-111-and-112\"\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e with Go 1.11 and 1.12\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eGO111MODULE=on\u003c/code\u003e will force using Go modules even if the project is in your GOPATH. Requires \u003ccode\u003ego.mod\u003c/code\u003e to work.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eGO111MODULE=off\u003c/code\u003e forces Go to behave the GOPATH way, even outside of GOPATH.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eGO111MODULE=auto\u003c/code\u003e is the default mode. In this mode, Go will behave\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esimilarly to \u003ccode\u003eGO111MODULE=on\u003c/code\u003e when you are outside of \u003ccode\u003eGOPATH\u003c/code\u003e,\u003c/li\u003e\n\u003cli\u003esimilarly to \u003ccode\u003eGO111MODULE=off\u003c/code\u003e when you are inside the \u003ccode\u003eGOPATH\u003c/code\u003e even if a \u003ccode\u003ego.mod\u003c/code\u003e is present.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWhenever you are in your GOPATH and you want to do an operation that requires Go modules (e.g., \u003ccode\u003ego get\u003c/code\u003e a specific version of a binary), you need to do:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon go get github.com/golang/mock/tree/master/mockgen@v1.3.1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"go111module-with-go-113\"\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e with Go 1.13\u003c/h3\u003e\n\u003cp\u003eUsing Go 1.13, \u003ccode\u003eGO111MODULE\u003c/code\u003e\u0026rsquo;s default (\u003ccode\u003eauto\u003c/code\u003e) changes:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebehaves like \u003ccode\u003eGO111MODULE=on\u003c/code\u003e anywhere there is a \u003ccode\u003ego.mod\u003c/code\u003e OR anywhere outside the GOPATH even if there is no \u003ccode\u003ego.mod\u003c/code\u003e. So you can keep all your repositories in your GOPATH with Go 1.13.\u003c/li\u003e\n\u003cli\u003ebehaves like \u003ccode\u003eGO111MODULE=off\u003c/code\u003e in the GOPATH with no \u003ccode\u003ego.mod\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"go111module-with-go-114\"\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e with Go 1.14\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eGO111MODULE\u003c/code\u003e variable has the same behavior as with Go 1.13.\u003c/p\u003e\n\u003cp\u003eNote that some slight changes in behaviors unrelated to \u003ccode\u003eGO111MODULE\u003c/code\u003e happened:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003evendor/\u003c/code\u003e is picked up automatically. That has the tendency of breaking Gomock (\u003ca href=\"https://github.com/golang/mock/issues/415\"\u003eissue\u003c/a\u003e) which were unknowingly not using \u003ccode\u003evendor/\u003c/code\u003e before 1.14.\u003c/li\u003e\n\u003cli\u003eYou still need to use \u003ccode\u003ecd \u0026amp;\u0026amp; GO111MODULE=on go get\u003c/code\u003e when you don\u0026rsquo;t want to mess up your current project’s \u003ccode\u003ego.mod\u003c/code\u003e (that\u0026rsquo;s so annoying).\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"go111module-with-go-116\"\u003e\u003ccode\u003eGO111MODULE\u003c/code\u003e with Go 1.16\u003c/h3\u003e\n\u003cp\u003eAs of Go 1.16, the default behavior is \u003ccode\u003eGO111MODULE=on\u003c/code\u003e, meaning that if you want to keep using the old \u003ccode\u003eGOPATH\u003c/code\u003e way, you will have to force Go not to use the Go Modules feature:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eoff\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe best news in Go 1.16 is that we finally get a dedicated command for installing Go tools instead of relying on the does-it-all \u003ccode\u003ego get\u003c/code\u003e that keeps \u003ca href=\"#the-pitfall-of-gomod-being-silently-updated\"\u003eupdating\u003c/a\u003e your \u003ccode\u003ego.mod\u003c/code\u003e. Instead of:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"c1\"\u003e# Old way\u003c/span\u003e\n\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e go install golang.org/x/tools/gopls@latest\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eyou can now run:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ego install golang.org/x/tools/gopls@latest\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOne caveat is that the semantics of \u003ccode\u003ego install\u003c/code\u003e is slightly different from \u003ccode\u003ego get\u003c/code\u003e. As detailed on the \u003ca href=\"https://blog.golang.org/go116-module-changes\"\u003eGo\nblog\u003c/a\u003e:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIn order to eliminate ambiguity about which versions are used, there are several restrictions on what directives may be present in the program\u0026rsquo;s \u003ccode\u003ego.mod\u003c/code\u003e file when using this install syntax. In particular, \u003cstrong\u003ereplace and exclude directives are not allowed\u003c/strong\u003e, at least for now. In the long term, once the new \u003ccode\u003ego install program@version\u003c/code\u003e is working well for enough use cases, we plan to make \u003ccode\u003ego get\u003c/code\u003e stop installing command binaries. See \u003ca href=\"https://github.com/golang/go/issues/43684\"\u003eissue 43684\u003c/a\u003e for details.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAs an example, you cannot (as of April 2021) install the master version of \u003ca href=\"https://github.com/golang/tools/tree/master/gopls\"\u003egopls\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% go install golang.org/x/tools/gopls@master\ngo: downloading golang.org/x/tools v0.1.1-0.20210316190639-9e9211a98eaa\ngo: downloading golang.org/x/tools/gopls v0.0.0-20210316190639-9e9211a98eaa\ngo install golang.org/x/tools/gopls@master: golang.org/x/tools/gopls@v0.0.0-20210316190639-9e9211a98eaa\n        The go.mod file \u003cspan class=\"k\"\u003efor\u003c/span\u003e the module providing named packages contains one or\n        more replace directives. It must not contain directives that would cause\n        it to be interpreted differently than \u003cspan class=\"k\"\u003eif\u003c/span\u003e it were the main module.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe replace directive in the \u003ca href=\"https://github.com/golang/tools/blob/master/gopls/go.mod\"\u003ego.mod\u003c/a\u003e file looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e \u003cspan class=\"nx\"\u003egolang\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eorg\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003etools\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e..\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFortunately, the gopls project makes sure to remove the \u003ccode\u003ereplace\u003c/code\u003e directive before each release, which means you can use the \u003ccode\u003elatest\u003c/code\u003e tag:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ego install golang.org/x/tools/gopls@latest\n\u003cspan class=\"c1\"\u003e#                                   ^^^^^^\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"so-why-is-go111module-everywhere\"\u003eSo, why is \u003ccode\u003eGO111MODULE\u003c/code\u003e everywhere?!\u003c/h3\u003e\n\u003cp\u003eNow that we know that \u003ccode\u003eGO111MODULE\u003c/code\u003e can be very useful for enabling the Go Modules behavior, here is the answer: that\u0026rsquo;s because \u003ccode\u003eGO111MODULE=on\u003c/code\u003e allows you to select a version. Without Go Modules, \u003ccode\u003ego get\u003c/code\u003e fetches the latest commit from master. With Go Modules, you can select a specific version based on git tags.\u003c/p\u003e\n\u003cp\u003eI use \u003ccode\u003eGO111MODULE=on\u003c/code\u003e very often when I want to switch between the latest version and the HEAD version of \u003ccode\u003egopls\u003c/code\u003e (the Go Language Server):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon go get golang.org/x/tools/gopls@latest\n\u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon go get golang.org/x/tools/gopls@master\n\u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon go get golang.org/x/tools/gopls@v0.1\n\u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon go get golang.org/x/tools/gopls@v0.1.8\n\u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;on\u0026#34;\u003c/span\u003e go get sigs.k8s.io/kind@v0.7.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"_fixed-in-go-116_-the-pitfall-of-gomod-being-silently-updated\"\u003e\u003cem\u003e[Fixed in Go 1.16]\u003c/em\u003e The pitfall of \u003ccode\u003ego.mod\u003c/code\u003e being silently updated\u003c/h3\u003e\n\u003cp\u003eAnd to make matters even worse, you may have encountered this weird one-liner in READMEs:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon go get golang.org/x/tools/gopls@latest\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis weird line was meant for Go 1.15 and below; in Go 1.15 and below and was fixed in Go 1.16. With Go 1.16, the above line becomes:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ego install golang.org/x/tools/gopls@latest\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eNote:\u003c/strong\u003e the \u003ccode\u003e@latest\u003c/code\u003e suffix will use the latest git tag of gopls. Note that \u003ccode\u003e-u\u003c/code\u003e (which means \u0026lsquo;update\u0026rsquo;) is not needed for \u003ccode\u003e@v0.1.8\u003c/code\u003e since this is a \u0026lsquo;fixed\u0026rsquo; version, and updating a fixed version does not really make sense. It is also interesting to note that with \u003ccode\u003e@v0.1\u003c/code\u003e, \u003ccode\u003ego get\u003c/code\u003e will fetch the latest patch version for that tag.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSo, why did we need to use this contrived command that calls a subshell and moves to your HOME? That\u0026rsquo;s yet another Go ideocracy that was fixed with Go 1.16: in Go 1.15 and below, by default (and you can\u0026rsquo;t turn that off), if you are in a folder that has a \u003ccode\u003ego.mod\u003c/code\u003e, \u003ccode\u003ego get\u003c/code\u003e will update that \u003ccode\u003ego.mod\u003c/code\u003e with what you just installed. And in the case of development binaries like \u003ca href=\"https://github.com/golang/tools/tree/master/gopls\"\u003egopls\u003c/a\u003e or \u003ca href=\"https://github.com/kubernetes-sigs/kind\"\u003ekind\u003c/a\u003e, you definitely don\u0026rsquo;t want to have these appearing in the \u003ccode\u003ego.mod\u003c/code\u003e file!\u003c/p\u003e\n\u003cp\u003eSo the workaround for anyone using Go 1.15 and below was to give a one-liner that makes sure that you won\u0026rsquo;t be in a \u003ccode\u003ego.mod\u003c/code\u003e-enabled folder: \u003ccode\u003e(cd \u0026amp;\u0026amp; go get)\u003c/code\u003e does exactly that.\u003c/p\u003e\n\u003cp\u003eI hope that (sooner or later) we will have a clear separation of concerns between \u003ccode\u003ego get\u003c/code\u003e that is adding a dependency to your \u003ccode\u003ego.mod\u003c/code\u003e (like npm install) and \u003ccode\u003ego install\u003c/code\u003e that is meant to install a binary without messing up your \u003ccode\u003ego.mod\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"the--u-and-version-pitfall\"\u003eThe \u003ccode\u003e-u\u003c/code\u003e and \u003ccode\u003e@version\u003c/code\u003e pitfall\u003c/h3\u003e\n\u003cp\u003eI have been bitten multiple times by this: when using \u003ccode\u003ego get @latest\u003c/code\u003e (for a binary, at least), you should avoid using \u003ccode\u003e-u\u003c/code\u003e so that it uses the dependencies as defined in \u003ccode\u003ego.sum\u003c/code\u003e. Otherwise, it will update all the dependencies to their latest minor revision\u0026hellip; And since a ton of projects choose to have breaking changes between minor versions (e.g. v0.2.0 to v0.3.0), using \u003ccode\u003e-u\u003c/code\u003e has a large chance of breaking things.\u003c/p\u003e\n\u003cp\u003eSo if you see this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"c1\"\u003e# Both -u and @latest!\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon go get -u golang.org/x/tools/gopls@latest\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ethen you will immediately realize that (1) it uses the old preGo .1.16 way of installing a Go binary, and (2) you want to be using the recorded versions given in \u003ccode\u003ego.sum\u003c/code\u003e when go-getting a binary!\u003c/p\u003e\n\u003cp\u003eRebecca Stambler \u003ca href=\"https://github.com/golang/go/issues/35868#issuecomment-564151454\"\u003ereminds us\u003c/a\u003e that we should not use \u003ccode\u003e-u\u003c/code\u003e in conjunction with a version:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-u\u003c/code\u003e should not be used in conjunction with the \u003ccode\u003e@latest\u003c/code\u003e tag, as it will give you incorrect versions of the dependencies.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBut it\u0026rsquo;s kind of hidden in this issue\u0026hellip; I guess it is written somewhere in the Go help (btw, what a hideous help compared to \u003ccode\u003egit help\u003c/code\u003e) but that kind of caveat should be more visible: maybe print a warning when installing a binary with both \u003ccode\u003e@version\u003c/code\u003e and \u003ccode\u003e-u\u003c/code\u003e?\u003c/p\u003e\n\u003ch2 id=\"caveats-when-using-go-modules\"\u003eCaveats when using Go Modules\u003c/h2\u003e\n\u003cp\u003eNow, let\u0026rsquo;s go through some caveats I encountered when working with Go Modules.\u003c/p\u003e\n\u003ch3 id=\"remember-that-go-get-also-updates-your-gomod\"\u003eRemember that \u003ccode\u003ego get\u003c/code\u003e also updates your \u003ccode\u003ego.mod\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003eBefore Go 1.16 came out, that was one of the weird things with \u003ccode\u003ego get\u003c/code\u003e: sometimes, it served the purpose of installing binaries or downloading packages. And with Go modules, if you were in a repo with a \u003ccode\u003ego.mod\u003c/code\u003e, it would silently add the binary that you were \u003ccode\u003ego get\u003c/code\u003e-ing to your \u003ccode\u003ego.mod\u003c/code\u003e!\u003c/p\u003e\n\u003cp\u003eFortunately, with Go 1.16, \u003ccode\u003ego install\u003c/code\u003e has \u003ca href=\"https://blog.golang.org/go116-module-changes\"\u003elearnt\u003c/a\u003e about the \u003ccode\u003e@version\u003c/code\u003e suffix. With \u003ccode\u003ego install foo@version\u003c/code\u003e, your local \u003ccode\u003ego.mod\u003c/code\u003e won\u0026rsquo;t be affected!\u003c/p\u003e\n\u003ch3 id=\"where-are-the-sources-of-the-dependencies-with-go-modules\"\u003eWhere are the sources of the dependencies with Go Modules\u003c/h3\u003e\n\u003cp\u003eWhen using Go Modules, the packages that are used during \u003ccode\u003ego build\u003c/code\u003e are stored in \u003ccode\u003e$GOPATH/pkg/mod\u003c/code\u003e. When trying to inspect an \u0026lsquo;import\u0026rsquo; in vim or VSCode, you might end up in the GOPATH version of the package instead of the pkg/mod one used during compilation.\u003c/p\u003e\n\u003cp\u003eA second issue that arises is when you want to hack one of your dependencies, for example for testing purposes.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSolution 1\u003c/strong\u003e: use \u003ccode\u003ego mod vendor\u003c/code\u003e + \u003ccode\u003ego build -mod=vendor\u003c/code\u003e. That will force \u003ccode\u003ego\u003c/code\u003e to use the vendor/ files instead of using the \u003ccode\u003e$GOPATH/pkg/mod\u003c/code\u003e ones. This option also solves the problem of vim and VSCode not opening the right version of a package’s file.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSolution 2\u003c/strong\u003e: add a \u0026lsquo;replace\u0026rsquo; line at the end of your \u003ccode\u003ego.mod\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003ereplace github.com/maelvls/beers =\u0026gt; ../beers\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ewhere \u003ccode\u003e../beers\u003c/code\u003e is a local copy I made of the dependency I want to inspect and hack.\u003c/p\u003e\n\u003ch3 id=\"set-go111module-on-a-per-folder-basis-with-direnv\"\u003eSet \u003ccode\u003eGO111MODULE\u003c/code\u003e on a per-folder basis with \u003ccode\u003edirenv\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003eOn older versions of Go (1.15 and below), while migrating from GOPATH-based projects (mainly using Dep) to Go Modules, I found myself struggling with two different places: inside and outside GOPATH. All Go Modules had to be kept outside of GOPATH, which meant my projects were in different folders. To remediate that, I used \u003ccode\u003eGO111MODULE\u003c/code\u003e extensively. I would keep all my projects in the GOPATH, and for the Go Modules-enabled projects, I would set \u003ccode\u003eexport GO111MODULE=on\u003c/code\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eNote:\u003c/strong\u003e since the default behavior in Go 1.16 is now \u003ccode\u003eGO111MODULE=on\u003c/code\u003e, this trick isn\u0026rsquo;t necessary anymore.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is where \u003ca href=\"https://direnv.net/\"\u003e\u003ccode\u003edirenv\u003c/code\u003e\u003c/a\u003e came in handy. Direnv is a lightweight command written in Go that will load a file, \u003ccode\u003e.envrc\u003c/code\u003e, whenever you enter a directory and \u003ccode\u003e.envrc\u003c/code\u003e is present. For every Go Module-enabled project, I would have this \u003ccode\u003e.envrc\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"c1\"\u003e# .envrc\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eGOPRIVATE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003egithub.com/mycompany/\u003cspan class=\"se\"\u003e\\*\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eGOFLAGS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-mod\u003cspan class=\"o\"\u003e=\u003c/span\u003evendor\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe \u003ccode\u003eGOPRIVATE\u003c/code\u003e environment variable disables the Go Proxy (introduced in Go 1.13) for certain import paths. I also found useful to set \u003ccode\u003e-mod=vendor\u003c/code\u003e so that every command uses the \u003ccode\u003evendor\u003c/code\u003e folder (\u003ccode\u003ego mod vendor\u003c/code\u003e).\u003c/p\u003e\n\u003ch3 id=\"private-go-modules-and-dockerfile\"\u003ePrivate Go Modules and Dockerfile\u003c/h3\u003e\n\u003cp\u003eMany companies choose to use private repositories as import paths. As explained above, we can use \u003ccode\u003eGOPRIVATE\u003c/code\u003e in order to tell Go (as of Go 1.13) to skip the package proxy and fetch our private packages directly from Github.\u003c/p\u003e\n\u003cp\u003eBut what about building Docker images? How can \u003ccode\u003ego get\u003c/code\u003e fetch our private repositories from a docker build?\u003c/p\u003e\n\u003ch4 id=\"solution-1-vendoring\"\u003eSolution 1: vendoring\u003c/h4\u003e\n\u003cp\u003eWith \u003ccode\u003ego mod vendor\u003c/code\u003e, no need to pass Github credentials to the docker build context. We can just put everything in \u003ccode\u003evendor/\u003c/code\u003e and the problem is solved. In the Dockerfile, \u003ccode\u003e-mod=vendor\u003c/code\u003e will be required, but developers don\u0026rsquo;t even have to bother with \u003ccode\u003e-mod=vendor\u003c/code\u003e since they have access to the private Github repositories anyway using their local Git config\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePros: faster build on CI (~10 to 30 seconds less)\u003c/li\u003e\n\u003cli\u003eCons: PRs are bloated with \u003ccode\u003evendor/\u003c/code\u003e changes and the repo\u0026rsquo;s size might be big\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"solution-2-no-vendoring\"\u003eSolution 2: no vendoring\u003c/h4\u003e\n\u003cp\u003eIf \u003ccode\u003evendor/\u003c/code\u003e is just too big (e.g., for Kubernetes controllers, \u003ccode\u003evendor/\u003c/code\u003e is about 30MB), we can very well do it without vendoring. That would require to pass some form of GITHUB_TOKEN as argument of \u003ccode\u003edocker build\u003c/code\u003e, and in the Dockerfile, set something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003egit config --global url.\u003cspan class=\"s2\"\u003e\u0026#34;https://foo:\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e@github.com/company\u0026#34;\u003c/span\u003e.insteadOf \u003cspan class=\"s2\"\u003e\u0026#34;https://github.com/company\u0026#34;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eGOPRIVATE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003egithub.com/company/\u003cspan class=\"se\"\u003e\\*\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cem\u003eIllustration by Bailey Beougher, from The Illustrated Children\u0026rsquo;s Guide to Kubernetes.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate 22 June 2020:\u003c/strong\u003e it said \u003ccode\u003euse replace\u003c/code\u003e instead of just \u003ccode\u003ereplace\u003c/code\u003e.\n\u003cstrong\u003eUpdate 8 April 2021:\u003c/strong\u003e update with Go 1.16.\u003c/p\u003e\n","date":1573603200,"description":"GO111MODULE is all over the place. It appears in README install instructions, in Dockerfiles, in makefiles. On top of that, the behavior of GO111MODULE has changed from Go 1.11 to 1.12, changed again with 1.13 and will changed a last time in 1.14.","dir":"2019/go111modules/","expirydate":-62135596800,"fuzzywordcount":2100,"images":["go111module-everywhere/cover-go-modules-sad.jpg"],"keywords":null,"kind":"page","lang":"en","lastmod":1573603200,"objectID":"a29fe97a11056a2aa23043ba9101578a","permalink":"https://maelvls.dev/go111module-everywhere/","publishdate":"2019-11-13T00:00:00Z","readingtime":10,"relpermalink":"/go111module-everywhere/","section":"2019","summary":"You might have noticed that GO111MODULE=on is flourishing everywhere. Many readmes have that:\nGO111MODULE=on go get golang.org/x/tools/gopls@latest In this short post, I will explain why GO111MODULE exists, its caveats and interesting bits that you need to know when dealing with Go Modules.\n Table of content:\n From GOPATH to GO111MODULE The GO111MODULE environment variable  GO111MODULE with Go 1.11 and 1.12 GO111MODULE with Go 1.13 GO111MODULE with Go 1.14 GO111MODULE with Go 1.","tags":["go","go-modules"],"title":"Why is GO111MODULE everywhere, and everything about Go Modules","type":"2019","url":"https://maelvls.dev/go111module-everywhere/","weight":0,"wordcount":2091},{"authors":null,"categories":null,"content":"","date":1573516800,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":1573516800,"objectID":"","permalink":"https://maelvls.dev/tags/controller/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/controller/","section":"tags","summary":"","tags":null,"title":"controller","type":"tags","url":"https://maelvls.dev/tags/controller/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003cp\u003eWhile building a Kubernetes controller using CRDs, I stumbled across \u0026lsquo;conditions\u0026rsquo; in the status field. What are conditions and how should I implement them in my controller?\u003c/p\u003e\n\u003cp\u003eIn this post, I will explain what \u0026lsquo;status conditions\u0026rsquo; are in Kubernetes and show how they can be used in your own controllers.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eTable of contents:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"#pod-example\"\u003ePod example\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#what-other-projects-do\"\u003eWhat other projects do\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#conditions-vs-state-machine\"\u003eConditions vs. State machine\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#conditions-vs-events\"\u003eConditions vs. Events\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#orthogonality-vs-extensibility\"\u003eOrthogonality vs. Extensibility\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#are-conditions-still-used\"\u003eAre Conditions still used?\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#conditions-vs-reasons\"\u003eConditions vs. Reasons\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#how-many-conditions\"\u003eHow many conditions?\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003cp\u003eIn the following, a \u0026lsquo;component\u0026rsquo; is considered to be one sync loop. A sync loop (also called reconciliation loop) is what must be done in order to synchronize the \u0026lsquo;desired state\u0026rsquo; with the \u0026lsquo;observed state\u0026rsquo;.\u003c/p\u003e\n\u003cp\u003eKubernetes itself is made of multiple binaries (kubelet on each node, one apiserver, one kube-controller-manager and one kube-scheduler). And each of these binaries have multiple components (i.e., sync loops):\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ebinary\u003c/th\u003e\n\u003cth\u003esync loop = component\u003c/th\u003e\n\u003cth\u003ereads\u003c/th\u003e\n\u003cth\u003ecreates\u003c/th\u003e\n\u003cth\u003eupdates\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ekube-controller-manager\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/controller/deployment/deployment_controller.go#L560-L649\"\u003e\u003ccode\u003esyncDeployment\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003ePod\u003c/td\u003e\n\u003ctd\u003eReplicaSet\u003c/td\u003e\n\u003ctd\u003eDeployment\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekube-controller-manager\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/controller/replicaset/replica_set.go#L653-L721\"\u003e\u003ccode\u003esyncReplicaSet\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003ePod\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubelet\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/kubelet/status/status_manager.go#L514-L567\"\u003e\u003ccode\u003esyncPod\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003ePod\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekube-scheduler\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/scheduler/scheduler.go#L589-L762\"\u003e\u003ccode\u003escheduleOne\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003ePod\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekubelet\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bff9bfb9dfe0f2ea40f1c80cac47fc12b2/pkg/kubelet/kubelet_node_status.go#L374-L391\"\u003e\u003ccode\u003esyncNodeStatus\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eNode\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eWe can see that one single object (Pod) can be read, edited and updated by different components. When I say \u0026lsquo;edited\u0026rsquo;, I mean the sync loop edits the status (which contains the conditions), not the rest. The status is a way of communicating between components/sync loops.\u003c/p\u003e\n\u003cp\u003eAs Brian Grant put it,\u003c/p\u003e\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eRather than rigid fine-grained state enumerations that couldn\u0026#39;t be evolved, we initially adopted simple basic states that could report open-ended reasons for being in each state (\u003ca href=\"https://t.co/l5WXSjbg3K\"\u003ehttps://t.co/l5WXSjbg3K\u003c/a\u003e), and later non-orthogonal, extensible conditions (\u003ca href=\"https://t.co/XiwOcgcSGY\"\u003ehttps://t.co/XiwOcgcSGY\u003c/a\u003e).\u003c/p\u003e\u0026mdash; Brian Grant (@bgrant0607) \u003ca href=\"https://twitter.com/bgrant0607/status/1111473660479430656?ref_src=twsrc%5Etfw\"\u003eMarch 29, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n\u003ch2 id=\"pod-example\"\u003ePod example\u003c/h2\u003e\n\u003cp\u003eLet\u0026rsquo;s read a Pod manifest:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"c\"\u003e# kubectl -n cert-manager get pods -oyaml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ePod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-10-22T16:29:24Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ePodScheduled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-10-22T16:29:24Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eInitialized\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-10-22T16:29:31Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eContainersReady\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-10-22T16:29:31Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eReady\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainerStatuses\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003equay.io/jetstack/cert-manager-controller:v0.6.1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eready\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e{\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003erunning\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e{\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003estartedAt\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-10-22T16:29:31Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e}\u003cspan class=\"w\"\u003e \u003c/span\u003e}\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ephase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRunning\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA condition contains a Status and a Type. It may also contain a Reason and a Message. For example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e- \u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-10-22T16:29:31Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eContainersReady\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe \u003ca href=\"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-conditions\"\u003epod-lifecycle\u003c/a\u003e documentation explains the difference between the \u0026lsquo;phase\u0026rsquo; and \u0026lsquo;conditions:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe top-level \u003ccode\u003ephase\u003c/code\u003e is an aggregated state that answers some user-facing questions such as \u003cem\u003eis my pod in a terminal state?\u003c/em\u003e but has gaps since the actual state is contained in the conditions.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003econditions\u003c/code\u003e array is a set of types (Ready, PodScheduled\u0026hellip;) with a status (True, False or Unknown) that make up the \u0026lsquo;computed state\u0026rsquo; of a Pod at any time. As we will see later, the state is almost always \u0026lsquo;partial\u0026rsquo; (\u003cem\u003eopen-ended conditions\u003c/em\u003e).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eNow, let\u0026rsquo;s see what I mean by \u0026lsquo;components\u0026rsquo;. The status of a Pod is not updated by a single Sync loop: it is updated by multiple components: the kubelet, and the kube-scheduler. Here is a list of the condition types per component:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ePossible condition types for a Pod\u003c/th\u003e\n\u003cth\u003eComponent that updates this condition type\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/beaf3a2f0/pkg/scheduler/scheduler.go#L435\"\u003ePodScheduled\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/scheduler/scheduler.go#L589-L762\"\u003e\u003ccode\u003escheduleOne\u003c/code\u003e\u003c/a\u003e (kube-scheduler)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/beaf3a2f0/pkg/scheduler/scheduler.go#L615\"\u003eUnschedulable\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/scheduler/scheduler.go#L589-L762\"\u003e\u003ccode\u003escheduleOne\u003c/code\u003e\u003c/a\u003e (kube-scheduler)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/beaf3a2f0/pkg/kubelet/kubelet_pods.go#L1368\"\u003eInitialized\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/kubelet/status/status_manager.go#L514-L567\"\u003e\u003ccode\u003esyncPod\u003c/code\u003e\u003c/a\u003e (kubelet)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/beaf3a2f0/pkg/kubelet/kubelet_pods.go#L1370\"\u003eContainersReady\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/kubelet/status/status_manager.go#L514-L567\"\u003e\u003ccode\u003esyncPod\u003c/code\u003e\u003c/a\u003e (kubelet)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/beaf3a2f0/pkg/kubelet/kubelet_pods.go#L1369\"\u003eReady\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/5bac42bf/pkg/kubelet/status/status_manager.go#L514-L567\"\u003e\u003ccode\u003esyncPod\u003c/code\u003e\u003c/a\u003e (kubelet)\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eAlthough conditions are a good way to convey information to the user, they also serve as a way of communicating between components (e.g., between kube-scheduler and apiserver) but also to external components (e.g. a custom controller that wants to trigger something as soon as a pod becomes \u0026lsquo;Unschedulable\u0026rsquo;, and maybe order more VMs to the cloud provider and add it as a node.\u003c/p\u003e\n\u003cp\u003eAs you will see below, the \u0026lsquo;conditions\u0026rsquo; array is considered to be containing all the \u0026lsquo;ground truth\u0026rsquo;. The \u0026lsquo;phase\u0026rsquo; just an abstraction of these conditions.\u003c/p\u003e\n\u003ch2 id=\"what-other-projects-do\"\u003eWhat other projects do\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/kubernetes-sigs/cluster-api\"\u003ecluster-api\u003c/a\u003e and its providers (e.g., cluster-api-gcp-provider) do not use Conditions at all:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://github.com/kubernetes-sigs/cluster-api/blob/112951ee/docs/proposals/20181121-machine-api.md\"\u003eFeng Min, Nov 2018\u003c/a\u003e) Brian Grant (@bgrant0607) and Eric Tune (@erictune) have indicated that the API pattern of having \u0026ldquo;Conditions\u0026rdquo; lists in object statuses is soon to be deprecated. These have generally been used as a timeline of state transitions for the object\u0026rsquo;s reconciliation, and difficult to consume for clients that just want a meaningful representation of the object\u0026rsquo;s current state. There are no existing examples of the new pattern to follow instead, just the guidance that we should use top-level fields in the status to represent meaningful information. We can revisit the specifics when new patterns start to emerge in core.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eInstead of using a list of conditions, cluster-api projects go like that:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eready\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ephase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Failed\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efailureReason\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;GcpMachineCrashed\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efailureMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;VM crashed: ...\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jetstack/cert-manager\"\u003ecert-manager\u003c/a\u003e uses Conditions, but the only type is \u0026lsquo;Ready\u0026rsquo;. The rest of the information is given in Ready\u0026rsquo;s Reason field. That might be unfortunate for users or other components that are willing to use cert-manager\u0026rsquo;s API, similarly to what happens with the PodSchedulable condition and its reason, PodReasonUnschedulable. For example, the \u003ca href=\"https://github.com/jetstack/cert-manager/blob/b91b7d8d3/pkg/controller/issuers/sync.go#L61-L69\"\u003eIssuer\u0026rsquo;s Sync\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eIssuer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Ready\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;False\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ErrorConfig\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Resource validation failed: ...\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOpenshift uses conditions a lot but does not use the standard \u0026lsquo;Ready\u0026rsquo; type. For example, cluster-version-operators (CVO) has a \u003ca href=\"https://github.com/openshift/api/blob/b1bcdbc3/config/v1/types_cluster_operator.go#L123-L134\"\u003e\u003ccode\u003ekind: ClusterOperator\u003c/code\u003e\u003c/a\u003e with condition types \u0026lsquo;Available\u0026rsquo;, \u0026lsquo;Progressing\u0026rsquo;, \u0026lsquo;Degraded\u0026rsquo; and \u0026lsquo;Upgradeable\u0026rsquo;.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHyperconverged Cluster Operator (HCO) uses conditions but in a slightly different way that cert-manager or openshift does. Each condition is set by a different component\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIt\u0026rsquo;s important to point out that the Condition types on the HCO don\u0026rsquo;t represent the condition the HCO is in, rather the condition of the component CRs.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGardener also uses conditions, and like Openshift, it doesn\u0026rsquo;t rely on the standard \u0026lsquo;Ready\u0026rsquo; type. For example, the \u003ca href=\"https://github.com/gardener/gardener/blob/161695ada/pkg/apis/core/v1alpha1/types_controllerinstallation.go\"\u003e\u003ccode\u003ekind: ControllerInstallation\u003c/code\u003e\u003c/a\u003e has conditions types \u0026lsquo;Valid\u0026rsquo; and \u0026lsquo;Installed\u0026rsquo;.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWe see a lot of variance across projects. In late 2017, we saw some uncertainty about Conditions disappearing. In the remaining of this post, I will try to give answers as to why you should use conditions and how to do so.\u003c/p\u003e\n\u003ch2 id=\"conditions-vs-state-machine\"\u003eConditions vs. State machine\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://github.com/kubernetes/community/blob/4c9ef2d/contributors/devel/sig-architecture/api-conventions.md\"\u003eapi-conventions.md\u003c/a\u003e, July 2017) Conditions are observations and not, themselves, state machines.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSo, what is the difference between a state in a state machine and an observation? A state machine has a known a fixed state. In comparison, conditions offers an \u0026lsquo;open-world\u0026rsquo; perspective with the Unknown value. For example, the status of a Pod is partly constructed by the kube-scheduler, partly by the kubelet.\u003c/p\u003e\n\u003cp\u003eBut when an object gets created, no conditions are present. What does that mean?\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://issues.k8s.io/7856#issuecomment-99657942\"\u003eTim Hockin, May 2015\u003c/a\u003e) The absence of a condition should be interpreted the same as Unknown.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIn the end, this set of conditions are just a way of communicating changes of state between components, and this state can always be reconstructed by observing the system:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://github.com/kubernetes/community/blob/4c9ef2d/contributors/design-proposals/architecture/principles.md\"\u003eprinciples.md\u003c/a\u003e, 2015) Object status must be 100% reconstructable by observation. Any history kept (E.g., through conditions or other fields in \u0026lsquo;status\u0026rsquo;) must be just an optimization and not required for correct operation.\u003c/p\u003e\n\u003cp\u003eDo not define comprehensive state machines for objects with behaviors associated with state transitions and/or \u0026ldquo;assumed\u0026rdquo; states that cannot be ascertained by observation.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eOne last comment that explains why the Kubernetes docs don\u0026rsquo;t have any state-machine diagram:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://issues.k8s.io/24130\"\u003eTim Hockin, Apr 2016\u003c/a\u003e) This [state-machine-alike diagram representing the Pod states] is not strictly correct though, because a pod can cease to be \u0026ldquo;ready\u0026rdquo; but not die. We\u0026rsquo;ve intentionally NOT drawn this as a state-machine because conditions are really orthogonal concepts. We report a singular status as part of kubectl, so maybe we should document THAT, but it\u0026rsquo;s more complicated than this diagram captures.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"conditions-vs-events\"\u003eConditions vs. Events\u003c/h2\u003e\n\u003cp\u003eEvents are meant to save history (for non-machine consumption, i.e., for humans). The set of conditions describes the \u0026lsquo;current\u0026rsquo; state:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://issues.k8s.io/7856#issuecomment-323196033\"\u003eBrian Grant, Aug 2017\u003c/a\u003e Status, represented as conditions or otherwise, should be complementary to events pertaining to the resource. Events provide additional information for debugging and tracing, akin to log messages, but aren\u0026rsquo;t intended to be used for event-driven automation.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIt was reminded in 2019:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://issues.k8s.io/51594#issuecomment-334646068\"\u003eKenneth Owens, Oct 2019\u003c/a\u003e) Events are used to express point in time occurrences, and Conditions are used to express the current state of an ongoing process. For instance, Pod creation is an event, Deployment progressing is a condition.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"orthogonality-vs-extensibility\"\u003eOrthogonality vs. Extensibility\u003c/h2\u003e\n\u003cp\u003eIn 2015, the Kubernetes team seemed to be attached to the idea of \u0026lsquo;orthogonality\u0026rsquo; between conditions.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://issues.k8s.io/6951#issuecomment-94203495\"\u003eDavid Oppenheimer, Apr 2015\u003c/a\u003e) To avoid confusion, Conditions should be orthogonal. The ones you suggested \u0026ndash; Instantiated, Initialized, and Terminated \u0026ndash; don\u0026rsquo;t seem to be orthogonal (in fact I would expect a pod to transition from FFF to TFF to TTF to TTT). What you\u0026rsquo;ve described sounds more like a state machine than a set of orthogonal conditions, and I think Conditions should only be used for the latter.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIn 2017, things start to get confusing: \u003cem\u003eeach condition represents one non-orthogonal \u0026ldquo;state\u0026rdquo; of a resource\u003c/em\u003e?! Conditions are orthogonal to each other, but the states that they represent may be non-orthogonal\u0026hellip;\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://issues.k8s.io/7856#issuecomment-323196033\"\u003eBrian Grant, Aug 2017\u003c/a\u003e) Conditions were created as a way to wean contributors off of the idea of state machines with mutually exclusive states (called \u0026ldquo;phase\u0026rdquo;).\u003c/p\u003e\n\u003cp\u003eEach condition should represent a non-orthogonal \u0026ldquo;state\u0026rdquo; of a resource \u0026ndash; is the resource in that state or not (or unknown).\u003c/p\u003e\n\u003cp\u003eArbitrarily typed/structured status properties specific to a particular resource should just be status fields.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eI did not find anywhere a definition of \u0026lsquo;orthogonal condition\u0026rsquo;; my guess is that two conditions are orthogonal when they explain two uncorrelated parts of the system.\u003c/p\u003e\n\u003cp\u003eBut in 2019, the narrative seems to have changed: Brian Grant talks about \u0026lsquo;non-orthogonal \u0026amp; extensible conditions\u0026rsquo;.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://twitter.com/bgrant0607/status/1111473660479430656\"\u003eBrian Grant, Mar 2019\u003c/a\u003e) Rather than rigid fine-grained state enumerations that couldn\u0026rsquo;t be evolved, we initially adopted simple basic states that could report open-ended reasons for being in each state (\u003ca href=\"http://issues.k8s.io/1146\"\u003ehttp://issues.k8s.io/1146\u003c/a\u003e), and later non-orthogonal, extensible conditions (\u003ca href=\"http://issues.k8s.io/7856\"\u003ehttp://issues.k8s.io/7856\u003c/a\u003e).\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eOrthogonality was hard to implement anyway:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://issues.k8s.io/7856#issuecomment-325978016\"\u003eSteven E. Harris, Aug 2019\u003c/a\u003e) The burden is on the status type author to come up with dimensions that are orthogonal; that required careful thought when writing my own condition types.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eHere is what I think: you should definitely use conditions, but don\u0026rsquo;t bother with orthogonality. Just use conditions that represent important changes for the object, beginning with the \u0026lsquo;Ready\u0026rsquo; condition type. \u0026lsquo;Ready\u0026rsquo; is the strongest condition of all and indicates something 100% operational.\u003c/p\u003e\n\u003ch2 id=\"are-conditions-still-used\"\u003eAre Conditions still used?\u003c/h2\u003e\n\u003cp\u003eThere was an extensive dicussion about removing or keeping these conditions. They were described by \u003ca href=\"https://issues.k8s.io/7856#issuecomment-323196033\"\u003eBrian Grant in Aug 2017\u003c/a\u003e as cumbersome (an array is harder to deal with than top-level fields) and confusing because of the open-ended statuses (True, False, Unknown). In 2019, the Kubernetes stated that conditions are still what controller authors should use:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://issues.k8s.io/7856#issuecomment-492812566\"\u003eDaniel Smith, May 2019\u003c/a\u003e) Conditions are not going to be removed.\u003c/p\u003e\n\u003cp\u003eThe ground truth is set as conditions by the components that are nearby, e.g. kubelet sets \u0026ldquo;DiskPressure = True\u0026rdquo;.\u003c/p\u003e\n\u003cp\u003eThe set of conditions is summarized into phases (or secondary conditions) for consumption by general controllers. E.g., if there is disk pressure, that can be aggregated into \u003ccode\u003econditionSummary.schedulable: false\u003c/code\u003e. The process doing this needs to know all possible gound truth statements; the process of summarizing them isolates the rest of the cluster from needing to know this.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"conditions-vs-reasons\"\u003eConditions vs. Reasons\u003c/h2\u003e\n\u003cp\u003eDo I really need to bother with this \u003ccode\u003e.status.conditions\u003c/code\u003e array, can I just use \u003ccode\u003e.status.phase\u003c/code\u003e with a simple enum? Or just a \u003ccode\u003ereason\u003c/code\u003e as part of an existing \u0026lsquo;Ready\u0026rsquo; condition?\u003c/p\u003e\n\u003cp\u003eAt first, Kubernetes would rely on many Reasons:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://github.com/kubernetes/community/blob/4c9ef2d/contributors/devel/sig-architecture/api-conventions.md\"\u003eapi-conventions.md\u003c/a\u003e, July 2017) In condition types, and everywhere else they appear in the API, \u003ccode\u003eReason\u003c/code\u003e is intended to be a one-word, CamelCase representation of the category of cause of the current status, and \u003ccode\u003eMessage\u003c/code\u003e is intended to be a human-readable phrase or sentence, which may contain specific details of the individual occurrence.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eReason\u003c/code\u003e is intended to be used in concise output, such as one-line kubectl get output, and in summarizing occurrences of causes, whereas \u003ccode\u003eMessage\u003c/code\u003e is intended to be presented to users in detailed status explanations, such as kubectl describe output.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eLater, they mode to non-orthogonal (read: may-be-corrolated conditions):\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://twitter.com/bgrant0607/status/1111473660479430656\"\u003eBrian Grant, Mar 2019\u003c/a\u003e) Rather than rigid fine-grained state enumerations that couldn\u0026rsquo;t be evolved, we initially adopted simple basic states that could report \u003ca href=\"http://issues.k8s.io/1146\"\u003eopen-ended reasons for being in each state\u003c/a\u003e (2014), and later \u003ca href=\"http://issues.k8s.io/7856\"\u003enon-orthogonal, extensible conditions\u003c/a\u003e (2017).\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSince the Pod conditions do not have a \u0026lsquo;Reason\u0026rsquo; field (in the previous Pod example), let\u0026rsquo;s take a look at the Node conditions instead:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eNode\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDiskPressure\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;False\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eKubeletHasNoDiskPressure\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekubelet has no disk pressure\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elastHeartbeatTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-11-17T14:18:26Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-10-22T16:27:53Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eReady\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;True\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eKubeletReady\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ekubelet is posting ready status. AppArmor enabled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elastHeartbeatTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-11-17T14:18:26Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elastTransitionTime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2019-10-22T16:27:53Z\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHere, the \u0026lsquo;Ready\u0026rsquo; condition type has an additional \u0026lsquo;Reason\u0026rsquo; field that gives the user more information about the transition. The Reason field is sometimes used by other components: for example, \u003ccode\u003ePodReasonUnschedulable\u003c/code\u003e is a reason of the \u003ccode\u003ePodSchedulable\u003c/code\u003e condition type. This reason is set by the kube-scheduler and is \u0026lsquo;consumed\u0026rsquo; by the kubelet (or the reverse, I can\u0026rsquo;t really tell).\u003c/p\u003e\n\u003cp\u003eSo, Reason of another condition or Condition? If you feel that this state might be interesting to the rest of the system, then use a proper Condition.\u003c/p\u003e\n\u003cp\u003eRegarding the \u0026lsquo;phase\u0026rsquo; top-level field, I would recommend to offer it to your users when the conditions alone cannot help them answer questions such as \u003cem\u003ehas my pod terminated?\u003c/em\u003e.\u003c/p\u003e\n\u003ch2 id=\"how-many-conditions\"\u003eHow many conditions?\u003c/h2\u003e\n\u003cp\u003eIf you think that the \u0026lsquo;Errored\u0026rsquo; state can be useful for other components or the user (e.g. \u003ccode\u003ekubectl wait --for=condition=errored\u003c/code\u003e), then add it. If you think it is important for other components or for the user to know that something is in progress, go ahead and add a \u0026lsquo;InProgress\u0026rsquo; condition.\u003c/p\u003e\n\u003cp\u003eRegarding the naming of condition types, here is some advice:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://github.com/kubernetes/community/blob/4c9ef2d/contributors/devel/sig-architecture/api-conventions.md\"\u003eapi-conventions.md\u003c/a\u003e, July 2017) Condition types should indicate state in the \u0026ldquo;abnormal-true\u0026rdquo; polarity. For example, if the condition indicates when a policy is invalid, the \u0026ldquo;is valid\u0026rdquo; case is probably the norm, so the condition should be called \u0026ldquo;Invalid\u0026rdquo;.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAlso, remember that these types are part of your API and you should keep in mind that they require maintaining backwards- and forwards-compatibility. Adding a new condition is not free: you must maintain them over time.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(\u003ca href=\"https://github.com/kubernetes/community/blob/4c9ef2d/contributors/devel/sig-architecture/api-conventions.md\"\u003eapi-conventions.md\u003c/a\u003e, July 2017) The meaning of a Condition can not be changed arbitrarily - it becomes part of the API, and has the same backwards- and forwards-compatibility concerns of any other part of the API.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eConditions are also a clean way of letting third-party components (such as the cluster-api controller) to add their own \u0026lsquo;named\u0026rsquo; conditions to an existing object, e.g. to a Pod (see \u003ca href=\"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-readiness-gate\"\u003epod-readiness-gate\u003c/a\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nt\"\u003eKind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ePod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereadinessGates\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003econditionType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;www.example.com/feature-1\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eReady # this is a builtin PodCondition\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;False\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;www.example.com/feature-1\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# an extra PodCondition\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;False\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c!--\nDiscussion is happening here:\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eKubernetes custom controllers are awesome, CRDs are great! Still, these Conditions are confusing: is it meant for the user, and what about that \u0026#39;phase\u0026#39; thing?\u003cbr\u003e\u003cbr\u003eHere is my attempt at understanding all that 😅\u003ca href=\"https://t.co/CllGBXtd70\"\u003ehttps://t.co/CllGBXtd70\u003c/a\u003e\u003c/p\u003e\u0026mdash; Maël Valais (@maelvls) \u003ca href=\"https://twitter.com/maelvls/status/1195058503695642627?ref_src=twsrc%5Etfw\"\u003eNovember 14, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n--\u003e\n","date":1573516800,"description":"Although progress is being made, Kubernetes controllers and operators still require prior knowledge about Kubernetes internals. Information on how to set the status is scattered across comments, issues, PRs and the Kubernetes code itself. Conditions may be a good solution for your controller, but for what?","dir":"2019/kubernetes-conditions/","expirydate":-62135596800,"fuzzywordcount":2400,"images":["kubernetes-conditions/cover-kubernetes-conditions.png"],"keywords":null,"kind":"page","lang":"en","lastmod":1573516800,"objectID":"549ab9bc074dfc4bc6f90cb356030275","permalink":"https://maelvls.dev/kubernetes-conditions/","publishdate":"2019-11-12T00:00:00Z","readingtime":11,"relpermalink":"/kubernetes-conditions/","section":"2019","summary":"While building a Kubernetes controller using CRDs, I stumbled across \u0026lsquo;conditions\u0026rsquo; in the status field. What are conditions and how should I implement them in my controller?\nIn this post, I will explain what \u0026lsquo;status conditions\u0026rsquo; are in Kubernetes and show how they can be used in your own controllers.\n Table of contents:\n Pod example What other projects do Conditions vs. State machine Conditions vs. Events Orthogonality vs. Extensibility Are Conditions still used?","tags":["kubernetes","go","controller"],"title":"What the heck are Conditions in Kubernetes controllers?","type":"2019","url":"https://maelvls.dev/kubernetes-conditions/","weight":0,"wordcount":2318},{"authors":null,"categories":null,"content":"\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003etcpdump -i eth0 -U -w - \u003cspan class=\"s1\"\u003e\u0026#39;not port 22\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e wireshark -k -i -\n\nwireshark -i en9 -k -Y \u003cspan class=\"s2\"\u003e\u0026#34;ip.addr == 35.211.248.124 \u0026amp;\u0026amp; tcp.port == 22\u0026#34;\u003c/span\u003e\n\nnc -v 35.211.248.124 \u003cspan class=\"m\"\u003e22\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1572998400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1572998400,"objectID":"816d1b0fce34170c356a8b4578449983","permalink":"https://maelvls.dev/notes/wireshark/","publishdate":"2019-11-06T00:00:00Z","readingtime":1,"relpermalink":"/notes/wireshark/","section":"notes","summary":"tcpdump -i eth0 -U -w - \u0026#39;not port 22\u0026#39; | wireshark -k -i - wireshark -i en9 -k -Y \u0026#34;ip.addr == 35.211.248.124 \u0026amp;\u0026amp; tcp.port == 22\u0026#34; nc -v 35.211.248.124 22 ","tags":[],"title":"Stuff about Wireshark","type":"notes","url":"https://maelvls.dev/notes/wireshark/","weight":0,"wordcount":30},{"authors":null,"categories":null,"content":"\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#difference-between-ca-and-cert\"\u003eDifference between CA and cert\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#ssh-authentication-themes\"\u003eSsh authentication themes\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#case-a-unknown-host\"\u003eCase A: unknown host\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#case-b-host-already-in-known_host-but-ip-changed\"\u003eCase B: host already in known_host but ip changed\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#case-c-host-already-known-ipfqdn-in-sshknown_hosts\"\u003eCase C: host already known (ip/fqdn in \u003ccode\u003e~/.ssh/known_hosts\u003c/code\u003e)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#case-d-host-has-clients-pub-key-in-authorized_keys\"\u003eCase D: host has client\u0026rsquo;s pub key in authorized_keys\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#ssh--certificates\"\u003eSsh + certificates\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#reason-why-ssh-host-cmd-not-using-bashrcloginzshrc\"\u003eReason why \u003ccode\u003essh host cmd\u003c/code\u003e not using .bashrc/.login/.zshrc\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#passwordless-connexion-to-a-server\"\u003ePasswordless connexion to a server\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#glossary\"\u003eGlossary\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eWARNING:\u003c/strong\u003e many things in this memo are wrong or very wrong. Do not take any of it as good information.\u003c/p\u003e\n\u003ch2 id=\"difference-between-ca-and-cert\"\u003eDifference between CA and cert\u003c/h2\u003e\n\u003cp\u003eThese confusing names (CA cert, client cert, cert key\u0026hellip;) are due to the fact that you need 4 keys in order to have two parties communicate:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e+-----------+                                   +-----------+\n|           |-------what\u0026#39;s your ca-cert?-------\u0026gt;|           |\n|           |                                   |           |\n|  client   |\u0026lt;------------ca-cert-------------- |  server   |\n|           |                                   |           |\n|           |------let\u0026#39;s use this sym key-----\u0026gt; |           |\n+-----------+                                   +-----------+\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col\u003e\n\u003cli\u003eca-cert is the server pub key that is offered to the client\u003c/li\u003e\n\u003cli\u003ecert (or client-cert) is the client pub key which allows\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eFrom \u003ca href=\"https://docs.gitlab.com/runner/configuration/advanced-configuration.html\"\u003ehttps://docs.gitlab.com/runner/configuration/advanced-configuration.html\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etls-ca-file certificates is a pub key that is used to \u003cstrong\u003everify\u003c/strong\u003e the remote peer.\u003c/li\u003e\n\u003cli\u003etls-cert-file certificate to \u003cstrong\u003eauthenticate\u003c/strong\u003e with the remote peer\u003c/li\u003e\n\u003cli\u003etls-key-file private key to authenticate with the remote peer\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSo:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ea \u003cstrong\u003eCA\u003c/strong\u003e is a certificate of authority. Example: AlphaSSL CA - SHA256 - G2. I will define a certificate of authority as a certificate that is a root CA (i.e., it is installed in browsers and /etc/ssl) or a sub-CA, i.e., any certificate signed by a root CA.\u003c/li\u003e\n\u003cli\u003ea \u003cstrong\u003ecert\u003c/strong\u003e is a certificate\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ssh-authentication-themes\"\u003eSsh authentication themes\u003c/h2\u003e\n\u003ch3 id=\"case-a-unknown-host\"\u003eCase A: unknown host\u003c/h3\u003e\n\u003cp\u003e\u0026mdash; everything in plain text\u0026mdash;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: hi server, can you send mme your public key?\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSERVER\u003c/strong\u003e: sure, here you go.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: (Hmm\u0026hellip; should I trust this pub key? This pub key isn\u0026rsquo;t in my \u003ccode\u003e~/.ssh/known_hosts\u003c/code\u003e. Let\u0026rsquo;s ask the user if he recognises the sha256 sum.)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eHUMAN\u003c/strong\u003e: whatever I don\u0026rsquo;t care (types \u0026lsquo;yes\u0026rsquo; and enter)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: OK, SERVER, I trust you.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u0026mdash; only SERVER -\u0026gt; CLIENT encrypted \u0026mdash;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSERVER\u003c/strong\u003e: perfect. (SERVER generates a pub/priv key for this specific connexion). Take that id_rsa2.pub I just generated so that you can encrypt stuff to me.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u0026mdash; both ways encrypted \u0026mdash;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: Thanks, now we can speak privatly.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"case-b-host-already-in-known_host-but-ip-changed\"\u003eCase B: host already in known_host but ip changed\u003c/h3\u003e\n\u003cp\u003e\u0026mdash; plain text \u0026mdash;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: Hi SERVER, I don\u0026rsquo;t know you (i.e., I don\u0026rsquo;t have this ip/fqhn in my \u003ccode\u003e~/.ssh/known_hosts\u003c/code\u003e), can you send me your pub key?\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSERVER\u003c/strong\u003e: Sure, here you go.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: (Should I trust him? Oh wait, this pub key already exists in my known hosts! But with a different IP!!! Tell the user to do something)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eHUMAN\u003c/strong\u003e: Oh crap, why is ssh throwing this error. Let\u0026rsquo;s remove this faulty line from \u003ccode\u003e~/.ssh/known_hosts\u003c/code\u003e!\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNow, we can go to Case B.\u003c/p\u003e\n\u003ch3 id=\"case-c-host-already-known-ipfqdn-in-sshknown_hosts\"\u003eCase C: host already known (ip/fqdn in \u003ccode\u003e~/.ssh/known_hosts\u003c/code\u003e)\u003c/h3\u003e\n\u003cp\u003e\u0026mdash; only CLIENT -\u0026gt; SERVER encrypted \u0026mdash;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: Hi again, SERVER. Can you give me a new pub key so that I can tell you stuff secretely?\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSERVER\u003c/strong\u003e: Sure, here you go.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u0026mdash; both ways encrypted\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: Perfect.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: (Oh! I know this host, lets use the pub key in known_hosts)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"case-d-host-has-clients-pub-key-in-authorized_keys\"\u003eCase D: host has client\u0026rsquo;s pub key in authorized_keys\u003c/h3\u003e\n\u003cp\u003e\u0026mdash; plain text \u0026mdash;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: Hi, SERVER, remember me?\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u0026mdash; only SERVER -\u0026gt; CLIENT encrypted \u0026mdash;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSERVER\u003c/strong\u003e: (Oh, I know this gay as I have his pub key in my \u003ccode\u003eauthorized_keys\u003c/code\u003e) I guess we can speak privately from now on! Here is a generated a pub key so that you can talk to me privatly!\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u0026mdash; both ways encrypted \u0026mdash;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCLIENT\u003c/strong\u003e: perfect.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ssh--certificates\"\u003eSsh + certificates\u003c/h2\u003e\n\u003cp\u003eMy take on that:\u003c/p\u003e\n\u003cp\u003eAs we saw in [#case-a-unknown-host], the client has a very basic and quite dumb way of guessing wether or not the server should be trusted: it asks the user if he recognises/trusts the sha256sum of the public key! Here is an example of prompt:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u0026gt; ssh 123.10.9.23\nRSA key fingerprint is 96:a9:23:5c:cc:d1:0a:d4:70:22:93:e9:9e:1e:74:2f.\nAre you sure you want to \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e connecting \u003cspan class=\"o\"\u003e(\u003c/span\u003eyes/no\u003cspan class=\"o\"\u003e)\u003c/span\u003e? yes\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNaturally, no one is checking and it is practically impossible to enforce trust in production servers. Users should not be expected to check wether a public key is valid or not, and most importantly, requiring a human prevents automation.\u003c/p\u003e\n\u003cp\u003eThe trick is to use the same system as for standard HTTPS: a chain of trust based on certification entities. A trusted entity will sign the public key so that \u003ccode\u003essh\u003c/code\u003e will be able to check by himself (if root certificates are installed, obviously).\u003c/p\u003e\n\u003cp\u003eNOTE : the root certificate is simple public key (in the gpg sense, not the ssh one) that allows people to check if the signed version (the signature, called \u0026lsquo;certificate\u0026rsquo;) of a public key (i.e., the result of the root entity using his private key to sign the public key of someone else) matches. To sum up,\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e[creating certificate] the root entity creates a signature file (called certificate) using his private key to sign the public key of entity B\u003c/li\u003e\n\u003cli\u003e[checking certificate] a client that wants to check if the pub key of entity B can be trusted will use the public key of the root entity (CA file? pem/crt file?) and will know if the signature of the pub key (= certificate) matches the public key itself (or something like that).\u003c/li\u003e\n\u003cli\u003e[deploying certificate] now, how to make sure every client that wants to connect to entoty B has the pub key of the root entity? These pub keys must be installed somewhere: in /etc/ssl/certs for example.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"reason-why-ssh-host-cmd-not-using-bashrcloginzshrc\"\u003eReason why \u003ccode\u003essh host cmd\u003c/code\u003e not using .bashrc/.login/.zshrc\u003c/h2\u003e\n\u003cp\u003eSee: \u003ca href=\"https://superuser.com/questions/1224938/ssh-host-is-a-login-shell-but-ssh-host-command-is-not\"\u003ehttps://superuser.com/questions/1224938/ssh-host-is-a-login-shell-but-ssh-host-command-is-not\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003essh is using a non-login, non-interactive shell, meaning that\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e.login (for login shell) .bashrc, .zshrc (interactive shell) are not called. In order to have some environment set, I have to use .zshenv (which is called before anything and in any case)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"passwordless-connexion-to-a-server\"\u003ePasswordless connexion to a server\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e$ ssh-keygen -t rsa -b \u003cspan class=\"m\"\u003e4096\u003c/span\u003e -C \u003cspan class=\"s2\"\u003e\u0026#34;mael.valais@gmail.com\u0026#34;\u003c/span\u003e\nssh-copy-id -i ~/.ssh/id_rsa.pub \u0026lt;remote_server\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"glossary\"\u003eGlossary\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003efqdn\u003c/strong\u003e: fully-quallified domain name, e.g., dl.bintray.com\u003c/li\u003e\n\u003c/ul\u003e\n","date":1559001600,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":1000,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1559001600,"objectID":"4818b08d0ace8454823dd206915d937d","permalink":"https://maelvls.dev/notes/ssh/","publishdate":"2019-05-28T00:00:00Z","readingtime":5,"relpermalink":"/notes/ssh/","section":"notes","summary":"Difference between CA and cert Ssh authentication themes  Case A: unknown host Case B: host already in known_host but ip changed Case C: host already known (ip/fqdn in ~/.ssh/known_hosts) Case D: host has client\u0026rsquo;s pub key in authorized_keys   Ssh + certificates Reason why ssh host cmd not using .bashrc/.login/.zshrc Passwordless connexion to a server Glossary  WARNING: many things in this memo are wrong or very wrong.","tags":[],"title":"How client-server SSH authentication works","type":"notes","url":"https://maelvls.dev/notes/ssh/","weight":0,"wordcount":972},{"authors":null,"categories":null,"content":"\u003cp\u003eFrom: \u003ca href=\"https://apple.stackexchange.com/questions/220670/run-boot-camp-windows10-partition-inside-virtualbox\"\u003ehttps://apple.stackexchange.com/questions/220670/run-boot-camp-windows10-partition-inside-virtualbox\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eFirst, find which disks are EFI and BOOTCAMP with \u003ccode\u003ediskutil list\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ediskutil list\ndiskutil unmount /Volumes/BOOTCAMP\nsudo chmod \u003cspan class=\"m\"\u003e777\u003c/span\u003e /dev/disk0s1\nsudo chmod \u003cspan class=\"m\"\u003e777\u003c/span\u003e /dev/disk0s3\nsudo VBoxManage internalcommands createrawvmdk -rawdisk /dev/disk0 -filename win10raw.vmdk -partitions 1,3\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUncheck \u0026ldquo;Enable EFI\u0026rdquo;, uncheck \u0026ldquo;Enable VT-x/AMD-V\u0026rdquo;\u003c/p\u003e\n","date":1555718400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1555718400,"objectID":"4df8e28d2aaa71f0d9e10b1aadf0b6a7","permalink":"https://maelvls.dev/notes/bootcamp_vm/","publishdate":"2019-04-20T00:00:00Z","readingtime":1,"relpermalink":"/notes/bootcamp_vm/","section":"notes","summary":"From: https://apple.stackexchange.com/questions/220670/run-boot-camp-windows10-partition-inside-virtualbox\nFirst, find which disks are EFI and BOOTCAMP with diskutil list.\ndiskutil list diskutil unmount /Volumes/BOOTCAMP sudo chmod 777 /dev/disk0s1 sudo chmod 777 /dev/disk0s3 sudo VBoxManage internalcommands createrawvmdk -rawdisk /dev/disk0 -filename win10raw.vmdk -partitions 1,3 Uncheck \u0026ldquo;Enable EFI\u0026rdquo;, uncheck \u0026ldquo;Enable VT-x/AMD-V\u0026rdquo;","tags":[],"title":"Use the Bootcamp partition under VirtualBox","type":"notes","url":"https://maelvls.dev/notes/bootcamp_vm/","weight":0,"wordcount":42},{"authors":null,"categories":null,"content":"\u003cp\u003eI know two main ways of using OAuth2\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epassword-based client grant (2-leg oauth flow: on the project I worked on, the OAuth client was not third party server, but instead, it was the front-end.)\u003c/li\u003e\n\u003cli\u003eauthorization code based grant (3-legs oauth flow)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"what-is-the-client\"\u003eWhat is \u0026ldquo;the client\u0026rdquo;?\u003c/h2\u003e\n\u003cp\u003eThe \u003ca href=\"https://tools.ietf.org/html/rfc6749\"\u003eRFC 6749\u003c/a\u003e that presents OAuth2 is very readable, but some terms like \u0026ldquo;client\u0026rdquo; or \u0026ldquo;code\u0026rdquo; are confusing. What I found is that trying to understand \u0026ldquo;why\u0026rdquo; the main flow (3-legged oauth, or \u0026ldquo;authorization code flow\u0026rdquo;) has to be like this.\u003c/p\u003e\n\u003cp\u003eThe most important aspect that I had to realize is that \u0026ldquo;client\u0026rdquo; is hidden from the end-user (e.g. as a nodejs server serving /callback). The \u0026ldquo;client\u0026rdquo; has a single purpose: receive the code when /callback is called by the third-party Authorize screen, POST /token to the third party using the \u003ccode\u003eclient_secret\u003c/code\u003e using that code.\u003c/p\u003e\n\u003ch2 id=\"authorization-code-3-legged-oauth\"\u003eAuthorization code (3 legged oauth)\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eUser clicks the \u0026ldquo;Login with Google\u0026rdquo;; this URL is public and forwards the user to an \u0026ldquo;Authorize\u0026rdquo; form.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-http\" data-lang=\"http\"\u003e\u003cspan class=\"nf\"\u003eGET\u003c/span\u003e \u003cspan class=\"nn\"\u003e/o/oauth2/auth?client_id=foo\u0026amp;redirect_uri=http%3A%2F%2Flocalhost%3A8042%2Fcallback\u0026amp;response_type=code\u0026amp;scope=calendar.readonly\u0026amp;state=something\u003c/span\u003e \u003cspan class=\"kr\"\u003eHTTP\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e1.1\u003c/span\u003e\n\u003cspan class=\"n\"\u003eHost\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"l\"\u003ehttps://accounts.google.com\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSince this URL is quite long, let\u0026rsquo;s see what we have:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eaccess_type\u003c/code\u003e is \u003ccode\u003eoffline\u003c/code\u003e (huh??)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eclient_id\u003c/code\u003e (remember that the \u0026ldquo;client\u0026rdquo; is my CLI which asks the permission to Google\u0026rsquo;s servers to access the scopes.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eredirect_uri\u003c/code\u003e is \u003ca href=\"http://localhost:8042/oauth2\"\u003ehttp://localhost:8042/oauth2\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eresponse_type\u003c/code\u003e is \u003ccode\u003ecode\u003c/code\u003e which makes sense since we want a code so that we can, eventually, get a token. The \u003ccode\u003ecode\u003c/code\u003e and \u003ccode\u003estate\u003c/code\u003e values will be given to us in the callback. When pressing \u0026ldquo;Authorize\u0026rdquo; in the Google authentication page, we get something like:\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e\n\u003cp\u003eAfter authorizing, the user is redirected to the \u0026ldquo;client\u0026rdquo; endpoint:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-http\" data-lang=\"http\"\u003e\u003cspan class=\"nf\"\u003eGET\u003c/span\u003e \u003cspan class=\"nn\"\u003e/callback?code=f1a2bc\u0026amp;state=something\u0026amp;state=foo\u003c/span\u003e \u003cspan class=\"kr\"\u003eHTTP\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e1.1\u003c/span\u003e\n\u003cspan class=\"n\"\u003eHost\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"l\"\u003ehttp://localhost:8042\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eResponse is\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe client gets the token using the code it received.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-http\" data-lang=\"http\"\u003e\u003cspan class=\"nf\"\u003ePOST\u003c/span\u003e \u003cspan class=\"nn\"\u003e/token\u003c/span\u003e \u003cspan class=\"kr\"\u003eHTTP\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e1.1\u003c/span\u003e\n\u003cspan class=\"n\"\u003eHost\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"l\"\u003ehttps://oauth2.googleapis.com\u003c/span\u003e\n\u003cspan class=\"n\"\u003eContent-Type\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"l\"\u003eapplication/x-www-form-urlencoded\u003c/span\u003e\n\ngrant_type=authorization_code\u0026amp;code=f1a2bc\u0026amp;client_id=foo\u0026amp;client_secret=\u0026lt;the_secret\u0026gt;\u0026amp;redirect_url=\u0026lt;same as above\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe token looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026#34;access_token\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ya29.a0AfH6SMCkF6Kd0bZPf60Knhq8XyMKTgmQ6zE5lP9pjdZfW-9ebV5V9wifFagdiioN5JWovHmfVfdukAE0-jcHRmjzsycQCYPj7zzSup55X0n_gz8rkglYGBaeG5Tyde8a8rAIu1CimhtSdsoq0_HCh2VBXOLmrq7oKSg\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026#34;token_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Bearer\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026#34;refresh_token\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;1//03E6r0qdOHKqrCgYIARAAGAMSNwF-L9Ir37zr9-GH8po_A5XSwsSiEw8XmiHPnCbKPaFHNCckIF-vmJRRKddbjWLbX9ZrbOzffts\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026#34;expiry\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;2020-07-21T19:26:47.346143+02:00\u0026#34;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNote: when we say \u0026ldquo;an oauth token\u0026rdquo;, what we actually mean is the access token the refresh token.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n","date":1550361600,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":400,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1550361600,"objectID":"6a3ebbb76a77eb586c863984496eb01d","permalink":"https://maelvls.dev/notes/oauth/","publishdate":"2019-02-17T00:00:00Z","readingtime":2,"relpermalink":"/notes/oauth/","section":"notes","summary":"I know two main ways of using OAuth2\n password-based client grant (2-leg oauth flow: on the project I worked on, the OAuth client was not third party server, but instead, it was the front-end.) authorization code based grant (3-legs oauth flow)  What is \u0026ldquo;the client\u0026rdquo;? The RFC 6749 that presents OAuth2 is very readable, but some terms like \u0026ldquo;client\u0026rdquo; or \u0026ldquo;code\u0026rdquo; are confusing. What I found is that trying to understand \u0026ldquo;why\u0026rdquo; the main flow (3-legged oauth, or \u0026ldquo;authorization code flow\u0026rdquo;) has to be like this.","tags":[],"title":"Notes on OAuth","type":"notes","url":"https://maelvls.dev/notes/oauth/","weight":0,"wordcount":319},{"authors":null,"categories":null,"content":"\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ekubectl run --generator\u003cspan class=\"o\"\u003e=\u003c/span\u003erun-pod/v1 tmp-shell --rm -i --tty --image nicolaka/netshoot -- /bin/bash\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003egcloud ssh ...\ndocker ps --format\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{{.ID}} {{.Names}}\u0026#39;\u003c/span\u003e\nkubectl run --generator\u003cspan class=\"o\"\u003e=\u003c/span\u003erun-pod/v1 tmp-shell --rm -i --tty --image nicolaka/netshoot -- /bin/bash\nsudo iptables-save \u0026gt; a \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e vim a \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo iptables-restore \u0026lt; a\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% mvalais@gke-august-period-micro-g961 ~ $ vmstat -SM \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"m\"\u003e0\u003c/span\u003e      \u003cspan class=\"m\"\u003e0\u003c/span\u003e    \u003cspan class=\"m\"\u003e104\u003c/span\u003e      \u003cspan class=\"m\"\u003e7\u003c/span\u003e    \u003cspan class=\"m\"\u003e218\u003c/span\u003e    \u003cspan class=\"m\"\u003e0\u003c/span\u003e    \u003cspan class=\"m\"\u003e0\u003c/span\u003e   \u003cspan class=\"m\"\u003e160\u003c/span\u003e    \u003cspan class=\"m\"\u003e57\u003c/span\u003e  \u003cspan class=\"m\"\u003e273\u003c/span\u003e  \u003cspan class=\"m\"\u003e760\u003c/span\u003e  \u003cspan class=\"m\"\u003e2\u003c/span\u003e  \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e96\u003c/span\u003e  \u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ek get pods -A --field-selector\u003cspan class=\"o\"\u003e=\u003c/span\u003espec.nodeName\u003cspan class=\"o\"\u003e=\u003c/span\u003egke-august-period-234610-worker-micro-1de60498-g961\ngcloud compute ssh gke-august-period-234610-worker-micro-1de60498-g961 --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003eus-east1-c --command \u003cspan class=\"s2\"\u003e\u0026#34;docker run --rm --net=host corfr/tcpdump -i cbr0 -U -w - \u0026#39;not port 22\u0026#39;\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e wireshark -k -i -\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003edmsg\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"c1\"\u003e# Host B is 10.142.15.201\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Doesn\u0026#39;t work:\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#   from the pod on host B, nslookup github.com (tcpdump on pod\u0026#39;s eth0)\u003c/span\u003e\n\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e      \u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e    \u003cspan class=\"n\"\u003eDNS\u003c/span\u003e \u003cspan class=\"m\"\u003e98\u003c/span\u003e \u003cspan class=\"n\"\u003eStandard\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e            \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003egithub.com.traefik.svc.cluster.local\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#   same from host\u0026#39;s eth0\u003c/span\u003e\n\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e      \u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e       \u003cspan class=\"n\"\u003eDNS\u003c/span\u003e \u003cspan class=\"m\"\u003e96\u003c/span\u003e \u003cspan class=\"n\"\u003eStandard\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e            \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003egithub.com.traefik.svc.cluster.local\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# Works:\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#   from the host B, nslookup github.com 10.27.240.10 (tcpdump on host\u0026#39;s eth0)\u003c/span\u003e\n\u003cspan class=\"m\"\u003e10.142.15.201\u003c/span\u003e   \u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e       \u003cspan class=\"n\"\u003eDNS\u003c/span\u003e \u003cspan class=\"m\"\u003e70\u003c/span\u003e \u003cspan class=\"n\"\u003eStandard\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e            \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003egithub.com\u003c/span\u003e\n\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e       \u003cspan class=\"m\"\u003e10.142.15.201\u003c/span\u003e   \u003cspan class=\"n\"\u003eDNS\u003c/span\u003e \u003cspan class=\"m\"\u003e86\u003c/span\u003e \u003cspan class=\"n\"\u003eStandard\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e   \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003egithub.com\u003c/span\u003e \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"m\"\u003e140.82.113.4\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eDumping iptables on host B:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud compute ssh gke-august-period-234610-worker-micro-1de60498-g961 --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003eus-east1-c --command \u003cspan class=\"s2\"\u003e\u0026#34;docker run --rm --net=host --privileged praqma/network-multitool iptables-save\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e pbcopy\n-A KUBE-HP-JSWHQ3CPP5EMKPCA -s 10.24.10.2/32 -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;akrobateo-traefik-pqkqf_traefik hostport 443\u0026#34;\u003c/span\u003e -j KUBE-MARK-MASQ\n-A KUBE-HP-JSWHQ3CPP5EMKPCA -p tcp -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;akrobateo-traefik-pqkqf_traefik hostport 443\u0026#34;\u003c/span\u003e -m tcp -j DNAT --to-destination 10.24.10.2:443\n-A KUBE-HP-Q34NV5ACWTD24LGG -s 10.24.10.2/32 -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;akrobateo-traefik-pqkqf_traefik hostport 80\u0026#34;\u003c/span\u003e -j KUBE-MARK-MASQ\n-A KUBE-HP-Q34NV5ACWTD24LGG -p tcp -m comment --comment \u003cspan class=\"s2\"\u003e\u0026#34;akrobateo-traefik-pqkqf_traefik hostport 80\u0026#34;\u003c/span\u003e -m tcp -j DNAT --to-destination 10.24.10.2:80\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eContrack:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"c1\"\u003e# From the container. Since orig dst != reply src, packet is DNAT.\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% nslookup github.com\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003emvalais\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003egke\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eaugust\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eperiod\u003c/span\u003e\u003cspan class=\"m\"\u003e-234610\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eworker\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003emicro\u003c/span\u003e\u003cspan class=\"m\"\u003e-1\u003c/span\u003e\u003cspan class=\"n\"\u003ede60498\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eg961\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e \u003cspan class=\"n\"\u003edocker\u003c/span\u003e \u003cspan class=\"n\"\u003erun\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003enet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eprivileged\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003erm\u003c/span\u003e \u003cspan class=\"n\"\u003emissioncriticalkubernetes\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003econntrack\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eL\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003egrep\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24\u003c/span\u003e\n\u003cspan class=\"n\"\u003econntrack\u003c/span\u003e \u003cspan class=\"nf\"\u003ev1.4.4 \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econntrack\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003etools\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e52\u003c/span\u003e \u003cspan class=\"n\"\u003eflow\u003c/span\u003e \u003cspan class=\"n\"\u003eentries\u003c/span\u003e \u003cspan class=\"n\"\u003ehave\u003c/span\u003e \u003cspan class=\"n\"\u003ebeen\u003c/span\u003e \u003cspan class=\"n\"\u003eshown.\u003c/span\u003e\n\u003cspan class=\"n\"\u003eudp\u003c/span\u003e \u003cspan class=\"m\"\u003e17\u003c/span\u003e \u003cspan class=\"m\"\u003e26\u003c/span\u003e  \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e    \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003esport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57400\u003c/span\u003e \u003cspan class=\"n\"\u003edport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003e[UNREPLIED]\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e     \u003cspan class=\"n\"\u003esport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003edport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57400\u003c/span\u003e           \u003cspan class=\"n\"\u003emark\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003euse\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# From host B. Since orig dst != reply src, packet is DNAT.\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% nslookup github.com 10.27.240.10\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003emvalais\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003egke\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eaugust\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eperiod\u003c/span\u003e\u003cspan class=\"m\"\u003e-234610\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eworker\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003emicro\u003c/span\u003e\u003cspan class=\"m\"\u003e-1\u003c/span\u003e\u003cspan class=\"n\"\u003ede60498\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eg961\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e \u003cspan class=\"n\"\u003edocker\u003c/span\u003e \u003cspan class=\"n\"\u003erun\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003enet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eprivileged\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003erm\u003c/span\u003e \u003cspan class=\"n\"\u003emissioncriticalkubernetes\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003econntrack\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eL\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003egrep\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24\u003c/span\u003e\n\u003cspan class=\"n\"\u003eudp\u003c/span\u003e \u003cspan class=\"m\"\u003e17\u003c/span\u003e \u003cspan class=\"m\"\u003e175\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.142.15.201\u003c/span\u003e \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003esport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e37337\u003c/span\u003e \u003cspan class=\"n\"\u003edport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e             \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.26\u003c/span\u003e \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.142.15.201\u003c/span\u003e \u003cspan class=\"n\"\u003esport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003edport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e37337\u003c/span\u003e \u003cspan class=\"n\"\u003e[ASSURED]\u003c/span\u003e \u003cspan class=\"n\"\u003emark\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003euse\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003emvalais@gke-august-period-234610-worker-micro-1de60498-g961 ~ $ docker run -it --rm --net\u003cspan class=\"o\"\u003e=\u003c/span\u003ehost praqma/network-multitool ip route\ndefault via 10.142.0.1 dev eth0    proto dhcp                src 10.142.15.201 metric \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\ndefault via 10.142.0.1 dev eth0    proto dhcp                                  metric \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\n10.24.10.0/24          dev cbr0    proto kernel scope link   src 10.24.10.1\n10.142.0.1             dev eth0    proto dhcp scope   link   src 10.142.15.201 metric \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\n10.142.0.1             dev eth0    proto dhcp scope   link                     metric \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\n169.254.123.0/24       dev docker0 proto kernel scope link   src 169.254.123.1 linkdown\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhat\u0026rsquo;s very weird is that ICMP packets are properly routed:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% mvalais@gke-august-period-234610-worker-micro-1de60498-g961 ~ $ docker run --rm -it --net\u003cspan class=\"o\"\u003e=\u003c/span\u003econtainer:9e557d74b06c praqma/network-multitool bash\n% bash-5.0# ping 10.24.9.3\nPING 10.24.9.3 \u003cspan class=\"o\"\u003e(\u003c/span\u003e10.24.9.3\u003cspan class=\"o\"\u003e)\u003c/span\u003e 56\u003cspan class=\"o\"\u003e(\u003c/span\u003e84\u003cspan class=\"o\"\u003e)\u003c/span\u003e bytes of data.\n\u003cspan class=\"m\"\u003e64\u003c/span\u003e bytes from 10.24.9.3: \u003cspan class=\"nv\"\u003eicmp_seq\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003ettl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e \u003cspan class=\"nv\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1.47 ms\n\n% bash-5.0# nc -v 10.24.9.21 \u003cspan class=\"m\"\u003e9000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s take another pod that is on host A. It\u0026rsquo;s minio, which serves on port 10.24.9.21:9000:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003ebash-5.0# ping 10.24.9.21\nPING 10.24.9.21 \u003cspan class=\"o\"\u003e(\u003c/span\u003e10.24.9.21\u003cspan class=\"o\"\u003e)\u003c/span\u003e 56\u003cspan class=\"o\"\u003e(\u003c/span\u003e84\u003cspan class=\"o\"\u003e)\u003c/span\u003e bytes of data.\n\u003cspan class=\"m\"\u003e64\u003c/span\u003e bytes from 10.24.9.21: \u003cspan class=\"nv\"\u003eicmp_seq\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003ettl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e \u003cspan class=\"nv\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1.16 ms\n\n% bash-5.0# nc -v 10.24.9.21 \u003cspan class=\"m\"\u003e9000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThen I found out that host B has a \u0026lsquo;stale kube dns\u0026rsquo;:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003emvalais@gke-august-period-234610-worker-micro-1de60498-g961 ~ $ tail /var/log/kube-proxy.log\nI0125 12:30:37.882376       \u003cspan class=\"m\"\u003e1\u003c/span\u003e service.go:334\u003cspan class=\"o\"\u003e]\u003c/span\u003e Updating existing service port \u003cspan class=\"s2\"\u003e\u0026#34;traefik/traefik:http\u0026#34;\u003c/span\u003e at 10.27.244.111:80/TCP\nI0125 12:31:35.093785       \u003cspan class=\"m\"\u003e1\u003c/span\u003e proxier.go:675\u003cspan class=\"o\"\u003e]\u003c/span\u003e Stale udp service kube-system/kube-dns:dns -\u0026gt; 10.27.240.10\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, let\u0026rsquo;s trace in iptables on host B: \u003ca href=\"https://www.opsist.com/blog/2015/08/11/how-do-i-see-what-iptables-is-doing.html\"\u003ehttps://www.opsist.com/blog/2015/08/11/how-do-i-see-what-iptables-is-doing.html\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% sudo iptables -t nat -I PREROUTING \u003cspan class=\"m\"\u003e1\u003c/span\u003e -j LOG\n% sudo iptables -t nat -I POSTROUTING \u003cspan class=\"m\"\u003e1\u003c/span\u003e -j LOG\n% sudo iptables -t nat -I OUTPUT \u003cspan class=\"m\"\u003e1\u003c/span\u003e -j LOG\n% demsg -w\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e89712.445268\u003cspan class=\"o\"\u003e]\u003c/span\u003e                                                 \u003cspan class=\"nv\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ecbr0 \u003cspan class=\"nv\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e                                                     \u003cspan class=\"nv\"\u003ePHYSILEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"nv\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x00 \u003cspan class=\"nv\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x00 \u003cspan class=\"nv\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"nv\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e38810\u003c/span\u003e \u003cspan class=\"nv\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eUDP \u003cspan class=\"nv\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e54407\u003c/span\u003e \u003cspan class=\"nv\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"nv\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e89712.463153\u003cspan class=\"o\"\u003e]\u003c/span\u003e                                                 \u003cspan class=\"nv\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ecbr0 \u003cspan class=\"nv\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e                                                     \u003cspan class=\"nv\"\u003ePHYSILEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"nv\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x00 \u003cspan class=\"nv\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x00 \u003cspan class=\"nv\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"nv\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e38810\u003c/span\u003e \u003cspan class=\"nv\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eUDP \u003cspan class=\"nv\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e54407\u003c/span\u003e \u003cspan class=\"nv\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"nv\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e89712.481021\u003cspan class=\"o\"\u003e]\u003c/span\u003e                                                 \u003cspan class=\"nv\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ecbr0 \u003cspan class=\"nv\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e                                                     \u003cspan class=\"nv\"\u003ePHYSILEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"nv\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x00 \u003cspan class=\"nv\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x00 \u003cspan class=\"nv\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"nv\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e38810\u003c/span\u003e \u003cspan class=\"nv\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eUDP \u003cspan class=\"nv\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e54407\u003c/span\u003e \u003cspan class=\"nv\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"nv\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e89712.498895\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"nv\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eeth0                                                     \u003cspan class=\"nv\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eveth4a3719bc \u003cspan class=\"nv\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e10.24.10.2 \u003cspan class=\"nv\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e10.24.9.10    \u003cspan class=\"nv\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"nv\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x00 \u003cspan class=\"nv\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x00 \u003cspan class=\"nv\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"nv\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e38810\u003c/span\u003e \u003cspan class=\"nv\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eUDP \u003cspan class=\"nv\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e54407\u003c/span\u003e \u003cspan class=\"nv\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"nv\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s try again with the TRACE module:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"o\"\u003e% sudo modprobe ipt_LOG\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003eiptables\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eI\u003c/span\u003e \u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24.0.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e16\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% docker run --rm -it --net=container:9e557d74b06c --privileged praqma/network-multitool nslookup github.com\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003edmesg\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.179725]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.200327]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e               \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.221171]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.241576]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSERVICES\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e14\u003c/span\u003e                \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.262385]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSVC\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eTCOU7JCQXEZGVUNU\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.284116]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSEP\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eMQYG7Z5PYI3N6YFY\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e  \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.305838]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.326491]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.346973]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e             \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.368068]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.389031]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSERVICES\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e            \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.410253]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.430735]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eDOCKER\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eUSER\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e              \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.451887]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.472366]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eDOCKER\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eISOLATION\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSTAGE\u003c/span\u003e\u003cspan class=\"m\"\u003e-1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.494488]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.515049]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e              \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.531693]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.547953]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e            \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.564769]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.580978]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eIP\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eMASQ\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                       \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[90332.596840]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e                 \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth4a3719bc\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.10.2\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.3\u003c/span\u003e     \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e43592\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e36775\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNote that using TRACE is extremely expensive. For example, using \u003ccode\u003e-p icmp\u003c/code\u003e would result in pings going from 1ms (without tracing) to 500ms. I also overloaded one of the nodes by adding a rule that was \u0026ldquo;too wide\u0026rdquo; and nearly killed the entire node. Use tracing filters (\u003ccode\u003e-s\u003c/code\u003e, \u003ccode\u003e-p\u003c/code\u003e, \u003ccode\u003e-d\u003c/code\u003e) as narrow as possible!\u003c/p\u003e\n\u003ch2 id=\"other-experiment-icmp\"\u003eOther experiment: icmp\u003c/h2\u003e\n\u003cp\u003eAt this point, I recreated both nodes which changed all the IP CIDRs.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHost A CIDR is \u003ccode\u003e10.24.9.0/24\u003c/code\u003e,\u003c/li\u003e\n\u003cli\u003eHost B CIDR is \u003ccode\u003e10.24.11.0/24\u003c/code\u003e,\u003c/li\u003e\n\u003cli\u003eWe use the traefik pod (\u003ccode\u003e10.24.11.7\u003c/code\u003e) on host B for reproducing the connectivity issue.\u003c/li\u003e\n\u003cli\u003eKubeDNS is running on \u003ccode\u003e10.24.9.14\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHost B:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"o\"\u003e% docker run --rm -it --net=container:$(docker ps | grep POD_traefik | head -1 | cut -f1 -d\u0026#39; \u0026#39;) --privileged praqma/network-multitool ping 10.24.9.14\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003eiptables\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eicmp\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24.11.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e24\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% sudo iptables -A PREROUTING -p icmp -t raw -d 10.24.11.0/24 -j TRACE\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003edmesg\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5365.769471\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5365.790765\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5365.812684\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5365.834225\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e       \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5365.855880\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5365.877624\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHost A (that\u0026rsquo;s where KubeDNS' \u003ccode\u003e10.24.9.14\u003c/code\u003e is):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"o\"\u003e% sudo iptables -A PREROUTING -p icmp -t raw -s 10.24.11.0/24 -j TRACE\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003eiptables\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eicmp\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24.11.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e24\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\n% \u003cspan class=\"n\"\u003edmesg\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5528.648942\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5528.668115\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5528.687502\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5528.706928\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e       \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5528.726471\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5528.746157\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.14\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e84\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10728\u003c/span\u003e \u003cspan class=\"n\"\u003eDF\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eICMP\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"n\"\u003eCODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eSEQ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"lets-try-again-with-udp\"\u003eLet\u0026rsquo;s try again with udp\u003c/h2\u003e\n\u003cp\u003eHost B:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"o\"\u003e% docker run --rm -it --net=container:$(docker ps | grep POD_traefik | head -1 | cut -f1 -d\u0026#39; \u0026#39;) --privileged praqma/network-multitool nslookup github.com\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003eiptables\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eudp\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24.11.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e24\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\n\u003cspan class=\"o\"\u003e% sudo iptables -A PREROUTING -p udp -t raw -s 10.24.11.0/24 -j TRACE\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003edmesg\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.660913\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e7\u003c/span\u003e                  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.681727\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e               \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.702962\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.723562\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSERVICES\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                 \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.744284\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSVC\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eTCOU7JCQXEZGVUNU\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.766008\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSEP\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eFNEHYJGPMQEV2RPP\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e     \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.27.240.10\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e64\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.788020\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                  \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.809069\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.829669\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e             \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.850869\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.871663\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSERVICES\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e            \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.893472\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.914059\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eDOCKER\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eUSER\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e              \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.935373\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e                    \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.956083\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eDOCKER\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eISOLATION\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eSTAGE\u003c/span\u003e\u003cspan class=\"m\"\u003e-1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.978371\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eFORWARD\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecbr0\u003c/span\u003e \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6160.999283\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emangle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e              \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6161.016840\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6161.033296\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eKUBE\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e            \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6161.050267\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                   \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6161.066717\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eIP\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eMASQ\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e                       \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003cspan class=\"n\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6161.083318\u003c/span\u003e\u003cspan class=\"n\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enat\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ePOSTROUTING\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e                 \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e     \u003cspan class=\"n\"\u003eOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeth0\u003c/span\u003e \u003cspan class=\"n\"\u003ePHYSIN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eveth98b9f376\u003c/span\u003e \u003cspan class=\"n\"\u003eSRC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.11.7\u003c/span\u003e \u003cspan class=\"n\"\u003eDST\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10.24.9.25\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e82\u003c/span\u003e \u003cspan class=\"n\"\u003eTOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003ePREC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x00\u003c/span\u003e \u003cspan class=\"n\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e63\u003c/span\u003e \u003cspan class=\"n\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e18335\u003c/span\u003e \u003cspan class=\"n\"\u003ePROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eUDP\u003c/span\u003e \u003cspan class=\"n\"\u003eSPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e57262\u003c/span\u003e \u003cspan class=\"n\"\u003eDPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e53\u003c/span\u003e \u003cspan class=\"n\"\u003eLEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e62\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHost A:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-s\" data-lang=\"s\"\u003e\u003cspan class=\"o\"\u003e% sudo iptables -A PREROUTING -p udp -t raw -d 10.24.11.0/24 -j TRACE\n\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"n\"\u003eiptables\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ePREROUTING\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eudp\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"n\"\u003eraw\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"m\"\u003e10.24.11.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e24\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"n\"\u003eTRACE\u003c/span\u003e\n% \u003cspan class=\"n\"\u003edmesg\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Nothing!\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"communication-between-two-pods-across-nodes\"\u003eCommunication between two pods across nodes\u003c/h2\u003e\n\u003cp\u003eHost A (10.24.9.26):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl run --generator\u003cspan class=\"o\"\u003e=\u003c/span\u003erun-pod/v1 tmp-host-a --overrides\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;spec\u0026#34;:{\u0026#34;affinity\u0026#34;:{\u0026#34;nodeAffinity\u0026#34;:{\u0026#34;requiredDuringSchedulingIgnoredDuringExecution\u0026#34;:{\u0026#34;nodeSelectorTerms\u0026#34;:[{\u0026#34;matchFields\u0026#34;:[{\u0026#34;key\u0026#34;:\u0026#34;metadata.name\u0026#34;,\u0026#34;operator\u0026#34;:\u0026#34;In\u0026#34;,\u0026#34;values\u0026#34;:[\u0026#34;gke-august-period-234610-worker-96e2b32f-6k31\u0026#34;]}]}]}}}}}\u0026#39;\u003c/span\u003e --rm -i --tty --image nicolaka/netshoot\n% nc -v 10.24.11.21 \u003cspan class=\"m\"\u003e80\u003c/span\u003e\nConnection to 10.24.11.21 \u003cspan class=\"m\"\u003e80\u003c/span\u003e port \u003cspan class=\"o\"\u003e[\u003c/span\u003etcp/http\u003cspan class=\"o\"\u003e]\u003c/span\u003e succeeded!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHost B (10.24.11.21):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% kubectl run --generator\u003cspan class=\"o\"\u003e=\u003c/span\u003erun-pod/v1 tmp-host-b --overrides\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;spec\u0026#34;:{\u0026#34;affinity\u0026#34;:{\u0026#34;nodeAffinity\u0026#34;:{\u0026#34;requiredDuringSchedulingIgnoredDuringExecution\u0026#34;:{\u0026#34;nodeSelectorTerms\u0026#34;:[{\u0026#34;matchFields\u0026#34;:[{\u0026#34;key\u0026#34;:\u0026#34;metadata.name\u0026#34;,\u0026#34;operator\u0026#34;:\u0026#34;In\u0026#34;,\u0026#34;values\u0026#34;:[\u0026#34;gke-august-period-234610-worker-micro-2a7d2fc5-f85j\u0026#34;]}]}]}}}}}\u0026#39;\u003c/span\u003e --rm -i --tty --image nicolaka/netshoot\n% nc -v -l \u003cspan class=\"m\"\u003e80\u003c/span\u003e\nListening on \u003cspan class=\"o\"\u003e[\u003c/span\u003e0.0.0.0\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003efamily 0, port 80\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nConnection from 10.24.9.26 \u003cspan class=\"m\"\u003e38274\u003c/span\u003e received!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, using udp:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% nc -v -u 10.24.11.21 \u003cspan class=\"m\"\u003e80\u003c/span\u003e\nConnection to 10.24.11.21 \u003cspan class=\"m\"\u003e80\u003c/span\u003e port \u003cspan class=\"o\"\u003e[\u003c/span\u003eudp/http\u003cspan class=\"o\"\u003e]\u003c/span\u003e succeeded!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% tcpdump \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e nc -u -l \u003cspan class=\"m\"\u003e80\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e1\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"m\"\u003e32\u003c/span\u003e\ntcpdump: verbose output suppressed, use -v or -vv \u003cspan class=\"k\"\u003efor\u003c/span\u003e full protocol decode\nlistening on eth0, link-type EN10MB \u003cspan class=\"o\"\u003e(\u003c/span\u003eEthernet\u003cspan class=\"o\"\u003e)\u003c/span\u003e, capture size \u003cspan class=\"m\"\u003e262144\u003c/span\u003e bytes\n\u003cspan class=\"c1\"\u003e# Nothing\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eDefinitely something wrong with anything else than 80/tcp!\u003c/p\u003e\n\u003ch2 id=\"omg-it-was-a-missing-firewall-rule\"\u003eOMG it was a missing firewall rule\u003c/h2\u003e\n\u003cp\u003eI realised that only 80/tcp, 443/tcp and icmp packets would get routed. It\u0026rsquo;s surprisingly very specific: what if the VPC firewall rules were off. Maybe these 80/tcp and 443/tcp are correspond to the rule \u0026ldquo;akrobateo-fw-traefik\u0026rdquo; I had added when I wanted to load-balance traffic direclty from the cluster (as opposed as external load balancing).\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud compute firewall-rules list\nNAME                                 NETWORK  DIRECTION  PRIORITY  ALLOW                         DENY  DISABLED\nakrobateo-fw-traefik                 default  INGRESS    \u003cspan class=\"m\"\u003e1000\u003c/span\u003e      tcp:80,tcp:443                      False\ndefault-allow-icmp                   default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e     icmp                                False\ndefault-allow-internal               default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e     tcp:0-65535,udp:0-65535,icmp        False\ndefault-allow-rdp                    default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e     tcp:3389                            False\ndefault-allow-ssh                    default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e     tcp:22                              False\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNo rule for traffic in \u003ccode\u003e10.24.0.0/14\u003c/code\u003e! This CIDR is the subnet used for distributing CIDRs to each node. So I added a new rule \u0026ldquo;all\u0026rdquo;; here is the new list of rules:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% gcloud compute firewall-rules list\nNAME                                 NETWORK  DIRECTION  PRIORITY  ALLOW                         DENY  DISABLED\nakrobateo-fw-traefik                 default  INGRESS    \u003cspan class=\"m\"\u003e1000\u003c/span\u003e      tcp:80,tcp:443                      False\ndefault-allow-icmp                   default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e     icmp                                False\ndefault-allow-internal               default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e     tcp:0-65535,udp:0-65535,icmp        False\ndefault-allow-rdp                    default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e     tcp:3389                            False\ndefault-allow-ssh                    default  INGRESS    \u003cspan class=\"m\"\u003e65534\u003c/span\u003e     tcp:22                              False\ngke-august-period-234610-all         default  INGRESS    \u003cspan class=\"m\"\u003e1000\u003c/span\u003e      udp,icmp,esp,ah,sctp,tcp            False\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, let\u0026rsquo;s test again:\u003c/p\u003e\n\u003cp\u003ePod \u0026ldquo;tmp-host-b\u0026rdquo; (10.24.11.26) on Host B:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% nc -v -u 10.24.9.27 \u003cspan class=\"m\"\u003e8888\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Exits with 0 and no output\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ePod \u0026ldquo;tmp-host-a\u0026rdquo; (10.24.9.27) on Host A:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e% tcpdump\ntcpdump: verbose output suppressed, use -v or -vv \u003cspan class=\"k\"\u003efor\u003c/span\u003e full protocol decode\nlistening on eth0, link-type EN10MB \u003cspan class=\"o\"\u003e(\u003c/span\u003eEthernet\u003cspan class=\"o\"\u003e)\u003c/span\u003e, capture size \u003cspan class=\"m\"\u003e262144\u003c/span\u003e bytes\n21:54:39.787779 IP 10.24.11.26.40760 \u0026gt; tmp-host-a.8888: UDP, length \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n21:54:39.787802 IP tmp-host-a \u0026gt; 10.24.11.26: ICMP tmp-host-a udp port \u003cspan class=\"m\"\u003e8888\u003c/span\u003e unreachable, length \u003cspan class=\"m\"\u003e37\u003c/span\u003e\n21:54:39.787805 IP 10.24.11.26.40760 \u0026gt; tmp-host-a.8888: UDP, length \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n21:54:39.787808 IP tmp-host-a \u0026gt; 10.24.11.26: ICMP tmp-host-a udp port \u003cspan class=\"m\"\u003e8888\u003c/span\u003e unreachable, length \u003cspan class=\"m\"\u003e37\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eYay!\u003c/p\u003e\n","date":1546473600,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":2400,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1546473600,"objectID":"fbd225d1686c128115129c5309a62435","permalink":"https://maelvls.dev/notes/kubectl/","publishdate":"2019-01-03T00:00:00Z","readingtime":12,"relpermalink":"/notes/kubectl/","section":"notes","summary":"kubectl run --generator=run-pod/v1 tmp-shell --rm -i --tty --image nicolaka/netshoot -- /bin/bash gcloud ssh ... docker ps --format=\u0026#39;{{.ID}} {{.Names}}\u0026#39; kubectl run --generator=run-pod/v1 tmp-shell --rm -i --tty --image nicolaka/netshoot -- /bin/bash sudo iptables-save \u0026gt; a \u0026amp;\u0026amp; vim a \u0026amp;\u0026amp; sudo iptables-restore \u0026lt; a % mvalais@gke-august-period-micro-g961 ~ $ vmstat -SM 1 10 procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 0 0 0 104 7 218 0 0 160 57 273 760 2 1 96 1 0 k get pods -A --field-selector=spec.","tags":[],"title":"Some kubectl stuff","type":"notes","url":"https://maelvls.dev/notes/kubectl/","weight":0,"wordcount":2374},{"authors":null,"categories":null,"content":"\u003cp\u003eI installed \u003ca href=\"https://gist.github.com/cybic/6375457\"\u003ehttps://gist.github.com/cybic/6375457\u003c/a\u003e in \u003ccode\u003e~/.bash_completion\u003c/code\u003e (file) to get the bash completion.\u003c/p\u003e\n\u003ch2 id=\"general-shortcuts\"\u003eGeneral shortcuts\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003etmux attach          -\u0026gt; opens tmux\ntmux ls              -\u0026gt; lists open windows\ntmux attach -d 0     -\u0026gt; reopens window 0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eInside tmux. prefix = ctrl+b\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eprefix d         -\u0026gt; detach window (closes tmux)\nprefix w         -\u0026gt; lists windows\nprefix x         -\u0026gt; close window\nprefix c         -\u0026gt; create window\nprefix ,         -\u0026gt; rename window\nprefix [         -\u0026gt; scroll among history\nprefix arrow     -\u0026gt; move among panes\nprefix \u0026quot;         -\u0026gt; split vertically (up-down); % for horiz\nprefix maj+arrow -\u0026gt; bigger pane\nprefix alt+arrow -\u0026gt; even bigger pane\nprefix z         -\u0026gt; bigger current pane (redo that to resize like before)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI also created a script called \u003ccode\u003emonitor.sh\u003c/code\u003e to know which one of the 6 server I should use for my experiments. The thing is that I don\u0026rsquo;t want the session with 6 htop open to run in background for days.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eprefix ctrl+z    -\u0026gt; suspend the current session\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo scroll stdout history instead of command history with mouse wheel:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eset -g mouse on\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf I want to put an open pane to its own window:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ebreak-pane           # current pane is sent to a new window\njoin-pane -s 0       # -s = source window\njoin-pane -t 0       # -t = destination window\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"gray-not-displaying-zsh\"\u003eGray not displaying (zsh)\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026lt;can't remember how to do that\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n","date":1541203200,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":300,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1541203200,"objectID":"f262c827357f96b6fb6a91e08a076a00","permalink":"https://maelvls.dev/notes/tmux/","publishdate":"2018-11-03T00:00:00Z","readingtime":2,"relpermalink":"/notes/tmux/","section":"notes","summary":"I installed https://gist.github.com/cybic/6375457 in ~/.bash_completion (file) to get the bash completion.\nGeneral shortcuts tmux attach -\u0026gt; opens tmux tmux ls -\u0026gt; lists open windows tmux attach -d 0 -\u0026gt; reopens window 0  Inside tmux. prefix = ctrl+b\nprefix d -\u0026gt; detach window (closes tmux) prefix w -\u0026gt; lists windows prefix x -\u0026gt; close window prefix c -\u0026gt; create window prefix , -\u0026gt; rename window prefix [ -\u0026gt; scroll among history prefix arrow -\u0026gt; move among panes prefix \u0026quot; -\u0026gt; split vertically (up-down); % for horiz prefix maj+arrow -\u0026gt; bigger pane prefix alt+arrow -\u0026gt; even bigger pane prefix z -\u0026gt; bigger current pane (redo that to resize like before)  I also created a script called monitor.","tags":[],"title":"Memo for Tmux","type":"notes","url":"https://maelvls.dev/notes/tmux/","weight":0,"wordcount":218},{"authors":null,"categories":null,"content":"\u003cp\u003eIf there is a Nvidia card:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003envidia-smi\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOtherwise:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e cat /proc/cpuinfo\n lscpu\n\u003c/code\u003e\u003c/pre\u003e\n","date":1541030400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1541030400,"objectID":"15339c0f4108a8600b3e7c1400db40da","permalink":"https://maelvls.dev/notes/cpu_gpu/","publishdate":"2018-11-01T00:00:00Z","readingtime":1,"relpermalink":"/notes/cpu_gpu/","section":"notes","summary":"If there is a Nvidia card:\nnvidia-smi  Otherwise:\n cat /proc/cpuinfo lscpu  ","tags":[],"title":"Checking info about CPU and Nvidia GPU on Linux","type":"notes","url":"https://maelvls.dev/notes/cpu_gpu/","weight":0,"wordcount":11},{"authors":null,"categories":null,"content":"\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003esudo dd \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$HOME\u003c/span\u003e/Downloads/elementaryos-0.4.1-stable.20170814.iso \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/disk3s1 \u003cspan class=\"nv\"\u003estatus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eprogress\ndf -h\ndiskutil unmountDisk /dev/...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1538956800,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1538956800,"objectID":"1031fd59622557560850a335b7460343","permalink":"https://maelvls.dev/notes/dd/","publishdate":"2018-10-08T00:00:00Z","readingtime":1,"relpermalink":"/notes/dd/","section":"notes","summary":"sudo dd if=$HOME/Downloads/elementaryos-0.4.1-stable.20170814.iso of=/dev/disk3s1 status=progress df -h diskutil unmountDisk /dev/... ","tags":[],"title":"Using dd","type":"notes","url":"https://maelvls.dev/notes/dd/","weight":0,"wordcount":10},{"authors":null,"categories":null,"content":"\u003ch2 id=\"use-docker-machine-for-remoting-docker\"\u003eUse docker-machine for remoting docker\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003edocker-machine create --driver generic --generic-ip-address\u003cspan class=\"o\"\u003e=\u003c/span\u003e141.115.74.15 --generic-ssh-key ~/.ssh/id_rsa --generic-ssh-user\u003cspan class=\"o\"\u003e=\u003c/span\u003emvalais polatouche-docker-host\n\n\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e \u003cspan class=\"k\"\u003e$(\u003c/span\u003edocker-machine env polatouche-docker-host\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"tunneling\"\u003eTunneling\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003edocker-machine ssh default -L 0.0.0.0:8000:localhost:8000\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"namespaces-cgroups\"\u003eNamespaces, cgroups\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003enamespaces\u003c/li\u003e\n\u003cli\u003ecgroup (systemd-cgls)\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"commands\"\u003eCommands\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003edocker run --rm -it ubuntu\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-i\u003c/code\u003e means interactive (stdin will be attached)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-t\u003c/code\u003e (\u003ccode\u003e--tty\u003c/code\u003e) means that this is a pseudo-tty terminal instead of a non-tty (for example, without tty, bash has no prompt; with a tty, it gives a nice prompt such as \u003ccode\u003ebash-4.4#\u003c/code\u003e).\u003c/li\u003e\n\u003c/ul\u003e\n","date":1536796800,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1536796800,"objectID":"a19dd36092f8f3db00ccaa6a6e46e03c","permalink":"https://maelvls.dev/notes/docker/","publishdate":"2018-09-13T00:00:00Z","readingtime":1,"relpermalink":"/notes/docker/","section":"notes","summary":"Use docker-machine for remoting docker docker-machine create --driver generic --generic-ip-address=141.115.74.15 --generic-ssh-key ~/.ssh/id_rsa --generic-ssh-user=mvalais polatouche-docker-host eval $(docker-machine env polatouche-docker-host) Tunneling docker-machine ssh default -L 0.0.0.0:8000:localhost:8000 Namespaces, cgroups  namespaces cgroup (systemd-cgls)  Commands docker run --rm -it ubuntu  -i means interactive (stdin will be attached) -t (--tty) means that this is a pseudo-tty terminal instead of a non-tty (for example, without tty, bash has no prompt; with a tty, it gives a nice prompt such as bash-4.","tags":[],"title":"Remote Docker using docker-machine","type":"notes","url":"https://maelvls.dev/notes/docker/","weight":0,"wordcount":74},{"authors":null,"categories":null,"content":"\u003cp\u003eFrom \u003ca href=\"https://docs.gitlab.com/runner/install/linux-manually.html\"\u003ehttps://docs.gitlab.com/runner/install/linux-manually.html\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003esudo wget -O /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64\nsudo chmod +x /usr/local/bin/gitlab-runner\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1531094400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1531094400,"objectID":"e57940345774c451d7b0828a857b9821","permalink":"https://maelvls.dev/notes/gitlab/","publishdate":"2018-07-09T00:00:00Z","readingtime":1,"relpermalink":"/notes/gitlab/","section":"notes","summary":"From https://docs.gitlab.com/runner/install/linux-manually.html\nsudo wget -O /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64 sudo chmod +x /usr/local/bin/gitlab-runner ","tags":[],"title":"Run the test suite of the Gitlab projet","type":"notes","url":"https://maelvls.dev/notes/gitlab/","weight":0,"wordcount":11},{"authors":null,"categories":null,"content":"\u003cp\u003eOn macOS, install msmtp:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ebrew install mutt msmtp\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI read this thread: \u003ca href=\"https://www.engadget.com/2010/05/04/msmtp-a-free-tool-to-send-email-from-terminal/\"\u003ehttps://www.engadget.com/2010/05/04/msmtp-a-free-tool-to-send-email-from-terminal/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIn order to use msmtp from command-line \u0026lsquo;mail\u0026rsquo;\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eadd to \u003ccode\u003e~/.mailrc\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003eset sendmail=/usr/local/bin/msmtp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIn Keychain Access.app, go to File \u0026gt; New Password Item (Cmd+N) and fill it with\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e    smtp://smtp.gmail.com\n    email@gmail.com\n    mypassword\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIn Keychain Access.app, select System Roots, select all certificates and File \u0026gt; Export Items (Shift+Cmd+E) \u0026gt; Privacy Enhanced Mail (.pem) and save it as \u0026lsquo;Certificates.pem\u0026rsquo; in your $HOME.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTest the configuration with\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Hello world\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e mail -s \u003cspan class=\"s2\"\u003e\u0026#34;msmtp test at `date`\u0026#34;\u003c/span\u003e cheprugeph@qwfox.com\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eTroubleshooting:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eCheck in keychain Access.app that there is only ONE Internet password using the \u003ca href=\"mailto:email@gmail.com\"\u003eemail@gmail.com\u003c/a\u003e and smtp://smtp.gmail.com.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf the SMTP of Google says that you should go to some adress, with the error:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esend-mail: server message: 534-5.7.14 \u0026lt;https://accounts.google.com/signin/continue?sarp=1\u0026amp;scc=1\u0026amp;plt=AKgnsbtk\nsend-mail: server message: 534-5.7.14 z36uL0SoqtWkRHK4lg9Q60tKoOB5B_vNgRZ04wP0SbjkVSvkI3ByYM3aNcsUhrxrskG2Vf\nsend-mail: server message: 534-5.7.14 DEQUXboD5d_Px9ehRUYcaOhSdjo2hgTeUvPFDt7PuYRIZTv9CZ8RSybOQ84OAZAPNkbqhd\nsend-mail: server message: 534-5.7.14 LWOrMuYScmxwWyjg9PsUoUal67TvV2TYMyM9L_9-KcSyp5aZ-SRDH45cKU1vjGMdi7g7yn\nsend-mail: server message: 534-5.7.14 OARlP4_M6aIDqqDF2vbvirlleKMQs\u0026gt; Please log in via your web browser and\nsend-mail: server message: 534-5.7.14 then try again.\nsend-mail: server message: 534-5.7.14  Learn more at\nsend-mail: server message: 534 5.7.14  https://support.google.com/mail/answer/78754 m62sm13851787wmi.19 - gsmtp\nsend-mail: could not send mail (account default from /Users/mvalais/.msmtprc)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ethen you need to go to \u003ca href=\"https://accounts.google.com/b/0/DisplayUnlockCaptcha\"\u003ehttps://accounts.google.com/b/0/DisplayUnlockCaptcha\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"set-up-mutt\"\u003eSet up Mutt\u003c/h2\u003e\n\u003cp\u003eI followed the instructions of \u003ca href=\"https://gist.github.com/chrismytton/3976435\"\u003ehttps://gist.github.com/chrismytton/3976435\u003c/a\u003e except for the keychain stuff:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eWe are going to re-use the Keychain thing we created earlier. In order to show the password, use\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003esecurity find-internet-password -s smtp.gmail.com -a email@gmail.com -w\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ewhere \u0026lsquo;-w\u0026rsquo; tells him to only show the password, \u0026lsquo;-s\u0026rsquo; means server (in my case I had used \u0026lsquo;smtp://smtp.gmail.com\u0026rsquo; but you must remove the protocol smtp://) and \u0026lsquo;-a\u0026rsquo; means account.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n","date":1530316800,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":300,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1530316800,"objectID":"2f978526feaec6c2b51998c6535b6b5e","permalink":"https://maelvls.dev/notes/msmtp_mutt/","publishdate":"2018-06-30T00:00:00Z","readingtime":2,"relpermalink":"/notes/msmtp_mutt/","section":"notes","summary":"On macOS, install msmtp:\nbrew install mutt msmtp  I read this thread: https://www.engadget.com/2010/05/04/msmtp-a-free-tool-to-send-email-from-terminal/\nIn order to use msmtp from command-line \u0026lsquo;mail\u0026rsquo;\n  add to ~/.mailrc:\nset sendmail=/usr/local/bin/msmtp   In Keychain Access.app, go to File \u0026gt; New Password Item (Cmd+N) and fill it with\nsmtp://smtp.gmail.com email@gmail.com mypassword   In Keychain Access.app, select System Roots, select all certificates and File \u0026gt; Export Items (Shift+Cmd+E) \u0026gt; Privacy Enhanced Mail (.","tags":[],"title":"Using mutt and msmtp with Gmail","type":"notes","url":"https://maelvls.dev/notes/msmtp_mutt/","weight":0,"wordcount":261},{"authors":null,"categories":null,"content":"\u003ch2 id=\"how-is-a-tcp-connection-uniquely-identified\"\u003eHow is a TCP connection uniquely identified\u003c/h2\u003e\n\u003cp\u003eKill a process that is using a TCP port you need:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003elsof -n -i :8001\n\u003cspan class=\"c1\"\u003e# copy PID\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ekill\u003c/span\u003e \u003cspan class=\"m\"\u003e43903\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA TCP connection is identified by four things:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esource port\u003c/li\u003e\n\u003cli\u003esource ip\u003c/li\u003e\n\u003cli\u003edest port\u003c/li\u003e\n\u003cli\u003edest ip\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis is why there is no confusion between two requests to a web server on 80 port.\u003c/p\u003e\n\u003ch2 id=\"stateful-vs-stateless-firewall\"\u003eStateful vs. Stateless Firewall\u003c/h2\u003e\n\u003cp\u003eThis only applies to appliances in between two computers, for example a router using some kind of firewall. Is it???? Is it only for NATs or gateways?\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e    A -----\u0026gt; Router -----\u0026gt; B\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIf the router manages connection in a stateful way, here is what is going to happen:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eA connects to B via a TCP connection identified by IP_A:PORT_A + IP_B:PORT_B\u003c/li\u003e\n\u003cli\u003eRouter remembers the source port of A so that when B sends things back, it can\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eReferences:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUsing linux iptables to implement a stateless packet filtering firewall: \u003ca href=\"https://security.stackexchange.com/questions/74529\"\u003ehttps://security.stackexchange.com/questions/74529\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eExample:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e-A INPUT -p tcp -s 192.168.1.0/24 -m tcp --dport 80 -j ACCEPT\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-A CHAIN RULE\u003c/code\u003e tells iptables to append this RULE at the end of this CHAIN. A chain is identified by a name such as INPUT or OUTPUT.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-p TCP\u003c/code\u003e means protocol\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-s\u003c/code\u003e is the source. Here, 192.168.1.0/24 means any IP adress that matches with \u003ccode\u003e192.*.*.*\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-m TCP\u003c/code\u003e is for extensions (see \u003ccode\u003eman iptables-extensions\u003c/code\u003e) but I didn\u0026rsquo;t find it\u0026hellip;\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e--dport 80\u003c/code\u003e means the destination port must be 80\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-j ACCEPT\u003c/code\u003e means that the target is the action \u0026ldquo;ACCEPT\u0026rdquo;\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eQUESTIONS: what is the link between protocol and state?\u003c/p\u003e\n\u003ch2 id=\"sg-vs-acls\"\u003eSG vs. ACLs\u003c/h2\u003e\n\u003cp\u003eSecurity Groups = stateful firewall at the VM level (= iptables) Access Control Lists = stateless firewall at the VPC level.\u003c/p\u003e\n\u003ch2 id=\"protocol-stack\"\u003eProtocol stack\u003c/h2\u003e\n\u003cp\u003eThe protocol stack is the piece of software that implements (among others) the TCP/IP layers. A socket is the internal representation of an instance of this TCP stack. A socket is identified with a number (file descriptor in Unix terms).\u003c/p\u003e\n\u003cp\u003eTCP connection = 2 sockets = from(ip:port) + to(ip:port) TCP socket = internal representation of the \u0026lsquo;from\u0026rsquo; (ip:port)\u003c/p\u003e\n\u003ch2 id=\"the-stack\"\u003eThe stack\u003c/h2\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eOSI\u003c/th\u003e\n\u003cth\u003eLv\u003c/th\u003e\n\u003cth\u003eTCP/IP\u003c/th\u003e\n\u003cth\u003eKeywords\u003c/th\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eApplica\u003c/td\u003e\n\u003ctd\u003eL7\u003c/td\u003e\n\u003ctd\u003eHTTPS\u003c/td\u003e\n\u003ctd\u003eLB\u003c/td\u003e\n\u003ctd\u003eDeserialized\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ePresent\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eHTTPS\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eSerialized\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eSession\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eHTTPS\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eTranspo\u003c/td\u003e\n\u003ctd\u003eL4\u003c/td\u003e\n\u003ctd\u003eTCP,ICMP\u003c/td\u003e\n\u003ctd\u003eFirewall\u003c/td\u003e\n\u003ctd\u003eSegments\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eNetwork\u003c/td\u003e\n\u003ctd\u003eL3\u003c/td\u003e\n\u003ctd\u003eIP\u003c/td\u003e\n\u003ctd\u003eRouter\u003c/td\u003e\n\u003ctd\u003ePackets\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eLink\u003c/td\u003e\n\u003ctd\u003eL2\u003c/td\u003e\n\u003ctd\u003eMAC, ARP\u003c/td\u003e\n\u003ctd\u003eVLAN, Switch\u003c/td\u003e\n\u003ctd\u003eFrames\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ePhysic\u003c/td\u003e\n\u003ctd\u003eL1\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eBits\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eWarning: HTTP/1.1 and such have intertwined L5, L6 and L7 responsabilities. As an example, HTTP/1.1 carries headers that can be thought of of application data, but the payload (data) also spans over L6 (presentation using json for example). Session is also part of HTTP/1.1.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eL5-L6-L7 (application) protocols\u003c/strong\u003e = HTTP/1.1, HTTP/2, WebSockets\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eL6 serialization formats\u003c/strong\u003e = protobuf, json, avro, xml\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eVLAN\u003c/strong\u003e = just like the good\u0026rsquo;old ethernet between multiple equipments. Switches aliviates some of the issues with the one-cable-for-multiple-pc with a table (forwarding table, NOT an ARP table) that allows a one-to-one link with less noise on each link overall.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eTCP\u003c/strong\u003e = handles loss of packets using ACKs and SYN with sequence numbers. SYN = please open a connection. ACK = acknowledge.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSegments vs packets\u003c/strong\u003e = ??\u003c/p\u003e\n\u003cp\u003egRPC\u003c/p\u003e\n\u003ch2 id=\"cidr-network-masks-subnets\"\u003eCIDR, network masks, subnets\u003c/h2\u003e\n\u003cp\u003e10.0.2.3/16 = 16 first bits (10.0) for subnet.\u003c/p\u003e\n\u003cp\u003eThe idea of subnets: inside of a subnet, we pretty much share the same VLAN. For example, let\u0026rsquo;s say that we have two subnets A and B.\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003eSubnet A\u003c/th\u003e\n\u003cth\u003eSubnet B\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eCIDR\u003c/td\u003e\n\u003ctd\u003e10.0.1.0/24\u003c/td\u003e\n\u003ctd\u003e10.0.2.0/24\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eCount\u003c/td\u003e\n\u003ctd\u003e254\u003c/td\u003e\n\u003ctd\u003e254\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eVLAN\u003c/td\u003e\n\u003ctd\u003eVLAN1\u003c/td\u003e\n\u003ctd\u003eVLAN2\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"link-between-subnet-l3-and-vlan-l2\"\u003eLink between Subnet (L3) and VLAN (L2)\u003c/h3\u003e\n\u003cp\u003eFirst, let us remember that every machine in a VLAN can communicate with each other at any time. Now, we want to control what goes from/to A and B.\u003c/p\u003e\n\u003cp\u003eIn a VLAN, everything sees everything but it\u0026rsquo;s now really helpful unless we can use protocols like TCP. But TCP needs IPs. And IPs\u003c/p\u003e\n\u003cp\u003eA1 (10.0.1.7) \u0026mdash;-\u0026gt; A2 (10.0.1.13) Same subnet, ARP table says I know the MAC address so no need to route.\u003c/p\u003e\n\u003cp\u003eThe subnet allows a machine to know what is \u0026lsquo;internal\u0026rsquo; traffic and what is routed traffic.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA1 \u0026mdash;\u0026ndash;\u0026gt; IP inside subnet = A1 asks which MAC has this IP using ARP.\u003c/li\u003e\n\u003cli\u003eA1 \u0026mdash;\u0026ndash;\u0026gt; IP outside subnet = NAT to the gateway (= a router). See \u0026lsquo;Routing\u0026rsquo;.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"routing\"\u003eRouting\u003c/h2\u003e\n\u003cp\u003eThe gateway has routing tables such as\u003c/p\u003e\n\u003ch2 id=\"aws-terms\"\u003eAWS terms\u003c/h2\u003e\n\u003cp\u003eIGW = internet gateway VPC = virtual private cloud. ne VPC is equivalent to a VLAN: everyone can talk to everyone on L2 (MAC level).\u003c/p\u003e\n\u003cp\u003eThe routing in a VPC:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eeach subnet has an ACL (network access control list)\u003c/li\u003e\n\u003cli\u003eeach EC2 has security groups (L4 stateful firewall)\u003c/li\u003e\n\u003c/ul\u003e\n","date":1518998400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":800,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1518998400,"objectID":"a7e4dfe6e9e4163afc22a9e404b49230","permalink":"https://maelvls.dev/notes/tcp_ports/","publishdate":"2018-02-19T00:00:00Z","readingtime":4,"relpermalink":"/notes/tcp_ports/","section":"notes","summary":"How is a TCP connection uniquely identified Kill a process that is using a TCP port you need:\nlsof -n -i :8001 # copy PID kill 43903 A TCP connection is identified by four things:\n source port source ip dest port dest ip  This is why there is no confusion between two requests to a web server on 80 port.\nStateful vs. Stateless Firewall This only applies to appliances in between two computers, for example a router using some kind of firewall.","tags":[],"title":"Everything I know about TCP","type":"notes","url":"https://maelvls.dev/notes/tcp_ports/","weight":0,"wordcount":734},{"authors":null,"categories":null,"content":"\u003cp\u003eMany times, I used \u003ccode\u003egit reset --hard\u003c/code\u003e and found out later that all my changes had disappeared. I think this is because I do not fully understand what \u003ccode\u003egit reset --hard\u003c/code\u003e does:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003emove the branch ref pointer to the given reference\u003c/li\u003e\n\u003cli\u003eset HEAD to this ref\u003c/li\u003e\n\u003cli\u003eDepending on the option:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e\u0026ndash;soft: working dir and stage are not touched, useful when \u003ccode\u003egit reset --hard HEAD^\u003c/code\u003e to change the content of the commit without having to re-add everything\u003c/li\u003e\n\u003cli\u003e\u0026ndash;mixed: working dir is not touched, but the stage is set to match the HEAD\u003c/li\u003e\n\u003cli\u003e\u0026ndash;hard: stage + working dir are set to match the HEAD\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOn the other side, \u003ccode\u003egit stash\u003c/code\u003e will set stage + working dir to match the HEAD.\u003c/p\u003e\n\u003cp\u003eSo instead of \u003ccode\u003egit reset --hard REF\u003c/code\u003e I should rather do \u003ccode\u003egit stash \u0026amp;\u0026amp; git reset --hard REF\u003c/code\u003e. This would avoid cases where I forgot that I had made changes\u0026hellip; and end up losing them all.\u003c/p\u003e\n\u003cp\u003eIDEAS ON NEW COMMANDS\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eI often have committed something like @~0: edit touist.rb @~1: edit .travis.yml\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI want to add a command like \u003ccode\u003egit ci --amend~2\u003c/code\u003e that would amend the commit in @~1, not the HEAD. Here is what I must do:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003evim .travis.yml\ngit stash\ngit rb -i @^^ # edit HEAD^\ngit stash pop\ngit add .travis.yml\ngit ci --amend\ngit rb --continue\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFacebook\u0026rsquo;s hg extensions have \u0026lsquo;absorb\u0026rsquo; which does this but on @~1, @~2\u0026hellip; and chooses automatically in which commit it should be amended. See:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/24625411/amend-the-second-to-last-commit\"\u003ehttps://stackoverflow.com/questions/24625411/amend-the-second-to-last-commit\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.filippo.io/git-fixup-amending-an-older-commit/\"\u003ehttps://blog.filippo.io/git-fixup-amending-an-older-commit/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","date":1513728000,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":300,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1513728000,"objectID":"476b11704873e86df7c94d7ca643689e","permalink":"https://maelvls.dev/notes/git/","publishdate":"2017-12-20T00:00:00Z","readingtime":2,"relpermalink":"/notes/git/","section":"notes","summary":"Many times, I used git reset --hard and found out later that all my changes had disappeared. I think this is because I do not fully understand what git reset --hard does:\n move the branch ref pointer to the given reference set HEAD to this ref Depending on the option:   \u0026ndash;soft: working dir and stage are not touched, useful when git reset --hard HEAD^ to change the content of the commit without having to re-add everything \u0026ndash;mixed: working dir is not touched, but the stage is set to match the HEAD \u0026ndash;hard: stage + working dir are set to match the HEAD  On the other side, git stash will set stage + working dir to match the HEAD.","tags":[],"title":"git stash vs. git reset --hard","type":"notes","url":"https://maelvls.dev/notes/git/","weight":0,"wordcount":244},{"authors":null,"categories":null,"content":"\u003col\u003e\n\u003cli\u003e\u003ca href=\"#sign-my-message\"\u003eSign my message\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#things-on-securiry\"\u003eThings on securiry\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#public-key-protocol-is-slow\"\u003ePublic-key protocol is slow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#errors-i-got\"\u003eErrors I got\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eTo list the keys I have in my keyring, use \u003ccode\u003egpg --list-key\u003c/code\u003e. Here, I can see one public key in the file \u003ccode\u003epubring.pgp\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e\u0026gt; gpg --list-key\n/Users/mvalais/.gnupg/pubring.gpg\n-------------------------------\npub   4096R/27F4C016 2016-03-04\nuid                  Maël Valais \u0026lt;mael.valais@gmail.com\u0026gt;\nsub   4096R/A3D4828E 2016-03-04\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe identifier for my public key is \u003ccode\u003e27F4C016\u003c/code\u003e and the sub identifier \u003ccode\u003eA3D4828E\u003c/code\u003e. 4096R = 4096-bits RSA encrypted.\u003c/p\u003e\n\u003cp\u003eWhen seeing the whole primary key fingerprint:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003eF105 E235 8FEB FC3D A4A4 9499 0075 8A3D 27F4 C016\n                                        ^^^^^^^^^\n                                        identifier\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTo export my public key to the keys server:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e\u0026gt; gpg --send-keys 27F4C016\ngpg: envoi de la clef 27F4C016 au serveur hkp keys.gnupg.net\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eCheck that my public key has been pushed to the keys server:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003e\u0026gt; gpg --search-keys \u0026#34;mael.valais@gmail.com\u0026#34;\ngpg: recherche de « mael.valais@gmail.com » sur le serveur hkp\nkeys.gnupg.net\n(1) Maël Valais \u0026lt;mael.valais@gmail.com\u0026gt;\nTo  4096 bit RSA key 27F4C016, créé : 2016-03-04\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"sign-my-message\"\u003eSign my message\u003c/h2\u003e\n\u003cp\u003eSay I have writen the message in \u003ccode\u003emessage.txt\u003c/code\u003e. Now I want to sign it and I want the signature to be in ASCII-format \u003ccode\u003e.asc\u003c/code\u003e (not a binary mess \u003ccode\u003e.sig\u003c/code\u003e).\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egpg2 --armor --detach-sign message.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis signature will be in text format in \u003ccode\u003emessage.asc\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"things-on-securiry\"\u003eThings on securiry\u003c/h2\u003e\n\u003cp\u003eencrypt: AES 256 (symetric) salting: hash(pwd+salt), salt is dynamically generated key derivation: PBKDF2 hash: MD5, SHA-1, SHA-256\u003c/p\u003e\n\u003ch2 id=\"public-key-protocol-is-slow\"\u003ePublic-key protocol is slow\u003c/h2\u003e\n\u003cp\u003eWith gpg, the public-key protocol is only used for encrypting the symmetric key and the hash of the message (hash with SHA-256). The message is then encrypted using the symmetric encryption.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003egpg:\n    rsa public key ---encrypts--\u0026gt; symmetric key --encrpyts--\u0026gt; message\n                   ---encrypts--\u0026gt; SHA-256 hash\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWith SSL protocol, the only purpose of the public-key encryption is to encrypt the AES symmetric key.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003essl:\n    \u0026lt;---client---\u0026gt;             \u0026lt;-----server----\u0026gt;\n    rsa public key ---sends--\u0026gt; AES symmetric key\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhat about ssh? Two pairs of pub/priv keys?\u003c/p\u003e\n\u003ch2 id=\"errors-i-got\"\u003eErrors I got\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eError message with pinentry\n\u003col\u003e\n\u003cli\u003eInstall \u003ccode\u003ebrew install pinentry-mac\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eedit ~/.gnupg/gpg-agent.conf to use pinentry-mac instead of pinentry: pinentry-program /usr/local/bin/pinentry-mac\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","date":1510099200,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":400,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1510099200,"objectID":"8b3190c9e782dbefa1105dbaa66d7ffe","permalink":"https://maelvls.dev/notes/pgp/","publishdate":"2017-11-08T00:00:00Z","readingtime":2,"relpermalink":"/notes/pgp/","section":"notes","summary":"Sign my message Things on securiry Public-key protocol is slow Errors I got  To list the keys I have in my keyring, use gpg --list-key. Here, I can see one public key in the file pubring.pgp:\n\u0026gt; gpg --list-key /Users/mvalais/.gnupg/pubring.gpg ------------------------------- pub 4096R/27F4C016 2016-03-04 uid Maël Valais \u0026lt;mael.valais@gmail.com\u0026gt; sub 4096R/A3D4828E 2016-03-04 The identifier for my public key is 27F4C016 and the sub identifier A3D4828E. 4096R = 4096-bits RSA encrypted.","tags":[],"title":"Some stuff about gpg","type":"notes","url":"https://maelvls.dev/notes/pgp/","weight":0,"wordcount":319},{"authors":null,"categories":null,"content":"\u003cp\u003eThe Epson iPrint soft is producing PDFs in 300dpi but the 300 information does not seem to be stored in the PDF metadata; thus, the PDF reader thinks by default that it is a 72 dpi PDF and thus the huge size:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e87,49 × 123,72 cm\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003einstead of an A4 paper:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e21 × 29,7 cm\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo convert this 300 dpi into a real 300 dpi:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egs -sDEVICE=pdfwrite -dCompatibilityLevel=1.4 -dPDFSETTINGS=/ebook -dNOPAUSE -dQUIET -dBATCH -dDetectDuplicateImages -dCompressFonts=true -sPAPERSIZE=a4 -dPDFFitPage -sOutputFile=output.pdf input.pdf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e/screen selects low-resolution output similar to the Acrobat Distiller (up to version X) \u0026ldquo;Screen Optimized\u0026rdquo; setting.\u003c/li\u003e\n\u003cli\u003e/ebook selects medium-resolution output similar to the Acrobat Distiller (up to version X) \u0026ldquo;eBook\u0026rdquo; setting.\u003c/li\u003e\n\u003cli\u003e/printer selects output similar to the Acrobat Distiller \u0026ldquo;Print Optimized\u0026rdquo; (up to version X) setting.\u003c/li\u003e\n\u003cli\u003e/prepress selects output similar to Acrobat Distiller \u0026ldquo;Prepress Optimized\u0026rdquo; (up to version X) setting.\u003c/li\u003e\n\u003cli\u003e/default selects output intended to be useful across a wide variety of uses, possibly at the expense of a larger output file.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSee:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eopen /usr/local/share/ghostscript/9.22/doc/index.html\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003cpre\u003e\u003ccode\u003e(WORKS BUT BIGGER SIZE AFTERWARDS)\nconvert -units PixelsPerInch -density 300 filein.pdf fileout.pdf\nconvert -units PixelsPerInch EPSON004.pdf -density 300 -quality 30 -compress jpeg fileout.pdf\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"color-to-grayscale\"\u003eColor to grayscale\u003c/h2\u003e\n\u003cp\u003eFrom: \u003ca href=\"https://superuser.com/questions/104656/convert-a-pdf-to-greyscale-on-the-command-line-in-floss\"\u003ehttps://superuser.com/questions/104656/convert-a-pdf-to-greyscale-on-the-command-line-in-floss\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"nb\"\u003eread\u003c/span\u003e i\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n    gs -sDEVICE\u003cspan class=\"o\"\u003e=\u003c/span\u003epdfwrite -sColorConversionStrategy\u003cspan class=\"o\"\u003e=\u003c/span\u003eGray -dProcessColorModel\u003cspan class=\"o\"\u003e=\u003c/span\u003e/DeviceGray -dCompatibilityLevel\u003cspan class=\"o\"\u003e=\u003c/span\u003e1.4 -dNOPAUSE -dBATCH -sOutputFile\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e/.pdf/_gray.pdf\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;some.pdf\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUsing ImageMagick (mogrify):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003emogrify -despeckle -fuzz 5% -fill white -opaque white -gamma 0.8 -colorspace gray -depth \u003cspan class=\"m\"\u003e6\u003c/span\u003e -format png \u003cspan class=\"se\"\u003e\\*\u003c/span\u003e.jpg\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ocr\"\u003eOCR\u003c/h2\u003e\n\u003ch2 id=\"to-black-and-white\"\u003eTo black and white\u003c/h2\u003e\n\u003cp\u003eA SO link talking about that: \u003ca href=\"https://stackoverflow.com/questions/15211428/conversion-of-tiff-to-pdf-with-ghostscript\"\u003ehttps://stackoverflow.com/questions/15211428/conversion-of-tiff-to-pdf-with-ghostscript\u003c/a\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003egs -dQUIET -dNOPAUSE -r200 -dBATCH -sPAPERSIZE\u003cspan class=\"o\"\u003e=\u003c/span\u003ea4 -sDEVICE\u003cspan class=\"o\"\u003e=\u003c/span\u003etiffg3 -sOutputFile\u003cspan class=\"o\"\u003e=\u003c/span\u003etemp.tiff -sColorConversionStrategy\u003cspan class=\"o\"\u003e=\u003c/span\u003eMono -sColorConversionStrategyForImages\u003cspan class=\"o\"\u003e=\u003c/span\u003e/Mono -dProcessColorModel\u003cspan class=\"o\"\u003e=\u003c/span\u003e/DeviceGray \u003cspan class=\"s2\"\u003e\u0026#34;a.pdf\u0026#34;\u003c/span\u003e\ntiff2pdf -o out.pdf -p A4 -F temp.tiff\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOr:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003epdfimages -j \u003cspan class=\"s2\"\u003e\u0026#34;some.pdf\u0026#34;\u003c/span\u003e out/\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e out/\nmogrify -despeckle -fuzz 5% -fill white -opaque white -gamma 0.8 -colorspace gray -depth \u003cspan class=\"m\"\u003e6\u003c/span\u003e -format png \u003cspan class=\"se\"\u003e\\*\u003c/span\u003e.jpg\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"remove-noise-created-by-scanning-text-in-jpeg\"\u003eRemove noise created by scanning text in JPEG\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003epdfimages -j \u003cspan class=\"s2\"\u003e\u0026#34;some.pdf\u0026#34;\u003c/span\u003e out/\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e out/\nmogrify -despeckle -fuzz 5% -fill white -opaque white -gamma 0.8 -colorspace gray -depth \u003cspan class=\"m\"\u003e6\u003c/span\u003e -format png *.jpg\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1505174400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":400,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1505174400,"objectID":"ee4123539c87b72e5875a0b65a98410b","permalink":"https://maelvls.dev/notes/pdf/","publishdate":"2017-09-12T00:00:00Z","readingtime":2,"relpermalink":"/notes/pdf/","section":"notes","summary":"The Epson iPrint soft is producing PDFs in 300dpi but the 300 information does not seem to be stored in the PDF metadata; thus, the PDF reader thinks by default that it is a 72 dpi PDF and thus the huge size:\n87,49 × 123,72 cm  instead of an A4 paper:\n21 × 29,7 cm  To convert this 300 dpi into a real 300 dpi:\ngs -sDEVICE=pdfwrite -dCompatibilityLevel=1.4 -dPDFSETTINGS=/ebook -dNOPAUSE -dQUIET -dBATCH -dDetectDuplicateImages -dCompressFonts=true -sPAPERSIZE=a4 -dPDFFitPage -sOutputFile=output.","tags":[],"title":"Epson scanner, large PDFs and ImageMagick (convert CLI)","type":"notes","url":"https://maelvls.dev/notes/pdf/","weight":0,"wordcount":313},{"authors":null,"categories":null,"content":"\u003cp\u003eHere: \u003ca href=\"https://unix.stackexchange.com/questions/12195/how-to-avoid-being-asked-passphrase-each-time-i-push-to-bitbucket\"\u003ehttps://unix.stackexchange.com/questions/12195/how-to-avoid-being-asked-passphrase-each-time-i-push-to-bitbucket\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eTwo solutions:\u003c/p\u003e\n\u003ch2 id=\"using-ssh-agent\"\u003eUsing ssh-agent\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003eeval $(ssh-agent)\nssh-add\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"using-keychain-debianubuntu\"\u003eUsing keychain (debian/ubuntu)\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003eapt-get install keychain\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"using-forwardagent-yes-in-sshconfig\"\u003eUsing \u0026lsquo;ForwardAgent yes\u0026rsquo; in .ssh/config\u003c/h2\u003e\n\u003cp\u003eHere: \u003ca href=\"https://developer.github.com/v3/guides/using-ssh-agent-forwarding\"\u003ehttps://developer.github.com/v3/guides/using-ssh-agent-forwarding\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf it doesn\u0026rsquo;t work at first, check that the key ~/.ssh/id_rsa is added to ssh-agent, i.e., ssh-add has been run. To avoid re-typing \u0026lsquo;ssh-add\u0026rsquo; and password on every startup, run:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003essh-add -K id_rsa\n\u003c/code\u003e\u003c/pre\u003e\n","date":1496275200,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1496275200,"objectID":"a628e4eb87da3a98ad5e3b0d1eab1556","permalink":"https://maelvls.dev/notes/ssh-agent/","publishdate":"2017-06-01T00:00:00Z","readingtime":1,"relpermalink":"/notes/ssh-agent/","section":"notes","summary":"Here: https://unix.stackexchange.com/questions/12195/how-to-avoid-being-asked-passphrase-each-time-i-push-to-bitbucket\nTwo solutions:\nUsing ssh-agent eval $(ssh-agent) ssh-add  Using keychain (debian/ubuntu) apt-get install keychain  Using \u0026lsquo;ForwardAgent yes\u0026rsquo; in .ssh/config Here: https://developer.github.com/v3/guides/using-ssh-agent-forwarding\nIf it doesn\u0026rsquo;t work at first, check that the key ~/.ssh/id_rsa is added to ssh-agent, i.e., ssh-add has been run. To avoid re-typing \u0026lsquo;ssh-add\u0026rsquo; and password on every startup, run:\nssh-add -K id_rsa  ","tags":[],"title":"Avoid typing the SSH passphrase on Ubuntu using ssh-agent","type":"notes","url":"https://maelvls.dev/notes/ssh-agent/","weight":0,"wordcount":55},{"authors":null,"categories":null,"content":"\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003etlmgr install texliveonfly\ntexliveonfly main.tex\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ewill install automatically all packages called using \u003ccode\u003e\\usepackage{}\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eTo find a specific file that latex yells it cannot find:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003etlmgr search --global --file fullpage.sty\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1495670400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1495670400,"objectID":"9dc5d8b9caa612c67fff544c82759203","permalink":"https://maelvls.dev/notes/latex_packages/","publishdate":"2017-05-25T00:00:00Z","readingtime":1,"relpermalink":"/notes/latex_packages/","section":"notes","summary":"tlmgr install texliveonfly texliveonfly main.tex will install automatically all packages called using \\usepackage{}\nTo find a specific file that latex yells it cannot find:\ntlmgr search --global --file fullpage.sty ","tags":[],"title":"Managing Basic Texlive instead of Full Texlive/Mactex","type":"notes","url":"https://maelvls.dev/notes/latex_packages/","weight":0,"wordcount":29},{"authors":null,"categories":null,"content":"\u003cp\u003eToken server at IRIT:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ematlab -nodecktop -nodisplay -c 27000@licence.irit.fr\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eor\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eSERVER licence.irit.fr 0050568A1251 27000\nUSE_SERVER\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ein \u003ccode\u003e/Applications/MATLAB_R2016a.app/licenses/irit.lic\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eWhat toolbox can I access? \u003ccode\u003ever\u003c/code\u003e Know what licence file is used: \u003ccode\u003ematlab -e\u003c/code\u003e or \u003ccode\u003ematlab -n\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"which-licenses-at-irit\"\u003eWhich licenses at IRIT\u003c/h2\u003e\n\u003cp\u003econnecto to bali and do\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e /usr/local/matlab/etc/lmstat -a\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"on-cauchymathups-tlsefr\"\u003eOn cauchy.math.ups-tlse.fr\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e/opt/MATLABR2016a/toolbox/distcomp/bin\n\n./mdce start\n./admincenter\n./nodestatus\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"matlab-r2015a-hangs-at-startup\"\u003eMatlab R2015a hangs at startup\u003c/h2\u003e\n\u003cp\u003eEdit the shell script and go to line\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecd /Applications/MATLAB_R2015a.app/bin/\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI did a \u003ccode\u003ediff matlab matlab_patched\u003c/code\u003e; you can patch it:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003epatch matlab \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF\n\u003c/span\u003e\u003cspan class=\"s\"\u003e497c497\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026lt;     arglist=\u0026#34;\u0026#34;\n\u003c/span\u003e\u003cspan class=\"s\"\u003e---\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026gt;     arglist=\u0026#34;-c \\$MATLABdefault/licenses/license.lic\u0026#34;\n\u003c/span\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNote the \u003ccode\u003e\\$\u003c/code\u003e because of the shell treatment.\u003c/p\u003e\n","date":1489968000,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1489968000,"objectID":"58be2466af3e1e869d9c34292513e391","permalink":"https://maelvls.dev/notes/matlab/","publishdate":"2017-03-20T00:00:00Z","readingtime":1,"relpermalink":"/notes/matlab/","section":"notes","summary":"Token server at IRIT:\nmatlab -nodecktop -nodisplay -c 27000@licence.irit.fr  or\nSERVER licence.irit.fr 0050568A1251 27000 USE_SERVER  in /Applications/MATLAB_R2016a.app/licenses/irit.lic\nWhat toolbox can I access? ver Know what licence file is used: matlab -e or matlab -n\nWhich licenses at IRIT connecto to bali and do\n /usr/local/matlab/etc/lmstat -a  On cauchy.math.ups-tlse.fr /opt/MATLABR2016a/toolbox/distcomp/bin ./mdce start ./admincenter ./nodestatus  Matlab R2015a hangs at startup Edit the shell script and go to line","tags":[],"title":"Using Matlab at IRIT","type":"notes","url":"https://maelvls.dev/notes/matlab/","weight":0,"wordcount":97},{"authors":null,"categories":null,"content":"\u003ch2 id=\"warning-ignoring-because-its-extensions-are-not-built\"\u003eWarning \u0026lsquo;Ignoring\u0026hellip; because its extensions are not built\u0026rsquo;\u003c/h2\u003e\n\u003cp\u003eThe message is:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eIgnoring atomic-1.1.101 because its extensions are not built.  Try: gem pristine atomic --version 1.1.101\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTry:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egem 2\u0026gt;\u0026amp;1 | perl -ne '/Try: gem pristine ([^ ]+)/ \u0026amp;\u0026amp; print $1 . \u0026quot; \u0026quot;' | xargs gem pristine\n\u003c/code\u003e\u003c/pre\u003e\n","date":1486252800,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1486252800,"objectID":"08e6ef6c408ceae76a4bb98545aa917b","permalink":"https://maelvls.dev/notes/ruby/","publishdate":"2017-02-05T00:00:00Z","readingtime":1,"relpermalink":"/notes/ruby/","section":"notes","summary":"Warning \u0026lsquo;Ignoring\u0026hellip; because its extensions are not built\u0026rsquo; The message is:\nIgnoring atomic-1.1.101 because its extensions are not built. Try: gem pristine atomic --version 1.1.101  Try:\ngem 2\u0026gt;\u0026amp;1 | perl -ne '/Try: gem pristine ([^ ]+)/ \u0026amp;\u0026amp; print $1 . \u0026quot; \u0026quot;' | xargs gem pristine  ","tags":[],"title":"Stuff about managing Ruby \u0026 rvm","type":"notes","url":"https://maelvls.dev/notes/ruby/","weight":0,"wordcount":46},{"authors":null,"categories":null,"content":"\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003econvert -resample 72x72 -compress JPEG -quality \u003cspan class=\"m\"\u003e20\u003c/span\u003e a.jpg a.pdf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003econvert -resample 72x72 -compress JPEG -quality \u003cspan class=\"m\"\u003e20\u003c/span\u003e a.jpg a.pdf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWARNING: convert (imagemagick) often bugs as it uses external tools such as \u003ccode\u003egs\u003c/code\u003e and \u003ccode\u003effmpeg\u003c/code\u003e; reinstalling Ghostcript can help.\u003c/p\u003e\n","date":1485734400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1485734400,"objectID":"c6af5ab95da966d1303da6ff1cc8dbfe","permalink":"https://maelvls.dev/notes/lighter_pdfs/","publishdate":"2017-01-30T00:00:00Z","readingtime":1,"relpermalink":"/notes/lighter_pdfs/","section":"notes","summary":"convert -resample 72x72 -compress JPEG -quality 20 a.jpg a.pdf convert -resample 72x72 -compress JPEG -quality 20 a.jpg a.pdf WARNING: convert (imagemagick) often bugs as it uses external tools such as gs and ffmpeg; reinstalling Ghostcript can help.","tags":[],"title":"Get lighter PDFs","type":"notes","url":"https://maelvls.dev/notes/lighter_pdfs/","weight":0,"wordcount":37},{"authors":null,"categories":null,"content":"\u003cp\u003eOn the university server azteca or inca (must use vpn or sassh through-pass)\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexport http_proxy=proxy.univ-tlse3.fr:3128\nexport https_proxy=proxy.univ-tlse3.fr:3128\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen,\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eruby -e \u0026quot;$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install)\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut on linux with gcc-4.4.7 only, I had also to follow the instructions on \u003ca href=\"https://github.com/Linuxbrew/homebrew-core/issues/4077\"\u003ehttps://github.com/Linuxbrew/homebrew-core/issues/4077\u003c/a\u003e. It will\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003efirst install glibc 2.20\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003einstall gcc-5 and others\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethen upgrade to glibc 2.23\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003ebrew install --only-dependencies glibc\nbrew install --ignore-dependencies https://raw.githubusercontent.com/Linuxbrew/homebrew-core/6fb5dfd50895416bea3d00628b8d3b41fa1f4f32/Formula/glibc.rb \u003cspan class=\"c1\"\u003e# 2.20\u003c/span\u003e\nbrew install --ignore-dependencies xz gmp mpfr libmpc isl gcc\nbrew upgrade glibc\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThen I also got on the last \u003ccode\u003ebrew upgrade glibc\u003c/code\u003e an \u0026lsquo;Illegal instruction\u0026rsquo;; the issue is mentionned in\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Linuxbrew/legacy-linuxbrew/issues/173\"\u003ehttps://github.com/Linuxbrew/legacy-linuxbrew/issues/173\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Linuxbrew/homebrew-core/issues/4244\"\u003ehttps://github.com/Linuxbrew/homebrew-core/issues/4244\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e(gcc failing) \u003ca href=\"https://github.com/Linuxbrew/brew/issues/488\"\u003ehttps://github.com/Linuxbrew/brew/issues/488\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e(gmp 6.1.2 issue) \u003ca href=\"https://github.com/Linuxbrew/homebrew-core/issues/4261\"\u003ehttps://github.com/Linuxbrew/homebrew-core/issues/4261\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe error was:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-plain\" data-lang=\"plain\"\u003emake[2]: *** [/tmp/glibc-20170921-55100-dli0th/glibc-2.23/build/csu/elf-init.oS] Erreur 1\nlibc-tls.c: In function \u0026#39;__libc_setup_tls\u0026#39;:\nlibc-tls.c:105:1: internal compiler error: Illegal instruction\n __libc_setup_tls (size_t tcbsize, size_t tcbalign)\n ^\n../sysdeps/x86/libc-start.c: In function \u0026#39;__libc_start_main\u0026#39;:\n../sysdeps/x86/libc-start.c:20:0: internal compiler error: Illegal instruction\n # else\n ^\n../sysdeps/x86/libc-start.c: In function \u0026#39;apply_irel\u0026#39;:\n../sysdeps/x86/libc-start.c:40:1: internal compiler error: Illegal instruction\n }\n ^\n0x7f23a592972f ???\n    /tmp/glibc-20170921-64874-12af6ru/glibc-2.20/signal/../sysdeps/unix/sysv/linux/x86_64/sigaction.c:0\n0x7f23a59167cc __libc_start_main\n    /tmp/glibc-20170921-64874-12af6ru/glibc-2.20/csu/libc-start.c:289\nPlease submit a full bug report,\nwith preprocessed source if appropriate.\nPlease include the complete backtrace with any bug report.\nSee \u0026lt;https://github.com/Homebrew/homebrew/issues\u0026gt; for instructions.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTo install gmp 6.1.1:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ebrew install --ignore-dependencies https://raw.githubusercontent.com/Linuxbrew/homebrew-core/58cb0879c8b423ccf7a7cfd8641abc13da5a0753/Formula/gmp.rb\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo avoid \u0026lsquo;brew updating\u0026hellip;\u0026rsquo; all the time:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexport HOMEBREW_NO_AUTO_UPDATE=1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNOTE: to install on REHL 6.9 or CentOS6, just use the commands given by sjackman at \u003ca href=\"https://github.com/Linuxbrew/brew/wiki/CentOS6\"\u003ehttps://github.com/Linuxbrew/brew/wiki/CentOS6\u003c/a\u003e\u003c/p\u003e\n","date":1481760000,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":300,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1481760000,"objectID":"3d97682b546d747745551586fd802ec8","permalink":"https://maelvls.dev/notes/linuxbrew/","publishdate":"2016-12-15T00:00:00Z","readingtime":2,"relpermalink":"/notes/linuxbrew/","section":"notes","summary":"On the university server azteca or inca (must use vpn or sassh through-pass)\nexport http_proxy=proxy.univ-tlse3.fr:3128 export https_proxy=proxy.univ-tlse3.fr:3128  Then,\nruby -e \u0026quot;$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install)\u0026quot;  But on linux with gcc-4.4.7 only, I had also to follow the instructions on https://github.com/Linuxbrew/homebrew-core/issues/4077. It will\n  first install glibc 2.20\n  install gcc-5 and others\n  then upgrade to glibc 2.23\nbrew install --only-dependencies glibc brew install --ignore-dependencies https://raw.githubusercontent.com/Linuxbrew/homebrew-core/6fb5dfd50895416bea3d00628b8d3b41fa1f4f32/Formula/glibc.rb # 2.","tags":[],"title":"Using Linyxbrew on university servers","type":"notes","url":"https://maelvls.dev/notes/linuxbrew/","weight":0,"wordcount":215},{"authors":null,"categories":null,"content":"\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003eopen -a MacDown README.md    \u003cspan class=\"c1\"\u003e# open README.md in MacDown\u003c/span\u003e\nmdfind                       \u003cspan class=\"c1\"\u003e# spotlight\u003c/span\u003e\npbcopy                       \u003cspan class=\"c1\"\u003e# copy from stdin to pb\u003c/span\u003e\npbpaste                      \u003cspan class=\"c1\"\u003e# paste from pb\u003c/span\u003e\nkillall MacDown              \u003cspan class=\"c1\"\u003e# same as kill but with app name\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1476921600,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1476921600,"objectID":"966df6f0799812083648bd0aa168c0be","permalink":"https://maelvls.dev/notes/mac_commands/","publishdate":"2016-10-20T00:00:00Z","readingtime":1,"relpermalink":"/notes/mac_commands/","section":"notes","summary":"open -a MacDown README.md # open README.md in MacDown mdfind # spotlight pbcopy # copy from stdin to pb pbpaste # paste from pb killall MacDown # same as kill but with app name ","tags":[],"title":"Interesting macOS-specific commands","type":"notes","url":"https://maelvls.dev/notes/mac_commands/","weight":0,"wordcount":34},{"authors":null,"categories":null,"content":"\u003col\u003e\n\u003cli\u003e\u003ca href=\"#general-information\"\u003eGeneral information\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#sed\"\u003eSed\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#shell-terminal-console-command-line\"\u003eShell, terminal, console, command line\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#bash_profile-vs-bashrc\"\u003e\u003ccode\u003e.bash_profile\u003c/code\u003e vs \u003ccode\u003e.bashrc\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#tty-pty-interactive-vs-non-interactive\"\u003eTty, pty, interactive vs non-interactive\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#login-vs-non-login-shells\"\u003eLogin vs. non-login shells\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#use-bashrc-also-on-login-shell\"\u003eUse \u003ccode\u003ebashrc\u003c/code\u003e also on login shell\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#parallelize-xargs\"\u003eParallelize xargs\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#discrepencies-between-binsh-versions\"\u003eDiscrepencies between /bin/sh versions\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-information\"\u003eGeneral information\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eXargs for creating positionnals through stdin \u003ccode\u003eincluded_figures.sh | xargs git add\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAvoid the sub-shell problem when \u003ccode\u003ewhile read a\u003c/code\u003e \u003ccode\u003ewhile read a; do ...; done \u0026lt; \u0026lt;(ls)\u003c/code\u003e pour éviter d\u0026rsquo;avoir le while dans un sous-shell C.f. Process Substitution dans man bash\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eParameter Expansion (man bash -\u0026gt; /Parameter Expansion) \u003ccode\u003e${a:-text}\u003c/code\u003e if $a isn\u0026rsquo;t set, the${} expression returns \u0026ldquo;text\u0026rdquo; \u003ccode\u003e${a:+text}\u003c/code\u003e if $a isn\u0026rsquo;t set, the${} expression returns nothing \u003ccode\u003e${a:=text}\u003c/code\u003e same but $a is also set to \u0026ldquo;text\u0026rdquo; \u003ccode\u003e${a// /_/}\u003c/code\u003e substitutes all spaces to \u003ccode\u003e_\u003c/code\u003e in the content of a\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eiterate on each space-separated elements of a list for e in \u003ccode\u003eecho \u0026quot;a b c d e\u0026quot;\u003c/code\u003e; do echo $e done\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTo know if a variable is empty or not (\u003ccode\u003eman test\u003c/code\u003e): -n STRING the length of STRING is nonzero -z STRING the length of STRING is zero\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"sed\"\u003eSed\u003c/h2\u003e\n\u003cp\u003eSubstitute dots to \u003ccode\u003e_\u003c/code\u003e in filenames:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efor f in *; do mv \u0026quot;$f\u0026quot; \u0026quot;`echo $f | sed 's/\\(.*\\)\\.\\(.*\\)\\(\\.[a-z]*\\)$/\\1_\\2\\3/g'`\u0026quot;; done\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"shell-terminal-console-command-line\"\u003eShell, terminal, console, command line\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eTerminal text input/output environment (also means a specific file in Unix world) ttys001, ttys002\u0026hellip; are Unix \u0026ldquo;terminal\u0026rdquo; files. These are provided by the kernel\u003c/li\u003e\n\u003cli\u003eVirtual/emulated terminal layer over the plain Unix terminal (iTerm2, etc)\u003c/li\u003e\n\u003cli\u003eConsole local physical terminal (with screen and keyboard)\u003c/li\u003e\n\u003cli\u003eShell when launching a terminal (ttys001\u0026hellip;), it is the program that allows to launch other programs (commands like \u003ccode\u003els\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eCommand-line shell A shell specialized for interpreting commands\u003c/li\u003e\n\u003cli\u003eBash one of the many command-line shells\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etty\u003c/code\u003e: Teletype, meaning interactive terminal, as opposed to tty-less/headless terminal.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epty\u003c/code\u003e: pseudo-teletype is a tty that does not directly talk to a end-user terminal but instead talks to another terminal. Most terminal emulators such as iTerm2, xterm\u0026hellip; use a pty instead of a tty.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWhat happens when I want to launch some bourne-shell commands:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eOpen a terminal emulator\u003c/li\u003e\n\u003cli\u003eThe terminal emulator will open a ttys001 for me\u003c/li\u003e\n\u003cli\u003eThe terminal emulator will then execute a command-line shell (/bin/sh)\u003c/li\u003e\n\u003cli\u003ethen I can type my commands\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"bash_profile-vs-bashrc\"\u003e\u003ccode\u003e.bash_profile\u003c/code\u003e vs \u003ccode\u003e.bashrc\u003c/code\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e.bash_profile\u003c/code\u003e (and \u003ccode\u003e.profile\u003c/code\u003e) when login shell\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.bashrc\u003c/code\u003e when interactive shell (tty/pty)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eA login shell is a shell where $0 == \u0026ldquo;-\u0026rdquo;\u003c/p\u003e\n\u003ch2 id=\"tty-pty-interactive-vs-non-interactive\"\u003eTty, pty, interactive vs non-interactive\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003enode -p -e \u0026quot;Boolean(process.stdout.isTTY)\u0026quot;\n[ -t 1 ]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"login-vs-non-login-shells\"\u003eLogin vs. non-login shells\u003c/h2\u003e\n\u003cp\u003eAn interactive login shell is the shell launched when using ssh, iTerm2 or xterm. In interactive login shell, \u003ccode\u003e.profile\u003c/code\u003e and \u003ccode\u003e.bash_profile\u003c/code\u003e are used. To know if you are in a login shell:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e$ \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\n-bash\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eInteractive non-login shell: \u003ccode\u003e.bashrc\u003c/code\u003e is used\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e$ \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\nbash\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"use-bashrc-also-on-login-shell\"\u003eUse \u003ccode\u003ebashrc\u003c/code\u003e also on login shell\u003c/h2\u003e\n\u003cp\u003eWhat I did was to add a simple thing to \u003ccode\u003e.profile\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -f ~/.bashrc \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n    . ~/.bashrc\n\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"parallelize-xargs\"\u003eParallelize xargs\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e/usr/local/bin/code --list-extensions | xargs -L 1 -P 4 /usr/local/bin/code-insiders --install-extension\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"discrepencies-between-binsh-versions\"\u003eDiscrepencies between /bin/sh versions\u003c/h2\u003e\n\u003cp\u003eOn Ubuntu, \u003ccode\u003e/bin/sh\u003c/code\u003e is hard-linked to \u003ccode\u003e/bin/dash\u003c/code\u003e. On macOS, \u003ccode\u003e/bin/sh\u003c/code\u003e is hard-linked to \u003ccode\u003e/bin/bash\u003c/code\u003e. None of them are the original \u0026ldquo;Bourne shell\u0026rdquo;!\u003c/p\u003e\n\u003cp\u003eOn top of that, \u003ccode\u003emake\u003c/code\u003e always uses \u003ccode\u003e/bin/sh\u003c/code\u003e, which means there are discrepancies between Ubuntu and macOS:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebash knows about \u003ccode\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/code\u003e (here-string), but dash doesn\u0026rsquo;t\u003c/li\u003e\n\u003cli\u003ebash knows about \u003ccode\u003e\u0026lt;()\u003c/code\u003e (process substitution), but dash doesn\u0026rsquo;t\u003c/li\u003e\n\u003cli\u003ebash knows about \u003ccode\u003e${a/b/c}\u003c/code\u003e (glob variable content replace) but dash doesn\u0026rsquo;t\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\n\u003c/span\u003e\u003cspan class=\"s1\"\u003ebar\n\u003c/span\u003e\u003cspan class=\"s1\"\u003e% dash -c \u0026#39;\u003c/span\u003e\u003cspan class=\"nv\"\u003eA\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003efoo\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e/foo/bar\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\ndash: 1: Bad substitution\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\n**Workaround**: force `make` to use a well known shell, e.g. in your Makefile:\n\n```sh\nSHELL := /bin/bash\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1468022400,"description":"","dir":"notes/","expirydate":-62135596800,"fuzzywordcount":600,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":1468022400,"objectID":"d494efdf185ef47b08ac62e13f653e4e","permalink":"https://maelvls.dev/notes/shell/","publishdate":"2016-07-09T00:00:00Z","readingtime":3,"relpermalink":"/notes/shell/","section":"notes","summary":"General information Sed Shell, terminal, console, command line .bash_profile vs .bashrc Tty, pty, interactive vs non-interactive Login vs. non-login shells Use bashrc also on login shell Parallelize xargs Discrepencies between /bin/sh versions  General information   Xargs for creating positionnals through stdin included_figures.sh | xargs git add\n  Avoid the sub-shell problem when while read a while read a; do ...; done \u0026lt; \u0026lt;(ls) pour éviter d\u0026rsquo;avoir le while dans un sous-shell C.","tags":[],"title":"What I know about shells","type":"notes","url":"https://maelvls.dev/notes/shell/","weight":0,"wordcount":578},{"authors":null,"categories":null,"content":"\u003cp\u003eHi! My name is Maël, I am a software engineer based in \u003ca href=\"https://www.google.com/maps/place/Toulouse/@46.6763781,0.1867932,5.46z/data=!4m5!3m4!1s0x12aebb6fec7552ff:0x406f69c2f411030!8m2!3d43.604652!4d1.444209\"\u003eToulouse, France\u003c/a\u003e. I mostly write Go, Kubernetes controllers and network-related components. I like details.\u003c/p\u003e\n\u003cp\u003eI currently work on \u003ca href=\"https://github.com/jetstack/cert-manager\"\u003ecert-manager\u003c/a\u003e, an open-souce CNCF incubated x509 lifecycle manager that \u003ca href=\"https://www.jetstack.io/\"\u003eJetstack\u003c/a\u003e is maintaining. See my resume at \u003ca href=\"https://github.com/maelvls\"\u003ehttps://github.com/maelvls\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003ePreviously: \u003ca href=\"https://www.ori.co/\"\u003eOri Industries\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eI completed a PhD in logic in 2019 (\u003ca href=\"https://scholar.google.com/citations?user=0BrmuaAAAAAJ\u0026amp;hl=en\u0026amp;oi=ao\"\u003epapers\u003c/a\u003e).\u003c/p\u003e\n","date":-62135596800,"description":"","dir":"/","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"page","lang":"en","lastmod":-62135596800,"objectID":"6083a88ee3411b0d17ce02d738f69d47","permalink":"https://maelvls.dev/about/","publishdate":"0001-01-01T00:00:00Z","readingtime":1,"relpermalink":"/about/","section":"","summary":"Hi! My name is Maël, I am a software engineer based in Toulouse, France. I mostly write Go, Kubernetes controllers and network-related components. I like details.\nI currently work on cert-manager, an open-souce CNCF incubated x509 lifecycle manager that Jetstack is maintaining. See my resume at https://github.com/maelvls.\nPreviously: Ori Industries.\nI completed a PhD in logic in 2019 (papers).","tags":null,"title":"About","type":"page","url":"https://maelvls.dev/about/","weight":0,"wordcount":59},{"authors":null,"categories":null,"content":"","date":-62135596800,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"taxonomy","lang":"en","lastmod":-62135596800,"objectID":"","permalink":"https://maelvls.dev/series/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/series/","section":"series","summary":"","tags":null,"title":"Series","type":"series","url":"https://maelvls.dev/series/","weight":0,"wordcount":0},{"authors":null,"categories":null,"content":"\u003c!--\n\n1. service vs. ingress (L4 vs L7)\n\n\u003chttps://github.com/kubernetes/ingress-gce/search?p=3\u0026q=LoadBalancer\u0026unscoped_q=LoadBalancer\u003e\n\n2. how service and ingress interact with their controllers\n3. traffic flow with GKE's service LB and Traefik\n4. using my own service controller\n5. traffic flow with my own service controller\n6. comparison, benchmark, recap\n\n--\u003e\n\u003cp\u003eThe Service and Ingress respectively brings L4 and L7 traffics to your pods. I previously talked about \u003ca href=\"/avoid-gke-lb-with-hostport/\"\u003eusing \u003ccode\u003ehostPort\u003c/code\u003e to avoid GKE\u0026rsquo;s load balancer\u003c/a\u003e without really getting into the details of how everything works. In this article, I focus on how traffic flows in and what are the interactions between the ingress controller and the \u0026ldquo;service-lb controller\u0026rdquo; (the thing that creates the external load balancer). I also detail how the \u003ccode\u003ehostPort\u003c/code\u003e approach shapes traffic.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eIn Kubernetes, the service object represents how a set of pods can be hit with TCP or UDP connections. Since it is L4-only, the service only deals with IPs and ports. An Ingress is the L7 counterpart of a service: it deals with TLS, hostnames, HTTP paths and virtual servers (called \u0026ldquo;backends\u0026rdquo;).\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: you might see some mentions of ingresses since Traefik is an ingress controller but I will not describe the traffic handling at the L7 level.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAn ingress controller is a binary running as a simple deployment that watches all Ingress objects and live-updates the L7 proxy. Traefik qualifies as an ingress controllers: it has the nice property of embeding both the \u0026ldquo;ingress watcher\u0026rdquo; and the L7 proxy in a single binary. HAProxy and Nginx both use separate ingress controllers. And in order to get L4 traffic coming to the L7 proxy, we usually use a service that has the type \u003ccode\u003eLoadBalancer\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eI call \u0026ldquo;service-lb controller\u0026rdquo; a binary that watches service objects that have the \u003ccode\u003eLoadBalancer\u003c/code\u003e type. Any time the Google\u0026rsquo;s service-lb controller sees a new \u003ccode\u003eLoadBalancer\u003c/code\u003e service, it spins up a Network Load Balancer and sets up some firewall rules. In fact, Google\u0026rsquo;s service-lb controller runs as a small closed-source binary that runs on your master node (but not visible as a pod) and acts as a service-lb controller.\u003c/p\u003e\n\u003cp\u003eHere is a diagram that represents how GKE\u0026rsquo;s service-lb controller interacts with the ingress controller:\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"GKE service LoadBalancer controller and ingress controller\ninteraction\" src=\"kubernetes-service-controllers-with-gke-service.svg\" width=\"80%\"/\u003e\u003c/p\u003e\n\u003cp\u003eSo, how does external traffic make it to the pod? The following diagram shows how a packet is forwarded to the right pod. Notice how many iptable rewriting happen (which corresponds to one connection managed by conntrack):\u003c/p\u003e\n\u003cimg alt=\"Packet coming from a user hitting the GKE network balancer and forwarded to the right pod\" src=\"kubernetes-traffic-with-gke-lb.svg\" width=\"80%\"/\u003e\n\u003cp\u003eNow, let\u0026rsquo;s see how it goes when using \u003ca href=\"https://github.com/kontena/akrobateo\"\u003eAkrobateo\u003c/a\u003e (I detailed that \u003ca href=\"/avoid-gke-lb-with-hostport/\"\u003ehere\u003c/a\u003e). Instead of using an external compute resource, we use the node\u0026rsquo;s IP in order to let traffic in.\u003c/p\u003e\n\u003cp\u003eNote: Akrobateo is EOL, but K3s\u0026rsquo;s \u003ca href=\"https://github.com/rancher/k3s/blob/master/pkg/servicelb/controller.go\"\u003eservicelb\u003c/a\u003e and \u003ca href=\"https://github.com/metallb/metallb\"\u003eMetallb\u003c/a\u003e work in a very similar way, setting the service\u0026rsquo;s \u003ccode\u003estatus.loadBalancer\u003c/code\u003e field with the correct external IP.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Akrobateo service LoadBalancer controller and ingress controller\ninteraction\" src=\"kubernetes-service-controllers-with-akrobateo.svg\" width=\"70%\"/\u003e\u003c/p\u003e\n\u003cp\u003eYou might wonder why the \u0026lsquo;internal IP\u0026rsquo; is used in \u003ccode\u003estatus.loadBalancer\u003c/code\u003e. We might expect the external IP to be set there. But since Google\u0026rsquo;s VPC NAT swaps the node\u0026rsquo;s external IP to the node\u0026rsquo;s internal IP, the incoming packets have the internal IP as source IP. So that\u0026rsquo;s why 😁.\u003c/p\u003e\n\u003cp\u003eThe following diagram shows a packet coming from a user being routed to the Service that has the ClusterIP \u003ccode\u003e10.24.3.12\u003c/code\u003e. Notice the number of packet rewritings:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eDNAT by the VPC firewall,\u003c/li\u003e\n\u003cli\u003eDNAT in the \u003ccode\u003ehostPort\u003c/code\u003e rule on node 1,\u003c/li\u003e\n\u003cli\u003eDNAT in the Akrobateo pod,\u003c/li\u003e\n\u003cli\u003eDNAT for the Service ClusterIP rule on node 1,\u003c/li\u003e\n\u003cli\u003eSNAT due to the \u003ccode\u003eexternalTrafficPolicy: Cluster\u003c/code\u003e rule on node 1 (service-level random load-balancing across nodes),\u003c/li\u003e\n\u003cli\u003eUser-space TCP termination by Traefik (i.e., new dial to the pod-ip).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThat\u0026rsquo;s a lot of hops and rewritings!\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Packet coming from a user hitting one of the nodes directly\nthrough DNS resolution and forwarded to the right pod\"\nsrc=\"kubernetes-traffic-with-akrobateo.svg\" width=\"70%\"/\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate 28 April 2020\u003c/strong\u003e: Fixed a mistake I made in this diagram. I had set the source port to 80 in the \u0026ldquo;User\u0026rsquo;s request\u0026rdquo;. This example does not reflect what happens in reality. When connecting to a remote host, the TCP stack picks a random ephemeral IP above or equal 32768. The kernel calls it \u0026ldquo;local ports\u0026rdquo;, see \u003ca href=\"https://github.com/torvalds/linux/blob/c60174717544aa8959683d7e19d568309c3a0c65/net/ipv4/inet_hashtables.c#L739-L740\"\u003e\u003ccode\u003einet_hash_connect\u003c/code\u003e (\u003ccode\u003einet_hashtables.c\u003c/code\u003e)\u003c/a\u003e, \u003ca href=\"https://github.com/torvalds/linux/blob/9c7db5004280767566e91a33445bf93aa479ef02/net/core/secure_seq.c\"\u003e\u003ccode\u003esecure_ipv4_port_ephemeral\u003c/code\u003e (\u003ccode\u003esecure_seq.c\u003c/code\u003e)\u003c/a\u003e and \u003ca href=\"https://github.com/torvalds/linux/blob/29d9f30d4ce6c7a38745a54a8cddface10013490/Documentation/networking/ip-sysctl.txt#L907-L914\"\u003e\u003ccode\u003eip_local_port_range\u003c/code\u003e (\u003ccode\u003eip-sysctl.txt\u003c/code\u003e)\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eSo I changed the \u0026ldquo;User\u0026rsquo;s request\u0026rdquo; source port from 80 to 32345:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-diff\" data-lang=\"diff\"\u003e\u003cspan class=\"gd\"\u003e-src: 1.2.3.4:80\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e\u003c/span\u003e\u003cspan class=\"gi\"\u003e+src: 1.2.3.4:32345\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e\u003c/span\u003e dst: 35.211.248.124:80\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/blockquote\u003e\n\u003cp\u003eWith the \u0026ldquo;Akrobateo\u0026rdquo; method, we only rely on the VPC\u0026rsquo;s firewall rules. But using the node\u0026rsquo;s IP is not perfect: it might be a seen as a security risk, and the many IPs that end up in the service\u0026rsquo;s \u003ccode\u003estatus.loadBalancer\u003c/code\u003e isn\u0026rsquo;t ideal when it comes to setting your DNS \u003ccode\u003eA\u003c/code\u003e records:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewhen a node disappears, the DNS might forward traffic to a unexisting node,\u003c/li\u003e\n\u003cli\u003eoffloading ingress traffic load balancing from a load balancer with a single IP to relying on DNS records isn\u0026rsquo;t ideal since DNS records leave you very few options as to how to balance traffic.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eK3s uses this approach of using the node IPs as service backends and does not need any external load balancer.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate 28 April 2020\u003c/strong\u003e: fixed an error with the source port in the last diagram. Added the list of DNAT and SNAT rewritings that happen in the last diagram. I also rewrote the introduction.\u003c/p\u003e\n","date":-62135596800,"description":"The Service and Ingress respectively brings L4 and L7 traffics to your pods. In this article, I focus on how traffic flows in and what are the interactions between the ingress controller and the service-lb controller (the thing that creates the external load balancer). I also detail how the `hostPort` approach shapes traffic.","dir":"2020/packets-eye-of-a-service/","expirydate":-62135596800,"fuzzywordcount":900,"images":["packets-eye-kubernetes-service/cover-packets-eye-kubernetes-service.png"],"keywords":null,"kind":"page","lang":"en","lastmod":-62135596800,"objectID":"a200a0c3236a727545b7eb8be5d9e6b3","permalink":"https://maelvls.dev/packets-eye-kubernetes-service/","publishdate":"0001-01-01T00:00:00Z","readingtime":4,"relpermalink":"/packets-eye-kubernetes-service/","section":"2020","summary":"2. how service and ingress interact with their controllers 3. traffic flow with GKE's service LB and Traefik 4. using my own service controller 5. traffic flow with my own service controller 6. comparison, benchmark, recap -- The Service and Ingress respectively brings L4 and L7 traffics to your pods. I previously talked about using hostPort to avoid GKE\u0026rsquo;s load balancer without really getting into the details of how everything works.","tags":["kubernetes","networking","traefik"],"title":"The Packet's-Eye View of a Kubernetes Service","type":"2020","url":"https://maelvls.dev/packets-eye-kubernetes-service/","weight":0,"wordcount":812},{"authors":null,"categories":null,"content":"","date":-62135596800,"description":"","dir":"","expirydate":-62135596800,"fuzzywordcount":100,"images":null,"keywords":null,"kind":"term","lang":"en","lastmod":-62135596800,"objectID":"","permalink":"https://maelvls.dev/tags/traefik/","publishdate":"0001-01-01T00:00:00Z","readingtime":0,"relpermalink":"/tags/traefik/","section":"tags","summary":"","tags":null,"title":"traefik","type":"tags","url":"https://maelvls.dev/tags/traefik/","weight":0,"wordcount":0}]