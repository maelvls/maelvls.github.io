<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.75.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=author content="Maël Valais"><meta name=keywords content="go,software-engineering"><meta name=description content="We often talk about avoiding unecessary comments that needlessly paraphrase what the code does. In this article, I gathered some thoughts about why writing comments is as important as writing the code itself, and how to spot comments that should be refactored using the 'what' and the 'why'."><meta property="og:title" content="Writing useful comments"><meta property="og:description" content="We often talk about avoiding unecessary comments that needlessly paraphrase what the code does. In this article, I gathered some thoughts about why writing comments is as important as writing the code itself, and how to spot comments that should be refactored using the 'what' and the 'why'."><meta property="og:type" content="article"><meta property="og:url" content="https://maelvls.dev/writing-useful-comments/"><meta property="og:image" content="https://maelvls.dev/writing-useful-comments/cover-writing-useful-comments.png"><meta property="article:published_time" content="2021-06-05T00:00:00+00:00"><meta property="article:modified_time" content="2021-06-05T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://maelvls.dev/writing-useful-comments/cover-writing-useful-comments.png"><meta name=twitter:title content="Writing useful comments"><meta name=twitter:description content="We often talk about avoiding unecessary comments that needlessly paraphrase what the code does. In this article, I gathered some thoughts about why writing comments is as important as writing the code itself, and how to spot comments that should be refactored using the 'what' and the 'why'."><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=https://maelvls.dev/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://maelvls.dev/css/main.css><link rel=stylesheet type=text/css media=screen href=https://maelvls.dev/css/all.css><link rel=stylesheet type=text/css media=screen href=https://maelvls.dev/css/maelvls.css><title>Writing useful comments | maelvls dev blog</title></head><body><header><div id=avatar><a href=https://maelvls.dev/><img src=/img/mael.jpg alt="maelvls dev blog"></a></div><div id=titletext><h2 id=title><a href=https://maelvls.dev/>maelvls dev blog</a></h2></div><div id=title-description><p id=subtitle>Systems software engineer. I write mostly about Kubernetes and Go. <a href=/about/>About</a></p><div id=social><nav><ul><li><a href=https://github.com/maelvls><i title=Github class="icons fab fa-github"></i></a></li><li><a href=https://twitter.com/maelvls><i title=Twitter class="icons fab fa-twitter"></i></a></li><li><a href=https://dev.to/maelvls><i title="Maël Valais's DEV Community Profile" class="icons fab fa-dev"></i></a></li></ul></nav></div></div><div id=mainmenu></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>05</span>
<span class=rest>Jun2021</span></div></div><div class=matter><h1 class=title>Writing useful comments</h1></div><span style=font-size:xx-small;text-align:right>cross-post <a href=https://dev.to/maelvls/you-should-write-comments-36fd><i title="Maël Valais's DEV Community Profile" class="icons fab fa-dev"></i></a></span></div><div class=markdown><p>In his book <em><a href=https://www.oreilly.com/library/view/clean-code-a/9780136083238/>Clean Code</a></em>, Robert C. Martin makes a strong case against comments:</p><blockquote><p>You don&rsquo;t need comments if you write clean code.</p></blockquote><p>Like any blanket statement, Martin is partially true. Although code clarity increases readability and decreases the need for comments, code has never been able to convey the whole context to the reader.</p><p>Programming patterns are often cited as a way to convey this context on a codebase scale. Well named functions and variables also convey some form of context. But most of the time, the context (the &ldquo;why&rdquo;) never gets written anywhere.</p><p>In this article, I present a few examples meant to showcase how comments may be written to convey the context around code.</p><p><strong>Contents:</strong></p><ol><li><a href=#code-example-1>Code example 1</a></li><li><a href=#code-example-2>Code example 2</a></li><li><a href=#code-example-3>Code example 3</a></li><li><a href=#code-example-4>Code example 4</a></li><li><a href=#conclusion>Conclusion</a></li></ol><h2 id=code-example-1>Code example 1</h2><p>I call &ldquo;in-flight comments&rdquo; comments that we write to ease the process of writing code. In-flight comments help us articulate what we are trying to achieve.</p><p>In the following example taken from the <a href=https://developers.google.com/tech-writing/two/code-comments>Google&rsquo;s Technical Writing</a>, the developer wrote a comment as they were writing an algorithm for randomly shuffling a slice of integers:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>Shuffle</span><span class=p>(</span><span class=nx>slice</span> <span class=p>[]</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>curIndex</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>slice</span><span class=p>)</span>

    <span class=c1>// If the current index is 0, return directly.
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>curIndex</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span>
    <span class=p>}</span>

    <span class=o>...</span>
<span class=p>}</span>
</code></pre></div><p>This comment is a typical in-flight comment: it only focuses on what the code does. This comment does not give context as to why this <code>if</code> statement exists. We can refactor this comment by focusing on the &ldquo;why&rdquo;:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>Shuffle</span><span class=p>(</span><span class=nx>slice</span> <span class=p>[]</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>curIndex</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>slice</span><span class=p>)</span>

    <span class=c1>// No need to shuffle an array with zero elements.
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>curIndex</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span>
    <span class=p>}</span>

    <span class=o>...</span>
<span class=p>}</span>
</code></pre></div><p>The reader now understand why this <code>if</code> exists, and does not have to dig further. Starting with the &ldquo;why&rdquo; helps glanceability: the reader only needs to read the first few words to get the idea.</p><p>Here is how I would diffenciate the &ldquo;why&rdquo; from the &ldquo;what&rdquo;:</p><table><thead><tr><th>Content in a comment</th><th>Description</th></tr></thead><tbody><tr><td>The &ldquo;why&rdquo;</td><td>Helps you understand how this piece of code came to life.</td></tr><tr><td>The &ldquo;what&rdquo;</td><td>Paraphrases* what is being done in a human-readable format.</td></tr></tbody></table><p>*Sometimes, the &ldquo;what&rdquo; may be valuable for readability purposes. I see three reasons to comment on the &ldquo;what&rdquo;:</p><ol><li>When the code is not self-explanatory, a &ldquo;what&rdquo; comment may avoid the reader the struggle of googling;</li><li>When a block of code is lenghy, adding &ldquo;what&rdquo; comments may help create &ldquo;sections&rdquo;, helping the reader quicly find the part they are interested in.</li></ol><h2 id=code-example-2>Code example 2</h2><p>Our next example comes from the cert-manager codebase:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// If the certificate request has been denied, set the last failure time to
</span><span class=c1>// now, and set the Issuing status condition to False with reason. We only
</span><span class=c1>// perform this check if the request also doesn&#39;t have a Ready condition,
</span><span class=c1>// since some issuers may not honor a Denied condition, and will sign and
</span><span class=c1>// set the Ready condition to True anyway. We would still want to complete
</span><span class=c1>// issuance for requests where the issuer doesn&#39;t respect approval.
</span><span class=c1></span><span class=nx>cond</span> <span class=o>:=</span> <span class=nx>apiutil</span><span class=p>.</span><span class=nf>GetCertificateRequestCondition</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>cmapi</span><span class=p>.</span><span class=nx>CertificateRequestConditionReady</span><span class=p>)</span>
<span class=k>if</span> <span class=nx>cond</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=k>if</span> <span class=nx>apiutil</span><span class=p>.</span><span class=nf>CertificateRequestIsDenied</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nf>failIssueCertificate</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>log</span><span class=p>,</span> <span class=nx>crt</span><span class=p>,</span> <span class=nx>apiutil</span><span class=p>.</span><span class=nf>GetCertificateRequestCondition</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>cmapi</span><span class=p>.</span><span class=nx>CertificateRequestConditionDenied</span><span class=p>))</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div><p>After looking at the <code>if</code> statement, the reader wonders: why do we need this <code>if</code> statement?</p><p>Their first reaction will probably be to take a look at the comment right above. Unfortunately, the comment starts with even more confusing implementation details. The reader has to keep reading until the 6th line to find out why the code is doing what it is doing.</p><p>Let us rate each individual information that the comment conveys:</p><table><thead><tr><th>Paragraph</th><th>Usefulness</th></tr></thead><tbody><tr><td><strong>(A)</strong> If the certificate request has been denied, set the last failure time to now, and set the Issuing status condition to False with reason.</td><td>⭐</td></tr><tr><td><strong>(B)</strong> We only perform this check if the request also doesn&rsquo;t have a Ready condition.</td><td>⭐⭐</td></tr><tr><td><strong>(C)</strong> Some issuers may not honor a Denied condition, and will sign and set the Ready condition to True anyway.</td><td>⭐⭐⭐</td></tr><tr><td><strong>(D)</strong> We would still want to complete issuance for requests where the issuer doesn&rsquo;t respect approval.</td><td>⭐⭐⭐⭐</td></tr></tbody></table><p>From the reader&rsquo;s perspective, the paragraphs (D) and (C) are the most useful. They give a high-level overview of why this <code>if</code> statement exists. We can merge the two paragraphs into one:</p><blockquote><p><strong>(C, D)</strong> External issuers may ignore the approval API. An issuer ignores the approval API when it proceeds with the issuance even though the &ldquo;Denied=True&rdquo; condition is present on the CertificateRequest. To avoid breaking the issuers that are ignoring the approval API, we want to detect when CertificateRequests has ignored the Denied=True condition; when it is the case, we skip bubbling-up the (possible) Denied condition.</p></blockquote><p>Paragraphs (B) and (A) may also be useful: they give the context about paragraph (C). The sentence lacks precision though, and &ldquo;this check&rdquo; may confuse the reader. Let us rephrase it:</p><blockquote><p><strong>(A, B)</strong> To know when the Denied=True condition was ignored by the issuer, we look at the CertificateRequest&rsquo;s Ready condition. If both the Ready and Denied</p></blockquote><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// Some issuers won&#39;t honor the &#34;Denied=True&#34; condition, and we don&#39;t want
</span><span class=c1>// to break these issuers. To avoid breaking these issuers, we skip bubbling
</span><span class=c1>// up the &#34;Denied=True&#34; condition from the certificate request object to the
</span><span class=c1>// certificate object when the issuer ignores the &#34;Denied&#34; state.
</span><span class=c1>//
</span><span class=c1>// To know whether or not an issuer ignores the &#34;Denied&#34; state, we pay
</span><span class=c1>// attention to the &#34;Ready&#34; condition on the certificate request. If a
</span><span class=c1>// certificate request is &#34;Denied=True&#34; and that the issuer still proceeds
</span><span class=c1>// to adding the &#34;Ready&#34; condition (to either true or false), then we
</span><span class=c1>// consider that this issuer has ignored the &#34;Denied&#34; state.
</span><span class=c1></span><span class=nx>cond</span> <span class=o>:=</span> <span class=nx>apiutil</span><span class=p>.</span><span class=nf>GetCertificateRequestCondition</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>cmapi</span><span class=p>.</span><span class=nx>CertificateRequestConditionReady</span><span class=p>)</span>
<span class=k>if</span> <span class=nx>cond</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=k>if</span> <span class=nx>apiutil</span><span class=p>.</span><span class=nf>CertificateRequestIsDenied</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nf>failIssueCertificate</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>log</span><span class=p>,</span> <span class=nx>crt</span><span class=p>,</span> <span class=nx>apiutil</span><span class=p>.</span><span class=nf>GetCertificateRequestCondition</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>cmapi</span><span class=p>.</span><span class=nx>CertificateRequestConditionDenied</span><span class=p>))</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div><h2 id=code-example-3>Code example 3</h2><p>The next <a href=https://github.com/jetstack/cert-manager/blob/1dad685e/pkg/controller/ingress-shim/sync.go#L145>example</a> comes from another part of the cert-manager codebase:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>errs</span> <span class=o>:=</span> <span class=nf>validateIngressTLSBlock</span><span class=p>(</span><span class=nx>tls</span><span class=p>)</span>
<span class=c1>// if this tls entry is invalid, record an error event on Ingress object and continue to the next tls entry
</span><span class=c1></span><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>errs</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
    <span class=nx>errMsg</span> <span class=o>:=</span> <span class=nx>utilerrors</span><span class=p>.</span><span class=nf>NewAggregate</span><span class=p>(</span><span class=nx>errs</span><span class=p>).</span><span class=nf>Error</span><span class=p>()</span>
    <span class=nx>c</span><span class=p>.</span><span class=nx>recorder</span><span class=p>.</span><span class=nf>Eventf</span><span class=p>(</span><span class=nx>ing</span><span class=p>,</span> <span class=nx>corev1</span><span class=p>.</span><span class=nx>EventTypeWarning</span><span class=p>,</span> <span class=s>&#34;BadConfig&#34;</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;TLS entry %d is invalid: %s&#34;</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>errMsg</span><span class=p>))</span>
    <span class=k>continue</span>
<span class=p>}</span>
</code></pre></div><p>Let&rsquo;s refactor the comment by focusing on the &ldquo;why&rdquo;:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// Let the user know that an TLS entry has been skipped due to being invalid.
</span><span class=c1></span><span class=nx>errs</span> <span class=o>:=</span> <span class=nf>validateIngressTLSBlock</span><span class=p>(</span><span class=nx>tls</span><span class=p>)</span>
<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>errs</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
    <span class=nx>errMsg</span> <span class=o>:=</span> <span class=nx>utilerrors</span><span class=p>.</span><span class=nf>NewAggregate</span><span class=p>(</span><span class=nx>errs</span><span class=p>).</span><span class=nf>Error</span><span class=p>()</span>
    <span class=nx>c</span><span class=p>.</span><span class=nx>recorder</span><span class=p>.</span><span class=nf>Eventf</span><span class=p>(</span><span class=nx>ing</span><span class=p>,</span> <span class=nx>corev1</span><span class=p>.</span><span class=nx>EventTypeWarning</span><span class=p>,</span> <span class=s>&#34;BadConfig&#34;</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;TLS entry %d is invalid: %s&#34;</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>errMsg</span><span class=p>))</span>
    <span class=k>continue</span>
<span class=p>}</span>
</code></pre></div><h2 id=code-example-4>Code example 4</h2><p>The next example <a href=https://github.com/jetstack/cert-manager/blob/1dad685e4/pkg/controller/ingress-shim/sync.go#L180-L209>comes</a> from the same file as the previous example:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// check if a Certificate for this TLS entry already exists, and if it
</span><span class=c1>// does then skip this entry
</span><span class=c1></span><span class=k>if</span> <span class=nx>existingCrt</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=nx>log</span> <span class=o>:=</span> <span class=nx>logs</span><span class=p>.</span><span class=nf>WithRelatedResource</span><span class=p>(</span><span class=nx>log</span><span class=p>,</span> <span class=nx>existingCrt</span><span class=p>)</span>
    <span class=nx>log</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=nx>logf</span><span class=p>.</span><span class=nx>DebugLevel</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;certificate already exists for ingress resource, ensuring it is up to date&#34;</span><span class=p>)</span>

    <span class=k>if</span> <span class=nx>metav1</span><span class=p>.</span><span class=nf>GetControllerOf</span><span class=p>(</span><span class=nx>existingCrt</span><span class=p>)</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=nx>log</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=nx>logf</span><span class=p>.</span><span class=nx>InfoLevel</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;certificate resource has no owner. refusing to update non-owned certificate resource for ingress&#34;</span><span class=p>)</span>
        <span class=k>continue</span>
    <span class=p>}</span>

    <span class=k>if</span> <span class=p>!</span><span class=nx>metav1</span><span class=p>.</span><span class=nf>IsControlledBy</span><span class=p>(</span><span class=nx>existingCrt</span><span class=p>,</span> <span class=nx>ing</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>log</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=nx>logf</span><span class=p>.</span><span class=nx>InfoLevel</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;certificate resource is not owned by this ingress. refusing to update non-owned certificate resource for ingress&#34;</span><span class=p>)</span>
        <span class=k>continue</span>
    <span class=p>}</span>

    <span class=k>if</span> <span class=p>!</span><span class=nf>certNeedsUpdate</span><span class=p>(</span><span class=nx>existingCrt</span><span class=p>,</span> <span class=nx>crt</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>log</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=nx>logf</span><span class=p>.</span><span class=nx>DebugLevel</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;certificate resource is already up to date for ingress&#34;</span><span class=p>)</span>
        <span class=k>continue</span>
    <span class=p>}</span>

    <span class=nx>updateCrt</span> <span class=o>:=</span> <span class=nx>existingCrt</span><span class=p>.</span><span class=nf>DeepCopy</span><span class=p>()</span>

    <span class=nx>updateCrt</span><span class=p>.</span><span class=nx>Spec</span> <span class=p>=</span> <span class=nx>crt</span><span class=p>.</span><span class=nx>Spec</span>
    <span class=nx>updateCrt</span><span class=p>.</span><span class=nx>Labels</span> <span class=p>=</span> <span class=nx>crt</span><span class=p>.</span><span class=nx>Labels</span>
    <span class=nf>setIssuerSpecificConfig</span><span class=p>(</span><span class=nx>updateCrt</span><span class=p>,</span> <span class=nx>ing</span><span class=p>)</span>
    <span class=nx>updateCrts</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>updateCrts</span><span class=p>,</span> <span class=nx>updateCrt</span><span class=p>)</span>
<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
    <span class=nx>newCrts</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>newCrts</span><span class=p>,</span> <span class=nx>crt</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>As in the previous examples, refactoring this example is about moving the &ldquo;why&rdquo; to the start of the comment:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// The &#34;secretName&#34; field may already refer to an existing Certificate object.
</span><span class=c1>// We still want this existing Certificate to be .
</span><span class=c1>//
</span><span class=c1>// For example, imagine that the certificate named &#34;example-tls&#34; already exists.
</span><span class=c1>//
</span><span class=c1>//     kind: Ingress
</span><span class=c1>//     spec:
</span><span class=c1>//       tls:
</span><span class=c1>//         - secretName: example-tls
</span><span class=c1>//           hosts: [example.com]
</span><span class=c1>//
</span><span class=c1></span><span class=k>if</span> <span class=nx>existingCrt</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=nx>log</span> <span class=o>:=</span> <span class=nx>logs</span><span class=p>.</span><span class=nf>WithRelatedResource</span><span class=p>(</span><span class=nx>log</span><span class=p>,</span> <span class=nx>existingCrt</span><span class=p>)</span>
    <span class=nx>log</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=nx>logf</span><span class=p>.</span><span class=nx>DebugLevel</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;certificate already exists for ingress resource, ensuring it is up to date&#34;</span><span class=p>)</span>

    <span class=k>if</span> <span class=nx>metav1</span><span class=p>.</span><span class=nf>GetControllerOf</span><span class=p>(</span><span class=nx>existingCrt</span><span class=p>)</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=nx>log</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=nx>logf</span><span class=p>.</span><span class=nx>InfoLevel</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;certificate resource has no owner. refusing to update non-owned certificate resource for ingress&#34;</span><span class=p>)</span>
        <span class=k>continue</span>
    <span class=p>}</span>

    <span class=k>if</span> <span class=p>!</span><span class=nx>metav1</span><span class=p>.</span><span class=nf>IsControlledBy</span><span class=p>(</span><span class=nx>existingCrt</span><span class=p>,</span> <span class=nx>ing</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>log</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=nx>logf</span><span class=p>.</span><span class=nx>InfoLevel</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;certificate resource is not owned by this ingress. refusing to update non-owned certificate resource for ingress&#34;</span><span class=p>)</span>
        <span class=k>continue</span>
    <span class=p>}</span>

    <span class=k>if</span> <span class=p>!</span><span class=nf>certNeedsUpdate</span><span class=p>(</span><span class=nx>existingCrt</span><span class=p>,</span> <span class=nx>crt</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>log</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=nx>logf</span><span class=p>.</span><span class=nx>DebugLevel</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;certificate resource is already up to date for ingress&#34;</span><span class=p>)</span>
        <span class=k>continue</span>
    <span class=p>}</span>

    <span class=nx>updateCrt</span> <span class=o>:=</span> <span class=nx>existingCrt</span><span class=p>.</span><span class=nf>DeepCopy</span><span class=p>()</span>

    <span class=nx>updateCrt</span><span class=p>.</span><span class=nx>Spec</span> <span class=p>=</span> <span class=nx>crt</span><span class=p>.</span><span class=nx>Spec</span>
    <span class=nx>updateCrt</span><span class=p>.</span><span class=nx>Labels</span> <span class=p>=</span> <span class=nx>crt</span><span class=p>.</span><span class=nx>Labels</span>
    <span class=nf>setIssuerSpecificConfig</span><span class=p>(</span><span class=nx>updateCrt</span><span class=p>,</span> <span class=nx>ing</span><span class=p>)</span>
    <span class=nx>updateCrts</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>updateCrts</span><span class=p>,</span> <span class=nx>updateCrt</span><span class=p>)</span>
<span class=p>}</span>

<span class=nx>newCrts</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>newCrts</span><span class=p>,</span> <span class=nx>crt</span><span class=p>)</span>
</code></pre></div><p>Note that I removed the <code>else</code> statement for the purpose of readability. Since &ldquo;creating a certificate&rdquo; seems to be the happy path of this function, it makes sense to unindent the code that relates to this happy path.</p><h2 id=conclusion>Conclusion</h2><p>As a developer, I want to write code that is readable and maintainable. I found that putting myself in the place of the future reader helps write comments that focus on the context.</p><p>HAProxy, Git or the Linux kernel are great examples of projects where there is a great focus on well-documented code:</p><ul><li><a href=https://github.com/haproxy/haproxy/blob/530408f976e5fe2f2f2b4b733b39da36770b566f/ebtree/ebtree.h#L23><code>ebtree/ebtree.h</code></a> (HAProxy)</li><li><a href=https://github.com/git/git/blob/2d2118b814c11f509e1aa76cb07110f7231668dc/unpack-trees.c#L821-L836><code>unpack-trees.c</code></a> (Git)</li><li><a href=https://github.com/torvalds/linux/blob/bfdc6d91a25f4545bcd1b12e3219af4838142ef1/kernel/sched/core.c#L157-L171><code>kernel/sched/core.c</code></a> (Linux kernel).</li></ul></div><a href=https://github.com/maelvls/maelvls.github.io/edit/source/content/2020/you-should-write-comments/index.md>📝 Edit this page</a><div class=tags><div style=float:right><p>Tags:
<a href=/tags/go/>go</a>
<a href=/tags/software-engineering/>software-engineering</a></div><div class=clearit></div></div><script src=https://utteranc.es/client.js repo=maelvls/maelvls.github.io issue-term=pathname label=💬 theme=github-light crossorigin=anonymous async></script></div></main><footer><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-88710120-3','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></footer></body></html>