<!DOCTYPE html>
<html lang="en"><head>

  <meta name="generator" content="Hugo 0.75.1" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Maël Valais"><meta name="description" content="I come here to mumble about Go, Kubernetes and networking"><meta property="og:title" content="maelvls dev blog" />
<meta property="og:description" content="I come here to mumble about Go, Kubernetes and networking" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://maelvls.dev/do-not-share-yet/" />
<meta property="og:image" content="https://maelvls.dev/img/mael.jpg"/>
<meta property="og:updated_time" content="2021-02-26T15:22:05+01:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://maelvls.dev/img/mael.jpg"/>

<meta name="twitter:title" content="maelvls dev blog"/>
<meta name="twitter:description" content="I come here to mumble about Go, Kubernetes and networking"/>
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><link rel="alternate" type="application/rss+xml" href="https://maelvls.dev/do-not-share-yet/index.xml" title="maelvls dev blog">
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/normalize.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/main.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/all.css" />
<link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/maelvls.css" /><title>maelvls dev blog </title></head>
<body>

<header>

  <div id="avatar">
    <a href="https://maelvls.dev/do-not-share-yet/">
      <img src="/img/mael.jpg" alt="maelvls dev blog">
    </a>
  </div>

  <div id="titletext"><h1 id="title"><a href="https://maelvls.dev/do-not-share-yet/">maelvls dev blog</a></h2></div>
  <div id="title-description"><p id="subtitle">Systems software engineer. I write mostly about Kubernetes and Go. <a href="/about">About</a></p><div id=social>
    <nav>
      <ul><li><a href="https://github.com/maelvls"><i title="Github" class="icons fab fa-github"></i></a></li><li><a href="https://twitter.com/maelvls"><i title="Twitter" class="icons fab fa-twitter"></i></a></li><li><a href="https://dev.to/maelvls"><i title="Maël Valais&#39;s DEV Community Profile" class="icons fab fa-dev"></i></a></li></ul>
    </nav>
  </div>
  </div>
  <div id="mainmenu">
	
  </div>
</header>
<main><div class="recent-posts">
<div class="posts">



<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">26</span>
<span class="rest">Feb 2021</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/kubernetes-api-deprecation-timeline/">Kubernetes Api Deprecation Timeline<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">04</span>
<span class="rest">Dec 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/custom-ingresses-and-helm-charts/">Custom Ingresses and Helm Charts<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">02</span>
<span class="rest">Nov 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/yaml-isnt-that-good/">Yaml Isnt That Good<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">21</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/expose-service-using-kind-on-macos/">Expose Service Using Kind on Macos<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">21</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/kind-and-service-loadbalancer/">Kind and Service Loadbalancer<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">13</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/what-are-proxies/">What Are Proxies<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">09</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/deepequal-is-slow/">Deepequal Is Slow<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">08</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/why-kubernetes-compares-with-hash/">Why Kubernetes Compares With Hash<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">08</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/digging-into-utf-8/">Digging Into Utf 8<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">07</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/deployment-available-condition/">Understanding the Available condition of a Kubernetes deployment</a></h3>
<span class="description">

Although the Kubernetes documentation is excellent, the API reference does not document the conditions that can be found in a deployment&#39;s status. The Available condition has always eluded me!

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">03</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/docker-proxy-registry-kind/">Pull-through Docker registry on Kind clusters</a></h3>
<span class="description">

Kind offers an excellent UX to Kubernetes developers but lacks support for caching images; each time you recreate a new cluster, all the previous downloaded images are gone. In this post, I explain why the default Docker network is a trap and how to set up a registry &amp; make sure that it actually works.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">01</span>
<span class="rest">Jul 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/mitmproxy-kubectl/">Using mitmproxy to understand what kubectl does under the hood</a></h3>
<span class="description">

Mitmproxy is an excellent tool that helps us understand what network calls are made by programs. And kubectl is one of these interesting programs, but it uses a mutual TLS authentication which is tricky to get right.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">30</span>
<span class="rest">May 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/static-libraries-and-autoconf-hell/">Epic journey with statically and dynamically-linked libraries (.a, .so)</a></h3>
<span class="description">

Dynamic libraries and PIC (position-independant code) are great features of modern systems. But trying to get the right library built can become a nightmare as soon as you rely on other libraries that may or may not have these features in the first place... In this post, I detail the hacks I made to the ./configure-based build system of Yices, a C&#43;&#43; library.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">29</span>
<span class="rest">May 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/weird-api-choices/">Weird Api Choices<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">09</span>
<span class="rest">May 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/gh-actions-with-tf-private-repo/">Github Actions with a private Terraform module</a></h3>
<span class="description">

Terraform makes it easy to manage infrastructure at scale; you might want to share code between modules, and that&#39;s where it becomes tricky. In this post, I try to give some clues on how to use terraform across private Github repos.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">08</span>
<span class="rest">May 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/writing-a-good-go-sdk/">Writing a good Go SDK<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">08</span>
<span class="rest">May 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/chatops-github-actions/">A ChatOps bot using Github Actions<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">08</span>
<span class="rest">May 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/slack-dont-miss-channels/">Slack: don&#39;t miss any channels!<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">30</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/everything-about-docker/">Everything About Docker<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">27</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/unicode/">Unicode<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">25</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/metallb-vs-k3s-servicelb/">MetalLB vs. K3s servicelb<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">22</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/setting-up-concourse/">Setting Up Concourse<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">22</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/learning-kubernetes-controllers/">Learning Kubernetes Controllers</a></h3>
<span class="description">

Kubernetes&#39; extensibility is probably its biggest strength. Controllers and CRDs are all over the place. But finding the right information to begin writing a controller isn&#39;t easy due to the sheer amount of tribal knowledge scattered everywhere. Here are some links to help you start.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">21</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/go-pointers-and-ownership/">Go, pointers and data ownership<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">20</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/proper-prompt/">A proper prompt<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">20</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/kubernetes-level-based-state/">Kubernetes level-based behaviour<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">19</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/bgp-101/">BGP 101<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">18</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/kubeconfigs-and-certs/">Kubeconfigs and Certs<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">16</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/deep-dive-go-assembly/">Deep Dive into Go Assembly<sup class="draft-label">DRAFT</sup></a></h3>
<span class="description">



</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">15</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/client-go-transitive-hell/">The Client-go Transitive Hell</a></h3>
<span class="description">

Client-go is the client library that allows anyone (including Kubernetes itself) to talk to the Kubernetes apiserver. Recently, the Kubernetes team chose to release a breaking version of client-go that adds support for context.Context, without really giving anyone notice. In this post, I detail the workaround and what that happened.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">13</span>
<span class="rest">Apr 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/how-do-packets-come-back/">How do packets find their way back?</a></h3>
<span class="description">

In one of my previous posts, I studied how traffic flows when using Kubernetes Services. While drawing the last diagram, I did not clearly see how traffic could make its way back to the user. In this post, I focus on how packets find their way back and what makes stateless rewriting interesting.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">30</span>
<span class="rest">Mar 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/home-office-2020/">My home office setup in 2020</a></h3>
<span class="description">

Here is what my home office looks like in 2020 and what changed between 2019 and 2020!

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">22</span>
<span class="rest">Mar 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/from-gke-to-civo-k3s/">Migrating from GKE to Civo&#39;s K3s</a></h3>
<span class="description">

My free trial on GKE was ending in 2 days and I had to find a way to migrate away. I decided to switch to Civo&#39;s managed K3s.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">27</span>
<span class="rest">Feb 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/you-should-write-comments/">You should write comments</a></h3>
<span class="description">

We often talk about avoiding unecessary comments that needlessly paraphrase what the code does. In this article, I gathered some thoughts about why writing comments is as important as writing the code itself.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">26</span>
<span class="rest">Jan 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/debugging-kubernetes-networking/">Debugging Kubernetes Networking: my kube-dns is not working!</a></h3>
<span class="description">

Some pods were unable to connect to the kube-proxy pod on one of my GKE Kubernetes clusters. This post present an in-depth investigation using tcpdump, wireshark and iptables tracing.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">20</span>
<span class="rest">Jan 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/avoid-gke-lb-with-hostport/">Avoid GKE&#39;s expensive load balancer by using hostPort</a></h3>
<span class="description">

I want to avoid using the expensive Google Network Load Balancer and instead do the load balancing in-cluster using akrobateo, which acts as a LoadBalancer controller.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">06</span>
<span class="rest">Jan 2020</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/go-ignores-proxy-localhost/">What to do when Go ignores HTTP_PROXY for 127.0.0.1</a></h3>
<span class="description">

At some point, the Go team chose to disable the proxy for requests coming from localhost or 127.0.0.1. This is annoying when debugging services locally.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">23</span>
<span class="rest">Nov 2019</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/go-happy-line-of-sight/">Go Happy Path: the Unindented Line of Sight</a></h3>
<span class="description">

Readability is a property we all love about Go. In other languages, it might be fine to have a lot of nested if statements; in Go, it is a good practice to keep away from overly-nested logic.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">13</span>
<span class="rest">Nov 2019</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/go111module-everywhere/">Why is GO111MODULE everywhere, and everything about Go Modules</a></h3>
<span class="description">

GO111MODULE is all over the place. It appears in README install instructions, in Dockerfiles, in makefiles. On top of that, the behavior of GO111MODULE has changed from Go 1.11 to 1.12, changed again with 1.13 and will changed a last time in 1.14.

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">12</span>
<span class="rest">Nov 2019</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/kubernetes-conditions/">What the heck are Conditions in Kubernetes controllers?</a></h3>
<span class="description">

Although progress is being made, Kubernetes controllers and operators still require prior knowledge about Kubernetes internals. Information on how to set the status is scattered across comments, issues, PRs and the Kubernetes code itself. Conditions may be a good solution for your controller, but for what?

</span>
</div>
</div>
</div>

<div class="post">
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">01</span>
<span class="rest">Jan 1</span>
</div>
</div>
<div class="matter">
<h3 class="title small"><a href="/do-not-share-yet/packets-eye-kubernetes-service/">The Packet&#39;s-Eye View of a Kubernetes Service</a></h3>
<span class="description">

The Service and Ingress respectively brings L4 and L7 traffics to your pods. In this article, I focus on how traffic flows in and what are the interactions between the ingress controller and the service-lb controller (the thing that creates the external load balancer). I also detail how the `hostPort` approach shapes traffic.

</span>
</div>
</div>
</div>




</div>

</main><footer>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-88710120-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</footer>
</body>
</html>
