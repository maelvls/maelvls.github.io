<!DOCTYPE html>
<html lang="en"><head>

  <meta name="generator" content="Hugo 0.147.6">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Ma√´l Valais"><meta name="description" content=""><meta property="og:url" content="https://maelvls.dev/do-not-share-yet/go-flaky-test/">
  <meta property="og:site_name" content="maelvls dev blog">
  <meta property="og:title" content="Go Flaky Test">
  <meta property="og:description" content="Debugging a flaky test go test does not allow you to run a single test many times in parallel. If your test takes 10 seconds (in our case, it had to spin up an apiserver for every test case), and that you want to run this test 100 times, it will take 16 minutes. The flags -count, -cpu, -parallel and the function t.Parallel only work for tests in separate packages. Multiple instances of a single test never run in parallel with each other. parallel &#34;go test ./test/integration/ -count=1&#34; ::: {1..100}">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="2021">
    <meta property="article:published_time" content="2021-09-02T15:07:38+02:00">
    <meta property="article:modified_time" content="2021-09-02T15:07:38+02:00">
    <meta property="og:image" content="https://maelvls.dev/do-not-share-yet/go-flaky-test/cover-go-flaky-test.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://maelvls.dev/do-not-share-yet/go-flaky-test/cover-go-flaky-test.png">
  <meta name="twitter:title" content="Go Flaky Test">
  <meta name="twitter:description" content="Debugging a flaky test go test does not allow you to run a single test many times in parallel. If your test takes 10 seconds (in our case, it had to spin up an apiserver for every test case), and that you want to run this test 100 times, it will take 16 minutes. The flags -count, -cpu, -parallel and the function t.Parallel only work for tests in separate packages. Multiple instances of a single test never run in parallel with each other. parallel &#34;go test ./test/integration/ -count=1&#34; ::: {1..100}">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/normalize.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/main.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/all.css" />
<link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/maelvls.css" /><title>Go Flaky Test | maelvls dev blog</title></head>
<body>

<header>

  <div id="avatar">
    <a href="https://maelvls.dev/do-not-share-yet/">
      <img src="/img/mael.jpg" alt="maelvls dev blog">
    </a>
  </div>

  <div id="titletext"><h2 id="title"><a href="https://maelvls.dev/do-not-share-yet/">maelvls dev blog</a></h2></div>
  <div id="title-description"><p id="subtitle">Systems software engineer. I write mostly about Kubernetes and Go. <a href="/about/">About</a></p><div id=social>
    <nav>
      <ul><li><a href="https://github.com/maelvls"><i title="Github" class="icons fab fa-github"></i></a></li><li><a href="https://x.com/maelvls"><i title="X" class="icons fab fa-x"></i></a></li><li><a href="https://dev.to/maelvls"><i title="Ma√´l Valais&#39;s DEV Community Profile" class="icons fab fa-dev"></i></a></li></ul>
    </nav>
  </div>
  </div>
  <div id="mainmenu">
	
  </div>
</header>
<main><div class="post">
    <div class="author">
        
    </div>
    <div class="post-header">
        
        <div class="meta">
            <div class="date">
                <span class="day">02</span>
                <span class="rest">
                    
                    Sep2021
                    
                </span>
            </div>
        </div>
        
        <div class="matter">
            <h1 class="title">Go Flaky Test</h1>
        </div>
        
    </div>
    <div class="markdown">
        <h2 id="debugging-a-flaky-test">Debugging a flaky test</h2>
<ul>
<li><code>go test</code> does not allow you to run a single test many times in parallel. If
your test takes 10 seconds (in our case, it had to spin up an apiserver for
every test case), and that you want to run this test 100 times, it will take
16 minutes. The flags <code>-count</code>, <code>-cpu</code>, <code>-parallel</code> and the function
<code>t.Parallel</code> only work for tests in separate packages. Multiple instances of a
single test never run in parallel with each other.</li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">parallel <span class="s2">&#34;go test ./test/integration/ -count=1&#34;</span> ::: <span class="o">{</span>1..100<span class="o">}</span>
</span></span></code></pre></div></li>
</ul>

    </div>
    <a href="https://github.com/maelvls/maelvls.github.io/edit/source/content/2021/go-flaky-test/index.md">üìù Edit this page</a>
    <div class="tags">
        
        
        
        
        
        
        
        
        
    </div>
    

<script
  src="https://utteranc.es/client.js"
  repo="maelvls/maelvls.github.io"
  issue-term="pathname"
  label="üí¨"
  theme="github-light"
  crossorigin="anonymous"
  async
></script>
</div>

</main><footer>
    
</footer></body>
</html>
