<!DOCTYPE html>
<html lang="en"><head>

  <meta name="generator" content="Hugo 0.147.6">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Maël Valais"><meta name="keywords" content="networking,windows"><meta name="description" content=""><meta property="og:url" content="https://maelvls.dev/do-not-share-yet/missing-gateway-windows/">
  <meta property="og:site_name" content="maelvls dev blog">
  <meta property="og:title" content="Missing Gateway on Windows">
  <meta property="og:description" content="packet was coming as
Incoming packet:
src: 10.8.8.10 dst: 10.4.0.2 The Windows VM receives the packet on nic2. IIS, which is listening on all interfaces, handles the connection and sends the response to 10.8.8.10.
The Windows IP stack looks at its routes:
C:\&gt; route print IPv4 Route Table =========================================================================== Active Routes: Network Destination Netmask Gateway Interface Metric 0.0.0.0 0.0.0.0 10.132.0.1 10.132.0.13 5 0.0.0.0 0.0.0.0 10.4.0.1 10.4.0.2 261 10.4.0.0 255.255.240.0 On-link 10.4.0.2 261 10.4.0.2 255.255.255.255 On-link 10.4.0.2 261 10.4.15.255 255.255.255.255 On-link 10.4.0.2 261 10.132.0.0 255.255.240.0 10.132.0.1 10.132.0.13 6 10.132.0.1 255.255.255.255 On-link 10.132.0.13 6 10.132.0.13 255.255.255.255 On-link 10.132.0.13 261 =========================================================================== Persistent Routes: Network Address Netmask Gateway Address Metric 169.254.169.254 255.255.255.255 On-link 1 0.0.0.0 0.0.0.0 10.4.0.1 Default ===========================================================================">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="2021">
    <meta property="article:published_time" content="2021-02-27T14:20:21+02:00">
    <meta property="article:modified_time" content="2021-02-27T14:20:21+02:00">
    <meta property="article:tag" content="Networking">
    <meta property="article:tag" content="Windows">
    <meta property="og:image" content="https://maelvls.dev/do-not-share-yet/missing-gateway-windows/cover-missing-gateway-windows.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://maelvls.dev/do-not-share-yet/missing-gateway-windows/cover-missing-gateway-windows.png">
  <meta name="twitter:title" content="Missing Gateway on Windows">
  <meta name="twitter:description" content="packet was coming as
Incoming packet:
src: 10.8.8.10 dst: 10.4.0.2 The Windows VM receives the packet on nic2. IIS, which is listening on all interfaces, handles the connection and sends the response to 10.8.8.10.
The Windows IP stack looks at its routes:
C:\&gt; route print IPv4 Route Table =========================================================================== Active Routes: Network Destination Netmask Gateway Interface Metric 0.0.0.0 0.0.0.0 10.132.0.1 10.132.0.13 5 0.0.0.0 0.0.0.0 10.4.0.1 10.4.0.2 261 10.4.0.0 255.255.240.0 On-link 10.4.0.2 261 10.4.0.2 255.255.255.255 On-link 10.4.0.2 261 10.4.15.255 255.255.255.255 On-link 10.4.0.2 261 10.132.0.0 255.255.240.0 10.132.0.1 10.132.0.13 6 10.132.0.1 255.255.255.255 On-link 10.132.0.13 6 10.132.0.13 255.255.255.255 On-link 10.132.0.13 261 =========================================================================== Persistent Routes: Network Address Netmask Gateway Address Metric 169.254.169.254 255.255.255.255 On-link 1 0.0.0.0 0.0.0.0 10.4.0.1 Default ===========================================================================">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/normalize.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/main.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/all.css" />
<link rel="stylesheet" type="text/css" media="screen" href="https://maelvls.dev/do-not-share-yet/css/maelvls.css" /><title>Missing Gateway on Windows | maelvls dev blog</title></head>
<body>

<header>

  <div id="avatar">
    <a href="https://maelvls.dev/do-not-share-yet/">
      <img src="/img/mael.jpg" alt="maelvls dev blog">
    </a>
  </div>

  <div id="titletext"><h2 id="title"><a href="https://maelvls.dev/do-not-share-yet/">maelvls dev blog</a></h2></div>
  <div id="title-description"><p id="subtitle">Systems software engineer. I write mostly about Kubernetes and Go. <a href="/about/">About</a></p><div id=social>
    <nav>
      <ul><li><a href="https://github.com/maelvls"><i title="Github" class="icons fab fa-github"></i></a></li><li><a href="https://x.com/maelvls"><i title="X" class="icons fab fa-x"></i></a></li><li><a href="https://dev.to/maelvls"><i title="Maël Valais&#39;s DEV Community Profile" class="icons fab fa-dev"></i></a></li></ul>
    </nav>
  </div>
  </div>
  <div id="mainmenu">
	
  </div>
</header>
<main><div class="post">
    <div class="author">
        
    </div>
    <div class="post-header">
        
        <div class="meta">
            <div class="date">
                <span class="day">27</span>
                <span class="rest">
                    
                    Feb2021
                    
                </span>
            </div>
        </div>
        
        <div class="matter">
            <h1 class="title">Missing Gateway on Windows</h1>
        </div>
        
    </div>
    <div class="markdown">
        <p>packet was coming as</p>
<p>Incoming packet:</p>
<pre><code>src: 10.8.8.10
dst: 10.4.0.2
</code></pre>
<p>The Windows VM receives the packet on <code>nic2</code>. IIS, which is listening on all
interfaces, handles the connection and sends the response to 10.8.8.10.</p>
<p>The Windows IP stack looks at its routes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; route print
</span></span><span class="line"><span class="cl">IPv4 Route Table
</span></span><span class="line"><span class="cl">===========================================================================
</span></span><span class="line"><span class="cl">Active Routes:
</span></span><span class="line"><span class="cl">Network Destination        Netmask          Gateway       Interface  Metric
</span></span><span class="line"><span class="cl">          0.0.0.0          0.0.0.0       10.132.0.1      10.132.0.13      5
</span></span><span class="line"><span class="cl">          0.0.0.0          0.0.0.0         10.4.0.1         10.4.0.2    261
</span></span><span class="line"><span class="cl">         10.4.0.0    255.255.240.0         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">         10.4.0.2  255.255.255.255         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">      10.4.15.255  255.255.255.255         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">       10.132.0.0    255.255.240.0       10.132.0.1      10.132.0.13      6
</span></span><span class="line"><span class="cl">       10.132.0.1  255.255.255.255         On-link       10.132.0.13      6
</span></span><span class="line"><span class="cl">      10.132.0.13  255.255.255.255         On-link       10.132.0.13    261
</span></span><span class="line"><span class="cl">===========================================================================
</span></span><span class="line"><span class="cl">Persistent Routes:
</span></span><span class="line"><span class="cl">  Network Address          Netmask  Gateway Address  Metric
</span></span><span class="line"><span class="cl">  169.254.169.254  255.255.255.255         On-link        1
</span></span><span class="line"><span class="cl">          0.0.0.0          0.0.0.0         10.4.0.1  Default
</span></span><span class="line"><span class="cl">===========================================================================
</span></span></code></pre></div><p><img src="remmina_Quick%20Connect_localhost_2021812-2141.png" alt=""></p>
<p>The response IP headers:</p>
<pre><code>src: 10.4.0.2
dst: 10.8.8.10
</code></pre>
<p>Since the address <code>10.8.8.10</code> is</p>
<p>When the nic 2 has an empty gateway:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; route print
</span></span><span class="line"><span class="cl">IPv4 Route Table
</span></span><span class="line"><span class="cl">===========================================================================
</span></span><span class="line"><span class="cl">Active Routes:
</span></span><span class="line"><span class="cl">Network Destination        Netmask          Gateway       Interface  Metric
</span></span><span class="line"><span class="cl">          0.0.0.0          0.0.0.0       10.132.0.1      10.132.0.13      5
</span></span><span class="line"><span class="cl">         10.4.0.0    255.255.240.0         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">         10.4.0.2  255.255.255.255         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">      10.4.15.255  255.255.255.255         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">       10.132.0.0    255.255.240.0       10.132.0.1      10.132.0.13      6
</span></span><span class="line"><span class="cl">       10.132.0.1  255.255.255.255         On-link       10.132.0.13      6
</span></span><span class="line"><span class="cl">      10.132.0.13  255.255.255.255         On-link       10.132.0.13    261
</span></span><span class="line"><span class="cl">        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
</span></span><span class="line"><span class="cl">        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
</span></span><span class="line"><span class="cl">  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
</span></span><span class="line"><span class="cl">  169.254.169.254  255.255.255.255         On-link       10.132.0.13      6
</span></span><span class="line"><span class="cl">  169.254.169.254  255.255.255.255         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
</span></span><span class="line"><span class="cl">        224.0.0.0        240.0.0.0         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">        224.0.0.0        240.0.0.0         On-link       10.132.0.13    261
</span></span><span class="line"><span class="cl">  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
</span></span><span class="line"><span class="cl">  255.255.255.255  255.255.255.255         On-link          10.4.0.2    261
</span></span><span class="line"><span class="cl">  255.255.255.255  255.255.255.255         On-link       10.132.0.13    261
</span></span><span class="line"><span class="cl">===========================================================================
</span></span><span class="line"><span class="cl">Persistent Routes:
</span></span><span class="line"><span class="cl">  Network Address          Netmask  Gateway Address  Metric
</span></span><span class="line"><span class="cl">  169.254.169.254  255.255.255.255         On-link        1
</span></span><span class="line"><span class="cl">===========================================================================
</span></span></code></pre></div><p><img src="remmina_Quick%20Connect_localhost_2021812-21538.png" alt=""></p>
<p>Hypotheses:</p>
<ol>
<li>The packet arrives into the VM but the TCP connection cannot be initiated.</li>
<li>The reason the TCP connection cannot be initiated is that Windows fails sending an ACK packet because it does not have a gateway IP set for this network card.</li>
<li>The ACK cannot be sent because Windows does not find an entry for 10.8.8.10 in its ARP table, and since no gateway is set, it cannot figure out to which MAC address the ACK packet should be addressed.</li>
</ol>
<p>Is it the same on Linux?</p>

    </div>
    <a href="https://github.com/maelvls/maelvls.github.io/edit/source/content/2021/windows-missing-gateway/index.md">📝 Edit this page</a>
    <div class="tags">
        
        
        
        
        
        
        
        
        
        
        <div style="float: right;">
            <p>Tags:
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <a href="/tags/networking/"> networking </a>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <a href="/tags/windows/"> windows </a>
                
                
                
                
                
                
                
        </div>
        <div class="clearit"></div>
        
        
        
        
        
    </div></div>

</main><footer>
    
</footer></body>
</html>
